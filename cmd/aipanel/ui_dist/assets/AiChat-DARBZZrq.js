import{d as Ge,e as b,D as Xe,I as ge,i as Ye,c as l,f as j,n as Qe,s as O,a as I,w as B,S as Ze,b as i,t as g,F as T,m as N,k as f,h as P,p as et,G as tt,g as _e,z as ke,H as V,r as z,o as a,j as ye,q as st}from"./index-LpQpIgge.js";import{n as nt,i as ee,o as at,p as lt,q as ae}from"./index-BclxA8EE.js";import{_ as ot}from"./_plugin-vue_export-helper-DlAUqK2U.js";const it={key:0,class:"drag-overlay"},rt={key:0,class:"running-tasks-banner"},ut={key:0,class:"resumed-list"},ct={key:0,class:"history-loading"},dt={key:1,class:"chat-empty"},pt={key:0,class:"welcome-msg"},ft={key:1,class:"examples"},ht=["onClick"],vt={key:0,class:"msg-row user"},mt={class:"msg-bubble user"},gt={key:0,class:"msg-images"},_t=["src","onClick"],kt={class:"msg-text"},yt={key:1,class:"msg-row assistant"},xt={class:"msg-col"},bt=["open"],Ct={class:"thinking-summary"},wt={class:"thinking-len"},St={class:"thinking-content"},$t={key:1,class:"tool-timeline"},It=["onClick"],Tt={class:"tool-step-header"},Dt={key:0,class:"tool-spin"},Mt={key:1},Nt={key:2},jt={key:3},Ft={class:"tool-step-icon"},Ot={class:"tool-step-name"},Ut={key:0,class:"tool-step-summary"},At={key:1,class:"tool-step-dur"},Rt={key:0},Bt={key:1},Lt={key:2},Et={key:3},Jt={key:4},Pt={class:"tool-step-chevron"},zt={key:0,class:"tool-section"},qt={class:"tool-pre"},Ht={key:1,class:"tool-section"},Kt={class:"tool-pre result"},Vt=["src","onClick"],Wt={class:"msg-bubble assistant"},Gt=["innerHTML"],Xt={key:1,class:"apply-card"},Yt={class:"apply-preview"},Qt={class:"apply-key"},Zt={class:"apply-val"},es=["onClick"],ts={class:"msg-actions"},ss=["onClick","title"],ns=["onClick"],as=["onClick"],ls={key:2,class:"option-chips"},os=["onClick"],is={key:2,class:"msg-row system"},rs={class:"msg-system"},us={key:2,class:"msg-row assistant"},cs={class:"msg-col"},ds={key:0,class:"thinking-block",open:""},ps={class:"thinking-summary"},fs={class:"thinking-content"},hs={key:1,class:"tool-timeline"},vs=["onClick"],ms={class:"tool-step-header"},gs={key:0,class:"tool-spin"},_s={key:1},ks={key:2},ys={class:"tool-step-icon"},xs={class:"tool-step-name"},bs={key:0,class:"tool-step-summary"},Cs={key:1,class:"tool-step-dur"},ws={key:0},Ss={key:1},$s={key:2},Is={key:3},Ts={key:4},Ds={class:"tool-step-chevron"},Ms={key:0,class:"tool-section"},Ns={class:"tool-pre"},js={key:1,class:"tool-section"},Fs={class:"tool-pre result"},Os=["src","onClick"],Us={key:2,class:"msg-bubble assistant"},As={key:0,class:"typing-dots"},Rs=["innerHTML"],Bs={key:2,class:"blink"},Ls=["src"],Es={class:"chat-input-area"},Js={key:0,class:"attachments-bar"},Ps=["src"],zs=["onClick"],qs={class:"attach-file-icon"},Hs={class:"attach-file-name"},Ks={class:"attach-file-size"},Vs=["onClick"],Ws={class:"input-row"},Gs={class:"textarea-wrap"},Xs=["placeholder","disabled","onKeydown"],Ys={class:"input-actions"},Qs={class:"icon-btn",title:"é™„åŠ æ–‡ä»¶ï¼ˆå›¾ç‰‡/ä»£ç /æ–‡æœ¬ï¼‰"},Zs=["disabled"],en={key:0,class:"spinner"},tn={key:1},sn=Ge({__name:"AiChat",props:{agentId:{},sessionId:{},context:{},scenario:{},skillId:{},placeholder:{},welcomeMessage:{},examples:{default:()=>[]},showThinking:{type:Boolean,default:!1},compact:{type:Boolean,default:!1},bgColor:{},height:{},initialMessages:{},applyable:{type:Boolean,default:!1}},emits:["message","response","apply","session-change","streaming-change"],setup(D,{expose:xe,emit:be}){const x=D,L=be,m=b(x.initialMessages?[...x.initialMessages]:[]),E=b(""),U=b([]),A=b([]),_=b(!1);Xe(_,s=>L("streaming-change",s));const C=b(""),M=b(""),w=b([]),q=st(new Map),R=b([]);let S=null;const le=ke(()=>{let s=0;for(const e of m.value)for(const n of e.toolCalls??[])n.taskId&&n.taskStatus&&!["done","error","killed"].includes(n.taskStatus)&&s++;return s+=R.value.filter(e=>!["done","error","killed"].includes(e.status)).length,s}),H=b(!1);let K=0;const W=b(null),G=b(""),k=b(x.sessionId),J=b(!1),X=b(),F=b(),Ce=ke(()=>({height:x.height??"100%","--bg":x.bgColor??"transparent"}));function oe(){S||(S=setInterval(we,3e3))}async function we(){if(q.size===0&&R.value.every(u=>["done","error","killed"].includes(u.status))){S&&(clearInterval(S),S=null);return}const e=[];let n=!1;for(const[u,c]of q)try{const t=(await ae.get(c)).data;for(const r of m.value){const o=r.toolCalls?.find(h=>h.id===u);if(o){const h=!["done","error","killed"].includes(o.taskStatus??"");o.taskStatus=t.status,["done","error","killed"].includes(t.status)&&(e.push(u),h&&(n=!0))}}}catch{e.push(u),n=!0}for(const u of e)q.delete(u);let d=!1;for(const u of R.value)if(!["done","error","killed"].includes(u.status))try{const c=await ae.get(u.id),p=u.status;u.status=c.data.status,["done","error","killed"].includes(u.status)&&p!==u.status&&(d=!0)}catch{u.status="error",d=!0}if(!(q.size>0||R.value.some(u=>!["done","error","killed"].includes(u.status)))&&S&&(clearInterval(S),S=null),(d||n)&&k.value&&!_.value){const u=k.value;setTimeout(async()=>{if(!_.value&&k.value===u)try{const c=await ee.get(x.agentId,u);if(_.value||k.value!==u)return;const p=c.data.messages??[],t=[];p.some(r=>r.isCompact||r.role==="compaction")&&t.push({role:"system",text:"æ›´æ—©çš„å†…å®¹å·²å‹ç¼©"});for(const r of p)r.role!=="compaction"&&t.push({role:r.role,text:r.text,toolCalls:r.toolCalls?.map(o=>({id:o.id,name:o.name,input:o.input,result:o.result,status:"done",_expanded:!1}))});m.value=t,y()}catch{}},1500)}}ge(()=>{S&&(clearInterval(S),S=null)});async function Se(s){try{const n=(await ae.list({sessionId:s})).data,d=n.filter(u=>!["done","error","killed"].includes(u.status));if(n.filter(u=>["done","error","killed"].includes(u.status)).length>0&&setTimeout(async()=>{if(!_.value&&k.value===s)try{const u=await ee.get(x.agentId,s);if(_.value||k.value!==s)return;const c=u.data.messages??[],p=[];c.some(t=>t.isCompact||t.role==="compaction")&&p.push({role:"system",text:"æ›´æ—©çš„å†…å®¹å·²å‹ç¼©"});for(const t of c)t.role!=="compaction"&&p.push({role:t.role,text:t.text,toolCalls:t.toolCalls?.map(r=>({id:r.id,name:r.name,input:r.input,result:r.result,status:"done",_expanded:!1}))});m.value=p,y()}catch{}},500),d.length===0)return;R.value=d.map(u=>({id:u.id,label:u.label||u.id.slice(0,8),status:u.status})),oe()}catch{}}function y(){V(()=>{X.value&&(X.value.scrollTop=X.value.scrollHeight)})}function $e(){F.value&&(F.value.style.height="auto",F.value.style.height=Math.min(F.value.scrollHeight,160)+"px")}function Y(s){E.value=s,V(()=>F.value?.focus())}function ie(s){try{return JSON.stringify(JSON.parse(s),null,2)}catch{return s}}function Ie(s){navigator.clipboard?.writeText(s);const e=m.value.findIndex(n=>n.text===s);W.value=e,setTimeout(()=>{W.value=null},1500)}function Te(s){for(let e=s-1;e>=0;e--){const n=m.value[e];if(n&&n.role==="user"){const d=n.text,v=n.images??[];m.value.splice(e,m.value.length-e),ne(d,v);return}}}function te(s){G.value=s}function re(s){return s?s.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/```(\w*)\n([\s\S]*?)```/g,(n,d,v)=>`<pre class="code-block${d?" lang-"+d:""}"><code>${v}</code></pre>`).replace(/`([^`]+)`/g,'<code class="inline-code">$1</code>').replace(/\*\*(.+?)\*\*/g,"<strong>$1</strong>").replace(/\*(.+?)\*/g,"<em>$1</em>").replace(/\[(.+?)\]\((https?:\/\/[^\)]+)\)/g,'<a href="$2" target="_blank" rel="noopener">$1</a>').replace(/^### (.+)$/gm,"<h3>$1</h3>").replace(/^## (.+)$/gm,"<h2>$1</h2>").replace(/^# (.+)$/gm,"<h1>$1</h1>").replace(/^[-*] (.+)$/gm,"<li>$1</li>").replace(/^\d+\. (.+)$/gm,"<li>$1</li>").replace(/(<li>[\s\S]+?<\/li>)(\n(?!<li>)|$)/g,"<ul>$1</ul>$2").replace(/([^>])\n([^<])/g,"$1<br>$2"):""}function De(s){const e=s.split(`
`),n=[],d=/^([ğŸ™ğŸ˜„ğŸŒğŸ›ğŸ“šğŸ¨ğŸ’¼ğŸ¤–âš½ğŸ¯âœ…âŒğŸ”¥ğŸ’¡ğŸğŸš€ğŸŒŸğŸ’ğŸªğŸ­ğŸ¬ğŸ¤]|[\u{1F300}-\u{1FFFF}]|[\u{2600}-\u{27BF}])\s+(.{4,40})/u;for(const v of e){const u=v.replace(/^[-*â€¢]\s*/,"").trim();if(u.match(d)){const p=u.replace(/[ï¼š:ã€‚ï¼Œ,]$/,"").trim();p.length>=5&&n.push(p)}}return n.slice(0,5)}function Me(s){return s?/\{[\s\S]{30,}\}/.test(s)&&(s.includes('"name"')||s.includes('"identity"')||s.includes('"soul"')||s.includes('"IDENTITY"')||s.includes('"SOUL"')):!1}function Ne(s){const e=ce(s.text);e?(m.value.forEach(n=>{n!==s&&n.applyData&&delete n.applyData}),s.applyData=e,V(()=>L("apply",e))):alert("æœªèƒ½ä»æ¶ˆæ¯ä¸­æå–åˆ°é…ç½® JSONï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶")}function ue(s,e=0){const n=s.indexOf("{",e);if(n===-1)return null;let d=0,v=!1,u=!1;for(let c=n;c<s.length;c++){const p=s[c];if(u){u=!1;continue}if(p==="\\"&&v){u=!0;continue}if(p==='"'){v=!v;continue}if(!v){if(p==="{")d++;else if(p==="}"&&(d--,d===0))return{raw:s.slice(n,c+1),end:c+1}}}return null}function ce(s){const e=/```(?:json)?\s*\n?([\s\S]*?)```/g,n=[];let d;for(;(d=e.exec(s))!==null;){const c=(d[1]??"").trim();c.startsWith("{")&&n.push(c)}for(let c=n.length-1;c>=0;c--){const p=n[c],t=ue(p);if(!t)continue;const r=Q(t.raw)??Q(de(t.raw));if(r)return r}const v=[];let u=0;for(;u<s.length;){const c=ue(s,u);if(!c)break;v.push(c.raw),u=c.end}for(let c=v.length-1;c>=0;c--){const p=v[c],t=Q(p)??Q(de(p));if(t)return t}return null}function Q(s){try{const e=JSON.parse(s);if(e&&typeof e=="object"&&!Array.isArray(e)){const n=["name","id","description","identity","soul","IDENTITY","SOUL","NAME","DESCRIPTION"];if(Object.keys(e).some(d=>n.includes(d)))return e}}catch{}return null}function de(s){let e="",n=!1,d=!1;for(let v=0;v<s.length;v++){const u=s[v];if(d){e+=u,d=!1;continue}if(u==="\\"&&n){e+=u,d=!0;continue}if(u==='"'){n=!n,e+=u;continue}if(n&&u===`
`){e+="\\n";continue}if(n&&u==="\r"){e+="\\r";continue}e+=u}return e}const je={exec:"âš¡",bash:"âš¡",read:"ğŸ“–",write:"âœï¸",edit:"âœï¸",web_search:"ğŸŒ",web_fetch:"ğŸŒ",browser:"ğŸŒ",agent_spawn:"ğŸš€",agent_tasks:"ğŸ“‹",agent_kill:"ğŸ›‘",agent_result:"ğŸ“Š",project_read:"ğŸ“",project_write:"ğŸ“",project_list:"ğŸ“",project_create:"ğŸ“",project_glob:"ğŸ“",memory_search:"ğŸ§ ",memory_get:"ğŸ§ ",image:"ğŸ–¼ï¸",tts:"ğŸ”Š",show_image:"ğŸ–¼ï¸",cron:"â±ï¸"};function pe(s){return je[s]??"âš™ï¸"}function fe(s,e){try{const n=JSON.parse(e);if(s==="exec"||s==="bash")return(n.command??"").slice(0,60);if(s==="read")return n.file_path??n.path??"";if(s==="write")return(n.file_path??n.path??"")+(n.content?` (${n.content.length}B)`:"");if(s==="edit")return n.file_path??n.path??"";if(s==="web_search")return n.query??"";if(s==="web_fetch")return n.url??"";if(s==="agent_spawn")return`â†’ ${n.agentId}: ${(n.task??"").slice(0,40)}`;if(s==="project_read"||s==="project_write")return n.path??"";if(s==="memory_search")return n.query??"";if(s==="show_image")return(n.path??"").split("/").pop()??""}catch{}return""}const Fe=new Set(["txt","md","markdown","js","ts","jsx","tsx","vue","go","py","rs","java","kt","swift","html","css","scss","less","json","yaml","yml","toml","ini","cfg","env","sh","bash","zsh","fish","ps1","bat","cmd","dockerfile","makefile","sql","graphql","proto","xml","svg","gitignore","gitattributes"]);function he(s){const e=s.split(".").pop()?.toLowerCase()??"";return Fe.has(e)}function Oe(s){const e=s.split(".").pop()?.toLowerCase()??"";return{js:"ğŸŸ¨",ts:"ğŸ”µ",vue:"ğŸ’š",go:"ğŸ¹",py:"ğŸ",rs:"ğŸ¦€",html:"ğŸŒ",css:"ğŸ¨",json:"ğŸ“‹",md:"ğŸ“",sh:"âš¡",sql:"ğŸ—„ï¸",yaml:"âš™ï¸",yml:"âš™ï¸",dockerfile:"ğŸ³"}[e]??"ğŸ“„"}function Ue(s){return s<1024?`${s}B`:s<1024*1024?`${(s/1024).toFixed(1)}KB`:`${(s/1024/1024).toFixed(1)}MB`}function Ae(s){const e=s.clipboardData?.items;if(e){for(const n of Array.from(e))if(n.type.startsWith("image/")){s.preventDefault();const d=n.getAsFile();d&&se(d)}}}function Re(s){s.preventDefault(),K++,H.value=!0}function Be(s){s.preventDefault(),K--,K<=0&&(K=0,H.value=!1)}function Le(s){K=0,H.value=!1;const e=s.dataTransfer?.files;if(e)for(const n of Array.from(e))n.type.startsWith("image/")?se(n):he(n.name)&&ve(n)}function Ee(s){const e=s.target.files;if(e){for(const n of Array.from(e))n.type.startsWith("image/")?se(n):he(n.name)&&ve(n);s.target.value=""}}function ve(s){const e=new FileReader;e.onload=()=>{typeof e.result=="string"&&A.value.push({name:s.name,content:e.result})},e.readAsText(s)}function se(s){const e=new FileReader;e.onload=()=>{typeof e.result=="string"&&U.value.push(e.result)},e.readAsDataURL(s)}function Je(s){U.value.splice(s,1)}function Z(){const s=E.value.trim(),e=[...U.value],n=[...A.value];if(!s&&!e.length&&!n.length||_.value)return;let d=s;if(n.length>0){const v=n.map(u=>{const c=u.name.split(".").pop()??"text";return`

ğŸ“ **${u.name}**
\`\`\`${c}
${u.content}
\`\`\``}).join("");d=s?s+v:v.trimStart()}E.value="",U.value=[],A.value=[],V(()=>{F.value&&(F.value.style.height="auto")}),L("message",d,e),ne(d,e)}function ne(s,e,n=!1){n||(m.value.push({role:"user",text:s,images:e.length?e:void 0}),y()),_.value=!0,C.value="",M.value="",w.value=[];const d={role:"assistant",text:"",toolCalls:[]};m.value.push(d),n&&y();const v=m.value.length-1;let u="",c;if(k.value)c=void 0;else{const t=m.value.slice(0,-1).filter(r=>(r.role==="user"||r.role==="assistant")&&r.text).slice(-20).map(r=>({role:r.role,content:r.text}));c=t.length>0?t:void 0}const p={sessionId:k.value,context:x.context,scenario:x.scenario,skillId:x.skillId,images:e.length?e:void 0,history:c};nt(x.agentId,s,t=>{switch(t.type){case"thinking_delta":M.value+=t.text,y();break;case"text":case"text_delta":C.value+=t.text,y();break;case"tool_call":{const r={id:t.tool_call?.id??String(Date.now()),name:t.tool_call?.name??"tool",input:t.tool_call?.input?JSON.stringify(t.tool_call.input):void 0,status:"running",_startedAt:Date.now(),_expanded:!1};m.value[v].toolCalls.push(r),w.value.push(r),u=r.id,y();break}case"tool_result":{const r=m.value[v].toolCalls?.find(o=>o.id===u);if(r){if(r.result=t.text,r.status="done",r._startedAt){const h=Date.now()-r._startedAt;r.duration=h<1e3?`${h}ms`:`${(h/1e3).toFixed(1)}s`}if(t.text){const h=t.text.match(/\[media:([^\]]+)\]/);if(h){const $=h[1],We=localStorage.getItem("aipanel_token")??"";r.mediaUrl=`/api/media?path=${encodeURIComponent($)}&token=${encodeURIComponent(We)}`}}if(r.name==="agent_spawn"&&t.text){const h=t.text.match(/ä»»åŠ¡\s*ID[ï¼š:]\s*([a-f0-9-]{8,})/i);h&&(r.taskId=h[1],r.taskStatus="pending",q.set(u,h[1]),oe())}const o=w.value.find(h=>h.id===u);o&&(o.result=r.result,o.status="done",o.duration=r.duration)}y();break}case"done":case"error":{if(t.type==="done"&&t.sessionId){const h=!k.value;k.value=t.sessionId,h&&L("session-change",t.sessionId)}const r=m.value[v];if(r.text=C.value,r.thinking=M.value||void 0,x.applyable){const h=ce(C.value);h&&(m.value.forEach($=>{$!==r&&$.applyData&&delete $.applyData}),r.applyData=h)}const o=De(C.value);if(o.length>=2&&(r.options=o),t.type==="error"){r.text=`[é”™è¯¯] ${t.error}`;const h=r.toolCalls?.find($=>$.status==="running");h&&(h.status="error")}_.value=!1,C.value="",M.value="",w.value=[],L("response",r.text),y();break}}},p)}function Pe(){m.value=[]}function ze(s){m.value.push(s),y()}async function qe(s){k.value=s,m.value=[],J.value=!0;const e=s;try{const n=await ee.get(x.agentId,s);if(k.value!==e)return;const d=n.data.messages??[],v=[];d.some(c=>c.isCompact||c.role==="compaction")&&v.push({role:"system",text:"æ›´æ—©çš„å†…å®¹å·²å‹ç¼©"});for(const c of d)c.role!=="compaction"&&v.push({role:c.role,text:c.text,toolCalls:c.toolCalls?.map(p=>({id:p.id,name:p.name,input:p.input,result:p.result,status:"done",_expanded:!1}))});m.value=v,y(),Se(s),me(s)}catch(n){n?.response?.status===404?m.value=[]:(console.error("[AiChat] resumeSession failed",n),m.value=[{role:"system",text:"å†å²åŠ è½½å¤±è´¥ï¼Œç»§ç»­å¯¹è¯ä»å¯æ¥ç»­"}])}finally{J.value=!1}}async function me(s){if(_.value)return;const e=await at(x.agentId,s);if(k.value!==s||!e.hasWorker)return;if(e.status!=="generating"){const c=async()=>{if(!_.value)try{const p=await ee.get(x.agentId,s);if(_.value||k.value!==s)return;const t=p.data.messages??[],r=[];t.some(o=>o.isCompact||o.role==="compaction")&&r.push({role:"system",text:"æ›´æ—©çš„å†…å®¹å·²å‹ç¼©"});for(const o of t)o.role!=="compaction"&&r.push({role:o.role,text:o.text,toolCalls:o.toolCalls?.map(h=>({id:h.id,name:h.name,input:h.input,result:h.result,status:"done",_expanded:!1}))});m.value=r,y()}catch{}};await c(),setTimeout(async()=>{_.value||k.value===s&&await c()},1e3);return}if(k.value!==s)return;_.value=!0,C.value="",M.value="",w.value=[];const n={role:"assistant",text:"",toolCalls:[]};m.value.push(n);const d=m.value.length-1;y();let v="";const u=lt(x.agentId,s,c=>{switch(c.type){case"idle":m.value.splice(d,1),_.value=!1;break;case"thinking_delta":M.value+=c.text,y();break;case"text":case"text_delta":C.value+=c.text,y();break;case"tool_call":{const p={id:c.tool_call?.id??String(Date.now()),name:c.tool_call?.name??"tool",input:c.tool_call?.input?JSON.stringify(c.tool_call.input):void 0,status:"running",_startedAt:Date.now(),_expanded:!1};m.value[d].toolCalls.push(p),w.value.push(p),v=p.id,y();break}case"tool_result":{const p=m.value[d].toolCalls?.find(t=>t.id===v);if(p){p.result=c.text,p.status="done";const t=w.value.find(r=>r.id===v);t&&(t.result=p.result,t.status="done")}y();break}case"done":case"error":{if(c.type==="done"&&c.sessionId){const t=!k.value;k.value=c.sessionId,t&&L("session-change",c.sessionId)}const p=m.value[d];p.text=C.value,p.thinking=M.value||void 0,c.type==="error"&&(p.text=`[é”™è¯¯] ${c.error}`),_.value=!1,C.value="",M.value="",w.value=[],y();break}}});ge(()=>u.abort())}function He(){k.value=void 0,m.value=[]}function Ke(s){Y(s),V(Z)}function Ve(s){ne(s,[],!0)}return xe({clearMessages:Pe,appendMessage:ze,sendText:Ke,sendSilent:Ve,fillInput:Y,messages:m,streaming:_,currentSessionId:k,resumeSession:qe,startNewSession:He}),Ye(()=>{y(),k.value&&me(k.value)}),(s,e)=>{const n=z("ChatRound"),d=z("el-icon"),v=z("Check"),u=z("CopyDocument"),c=z("Setting"),p=z("Paperclip");return a(),l("div",{class:O(["ai-chat",{compact:D.compact,"has-bg":D.bgColor,"drag-active":H.value}]),style:Qe(Ce.value),onDragenter:j(Re,["prevent"]),onDragover:e[6]||(e[6]=j(()=>{},["prevent"])),onDragleave:Be,onDrop:j(Le,["prevent","stop"])},[I(Ze,{name:"drag-fade"},{default:B(()=>[H.value?(a(),l("div",it,[...e[7]||(e[7]=[i("div",{class:"drag-overlay-content"},[i("div",{class:"drag-overlay-icon"},"ğŸ“"),i("div",{class:"drag-overlay-title"},"æ¾å¼€ä»¥é™„åŠ æ–‡ä»¶"),i("div",{class:"drag-overlay-hint"},"æ”¯æŒå›¾ç‰‡ Â· ä»£ç  Â· æ–‡æœ¬æ–‡ä»¶")],-1)])])):f("",!0)]),_:1}),le.value>0?(a(),l("div",rt,[e[8]||(e[8]=i("span",{class:"running-dot"},null,-1)),i("span",null,"åå°æœ‰ "+g(le.value)+" ä¸ªä»»åŠ¡æ­£åœ¨æ‰§è¡Œä¸­ï¼Œå…³é—­çª—å£åä»ä¼šç»§ç»­è¿è¡Œ",1),R.value.length?(a(),l("span",ut,[(a(!0),l(T,null,N(R.value.filter(t=>!["done","error","killed"].includes(t.status)),t=>(a(),l("span",{key:t.id,class:O(["resumed-chip",t.status])},g(t.status==="running"?"âŸ³":"ğŸŸ¡")+" "+g(t.label),3))),128))])):f("",!0)])):f("",!0),i("div",{class:"chat-messages",ref_key:"msgListRef",ref:X},[J.value?(a(),l("div",ct,[...e[9]||(e[9]=[i("div",{class:"history-loading-dots"},[i("span"),i("span"),i("span")],-1),i("div",{class:"history-loading-text"},"åŠ è½½å†å²å¯¹è¯â€¦",-1)])])):f("",!0),!m.value.length&&!J.value?(a(),l("div",dt,[D.welcomeMessage?(a(),l("div",pt,g(D.welcomeMessage),1)):f("",!0),D.examples.length?(a(),l("div",ft,[(a(!0),l(T,null,N(D.examples,(t,r)=>(a(),l("div",{key:r,class:"example-chip",onClick:o=>Y(t)},g(t),9,ht))),128))])):f("",!0)])):f("",!0),(a(!0),l(T,null,N(_.value?m.value.slice(0,-1):m.value,(t,r)=>(a(),l(T,{key:r},[t.role==="user"?(a(),l("div",vt,[i("div",mt,[t.images?.length?(a(),l("div",gt,[(a(!0),l(T,null,N(t.images,(o,h)=>(a(),l("img",{key:h,src:o,class:"msg-img",onClick:$=>te(o)},null,8,_t))),128))])):f("",!0),i("div",kt,g(t.text),1)])])):t.role==="assistant"?(a(),l("div",yt,[i("div",xt,[t.thinking?(a(),l("details",{key:0,class:"thinking-block",open:D.showThinking},[i("summary",Ct,[I(d,{class:"thinking-icon"},{default:B(()=>[I(n)]),_:1}),e[10]||(e[10]=P(" æ€è€ƒè¿‡ç¨‹ ",-1)),i("span",wt,g(t.thinking.length)+" å­—ç¬¦",1)]),i("pre",St,g(t.thinking),1)],8,bt)):f("",!0),t.toolCalls?.length?(a(),l("div",$t,[(a(!0),l(T,null,N(t.toolCalls,(o,h)=>(a(),l("div",{key:h,class:O(["tool-step",o.status]),onClick:$=>o._expanded=!o._expanded},[i("div",Tt,[i("span",{class:O(["tool-step-dot",o.status])},[o.status==="running"?(a(),l("span",Dt,"âŸ³")):o.status==="done"?(a(),l("span",Mt,"âœ“")):o.status==="error"?(a(),l("span",Nt,"âœ—")):(a(),l("span",jt,"â—‹"))],2),i("span",Ft,g(pe(o.name)),1),i("code",Ot,g(o.name),1),o.input?(a(),l("span",Ut,g(fe(o.name,o.input)),1)):f("",!0),e[12]||(e[12]=i("span",{class:"tool-step-flex"},null,-1)),o.duration?(a(),l("span",At,g(o.duration),1)):f("",!0),o.taskId?(a(),l("span",{key:2,class:O(["task-badge",o.taskStatus])},[o.taskStatus==="pending"?(a(),l("span",Rt,"ğŸŸ¡ æ’é˜Ÿä¸­")):o.taskStatus==="running"?(a(),l("span",Bt,[...e[11]||(e[11]=[i("span",{class:"tool-spin"},"âŸ³",-1),P(" æ‰§è¡Œä¸­ ",-1)])])):o.taskStatus==="done"?(a(),l("span",Lt,"âœ… å®Œæˆ")):o.taskStatus==="error"?(a(),l("span",Et,"âŒ å¤±è´¥")):o.taskStatus==="killed"?(a(),l("span",Jt,"ğŸ›‘ å·²ç»ˆæ­¢")):f("",!0)],2)):f("",!0),i("span",Pt,g(o._expanded?"â–²":"â–¼"),1)]),o._expanded?(a(),l("div",{key:0,class:"tool-step-body",onClick:e[0]||(e[0]=j(()=>{},["stop"]))},[o.input?(a(),l("div",zt,[e[13]||(e[13]=i("div",{class:"tool-label"},"INPUT",-1)),i("pre",qt,g(ie(o.input)),1)])):f("",!0),o.result?(a(),l("div",Ht,[e[14]||(e[14]=i("div",{class:"tool-label"},"OUTPUT",-1)),i("pre",Kt,g(o.result.slice(0,3e3))+g(o.result.length>3e3?`
â€¦ (æˆªæ–­)`:""),1)])):f("",!0)])):f("",!0),o.mediaUrl?(a(),l("div",{key:1,class:"tool-media-preview",onClick:e[1]||(e[1]=j(()=>{},["stop"]))},[i("img",{src:o.mediaUrl,class:"tool-media-img",onClick:$=>te(o.mediaUrl)},null,8,Vt)])):f("",!0)],10,It))),128))])):f("",!0),i("div",Wt,[t.text?(a(),l("div",{key:0,class:"msg-text",innerHTML:re(t.text)},null,8,Gt)):f("",!0),t.applyData&&x.applyable?(a(),l("div",Xt,[i("div",Yt,[(a(!0),l(T,null,N(t.applyData,(o,h)=>(a(),l("div",{key:h,class:"apply-row"},[i("span",Qt,g(h),1),i("span",Zt,g(String(o).slice(0,60))+g(String(o).length>60?"â€¦":""),1)]))),128))]),i("button",{class:"apply-btn",onClick:o=>s.$emit("apply",t.applyData)}," åº”ç”¨åˆ°è¡¨å• â†™ ",8,es)])):f("",!0),i("div",ts,[i("button",{class:"act-btn",onClick:o=>Ie(t.text),title:W.value===r?"å·²å¤åˆ¶":"å¤åˆ¶"},[W.value===r?(a(),ye(d,{key:0},{default:B(()=>[I(v)]),_:1})):(a(),ye(d,{key:1},{default:B(()=>[I(u)]),_:1}))],8,ss),i("button",{class:"act-btn",onClick:o=>Te(r),title:"é‡è¯•"},"â†º",8,ns),x.applyable&&!t.applyData&&Me(t.text)?(a(),l("button",{key:0,class:"act-btn apply-manual-btn",onClick:o=>Ne(t),title:"æ£€æµ‹åˆ°é…ç½® JSONï¼Œç‚¹å‡»åº”ç”¨"},[I(d,null,{default:B(()=>[I(c)]),_:1}),e[15]||(e[15]=P(" åº”ç”¨é…ç½® ",-1))],8,as)):f("",!0)])]),t.options&&t.options.length?(a(),l("div",ls,[(a(!0),l(T,null,N(t.options,(o,h)=>(a(),l("button",{key:h,class:"option-chip",onClick:$=>Y(o)},g(o),9,os))),128))])):f("",!0)])])):t.role==="system"?(a(),l("div",is,[i("div",rs,g(t.text),1)])):f("",!0)],64))),128)),_.value?(a(),l("div",us,[i("div",cs,[M.value&&D.showThinking?(a(),l("details",ds,[i("summary",ps,[I(d,{class:"thinking-icon"},{default:B(()=>[I(n)]),_:1}),e[16]||(e[16]=P(" æ€è€ƒä¸­â€¦ ",-1))]),i("pre",fs,[P(g(M.value),1),e[17]||(e[17]=i("span",{class:"blink"},"â–Š",-1))])])):f("",!0),w.value.length?(a(),l("div",hs,[(a(!0),l(T,null,N(w.value,(t,r)=>(a(),l("div",{key:r,class:O(["tool-step",t.status]),onClick:o=>t._expanded=!t._expanded},[i("div",ms,[i("span",{class:O(["tool-step-dot",t.status])},[t.status==="running"?(a(),l("span",gs,"âŸ³")):t.status==="done"?(a(),l("span",_s,"âœ“")):t.status==="error"?(a(),l("span",ks,"âœ—")):f("",!0)],2),i("span",ys,g(pe(t.name)),1),i("code",xs,g(t.name),1),t.input?(a(),l("span",bs,g(fe(t.name,t.input)),1)):f("",!0),e[19]||(e[19]=i("span",{class:"tool-step-flex"},null,-1)),t.duration?(a(),l("span",Cs,g(t.duration),1)):f("",!0),t.taskId?(a(),l("span",{key:2,class:O(["task-badge",t.taskStatus])},[t.taskStatus==="pending"?(a(),l("span",ws,"ğŸŸ¡ æ’é˜Ÿä¸­")):t.taskStatus==="running"?(a(),l("span",Ss,[...e[18]||(e[18]=[i("span",{class:"tool-spin"},"âŸ³",-1),P(" æ‰§è¡Œä¸­",-1)])])):t.taskStatus==="done"?(a(),l("span",$s,"âœ… å®Œæˆ")):t.taskStatus==="error"?(a(),l("span",Is,"âŒ å¤±è´¥")):t.taskStatus==="killed"?(a(),l("span",Ts,"ğŸ›‘ å·²ç»ˆæ­¢")):f("",!0)],2)):f("",!0),i("span",Ds,g(t._expanded?"â–²":"â–¼"),1)]),t._expanded?(a(),l("div",{key:0,class:"tool-step-body",onClick:e[2]||(e[2]=j(()=>{},["stop"]))},[t.input?(a(),l("div",Ms,[e[20]||(e[20]=i("div",{class:"tool-label"},"INPUT",-1)),i("pre",Ns,g(ie(t.input)),1)])):f("",!0),t.result?(a(),l("div",js,[e[21]||(e[21]=i("div",{class:"tool-label"},"OUTPUT",-1)),i("pre",Fs,g(t.result.slice(0,3e3)),1)])):f("",!0)])):f("",!0),t.mediaUrl?(a(),l("div",{key:1,class:"tool-media-preview",onClick:e[3]||(e[3]=j(()=>{},["stop"]))},[i("img",{src:t.mediaUrl,class:"tool-media-img",onClick:o=>te(t.mediaUrl)},null,8,Os)])):f("",!0)],10,vs))),128))])):f("",!0),C.value||!w.value.length?(a(),l("div",Us,[!C.value&&!w.value.length?(a(),l("div",As,[...e[22]||(e[22]=[i("span",null,null,-1),i("span",null,null,-1),i("span",null,null,-1)])])):f("",!0),C.value?(a(),l("div",{key:1,class:"msg-text",innerHTML:re(C.value)},null,8,Rs)):f("",!0),C.value?(a(),l("span",Bs,"â–Š")):f("",!0)])):f("",!0)])])):f("",!0)],512),G.value?(a(),l("div",{key:1,class:"img-preview-mask",onClick:e[4]||(e[4]=t=>G.value="")},[i("img",{src:G.value,class:"img-preview-full"},null,8,Ls)])):f("",!0),i("div",Es,[U.value.length||A.value.length?(a(),l("div",Js,[(a(!0),l(T,null,N(U.value,(t,r)=>(a(),l("div",{key:"img-"+r,class:"attach-thumb"},[i("img",{src:t},null,8,Ps),i("button",{class:"remove-attach",onClick:o=>Je(r)},"Ã—",8,zs)]))),128)),(a(!0),l(T,null,N(A.value,(t,r)=>(a(),l("div",{key:"file-"+r,class:"attach-file-chip"},[i("span",qs,g(Oe(t.name)),1),i("span",Hs,g(t.name),1),i("span",Ks,g(Ue(t.content.length)),1),i("button",{class:"attach-file-remove",onClick:o=>A.value.splice(r,1)},"Ã—",8,Vs)]))),128))])):f("",!0),i("div",Ws,[i("div",Gs,[et(i("textarea",{ref_key:"inputRef",ref:F,"onUpdate:modelValue":e[5]||(e[5]=t=>E.value=t),placeholder:D.placeholder||"è¾“å…¥æ¶ˆæ¯â€¦ æ”¯æŒæ‹–æ‹½å›¾ç‰‡æˆ–æ–‡ä»¶ (Ctrl+Enter å‘é€)",disabled:_.value||J.value,rows:"1",class:"chat-textarea",onKeydown:[_e(j(Z,["ctrl","prevent"]),["enter"]),_e(j(Z,["meta","prevent"]),["enter"])],onPaste:Ae,onInput:$e},null,40,Xs),[[tt,E.value]])]),i("div",Ys,[i("label",Qs,[I(d,null,{default:B(()=>[I(p)]),_:1}),i("input",{type:"file",multiple:"",hidden:"",onChange:Ee},null,32)]),i("button",{class:"send-btn",disabled:_.value||J.value||!E.value.trim()&&!U.value.length&&!A.value.length,onClick:Z},[_.value?(a(),l("span",en)):(a(),l("span",tn,"â†‘"))],8,Zs)])]),e[23]||(e[23]=i("div",{class:"input-hint"},"Ctrl+Enter å‘é€ Â· æ”¯æŒæ‹–æ‹½å›¾ç‰‡/æ–‡ä»¶",-1))])],38)}}}),on=ot(sn,[["__scopeId","data-v-b0b9bac5"]]);export{on as A};
