import{d as ge,i as xe,c as v,b as n,a as l,w as t,F as Z,m as ee,k as D,t as w,j as C,e as f,z as ke,r as m,o as u,l as p,B as le,s as Ve,L as I,V as Ce,h as r,f as ze,W as je,X as Fe,K as be,n as Be,M as te,Y as $e,J as Se,g as oe,E as c,x as ae}from"./index-BK19_pMu.js";import{q as x}from"./index-CSBCvw1g.js";import{_ as Ue}from"./_plugin-vue_export-helper-DlAUqK2U.js";const De={class:"projects-layout"},Ee={class:"projects-sidebar"},Ne={class:"sidebar-header"},Te={class:"project-list"},Pe=["onClick"],Me={class:"project-item-body"},Ie={class:"project-name"},Ke={key:0,class:"project-desc"},Le={key:0,class:"empty-projects"},qe={key:0,class:"projects-main"},Ae={class:"main-header"},We={class:"main-title"},Je={class:"file-panel"},Oe={class:"file-panel-header"},Re={style:{display:"flex",gap:"4px"}},Xe={style:{flex:"1","overflow-y":"auto"}},Ye={class:"tree-node"},he={class:"tree-label"},Ge={key:2,class:"tree-size"},He={class:"editor-panel"},Qe={key:0,class:"editor-header"},Ze={class:"editor-path"},el={key:1,class:"editor-header"},ll={key:3,class:"binary-hint"},tl={key:4,class:"editor-empty"},ol={key:5,class:"editor-footer"},al={key:1,class:"projects-main projects-empty"},nl=ge({__name:"ProjectsView",setup(sl){const B=f([]),y=f(""),E=ke(()=>B.value.find(o=>o.id===y.value)),N=f([]),d=f(""),k=f(""),z=f(null),$=f(!1),j=f(!1),T=f(!1),P=f(!1),M=f(!1),K=f(""),L=f(""),_=f({id:"",name:"",description:"",tagsStr:""}),V=f({id:"",name:"",description:"",tagsStr:""});xe(q);async function q(){try{const o=await x.list();if(B.value=o.data||[],B.value.length&&!y.value){const e=B.value[0];e&&W(e.id)}}catch{}}async function W(o){y.value=o,d.value="",k.value="",z.value=null,await S()}async function S(){if(y.value)try{const o=await x.readTree(y.value);N.value=Array.isArray(o.data)?o.data:[]}catch{N.value=[]}}async function ne(o){if(!o.isDir){d.value=o.path||o.name,z.value=o,$.value=!1;try{const e=await x.readFile(y.value,d.value);e.data?.encoding==="base64"?($.value=!0,k.value=""):k.value=e.data?.content??""}catch{k.value=""}}}async function se(){if(d.value)try{await x.writeFile(y.value,d.value,k.value),c.success("已保存"),S()}catch{c.error("保存失败")}}async function ie(){if(d.value)try{await ae.confirm(`删除「${d.value}」？`,"删除文件",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning",confirmButtonClass:"el-button--danger"}),await x.deleteFile(y.value,d.value),c.success("已删除"),d.value="",k.value="",z.value=null,S()}catch(o){o!=="cancel"&&c.error("删除失败")}}async function J(){const o=K.value.trim();if(o)try{await x.writeFile(y.value,o,""),c.success(`已创建 ${o}`),P.value=!1,K.value="",await S(),d.value=o,k.value="",z.value=null,$.value=!1}catch{c.error("创建失败")}}async function O(){const o=L.value.trim();if(o)try{await x.writeFile(y.value,o+"/.gitkeep",""),c.success(`已创建文件夹 ${o}`),M.value=!1,L.value="",S()}catch{c.error("创建失败")}}function R(){_.value={id:"",name:"",description:"",tagsStr:""}}async function ue(){const{id:o,name:e,description:s,tagsStr:i}=_.value;if(!o||!e){c.warning("请填写 ID 和名称");return}const U=i?i.split(",").map(F=>F.trim()).filter(Boolean):[];try{await x.create({id:o,name:e,description:s,tags:U}),c.success("项目已创建"),j.value=!1,R(),await q(),W(o)}catch(F){c.error(F.response?.data?.error||"创建失败")}}function de(o){V.value={id:o.id,name:o.name,description:o.description||"",tagsStr:(o.tags||[]).join(", ")},T.value=!0}async function re(){const{id:o,name:e,description:s,tagsStr:i}=V.value,U=i?i.split(",").map(F=>F.trim()).filter(Boolean):[];try{await x.update(o,{name:e,description:s,tags:U}),c.success("已更新"),T.value=!1,q()}catch{c.error("更新失败")}}async function fe(o){try{await ae.confirm(`删除项目「${o.name}」将删除其所有文件，不可恢复。`,"删除项目",{confirmButtonText:"确认删除",cancelButtonText:"取消",type:"warning",confirmButtonClass:"el-button--danger"}),await x.delete(o.id),c.success("已删除"),y.value===o.id&&(y.value="",N.value=[],d.value=""),q()}catch(e){e!=="cancel"&&c.error("删除失败")}}function me(o){const e=o.split(".").pop()?.toLowerCase()||"";return["md","txt","rst"].includes(e)?"#409eff":["json","yaml","yml","toml"].includes(e)?"#67c23a":["go","py","js","ts","sh","vue","rs","java","c","cpp"].includes(e)?"#e6a23c":["jpg","jpeg","png","gif","svg","webp"].includes(e)?"#f56c6c":o.startsWith(".")?"#c0c4cc":"#909399"}function pe(o){const e=o.split("/").pop()||o,s=e.lastIndexOf(".");return s>0?e.slice(s):"file"}function X(o){return o?o<1024?`${o} B`:o<1024*1024?`${(o/1024).toFixed(1)} KB`:`${(o/1024/1024).toFixed(1)} MB`:"0 B"}function ce(o){return o?new Date(o).toLocaleString("zh-CN",{month:"numeric",day:"numeric",hour:"2-digit",minute:"2-digit"}):""}return(o,e)=>{const s=m("el-icon"),i=m("el-button"),U=m("el-dropdown-item"),F=m("el-dropdown-menu"),ve=m("el-dropdown"),Y=m("el-tag"),h=m("el-text"),ye=m("el-tree"),_e=m("el-empty"),G=m("el-col"),g=m("el-input"),we=m("el-row"),b=m("el-form-item"),H=m("el-form"),A=m("el-dialog");return u(),v("div",De,[n("div",Ee,[n("div",Ne,[e[24]||(e[24]=n("span",{class:"sidebar-title"},"项目",-1)),l(i,{text:"",size:"small",onClick:e[0]||(e[0]=a=>j.value=!0),title:"新建项目"},{default:t(()=>[l(s,null,{default:t(()=>[l(p(le))]),_:1})]),_:1})]),n("div",Te,[(u(!0),v(Z,null,ee(B.value,a=>(u(),v("div",{key:a.id,class:Ve(["project-item",{active:y.value===a.id}]),onClick:Q=>W(a.id)},[l(s,{class:"project-icon"},{default:t(()=>[l(p(I))]),_:1}),n("div",Me,[n("div",Ie,w(a.name),1),a.description?(u(),v("div",Ke,w(a.description),1)):D("",!0)]),l(ve,{trigger:"click",onClick:e[1]||(e[1]=ze(()=>{},["stop"]))},{dropdown:t(()=>[l(F,null,{default:t(()=>[l(U,{onClick:Q=>de(a)},{default:t(()=>[...e[25]||(e[25]=[r("编辑信息",-1)])]),_:1},8,["onClick"]),l(U,{divided:"",onClick:Q=>fe(a),style:{color:"#f56c6c"}},{default:t(()=>[...e[26]||(e[26]=[r("删除项目",-1)])]),_:1},8,["onClick"])]),_:2},1024)]),default:t(()=>[l(s,{class:"project-menu-btn"},{default:t(()=>[l(p(Ce))]),_:1})]),_:2},1024)],10,Pe))),128)),B.value.length?D("",!0):(u(),v("div",Le,[l(s,{size:"32",style:{color:"#c0c4cc"}},{default:t(()=>[l(p(I))]),_:1}),e[28]||(e[28]=n("p",null,"暂无项目",-1)),l(i,{size:"small",type:"primary",plain:"",onClick:e[2]||(e[2]=a=>j.value=!0)},{default:t(()=>[...e[27]||(e[27]=[r("新建项目",-1)])]),_:1})]))])]),E.value?(u(),v("div",qe,[n("div",Ae,[n("div",We,[l(s,{style:{color:"#e6a23c"}},{default:t(()=>[l(p(I))]),_:1}),n("span",null,w(E.value.name),1),(u(!0),v(Z,null,ee(E.value.tags||[],a=>(u(),C(Y,{key:a,size:"small",style:{"margin-left":"4px"}},{default:t(()=>[r(w(a),1)]),_:2},1024))),128))]),E.value.description?(u(),C(h,{key:0,type:"info",size:"small"},{default:t(()=>[r(w(E.value.description),1)]),_:1})):D("",!0)]),l(we,{gutter:12,style:{flex:"1",overflow:"hidden"}},{default:t(()=>[l(G,{span:6,style:{height:"100%",display:"flex","flex-direction":"column"}},{default:t(()=>[n("div",Je,[n("div",Oe,[e[29]||(e[29]=n("span",null,"文件",-1)),n("div",Re,[l(i,{text:"",size:"small",onClick:e[3]||(e[3]=a=>P.value=!0),title:"新建文件"},{default:t(()=>[l(s,null,{default:t(()=>[l(p(je))]),_:1})]),_:1}),l(i,{text:"",size:"small",onClick:e[4]||(e[4]=a=>M.value=!0),title:"新建文件夹"},{default:t(()=>[l(s,null,{default:t(()=>[l(p(Fe))]),_:1})]),_:1}),l(i,{text:"",size:"small",onClick:S,title:"刷新"},{default:t(()=>[l(s,null,{default:t(()=>[l(p(be))]),_:1})]),_:1})])]),n("div",Xe,[N.value.length?(u(),C(ye,{key:0,data:N.value,props:{label:"name",children:"children"},"highlight-current":"","default-expand-all":"",onNodeClick:ne,style:{"font-size":"13px"}},{default:t(({data:a})=>[n("span",Ye,[a.isDir?(u(),C(s,{key:0,style:{color:"#e6a23c","font-size":"13px","flex-shrink":"0"}},{default:t(()=>[l(p(I))]),_:1})):(u(),C(s,{key:1,style:Be({color:me(a.name),fontSize:"13px",flexShrink:0})},{default:t(()=>[l(p(te))]),_:1},8,["style"])),n("span",he,w(a.name),1),a.isDir?D("",!0):(u(),v("span",Ge,w(X(a.size)),1))])]),_:1},8,["data"])):(u(),C(_e,{key:1,description:"暂无文件","image-size":48}))])])]),_:1}),l(G,{span:18,style:{height:"100%",display:"flex","flex-direction":"column"}},{default:t(()=>[n("div",He,[d.value?(u(),v("div",Qe,[n("span",Ze,w(d.value),1),l(Y,{size:"small",style:{"font-size":"11px"}},{default:t(()=>[r(w(pe(d.value)),1)]),_:1}),e[30]||(e[30]=n("div",{style:{flex:"1"}},null,-1)),l(i,{text:"",size:"small",type:"danger",onClick:ie,title:"删除"},{default:t(()=>[l(s,null,{default:t(()=>[l(p($e))]),_:1})]),_:1})])):(u(),v("div",el,[...e[31]||(e[31]=[n("span",{style:{color:"#c0c4cc","font-size":"13px"}},"从左侧选择文件",-1)])])),d.value&&!$.value?(u(),C(g,{key:2,modelValue:k.value,"onUpdate:modelValue":e[5]||(e[5]=a=>k.value=a),type:"textarea",placeholder:"（空文件）",autosize:!1,style:{flex:"1","font-family":"monospace","font-size":"13px"}},null,8,["modelValue"])):d.value&&$.value?(u(),v("div",ll,[l(s,{size:"32"},{default:t(()=>[l(p(te))]),_:1}),e[32]||(e[32]=n("p",null,"二进制文件，无法编辑",-1))])):(u(),v("div",tl,[l(s,{size:"48",style:{color:"#e4e7ed"}},{default:t(()=>[l(p(Se))]),_:1}),e[33]||(e[33]=n("p",null,"选择文件后在此编辑",-1))])),d.value&&!$.value?(u(),v("div",ol,[l(i,{type:"primary",size:"small",onClick:se},{default:t(()=>[...e[34]||(e[34]=[r("保存",-1)])]),_:1}),z.value?(u(),C(h,{key:0,type:"info",size:"small"},{default:t(()=>[r(w(X(z.value.size))+" · "+w(ce(z.value.modTime)),1)]),_:1})):D("",!0)])):D("",!0)])]),_:1})]),_:1})])):(u(),v("div",al,[l(s,{size:"64",style:{color:"#e4e7ed","margin-bottom":"16px"}},{default:t(()=>[l(p(I))]),_:1}),e[36]||(e[36]=n("p",{style:{color:"#909399","font-size":"15px"}},"从左侧选择或新建一个项目",-1)),l(i,{type:"primary",onClick:e[6]||(e[6]=a=>j.value=!0)},{default:t(()=>[l(s,null,{default:t(()=>[l(p(le))]),_:1}),e[35]||(e[35]=r(" 新建项目 ",-1))]),_:1})])),l(A,{modelValue:j.value,"onUpdate:modelValue":e[12]||(e[12]=a=>j.value=a),title:"新建项目",width:"440px",onClose:R},{footer:t(()=>[l(i,{onClick:e[11]||(e[11]=a=>j.value=!1)},{default:t(()=>[...e[37]||(e[37]=[r("取消",-1)])]),_:1}),l(i,{type:"primary",onClick:ue},{default:t(()=>[...e[38]||(e[38]=[r("创建",-1)])]),_:1})]),default:t(()=>[l(H,{model:_.value,"label-width":"80px"},{default:t(()=>[l(b,{label:"项目 ID",required:""},{default:t(()=>[l(g,{modelValue:_.value.id,"onUpdate:modelValue":e[7]||(e[7]=a=>_.value.id=a),placeholder:"如 ai-panel（小写字母/数字/连字符）"},null,8,["modelValue"])]),_:1}),l(b,{label:"名称",required:""},{default:t(()=>[l(g,{modelValue:_.value.name,"onUpdate:modelValue":e[8]||(e[8]=a=>_.value.name=a),placeholder:"项目名称"},null,8,["modelValue"])]),_:1}),l(b,{label:"描述"},{default:t(()=>[l(g,{modelValue:_.value.description,"onUpdate:modelValue":e[9]||(e[9]=a=>_.value.description=a),placeholder:"简短描述（可选）"},null,8,["modelValue"])]),_:1}),l(b,{label:"标签"},{default:t(()=>[l(g,{modelValue:_.value.tagsStr,"onUpdate:modelValue":e[10]||(e[10]=a=>_.value.tagsStr=a),placeholder:"多个标签用逗号分隔，如 go,vue"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),l(A,{modelValue:T.value,"onUpdate:modelValue":e[17]||(e[17]=a=>T.value=a),title:"编辑项目信息",width:"440px"},{footer:t(()=>[l(i,{onClick:e[16]||(e[16]=a=>T.value=!1)},{default:t(()=>[...e[39]||(e[39]=[r("取消",-1)])]),_:1}),l(i,{type:"primary",onClick:re},{default:t(()=>[...e[40]||(e[40]=[r("保存",-1)])]),_:1})]),default:t(()=>[l(H,{model:V.value,"label-width":"80px"},{default:t(()=>[l(b,{label:"名称"},{default:t(()=>[l(g,{modelValue:V.value.name,"onUpdate:modelValue":e[13]||(e[13]=a=>V.value.name=a)},null,8,["modelValue"])]),_:1}),l(b,{label:"描述"},{default:t(()=>[l(g,{modelValue:V.value.description,"onUpdate:modelValue":e[14]||(e[14]=a=>V.value.description=a)},null,8,["modelValue"])]),_:1}),l(b,{label:"标签"},{default:t(()=>[l(g,{modelValue:V.value.tagsStr,"onUpdate:modelValue":e[15]||(e[15]=a=>V.value.tagsStr=a),placeholder:"多个标签用逗号分隔"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),l(A,{modelValue:P.value,"onUpdate:modelValue":e[20]||(e[20]=a=>P.value=a),title:"新建文件",width:"380px"},{footer:t(()=>[l(i,{onClick:e[19]||(e[19]=a=>P.value=!1)},{default:t(()=>[...e[41]||(e[41]=[r("取消",-1)])]),_:1}),l(i,{type:"primary",onClick:J},{default:t(()=>[...e[42]||(e[42]=[r("创建",-1)])]),_:1})]),default:t(()=>[l(g,{modelValue:K.value,"onUpdate:modelValue":e[18]||(e[18]=a=>K.value=a),placeholder:"如 README.md 或 src/main.go",onKeyup:oe(J,["enter"])},null,8,["modelValue"])]),_:1},8,["modelValue"]),l(A,{modelValue:M.value,"onUpdate:modelValue":e[23]||(e[23]=a=>M.value=a),title:"新建文件夹",width:"380px"},{footer:t(()=>[l(i,{onClick:e[22]||(e[22]=a=>M.value=!1)},{default:t(()=>[...e[43]||(e[43]=[r("取消",-1)])]),_:1}),l(i,{type:"primary",onClick:O},{default:t(()=>[...e[44]||(e[44]=[r("创建",-1)])]),_:1})]),default:t(()=>[l(g,{modelValue:L.value,"onUpdate:modelValue":e[21]||(e[21]=a=>L.value=a),placeholder:"如 src 或 docs/api",onKeyup:oe(O,["enter"])},null,8,["modelValue"])]),_:1},8,["modelValue"])])}}}),rl=Ue(nl,[["__scopeId","data-v-6491ddba"]]);export{rl as default};
