import{d as qe,e as m,D as Ke,I as Ve,i as We,c as a,f as O,n as Ge,s as M,a as x,w as B,S as Xe,b as l,t as f,F as w,m as T,k as u,h as E,p as Ye,G as Qe,g as fe,z as ve,H as K,r as J,o as n,j as _e,q as Ze}from"./index-qHv2w6IK.js";import{n as et,i as tt,o as se}from"./index-B6SLQW8T.js";import{_ as st}from"./_plugin-vue_export-helper-DlAUqK2U.js";const nt={key:0,class:"drag-overlay"},ot={key:0,class:"running-tasks-banner"},at={key:0,class:"resumed-list"},lt={key:0,class:"history-loading"},it={key:1,class:"chat-empty"},rt={key:0,class:"welcome-msg"},ct={key:1,class:"examples"},ut=["onClick"],dt={key:0,class:"msg-row user"},pt={class:"msg-bubble user"},ht={key:0,class:"msg-images"},ft=["src","onClick"],vt={class:"msg-text"},_t={key:1,class:"msg-row assistant"},gt={class:"msg-col"},mt=["open"],kt={class:"thinking-summary"},yt={class:"thinking-len"},bt={class:"thinking-content"},xt={key:1,class:"tool-timeline"},wt=["onClick"],Ct={class:"tool-step-header"},St={key:0,class:"tool-spin"},It={key:1},Tt={key:2},$t={key:3},Dt={class:"tool-step-icon"},Mt={class:"tool-step-name"},At={key:0,class:"tool-step-summary"},Nt={key:1,class:"tool-step-dur"},jt={key:0},Ft={key:1},Ot={key:2},Bt={key:3},Lt={key:4},Rt={class:"tool-step-chevron"},Pt={key:0,class:"tool-section"},Et={class:"tool-pre"},Jt={key:1,class:"tool-section"},Ut={class:"tool-pre result"},zt={class:"msg-bubble assistant"},Ht=["innerHTML"],qt={key:1,class:"apply-card"},Kt={class:"apply-preview"},Vt={class:"apply-key"},Wt={class:"apply-val"},Gt=["onClick"],Xt={class:"msg-actions"},Yt=["onClick","title"],Qt=["onClick"],Zt=["onClick"],es={key:2,class:"option-chips"},ts=["onClick"],ss={key:2,class:"msg-row system"},ns={class:"msg-system"},os={key:2,class:"msg-row assistant"},as={class:"msg-col"},ls={key:0,class:"thinking-block",open:""},is={class:"thinking-summary"},rs={class:"thinking-content"},cs={key:1,class:"tool-timeline"},us=["onClick"],ds={class:"tool-step-header"},ps={key:0,class:"tool-spin"},hs={key:1},fs={key:2},vs={class:"tool-step-icon"},_s={class:"tool-step-name"},gs={key:0,class:"tool-step-summary"},ms={key:1,class:"tool-step-dur"},ks={key:0},ys={key:1},bs={key:2},xs={key:3},ws={key:4},Cs={class:"tool-step-chevron"},Ss={key:0,class:"tool-section"},Is={class:"tool-pre"},Ts={key:1,class:"tool-section"},$s={class:"tool-pre result"},Ds={key:2,class:"msg-bubble assistant"},Ms={key:0,class:"typing-dots"},As=["innerHTML"],Ns={key:2,class:"blink"},js=["src"],Fs={class:"chat-input-area"},Os={key:0,class:"attachments-bar"},Bs=["src"],Ls=["onClick"],Rs={class:"attach-file-icon"},Ps={class:"attach-file-name"},Es={class:"attach-file-size"},Js=["onClick"],Us={class:"input-row"},zs={class:"textarea-wrap"},Hs=["placeholder","disabled","onKeydown"],qs={class:"input-actions"},Ks={class:"icon-btn",title:"é™„åŠ æ–‡ä»¶ï¼ˆå›¾ç‰‡/ä»£ç /æ–‡æœ¬ï¼‰"},Vs=["disabled"],Ws={key:0,class:"spinner"},Gs={key:1},Xs=qe({__name:"AiChat",props:{agentId:{},sessionId:{},context:{},scenario:{},skillId:{},placeholder:{},welcomeMessage:{},examples:{default:()=>[]},showThinking:{type:Boolean,default:!1},compact:{type:Boolean,default:!1},bgColor:{},height:{},initialMessages:{},applyable:{type:Boolean,default:!1}},emits:["message","response","apply","session-change","streaming-change"],setup(C,{expose:ge,emit:me}){const k=C,U=me,_=m(k.initialMessages?[...k.initialMessages]:[]),L=m(""),A=m([]),N=m([]),S=m(!1);Ke(S,t=>U("streaming-change",t));const y=m(""),R=m(""),$=m([]),z=Ze(new Map),j=m([]);let b=null;const ne=ve(()=>{let t=0;for(const e of _.value)for(const o of e.toolCalls??[])o.taskId&&o.taskStatus&&!["done","error","killed"].includes(o.taskStatus)&&t++;return t+=j.value.filter(e=>!["done","error","killed"].includes(e.status)).length,t}),H=m(!1);let q=0;const V=m(null),W=m(""),F=m(k.sessionId),P=m(!1),G=m(),D=m(),ke=ve(()=>({height:k.height??"100%","--bg":k.bgColor??"transparent"}));function oe(){b||(b=setInterval(ye,3e3))}async function ye(){if(z.size===0&&j.value.every(i=>["done","error","killed"].includes(i.status))){b&&(clearInterval(b),b=null);return}const e=[];for(const[i,p]of z)try{const h=(await se.get(p)).data;for(const g of _.value){const s=g.toolCalls?.find(c=>c.id===i);s&&(s.taskStatus=h.status,["done","error","killed"].includes(h.status)&&e.push(i))}}catch{e.push(i)}for(const i of e)z.delete(i);for(const i of j.value)if(!["done","error","killed"].includes(i.status))try{const p=await se.get(i.id);i.status=p.data.status}catch{i.status="error"}!(z.size>0||j.value.some(i=>!["done","error","killed"].includes(i.status)))&&b&&(clearInterval(b),b=null)}Ve(()=>{b&&(clearInterval(b),b=null)});async function be(t){try{const o=(await se.list({sessionId:t})).data.filter(i=>!["done","error","killed"].includes(i.status));if(o.length===0)return;j.value=o.map(i=>({id:i.id,label:i.label||i.id.slice(0,8),status:i.status})),oe()}catch{}}function I(){K(()=>{G.value&&(G.value.scrollTop=G.value.scrollHeight)})}function xe(){D.value&&(D.value.style.height="auto",D.value.style.height=Math.min(D.value.scrollHeight,160)+"px")}function X(t){L.value=t,K(()=>D.value?.focus())}function ae(t){try{return JSON.stringify(JSON.parse(t),null,2)}catch{return t}}function we(t){navigator.clipboard?.writeText(t);const e=_.value.findIndex(o=>o.text===t);V.value=e,setTimeout(()=>{V.value=null},1500)}function Ce(t){for(let e=t-1;e>=0;e--){const o=_.value[e];if(o&&o.role==="user"){const i=o.text,p=o.images??[];_.value.splice(e,_.value.length-e),te(i,p);return}}}function Se(t){W.value=t}function le(t){return t?t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/```(\w*)\n([\s\S]*?)```/g,(o,i,p)=>`<pre class="code-block${i?" lang-"+i:""}"><code>${p}</code></pre>`).replace(/`([^`]+)`/g,'<code class="inline-code">$1</code>').replace(/\*\*(.+?)\*\*/g,"<strong>$1</strong>").replace(/\*(.+?)\*/g,"<em>$1</em>").replace(/\[(.+?)\]\((https?:\/\/[^\)]+)\)/g,'<a href="$2" target="_blank" rel="noopener">$1</a>').replace(/^### (.+)$/gm,"<h3>$1</h3>").replace(/^## (.+)$/gm,"<h2>$1</h2>").replace(/^# (.+)$/gm,"<h1>$1</h1>").replace(/^[-*] (.+)$/gm,"<li>$1</li>").replace(/^\d+\. (.+)$/gm,"<li>$1</li>").replace(/(<li>[\s\S]+?<\/li>)(\n(?!<li>)|$)/g,"<ul>$1</ul>$2").replace(/([^>])\n([^<])/g,"$1<br>$2"):""}function Ie(t){const e=t.split(`
`),o=[],i=/^([ğŸ™ğŸ˜„ğŸŒğŸ›ğŸ“šğŸ¨ğŸ’¼ğŸ¤–âš½ğŸ¯âœ…âŒğŸ”¥ğŸ’¡ğŸğŸš€ğŸŒŸğŸ’ğŸªğŸ­ğŸ¬ğŸ¤]|[\u{1F300}-\u{1FFFF}]|[\u{2600}-\u{27BF}])\s+(.{4,40})/u;for(const p of e){const d=p.replace(/^[-*â€¢]\s*/,"").trim();if(d.match(i)){const g=d.replace(/[ï¼š:ã€‚ï¼Œ,]$/,"").trim();g.length>=5&&o.push(g)}}return o.slice(0,5)}function Te(t){return t?/\{[\s\S]{30,}\}/.test(t)&&(t.includes('"name"')||t.includes('"identity"')||t.includes('"soul"')||t.includes('"IDENTITY"')||t.includes('"SOUL"')):!1}function $e(t){const e=re(t.text);console.log("[AiChat] manualApply result:",e),e?(t.applyData=e,K(()=>U("apply",e))):alert("æœªèƒ½ä»æ¶ˆæ¯ä¸­æå–åˆ°é…ç½® JSONï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶")}function ie(t,e=0){const o=t.indexOf("{",e);if(o===-1)return null;let i=0,p=!1,d=!1;for(let h=o;h<t.length;h++){const g=t[h];if(d){d=!1;continue}if(g==="\\"&&p){d=!0;continue}if(g==='"'){p=!p;continue}if(!p){if(g==="{")i++;else if(g==="}"&&(i--,i===0))return{raw:t.slice(o,h+1),end:h+1}}}return null}function re(t){const e=/```(?:json)?\s*\n?([\s\S]*?)```/g,o=[];let i;for(;(i=e.exec(t))!==null;){const h=(i[1]??"").trim();h.startsWith("{")&&o.push(h)}for(let h=o.length-1;h>=0;h--){const g=o[h],s=ie(g);if(!s)continue;const c=Y(s.raw)??Y(ce(s.raw));if(c)return c}const p=[];let d=0;for(;d<t.length;){const h=ie(t,d);if(!h)break;p.push(h.raw),d=h.end}for(let h=p.length-1;h>=0;h--){const g=p[h],s=Y(g)??Y(ce(g));if(s)return s}return null}function Y(t){try{const e=JSON.parse(t);if(e&&typeof e=="object"&&!Array.isArray(e)){const o=["name","id","description","identity","soul","IDENTITY","SOUL","NAME","DESCRIPTION"];if(Object.keys(e).some(i=>o.includes(i)))return e}}catch{}return null}function ce(t){let e="",o=!1,i=!1;for(let p=0;p<t.length;p++){const d=t[p];if(i){e+=d,i=!1;continue}if(d==="\\"&&o){e+=d,i=!0;continue}if(d==='"'){o=!o,e+=d;continue}if(o&&d===`
`){e+="\\n";continue}if(o&&d==="\r"){e+="\\r";continue}e+=d}return e}const De={exec:"âš¡",bash:"âš¡",read:"ğŸ“–",write:"âœï¸",edit:"âœï¸",web_search:"ğŸŒ",web_fetch:"ğŸŒ",browser:"ğŸŒ",agent_spawn:"ğŸš€",agent_tasks:"ğŸ“‹",agent_kill:"ğŸ›‘",agent_result:"ğŸ“Š",project_read:"ğŸ“",project_write:"ğŸ“",project_list:"ğŸ“",project_create:"ğŸ“",project_glob:"ğŸ“",memory_search:"ğŸ§ ",memory_get:"ğŸ§ ",image:"ğŸ–¼ï¸",tts:"ğŸ”Š",cron:"â±ï¸"};function ue(t){return De[t]??"âš™ï¸"}function de(t,e){try{const o=JSON.parse(e);if(t==="exec"||t==="bash")return(o.command??"").slice(0,60);if(t==="read")return o.file_path??o.path??"";if(t==="write")return(o.file_path??o.path??"")+(o.content?` (${o.content.length}B)`:"");if(t==="edit")return o.file_path??o.path??"";if(t==="web_search")return o.query??"";if(t==="web_fetch")return o.url??"";if(t==="agent_spawn")return`â†’ ${o.agentId}: ${(o.task??"").slice(0,40)}`;if(t==="project_read"||t==="project_write")return o.path??"";if(t==="memory_search")return o.query??""}catch{}return""}const Me=new Set(["txt","md","markdown","js","ts","jsx","tsx","vue","go","py","rs","java","kt","swift","html","css","scss","less","json","yaml","yml","toml","ini","cfg","env","sh","bash","zsh","fish","ps1","bat","cmd","dockerfile","makefile","sql","graphql","proto","xml","svg","gitignore","gitattributes"]);function pe(t){const e=t.split(".").pop()?.toLowerCase()??"";return Me.has(e)}function Ae(t){const e=t.split(".").pop()?.toLowerCase()??"";return{js:"ğŸŸ¨",ts:"ğŸ”µ",vue:"ğŸ’š",go:"ğŸ¹",py:"ğŸ",rs:"ğŸ¦€",html:"ğŸŒ",css:"ğŸ¨",json:"ğŸ“‹",md:"ğŸ“",sh:"âš¡",sql:"ğŸ—„ï¸",yaml:"âš™ï¸",yml:"âš™ï¸",dockerfile:"ğŸ³"}[e]??"ğŸ“„"}function Ne(t){return t<1024?`${t}B`:t<1024*1024?`${(t/1024).toFixed(1)}KB`:`${(t/1024/1024).toFixed(1)}MB`}function je(t){const e=t.clipboardData?.items;if(e){for(const o of Array.from(e))if(o.type.startsWith("image/")){t.preventDefault();const i=o.getAsFile();i&&ee(i)}}}function Fe(t){t.preventDefault(),q++,H.value=!0}function Oe(t){t.preventDefault(),q--,q<=0&&(q=0,H.value=!1)}function Be(t){q=0,H.value=!1;const e=t.dataTransfer?.files;if(e)for(const o of Array.from(e))o.type.startsWith("image/")?ee(o):pe(o.name)&&he(o)}function Le(t){const e=t.target.files;if(e){for(const o of Array.from(e))o.type.startsWith("image/")?ee(o):pe(o.name)&&he(o);t.target.value=""}}function he(t){const e=new FileReader;e.onload=()=>{typeof e.result=="string"&&N.value.push({name:t.name,content:e.result})},e.readAsText(t)}function ee(t){const e=new FileReader;e.onload=()=>{typeof e.result=="string"&&A.value.push(e.result)},e.readAsDataURL(t)}function Re(t){A.value.splice(t,1)}function Q(){const t=L.value.trim(),e=[...A.value],o=[...N.value];if(!t&&!e.length&&!o.length||S.value)return;let i=t;if(o.length>0){const p=o.map(d=>{const h=d.name.split(".").pop()??"text";return`

ğŸ“ **${d.name}**
\`\`\`${h}
${d.content}
\`\`\``}).join("");i=t?t+p:p.trimStart()}L.value="",A.value=[],N.value=[],K(()=>{D.value&&(D.value.style.height="auto")}),U("message",i,e),te(i,e)}function te(t,e,o=!1){o||(_.value.push({role:"user",text:t,images:e.length?e:void 0}),I()),S.value=!0,y.value="",R.value="",$.value=[];const i={role:"assistant",text:"",toolCalls:[]};_.value.push(i),o&&I();const p=_.value.length-1;let d="",h;if(F.value)h=void 0;else{const s=_.value.slice(0,-1).filter(c=>(c.role==="user"||c.role==="assistant")&&c.text).slice(-20).map(c=>({role:c.role,content:c.text}));h=s.length>0?s:void 0}const g={sessionId:F.value,context:k.context,scenario:k.scenario,skillId:k.skillId,images:e.length?e:void 0,history:h};et(k.agentId,t,s=>{switch(s.type){case"thinking_delta":R.value+=s.text,I();break;case"text":case"text_delta":y.value+=s.text,I();break;case"tool_call":{const c={id:s.tool_call?.id??String(Date.now()),name:s.tool_call?.name??"tool",input:s.tool_call?.input?JSON.stringify(s.tool_call.input):void 0,status:"running",_startedAt:Date.now(),_expanded:!1};_.value[p].toolCalls.push(c),$.value.push(c),d=c.id,I();break}case"tool_result":{const c=_.value[p].toolCalls?.find(r=>r.id===d);if(c){if(c.result=s.text,c.status="done",c._startedAt){const v=Date.now()-c._startedAt;c.duration=v<1e3?`${v}ms`:`${(v/1e3).toFixed(1)}s`}if(c.name==="agent_spawn"&&s.text){const v=s.text.match(/ä»»åŠ¡\s*ID[ï¼š:]\s*([a-f0-9-]{8,})/i);v&&(c.taskId=v[1],c.taskStatus="pending",z.set(d,v[1]),oe())}const r=$.value.find(v=>v.id===d);r&&(r.result=c.result,r.status="done",r.duration=c.duration)}I();break}case"done":case"error":{if(s.type==="done"&&s.sessionId){const v=!F.value;F.value=s.sessionId,v&&U("session-change",s.sessionId)}const c=_.value[p];if(c.text=y.value,c.thinking=R.value||void 0,k.applyable){const v=re(y.value);v?(c.applyData=v,console.log("[AiChat] applyData extracted:",v)):console.log("[AiChat] no applyData found in text length:",y.value.length)}const r=Ie(y.value);if(r.length>=2&&(c.options=r),s.type==="error"){c.text=`[é”™è¯¯] ${s.error}`;const v=c.toolCalls?.find(Z=>Z.status==="running");v&&(v.status="error")}S.value=!1,y.value="",R.value="",$.value=[],U("response",c.text),I();break}}},g)}function Pe(){_.value=[]}function Ee(t){_.value.push(t),I()}async function Je(t){F.value=t,_.value=[],P.value=!0;try{const o=(await tt.get(k.agentId,t)).data.messages??[],i=[];o.some(d=>d.isCompact||d.role==="compaction")&&i.push({role:"system",text:"æ›´æ—©çš„å†…å®¹å·²å‹ç¼©"});for(const d of o)d.role!=="compaction"&&i.push({role:d.role,text:d.text});_.value=i,I(),be(t)}catch(e){e?.response?.status===404?_.value=[]:(console.error("[AiChat] resumeSession failed",e),_.value=[{role:"system",text:"å†å²åŠ è½½å¤±è´¥ï¼Œç»§ç»­å¯¹è¯ä»å¯æ¥ç»­"}])}finally{P.value=!1}}function Ue(){F.value=void 0,_.value=[]}function ze(t){X(t),K(Q)}function He(t){te(t,[],!0)}return ge({clearMessages:Pe,appendMessage:Ee,sendText:ze,sendSilent:He,fillInput:X,messages:_,streaming:S,currentSessionId:F,resumeSession:Je,startNewSession:Ue}),We(()=>{I()}),(t,e)=>{const o=J("ChatRound"),i=J("el-icon"),p=J("Check"),d=J("CopyDocument"),h=J("Setting"),g=J("Paperclip");return n(),a("div",{class:M(["ai-chat",{compact:C.compact,"has-bg":C.bgColor,"drag-active":H.value}]),style:Ge(ke.value),onDragenter:O(Fe,["prevent"]),onDragover:e[4]||(e[4]=O(()=>{},["prevent"])),onDragleave:Oe,onDrop:O(Be,["prevent","stop"])},[x(Xe,{name:"drag-fade"},{default:B(()=>[H.value?(n(),a("div",nt,[...e[5]||(e[5]=[l("div",{class:"drag-overlay-content"},[l("div",{class:"drag-overlay-icon"},"ğŸ“"),l("div",{class:"drag-overlay-title"},"æ¾å¼€ä»¥é™„åŠ æ–‡ä»¶"),l("div",{class:"drag-overlay-hint"},"æ”¯æŒå›¾ç‰‡ Â· ä»£ç  Â· æ–‡æœ¬æ–‡ä»¶")],-1)])])):u("",!0)]),_:1}),ne.value>0?(n(),a("div",ot,[e[6]||(e[6]=l("span",{class:"running-dot"},null,-1)),l("span",null,"åå°æœ‰ "+f(ne.value)+" ä¸ªä»»åŠ¡æ­£åœ¨æ‰§è¡Œä¸­ï¼Œå…³é—­çª—å£åä»ä¼šç»§ç»­è¿è¡Œ",1),j.value.length?(n(),a("span",at,[(n(!0),a(w,null,T(j.value.filter(s=>!["done","error","killed"].includes(s.status)),s=>(n(),a("span",{key:s.id,class:M(["resumed-chip",s.status])},f(s.status==="running"?"âŸ³":"ğŸŸ¡")+" "+f(s.label),3))),128))])):u("",!0)])):u("",!0),l("div",{class:"chat-messages",ref_key:"msgListRef",ref:G},[P.value?(n(),a("div",lt,[...e[7]||(e[7]=[l("div",{class:"history-loading-dots"},[l("span"),l("span"),l("span")],-1),l("div",{class:"history-loading-text"},"åŠ è½½å†å²å¯¹è¯â€¦",-1)])])):u("",!0),!_.value.length&&!P.value?(n(),a("div",it,[C.welcomeMessage?(n(),a("div",rt,f(C.welcomeMessage),1)):u("",!0),C.examples.length?(n(),a("div",ct,[(n(!0),a(w,null,T(C.examples,(s,c)=>(n(),a("div",{key:c,class:"example-chip",onClick:r=>X(s)},f(s),9,ut))),128))])):u("",!0)])):u("",!0),(n(!0),a(w,null,T(S.value?_.value.slice(0,-1):_.value,(s,c)=>(n(),a(w,{key:c},[s.role==="user"?(n(),a("div",dt,[l("div",pt,[s.images?.length?(n(),a("div",ht,[(n(!0),a(w,null,T(s.images,(r,v)=>(n(),a("img",{key:v,src:r,class:"msg-img",onClick:Z=>Se(r)},null,8,ft))),128))])):u("",!0),l("div",vt,f(s.text),1)])])):s.role==="assistant"?(n(),a("div",_t,[l("div",gt,[s.thinking?(n(),a("details",{key:0,class:"thinking-block",open:C.showThinking},[l("summary",kt,[x(i,{class:"thinking-icon"},{default:B(()=>[x(o)]),_:1}),e[8]||(e[8]=E(" æ€è€ƒè¿‡ç¨‹ ",-1)),l("span",yt,f(s.thinking.length)+" å­—ç¬¦",1)]),l("pre",bt,f(s.thinking),1)],8,mt)):u("",!0),s.toolCalls?.length?(n(),a("div",xt,[(n(!0),a(w,null,T(s.toolCalls,(r,v)=>(n(),a("div",{key:v,class:M(["tool-step",r.status]),onClick:Z=>r._expanded=!r._expanded},[l("div",Ct,[l("span",{class:M(["tool-step-dot",r.status])},[r.status==="running"?(n(),a("span",St,"âŸ³")):r.status==="done"?(n(),a("span",It,"âœ“")):r.status==="error"?(n(),a("span",Tt,"âœ—")):(n(),a("span",$t,"â—‹"))],2),l("span",Dt,f(ue(r.name)),1),l("code",Mt,f(r.name),1),r.input?(n(),a("span",At,f(de(r.name,r.input)),1)):u("",!0),e[10]||(e[10]=l("span",{class:"tool-step-flex"},null,-1)),r.duration?(n(),a("span",Nt,f(r.duration),1)):u("",!0),r.taskId?(n(),a("span",{key:2,class:M(["task-badge",r.taskStatus])},[r.taskStatus==="pending"?(n(),a("span",jt,"ğŸŸ¡ æ’é˜Ÿä¸­")):r.taskStatus==="running"?(n(),a("span",Ft,[...e[9]||(e[9]=[l("span",{class:"tool-spin"},"âŸ³",-1),E(" æ‰§è¡Œä¸­ ",-1)])])):r.taskStatus==="done"?(n(),a("span",Ot,"âœ… å®Œæˆ")):r.taskStatus==="error"?(n(),a("span",Bt,"âŒ å¤±è´¥")):r.taskStatus==="killed"?(n(),a("span",Lt,"ğŸ›‘ å·²ç»ˆæ­¢")):u("",!0)],2)):u("",!0),l("span",Rt,f(r._expanded?"â–²":"â–¼"),1)]),r._expanded?(n(),a("div",{key:0,class:"tool-step-body",onClick:e[0]||(e[0]=O(()=>{},["stop"]))},[r.input?(n(),a("div",Pt,[e[11]||(e[11]=l("div",{class:"tool-label"},"INPUT",-1)),l("pre",Et,f(ae(r.input)),1)])):u("",!0),r.result?(n(),a("div",Jt,[e[12]||(e[12]=l("div",{class:"tool-label"},"OUTPUT",-1)),l("pre",Ut,f(r.result.slice(0,3e3))+f(r.result.length>3e3?`
â€¦ (æˆªæ–­)`:""),1)])):u("",!0)])):u("",!0)],10,wt))),128))])):u("",!0),l("div",zt,[s.text?(n(),a("div",{key:0,class:"msg-text",innerHTML:le(s.text)},null,8,Ht)):u("",!0),s.applyData&&k.applyable?(n(),a("div",qt,[l("div",Kt,[(n(!0),a(w,null,T(s.applyData,(r,v)=>(n(),a("div",{key:v,class:"apply-row"},[l("span",Vt,f(v),1),l("span",Wt,f(String(r).slice(0,60))+f(String(r).length>60?"â€¦":""),1)]))),128))]),l("button",{class:"apply-btn",onClick:r=>t.$emit("apply",s.applyData)}," åº”ç”¨åˆ°è¡¨å• â†™ ",8,Gt)])):u("",!0),l("div",Xt,[l("button",{class:"act-btn",onClick:r=>we(s.text),title:V.value===c?"å·²å¤åˆ¶":"å¤åˆ¶"},[V.value===c?(n(),_e(i,{key:0},{default:B(()=>[x(p)]),_:1})):(n(),_e(i,{key:1},{default:B(()=>[x(d)]),_:1}))],8,Yt),l("button",{class:"act-btn",onClick:r=>Ce(c),title:"é‡è¯•"},"â†º",8,Qt),k.applyable&&!s.applyData&&Te(s.text)?(n(),a("button",{key:0,class:"act-btn apply-manual-btn",onClick:r=>$e(s),title:"æ£€æµ‹åˆ°é…ç½® JSONï¼Œç‚¹å‡»åº”ç”¨"},[x(i,null,{default:B(()=>[x(h)]),_:1}),e[13]||(e[13]=E(" åº”ç”¨é…ç½® ",-1))],8,Zt)):u("",!0)])]),s.options&&s.options.length?(n(),a("div",es,[(n(!0),a(w,null,T(s.options,(r,v)=>(n(),a("button",{key:v,class:"option-chip",onClick:Z=>X(r)},f(r),9,ts))),128))])):u("",!0)])])):s.role==="system"?(n(),a("div",ss,[l("div",ns,f(s.text),1)])):u("",!0)],64))),128)),S.value?(n(),a("div",os,[l("div",as,[R.value&&C.showThinking?(n(),a("details",ls,[l("summary",is,[x(i,{class:"thinking-icon"},{default:B(()=>[x(o)]),_:1}),e[14]||(e[14]=E(" æ€è€ƒä¸­â€¦ ",-1))]),l("pre",rs,[E(f(R.value),1),e[15]||(e[15]=l("span",{class:"blink"},"â–Š",-1))])])):u("",!0),$.value.length?(n(),a("div",cs,[(n(!0),a(w,null,T($.value,(s,c)=>(n(),a("div",{key:c,class:M(["tool-step",s.status]),onClick:r=>s._expanded=!s._expanded},[l("div",ds,[l("span",{class:M(["tool-step-dot",s.status])},[s.status==="running"?(n(),a("span",ps,"âŸ³")):s.status==="done"?(n(),a("span",hs,"âœ“")):s.status==="error"?(n(),a("span",fs,"âœ—")):u("",!0)],2),l("span",vs,f(ue(s.name)),1),l("code",_s,f(s.name),1),s.input?(n(),a("span",gs,f(de(s.name,s.input)),1)):u("",!0),e[17]||(e[17]=l("span",{class:"tool-step-flex"},null,-1)),s.duration?(n(),a("span",ms,f(s.duration),1)):u("",!0),s.taskId?(n(),a("span",{key:2,class:M(["task-badge",s.taskStatus])},[s.taskStatus==="pending"?(n(),a("span",ks,"ğŸŸ¡ æ’é˜Ÿä¸­")):s.taskStatus==="running"?(n(),a("span",ys,[...e[16]||(e[16]=[l("span",{class:"tool-spin"},"âŸ³",-1),E(" æ‰§è¡Œä¸­",-1)])])):s.taskStatus==="done"?(n(),a("span",bs,"âœ… å®Œæˆ")):s.taskStatus==="error"?(n(),a("span",xs,"âŒ å¤±è´¥")):s.taskStatus==="killed"?(n(),a("span",ws,"ğŸ›‘ å·²ç»ˆæ­¢")):u("",!0)],2)):u("",!0),l("span",Cs,f(s._expanded?"â–²":"â–¼"),1)]),s._expanded?(n(),a("div",{key:0,class:"tool-step-body",onClick:e[1]||(e[1]=O(()=>{},["stop"]))},[s.input?(n(),a("div",Ss,[e[18]||(e[18]=l("div",{class:"tool-label"},"INPUT",-1)),l("pre",Is,f(ae(s.input)),1)])):u("",!0),s.result?(n(),a("div",Ts,[e[19]||(e[19]=l("div",{class:"tool-label"},"OUTPUT",-1)),l("pre",$s,f(s.result.slice(0,3e3)),1)])):u("",!0)])):u("",!0)],10,us))),128))])):u("",!0),y.value||!$.value.length?(n(),a("div",Ds,[!y.value&&!$.value.length?(n(),a("div",Ms,[...e[20]||(e[20]=[l("span",null,null,-1),l("span",null,null,-1),l("span",null,null,-1)])])):u("",!0),y.value?(n(),a("div",{key:1,class:"msg-text",innerHTML:le(y.value)},null,8,As)):u("",!0),y.value?(n(),a("span",Ns,"â–Š")):u("",!0)])):u("",!0)])])):u("",!0)],512),W.value?(n(),a("div",{key:1,class:"img-preview-mask",onClick:e[2]||(e[2]=s=>W.value="")},[l("img",{src:W.value,class:"img-preview-full"},null,8,js)])):u("",!0),l("div",Fs,[A.value.length||N.value.length?(n(),a("div",Os,[(n(!0),a(w,null,T(A.value,(s,c)=>(n(),a("div",{key:"img-"+c,class:"attach-thumb"},[l("img",{src:s},null,8,Bs),l("button",{class:"remove-attach",onClick:r=>Re(c)},"Ã—",8,Ls)]))),128)),(n(!0),a(w,null,T(N.value,(s,c)=>(n(),a("div",{key:"file-"+c,class:"attach-file-chip"},[l("span",Rs,f(Ae(s.name)),1),l("span",Ps,f(s.name),1),l("span",Es,f(Ne(s.content.length)),1),l("button",{class:"attach-file-remove",onClick:r=>N.value.splice(c,1)},"Ã—",8,Js)]))),128))])):u("",!0),l("div",Us,[l("div",zs,[Ye(l("textarea",{ref_key:"inputRef",ref:D,"onUpdate:modelValue":e[3]||(e[3]=s=>L.value=s),placeholder:C.placeholder||"è¾“å…¥æ¶ˆæ¯â€¦ æ”¯æŒæ‹–æ‹½å›¾ç‰‡æˆ–æ–‡ä»¶ (Ctrl+Enter å‘é€)",disabled:S.value||P.value,rows:"1",class:"chat-textarea",onKeydown:[fe(O(Q,["ctrl","prevent"]),["enter"]),fe(O(Q,["meta","prevent"]),["enter"])],onPaste:je,onInput:xe},null,40,Hs),[[Qe,L.value]])]),l("div",qs,[l("label",Ks,[x(i,null,{default:B(()=>[x(g)]),_:1}),l("input",{type:"file",multiple:"",hidden:"",onChange:Le},null,32)]),l("button",{class:"send-btn",disabled:S.value||P.value||!L.value.trim()&&!A.value.length&&!N.value.length,onClick:Q},[S.value?(n(),a("span",Ws)):(n(),a("span",Gs,"â†‘"))],8,Vs)])]),e[21]||(e[21]=l("div",{class:"input-hint"},"Ctrl+Enter å‘é€ Â· æ”¯æŒæ‹–æ‹½å›¾ç‰‡/æ–‡ä»¶",-1))])],38)}}}),en=st(Xs,[["__scopeId","data-v-77b21f61"]]);export{en as A};
