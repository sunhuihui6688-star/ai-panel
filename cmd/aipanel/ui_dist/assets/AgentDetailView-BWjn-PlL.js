import{d as Fe,i as Ne,E as c,j as P,w as n,n as Ae,g as s,r as o,a as t,f as m,l as De,p as Ie,t as _,e as d,c as v,k as te,F as K,m as E,q as Se,b as Be,s as le,o as p,v as Ee,_ as Le}from"./index-B-U8TcRI.js";import{b as Ye,f as y,c as $,d as Oe}from"./index-BEdvr7UB.js";const Re={class:"header-left"},Pe={class:"chat-container"},Ke={class:"msg-bubble"},He={key:0,class:"tool-block"},qe={class:"tool-result"},Je=["innerHTML"],We={key:0,class:"chat-msg assistant"},je={class:"msg-bubble"},Ge={class:"msg-text"},Qe={class:"chat-input"},Xe={key:0},Ze={style:{"margin-top":"8px",display:"flex",gap:"8px","align-items":"center"}},et=Fe({__name:"AgentDetailView",setup(tt){const i=Ae().params.id,h=s(null),L=s("chat"),V=s([]),z=s(""),x=s(!1),w=s(""),H=s(),F=s(""),N=s(""),A=s(""),Y=s([]),q=s([]),g=s(""),k=s(""),D=s(null),J=s([]),T=s(!1),u=s({name:"",expr:"0 9 * * *",tz:"Asia/Shanghai",message:"",enabled:!0});function ae(l){return l==="running"?"success":l==="stopped"?"danger":"info"}function ne(l){return l==="running"?"ËøêË°å‰∏≠":l==="stopped"?"Â∑≤ÂÅúÊ≠¢":"Á©∫Èó≤"}function oe(l){return(l||"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/`(.*?)`/g,"<code>$1</code>").replace(/\n/g,"<br>")}function se(l){return l<1024?l+" B":l<1048576?(l/1024).toFixed(1)+" KB":(l/1048576).toFixed(1)+" MB"}function ue(l){return new Date(l).toLocaleString()}Ne(async()=>{try{const l=await Ye.get(i);h.value=l.data}catch{c.error("Âä†ËΩΩ Agent Â§±Ë¥•")}re(),ie(),O()});async function W(){const l=z.value.trim();!l||x.value||(V.value.push({role:"user",text:l}),z.value="",x.value=!0,w.value="",await le(),j(),Oe(i,l,e=>{if(e.type==="text_delta")w.value+=e.text,j();else if(e.type==="tool_call")V.value.push({role:"tool",text:"",toolName:e.tool_call?.name||"tool"});else if(e.type==="tool_result"){const r=V.value[V.value.length-1];r?.role==="tool"&&(r.text=e.text)}else e.type==="done"?(w.value&&V.value.push({role:"assistant",text:w.value}),w.value="",x.value=!1):e.type==="error"&&(c.error(e.error||"ËØ∑Ê±ÇÂ§±Ë¥•"),x.value=!1)}))}function j(){le(()=>{const l=H.value;l&&(l.scrollTop=l.scrollHeight)})}async function re(){try{const[l,e,r]=await Promise.all([y.read(i,"IDENTITY.md"),y.read(i,"SOUL.md"),y.read(i,"MEMORY.md")]);F.value=l.data?.content||"",N.value=e.data?.content||"",A.value=r.data?.content||""}catch{}try{const l=await y.read(i,"memory");Array.isArray(l.data)&&(Y.value=l.data)}catch{}}async function I(l,e){try{await y.write(i,l,e),c.success(`${l} Â∑≤‰øùÂ≠ò`)}catch{c.error(`‰øùÂ≠ò ${l} Â§±Ë¥•`)}}async function de(l){g.value=`memory/${l}`;try{const e=await y.read(i,`memory/${l}`);k.value=e.data?.content||"",L.value="workspace"}catch{}}async function ie(){try{const l=await y.read(i,"/");Array.isArray(l.data)&&(q.value=l.data.map(e=>({name:e.name,isDir:e.isDir,size:e.size,modTime:e.modTime,path:e.name})))}catch{}}async function ce(l){if(!l.isDir){g.value=l.path||l.name,D.value=l;try{const e=await y.read(i,g.value);k.value=e.data?.content||""}catch{k.value="(Êó†Ê≥ïËØªÂèñ)"}}}async function me(){g.value&&await I(g.value,k.value)}async function O(){try{const l=await $.list();J.value=l.data}catch{}}async function pe(){try{await $.create({name:u.value.name,enabled:u.value.enabled,schedule:{kind:"cron",expr:u.value.expr,tz:u.value.tz},payload:{kind:"agentTurn",message:u.value.message,agentId:i},delivery:{mode:"announce"}}),c.success("‰ªªÂä°ÂàõÂª∫ÊàêÂäü"),T.value=!1,O()}catch(l){c.error(l.response?.data?.error||"ÂàõÂª∫Â§±Ë¥•")}}async function _e(l){try{await $.update(l.id,l)}catch{c.error("Êõ¥Êñ∞Â§±Ë¥•")}}async function fe(l){try{await $.run(l.id),c.success("Â∑≤Ëß¶ÂèëËøêË°å")}catch{c.error("ËøêË°åÂ§±Ë¥•")}}async function ve(l){try{await $.delete(l.id),c.success("Â∑≤Âà†Èô§"),O()}catch{c.error("Âà†Èô§Â§±Ë¥•")}}return(l,e)=>{const r=o("el-button"),G=o("el-tag"),Q=o("el-text"),ye=o("el-header"),ge=o("el-collapse-item"),be=o("el-collapse"),f=o("el-input"),Ve=o("Promotion"),X=o("el-icon"),U=o("el-tab-pane"),C=o("el-card"),S=o("el-col"),Z=o("el-row"),xe=o("el-empty"),we=o("el-tree"),ke=o("Plus"),B=o("el-table-column"),ee=o("el-switch"),Ce=o("el-table"),M=o("el-form-item"),R=o("el-option"),he=o("el-select"),Te=o("el-form"),Ue=o("el-dialog"),Me=o("el-tabs"),$e=o("el-main"),ze=o("el-container");return p(),P(ze,{class:"agent-detail"},{default:n(()=>[t(ye,{class:"detail-header"},{default:n(()=>[m("div",Re,[t(r,{icon:De(Ie),onClick:e[0]||(e[0]=a=>l.$router.push("/")),circle:""},null,8,["icon"]),m("h2",null,_(h.value?.name||"..."),1),t(G,{type:ae(h.value?.status)},{default:n(()=>[d(_(ne(h.value?.status)),1)]),_:1},8,["type"])]),t(Q,{type:"info"},{default:n(()=>[d(_(h.value?.model),1)]),_:1})]),_:1}),t($e,null,{default:n(()=>[t(Me,{modelValue:L.value,"onUpdate:modelValue":e[17]||(e[17]=a=>L.value=a),type:"border-card"},{default:n(()=>[t(U,{label:"ÂØπËØù",name:"chat"},{default:n(()=>[m("div",Pe,[m("div",{class:"chat-messages",ref_key:"chatMessagesRef",ref:H},[(p(!0),v(K,null,te(V.value,(a,b)=>(p(),v("div",{key:b,class:Ee(["chat-msg",a.role])},[m("div",Ke,[a.role==="tool"?(p(),v("div",He,[t(be,null,{default:n(()=>[t(ge,{title:"üîß "+(a.toolName||"tool")},{default:n(()=>[m("pre",qe,_(a.text?.slice(0,500)),1)]),_:2},1032,["title"])]),_:2},1024)])):(p(),v("div",{key:1,class:"msg-text",innerHTML:oe(a.text)},null,8,Je))])],2))),128)),x.value?(p(),v("div",We,[m("div",je,[m("div",Ge,[d(_(w.value),1),e[18]||(e[18]=m("span",{class:"cursor"},"‚ñä",-1))])])])):E("",!0)],512),m("div",Qe,[t(f,{modelValue:z.value,"onUpdate:modelValue":e[1]||(e[1]=a=>z.value=a),type:"textarea",rows:2,placeholder:"ËæìÂÖ•Ê∂àÊÅØ...",onKeydown:Se(Be(W,["ctrl"]),["enter"])},null,8,["modelValue","onKeydown"]),t(r,{type:"primary",onClick:W,loading:x.value,style:{"margin-top":"8px"}},{default:n(()=>[t(X,null,{default:n(()=>[t(Ve)]),_:1}),e[19]||(e[19]=d(" ÂèëÈÄÅ ",-1))]),_:1},8,["loading"])])])]),_:1}),t(U,{label:"Ë∫´‰ªΩ & ÁÅµÈ≠Ç",name:"identity"},{default:n(()=>[t(Z,{gutter:20},{default:n(()=>[t(S,{span:12},{default:n(()=>[t(C,{header:"IDENTITY.md"},{default:n(()=>[t(f,{modelValue:F.value,"onUpdate:modelValue":e[2]||(e[2]=a=>F.value=a),type:"textarea",rows:15,onBlur:e[3]||(e[3]=a=>I("IDENTITY.md",F.value))},null,8,["modelValue"])]),_:1})]),_:1}),t(S,{span:12},{default:n(()=>[t(C,{header:"SOUL.md"},{default:n(()=>[t(f,{modelValue:N.value,"onUpdate:modelValue":e[4]||(e[4]=a=>N.value=a),type:"textarea",rows:15,onBlur:e[5]||(e[5]=a=>I("SOUL.md",N.value))},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),t(U,{label:"ËÆ∞ÂøÜ",name:"memory"},{default:n(()=>[t(C,{header:"MEMORY.md"},{default:n(()=>[t(f,{modelValue:A.value,"onUpdate:modelValue":e[6]||(e[6]=a=>A.value=a),type:"textarea",rows:15,onBlur:e[7]||(e[7]=a=>I("MEMORY.md",A.value))},null,8,["modelValue"])]),_:1}),t(C,{header:"ËÆ∞ÂøÜÊñá‰ª∂",style:{"margin-top":"16px"}},{default:n(()=>[Y.value.length===0?(p(),v("div",Xe,[t(xe,{description:"ÊöÇÊó†ËÆ∞ÂøÜÊñá‰ª∂","image-size":60})])):E("",!0),(p(!0),v(K,null,te(Y.value,a=>(p(),P(G,{key:a.name,style:{margin:"4px",cursor:"pointer"},onClick:b=>de(a.name)},{default:n(()=>[d(_(a.name),1)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1}),t(U,{label:"Â∑•‰ΩúÂå∫",name:"workspace"},{default:n(()=>[t(Z,{gutter:20},{default:n(()=>[t(S,{span:8},{default:n(()=>[t(C,{header:"Êñá‰ª∂ÂàóË°®"},{default:n(()=>[t(we,{data:q.value,props:{label:"name",children:"children"},onNodeClick:ce,"highlight-current":"","default-expand-all":""},null,8,["data"])]),_:1})]),_:1}),t(S,{span:16},{default:n(()=>[t(C,{header:g.value||"ÈÄâÊã©Êñá‰ª∂Êü•Áúã"},{default:n(()=>[g.value?(p(),v(K,{key:0},[t(f,{modelValue:k.value,"onUpdate:modelValue":e[8]||(e[8]=a=>k.value=a),type:"textarea",rows:20},null,8,["modelValue"]),m("div",Ze,[t(r,{type:"primary",onClick:me},{default:n(()=>[...e[20]||(e[20]=[d("‰øùÂ≠ò",-1)])]),_:1}),D.value?(p(),P(Q,{key:0,type:"info",size:"small"},{default:n(()=>[d(_(se(D.value.size))+" ¬∑ "+_(ue(D.value.modTime)),1)]),_:1})):E("",!0)])],64)):E("",!0)]),_:1},8,["header"])]),_:1})]),_:1})]),_:1}),t(U,{label:"ÂÆöÊó∂‰ªªÂä°",name:"cron"},{default:n(()=>[t(r,{type:"primary",onClick:e[9]||(e[9]=a=>T.value=!0),style:{"margin-bottom":"16px"}},{default:n(()=>[t(X,null,{default:n(()=>[t(ke)]),_:1}),e[21]||(e[21]=d(" Êñ∞Âª∫‰ªªÂä° ",-1))]),_:1}),t(Ce,{data:J.value,stripe:""},{default:n(()=>[t(B,{prop:"name",label:"ÂêçÁß∞"}),t(B,{label:"Ë∞ÉÂ∫¶"},{default:n(({row:a})=>[d(_(a.schedule?.expr)+" ("+_(a.schedule?.tz)+")",1)]),_:1}),t(B,{label:"ÂêØÁî®",width:"80"},{default:n(({row:a})=>[t(ee,{modelValue:a.enabled,"onUpdate:modelValue":b=>a.enabled=b,onChange:b=>_e(a)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),t(B,{label:"Êìç‰Ωú",width:"200"},{default:n(({row:a})=>[t(r,{size:"small",onClick:b=>fe(a)},{default:n(()=>[...e[22]||(e[22]=[d("Á´ãÂç≥ËøêË°å",-1)])]),_:1},8,["onClick"]),t(r,{size:"small",type:"danger",onClick:b=>ve(a)},{default:n(()=>[...e[23]||(e[23]=[d("Âà†Èô§",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]),t(Ue,{modelValue:T.value,"onUpdate:modelValue":e[16]||(e[16]=a=>T.value=a),title:"Êñ∞Âª∫ÂÆöÊó∂‰ªªÂä°",width:"520px"},{footer:n(()=>[t(r,{onClick:e[15]||(e[15]=a=>T.value=!1)},{default:n(()=>[...e[24]||(e[24]=[d("ÂèñÊ∂à",-1)])]),_:1}),t(r,{type:"primary",onClick:pe},{default:n(()=>[...e[25]||(e[25]=[d("ÂàõÂª∫",-1)])]),_:1})]),default:n(()=>[t(Te,{model:u.value,"label-width":"100px"},{default:n(()=>[t(M,{label:"ÂêçÁß∞"},{default:n(()=>[t(f,{modelValue:u.value.name,"onUpdate:modelValue":e[10]||(e[10]=a=>u.value.name=a)},null,8,["modelValue"])]),_:1}),t(M,{label:"Cron Ë°®ËææÂºè"},{default:n(()=>[t(f,{modelValue:u.value.expr,"onUpdate:modelValue":e[11]||(e[11]=a=>u.value.expr=a),placeholder:"30 3 * * *"},null,8,["modelValue"])]),_:1}),t(M,{label:"Êó∂Âå∫"},{default:n(()=>[t(he,{modelValue:u.value.tz,"onUpdate:modelValue":e[12]||(e[12]=a=>u.value.tz=a)},{default:n(()=>[t(R,{label:"Asia/Shanghai",value:"Asia/Shanghai"}),t(R,{label:"UTC",value:"UTC"}),t(R,{label:"America/New_York",value:"America/New_York"})]),_:1},8,["modelValue"])]),_:1}),t(M,{label:"Ê∂àÊÅØ"},{default:n(()=>[t(f,{modelValue:u.value.message,"onUpdate:modelValue":e[13]||(e[13]=a=>u.value.message=a),type:"textarea",rows:3},null,8,["modelValue"])]),_:1}),t(M,{label:"ÂêØÁî®"},{default:n(()=>[t(ee,{modelValue:u.value.enabled,"onUpdate:modelValue":e[14]||(e[14]=a=>u.value.enabled=a)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})}}}),ot=Le(et,[["__scopeId","data-v-eb1993bd"]]);export{ot as default};
