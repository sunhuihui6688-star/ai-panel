import{d as Zl,h as et,o as i,c as f,b as s,a as e,w as t,j as h,F as D,l as J,q as Ye,t as r,i as x,f as o,e as lt,m as ol,B as Pt,k as S,g as d,x as il,E as v,r as p,C as Il,D as Rt,y as Wt,z as al,n as nl,G as jt,H as Ll,I as Kt,J as Ot,K as Yt,L as qt,M as Ht}from"./index-CfMkOgSO.js";import{g as je,f as be,b as Al,h as Ke,i as Oe,j as Jt,e as sl,r as Ql,k as H,l as Xl}from"./index-sb85_xT4.js";import{A as tt}from"./AiChat-6RCUep7c.js";import{_ as at}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Gt={class:"skill-studio"},Qt={class:"studio-sidebar"},Xt={class:"sidebar-top"},Zt={class:"sidebar-acts"},ea={class:"skill-list"},la={key:0,class:"list-empty"},ta=["onClick"],aa={class:"sk-icon"},na={key:0},sa={class:"sk-info"},oa={class:"sk-name"},ia={class:"sk-id"},ua={class:"sk-right"},da={class:"studio-editor"},ra={key:0,class:"editor-empty"},ma={class:"editor-toolbar"},pa={class:"editor-breadcrumb"},fa={class:"crumb-name"},va={class:"toolbar-acts"},ca={class:"editor-body"},ya={class:"file-tree"},ga={class:"tree-item tree-dir"},_a={key:0,class:"file-editor"},ba={class:"file-editor-head"},wa={style:{display:"flex","align-items":"center",gap:"10px"}},ka={style:{"font-size":"12px",color:"#909399"}},xa={class:"json-preview"},Ca={key:1,class:"file-editor"},ha={class:"file-editor-head"},Va={style:{"margin-left":"auto",display:"flex","align-items":"center",gap:"8px"}},za={style:{"font-size":"11px",color:"#c0c4cc"}},$a={class:"studio-chat"},Ta={class:"chat-panel-head"},Sa={key:0,style:{"margin-left":"auto","font-size":"11px",color:"#c0c4cc"}},Ua={class:"chat-wrap"},Ia=Zl({__name:"SkillStudio",props:{agentId:{}},setup(Fl){const Z=Fl,y=Z.agentId,j=d([]),ee=d(!1),g=d(null),W=d("meta"),C=d({name:"",icon:"",category:"",description:"",version:"1.0.0",enabled:!0}),L=d(""),we=d(!1),re=d(!1),Ie=d(!1),ke=d(!1),se=d(!1),le=d(null),me=il(()=>g.value?`你是一个技能配置助手，正在帮助用户配置技能「${g.value.name}」（ID: ${g.value.id}）。

当前 SKILL.md 内容：
\`\`\`markdown
${L.value||"（空）"}
\`\`\`

你可以帮助：
- 优化或重写 SKILL.md 系统提示词
- 测试技能效果（用户发消息即可测试）
- 给出技能设计建议`:"你是一个技能配置助手，帮助用户设计和优化 AI 技能的系统提示词。"),pe=il(()=>g.value?se.value?`新技能已创建（ID: ${g.value.id}）。告诉我你想要什么功能，我来帮你生成完整的 SKILL.md 内容，生成后直接点保存即可。`:`当前编辑「${g.value.name}」。你可以让我优化 SKILL.md、测试效果，或者直接对话体验当前技能。`:"选择一个技能后，我可以帮你优化配置、写 SKILL.md、测试效果。"),Le=il(()=>g.value?se.value?["我需要一个中英互译技能，风格自然流畅","帮我做一个 Go 代码审查专家，严格遵循最佳实践","创建一个数据分析助手，擅长 SQL 和 Python"]:[`帮我优化「${g.value.name}」的 SKILL.md`,"这个技能怎么写效果更好？","用中文回答一道历史题，测试当前技能效果"]:["帮我设计一个代码审查技能","帮我写一个翻译助手的 SKILL.md"]);async function M(){ee.value=!0;try{const w=await je.list(y);if(j.value=w.data||[],g.value){const m=j.value.find(K=>K.id===g.value.id);m&&(g.value=m,qe(m))}}catch{}finally{ee.value=!1}}function qe(w){C.value={name:w.name,icon:w.icon||"",category:w.category||"",description:w.description||"",version:w.version||"1.0.0",enabled:w.enabled}}async function Ae(w){g.value=w,qe(w),W.value="meta",re.value=!1,L.value="",se.value=!1,le.value?.resumeSession?.(`skill-studio-${w.id}`)}async function He(){g.value&&W.value!=="prompt"&&(W.value="prompt",L.value||await fe())}async function ul(){if(g.value){Ie.value=!0;try{await je.update(Z.agentId,g.value.id,{name:C.value.name,icon:C.value.icon,category:C.value.category,description:C.value.description,enabled:C.value.enabled}),(W.value==="prompt"||L.value)&&(await be.write(y,`skills/${g.value.id}/SKILL.md`,L.value),re.value=!1),v.success("保存成功"),await M()}catch(w){v.error(w.response?.data?.error||"保存失败")}finally{Ie.value=!1}}}async function xe(w,m){try{await je.update(Z.agentId,w.id,{enabled:m}),await M()}catch{v.error("操作失败")}}async function Ce(){if(g.value)try{await je.remove(Z.agentId,g.value.id),v.success("已删除"),g.value=null,await M()}catch{v.error("删除失败")}}async function A(){if(ke.value)return;ke.value=!0;const w="skill_"+Date.now().toString(36);try{await je.create(Z.agentId,{meta:{id:w,name:"新技能",icon:"",category:"",description:"",version:"1.0.0",enabled:!1,source:"local",installedAt:""},promptContent:""}),await M();const m=j.value.find(K=>K.id===w);m&&(await Ae(m),W.value="prompt",L.value="",se.value=!0)}catch(m){v.error(m.response?.data?.error||"创建失败")}finally{ke.value=!1}}async function Fe(w){g.value&&(se.value=!1,await M(),W.value==="prompt"&&await fe())}async function fe(){if(g.value){we.value=!0;try{const w=await be.read(y,`skills/${g.value.id}/SKILL.md`);L.value=w.data?.content||"",re.value=!1}catch{L.value=""}finally{we.value=!1}}}async function dl(){if(!g.value)return;L.value||await He();const w=`请用「${g.value.name}」技能效果回复：你好，请介绍一下你的功能。`;le.value?.fillInput?.(w),v.info("测试消息已填入右侧聊天框，点击发送即可测试")}return et(M),(w,m)=>{const K=p("Refresh"),T=p("el-icon"),O=p("el-button"),ve=p("Plus"),oe=p("Tools"),G=p("el-tag"),he=p("el-switch"),De=p("Setting"),ce=p("FolderOpened"),Ve=p("VideoPlay"),ye=p("DocumentChecked"),ze=p("Delete"),Je=p("el-popconfirm"),ie=p("Folder"),Q=p("Document"),Y=p("el-input"),U=p("el-form-item"),ue=p("el-col"),I=p("el-row"),rl=p("el-collapse-item"),ml=p("el-collapse"),pl=p("el-form"),fl=p("ChatLineRound");return i(),f("div",Gt,[s("div",Qt,[s("div",Xt,[m[10]||(m[10]=s("span",{class:"sidebar-title"},"技能库",-1)),s("div",Zt,[e(O,{size:"small",loading:ee.value,circle:"",onClick:M},{default:t(()=>[e(T,null,{default:t(()=>[e(K)]),_:1})]),_:1},8,["loading"]),e(O,{size:"small",type:"primary",circle:"",loading:ke.value,onClick:A},{default:t(()=>[e(T,null,{default:t(()=>[e(ve)]),_:1})]),_:1},8,["loading"])])]),s("div",ea,[!ee.value&&j.value.length===0?(i(),f("div",la,"暂无技能")):h("",!0),(i(!0),f(D,null,J(j.value,b=>(i(),f("div",{key:b.id,class:Ye(["skill-item",{active:g.value?.id===b.id}]),onClick:Ne=>Ae(b)},[s("span",aa,[b.icon?(i(),f("span",na,r(b.icon),1)):(i(),x(T,{key:1},{default:t(()=>[e(oe)]),_:1}))]),s("div",sa,[s("div",oa,r(b.name),1),s("div",ia,r(b.id),1)]),s("div",ua,[b.category?(i(),x(G,{key:0,size:"small",effect:"plain",style:{"margin-right":"6px","font-size":"11px"}},{default:t(()=>[o(r(b.category),1)]),_:2},1024)):h("",!0),e(he,{"model-value":b.enabled,size:"small",onChange:Ne=>xe(b,Ne),onClick:m[0]||(m[0]=lt(()=>{},["stop"]))},null,8,["model-value","onChange"])])],10,ta))),128))])]),s("div",da,[g.value?(i(),f(D,{key:1},[s("div",ma,[s("div",pa,[e(T,{style:{color:"#909399"}},{default:t(()=>[e(ce)]),_:1}),m[13]||(m[13]=s("span",{class:"crumb-sep"},"skills /",-1)),s("span",fa,r(g.value.id),1)]),s("div",va,[e(O,{size:"small",onClick:dl},{default:t(()=>[e(T,null,{default:t(()=>[e(Ve)]),_:1}),m[14]||(m[14]=o(" 测试 ",-1))]),_:1}),e(O,{size:"small",type:"primary",loading:Ie.value,onClick:ul},{default:t(()=>[e(T,null,{default:t(()=>[e(ye)]),_:1}),m[15]||(m[15]=o(" 保存 ",-1))]),_:1},8,["loading"]),e(Je,{title:"确认删除该技能？",onConfirm:Ce},{reference:t(()=>[e(O,{size:"small",type:"danger",plain:""},{default:t(()=>[e(T,null,{default:t(()=>[e(ze)]),_:1})]),_:1})]),_:1})])]),s("div",ca,[s("div",ya,[m[19]||(m[19]=s("div",{class:"tree-title"},"目录",-1)),s("div",ga,[e(T,null,{default:t(()=>[e(ie)]),_:1}),s("span",null,r(g.value.id)+"/",1)]),s("div",{class:Ye(["tree-item",{"tree-active":W.value==="meta"}]),onClick:m[1]||(m[1]=b=>W.value="meta")},[e(T,null,{default:t(()=>[e(Q)]),_:1}),m[16]||(m[16]=s("span",null,"skill.json",-1))],2),s("div",{class:Ye(["tree-item",{"tree-active":W.value==="prompt"}]),onClick:He},[e(T,null,{default:t(()=>[e(Q)]),_:1}),m[18]||(m[18]=s("span",null,"SKILL.md",-1)),g.value.enabled?(i(),x(G,{key:0,size:"small",type:"success",effect:"plain",style:{"margin-left":"4px","font-size":"10px"}},{default:t(()=>[...m[17]||(m[17]=[o("注入中",-1)])]),_:1})):h("",!0)],2)]),W.value==="meta"?(i(),f("div",_a,[s("div",ba,[e(T,null,{default:t(()=>[e(Q)]),_:1}),m[20]||(m[20]=o(" skill.json ",-1)),m[21]||(m[21]=s("span",{class:"file-hint"},"技能元信息，影响列表展示和 runner 行为",-1))]),e(pl,{model:C.value,"label-width":"72px",size:"small",style:{padding:"16px 20px"}},{default:t(()=>[e(U,{label:"技能 ID"},{default:t(()=>[e(Y,{value:g.value.id,disabled:""},null,8,["value"])]),_:1}),e(I,{gutter:12},{default:t(()=>[e(ue,{span:14},{default:t(()=>[e(U,{label:"名称"},{default:t(()=>[e(Y,{modelValue:C.value.name,"onUpdate:modelValue":m[2]||(m[2]=b=>C.value.name=b),placeholder:"如 翻译助手"},null,8,["modelValue"])]),_:1})]),_:1}),e(ue,{span:10},{default:t(()=>[e(U,{label:"图标"},{default:t(()=>[e(Y,{modelValue:C.value.icon,"onUpdate:modelValue":m[3]||(m[3]=b=>C.value.icon=b),placeholder:"emoji"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(I,{gutter:12},{default:t(()=>[e(ue,{span:14},{default:t(()=>[e(U,{label:"分类"},{default:t(()=>[e(Y,{modelValue:C.value.category,"onUpdate:modelValue":m[4]||(m[4]=b=>C.value.category=b),placeholder:"如 语言"},null,8,["modelValue"])]),_:1})]),_:1}),e(ue,{span:10},{default:t(()=>[e(U,{label:"版本"},{default:t(()=>[e(Y,{modelValue:C.value.version,"onUpdate:modelValue":m[5]||(m[5]=b=>C.value.version=b),placeholder:"1.0.0"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(U,{label:"描述"},{default:t(()=>[e(Y,{modelValue:C.value.description,"onUpdate:modelValue":m[6]||(m[6]=b=>C.value.description=b),type:"textarea",rows:2,placeholder:"简要描述技能功能"},null,8,["modelValue"])]),_:1}),e(U,{label:"状态"},{default:t(()=>[s("div",wa,[e(he,{modelValue:C.value.enabled,"onUpdate:modelValue":m[7]||(m[7]=b=>C.value.enabled=b)},null,8,["modelValue"]),s("span",ka,r(C.value.enabled?"已启用，SKILL.md 将注入系统提示":"已禁用"),1)])]),_:1}),e(ml,{style:{"margin-top":"8px"}},{default:t(()=>[e(rl,{title:"查看 skill.json 原文"},{default:t(()=>[s("pre",xa,r(JSON.stringify({id:g.value.id,...C.value},null,2)),1)]),_:1})]),_:1})]),_:1},8,["model"])])):(i(),f("div",Ca,[s("div",ha,[e(T,null,{default:t(()=>[e(Q)]),_:1}),m[23]||(m[23]=o(" SKILL.md ",-1)),m[24]||(m[24]=s("span",{class:"file-hint"},"注入到 AI System Prompt 的指令内容",-1)),s("div",Va,[re.value?(i(),x(G,{key:0,type:"warning",size:"small"},{default:t(()=>[...m[22]||(m[22]=[o("未保存",-1)])]),_:1})):h("",!0),s("span",za,r(L.value.length)+" 字符",1),e(O,{size:"small",circle:"",loading:we.value,onClick:fe,title:"重新加载"},{default:t(()=>[e(T,null,{default:t(()=>[e(K)]),_:1})]),_:1},8,["loading"])])]),ol(s("textarea",{"onUpdate:modelValue":m[8]||(m[8]=b=>L.value=b),class:"code-textarea",spellcheck:"false",placeholder:`# 技能名称

## 功能说明
描述该技能的用途…

## 行为规范
- 规范 1
- 规范 2`,onInput:m[9]||(m[9]=b=>re.value=!0)},null,544),[[Pt,L.value]])]))])],64)):(i(),f("div",ra,[e(T,{size:"48",color:"#c0c4cc"},{default:t(()=>[e(De)]),_:1}),m[12]||(m[12]=s("p",null,"从左侧选择一个技能开始编辑",-1)),e(O,{type:"primary",onClick:A},{default:t(()=>[e(T,null,{default:t(()=>[e(ve)]),_:1}),m[11]||(m[11]=o(" 新建技能",-1))]),_:1})]))]),s("div",$a,[s("div",Ta,[e(T,null,{default:t(()=>[e(fl)]),_:1}),m[25]||(m[25]=o(" AI 协作配置 ",-1)),g.value?(i(),f("span",Sa,"当前: "+r(g.value.name),1)):h("",!0)]),s("div",Ua,[e(tt,{ref_key:"aiChatRef",ref:le,"agent-id":S(y),context:me.value,scenario:"skill-studio","welcome-message":pe.value,examples:Le.value,compact:"",onResponse:Fe},null,8,["agent-id","context","welcome-message","examples"])])])])}}}),La=at(Ia,[["__scopeId","data-v-7dede331"]]),Aa={class:"header-left"},Fa={class:"chat-layout"},Da={class:"session-sidebar"},Na={class:"session-sidebar-header"},Ma={class:"session-list"},Ba=["onClick"],Ea={class:"session-item-title"},Pa={class:"session-item-meta"},Ra={key:0,class:"session-empty"},Wa={class:"at-panel"},ja={key:0,class:"at-form"},Ka={class:"chat-area"},Oa={style:{display:"flex","align-items":"center",gap:"8px"}},Ya={style:{"font-weight":"600"}},qa={key:0,style:{"text-align":"center",color:"#c0c4cc",padding:"32px 0","font-size":"14px"}},Ha={style:{display:"flex","align-items":"center",gap:"8px"}},Ja={style:{"font-size":"13px"}},Ga={style:{"font-size":"13px",color:"#606266"}},Qa={key:0,style:{"text-align":"center",color:"#c0c4cc",padding:"40px 0"}},Xa={key:1,class:"relations-list"},Za={class:"relation-info"},en={class:"relation-name"},ln={class:"relation-tags"},tn={class:"relation-desc"},an={style:{display:"flex","align-items":"center","justify-content":"space-between"}},nn={style:{display:"flex",gap:"8px","margin-top":"4px"}},sn={style:{display:"flex","align-items":"center","justify-content":"space-between"}},on={key:0,style:{"text-align":"center",color:"#c0c4cc",padding:"16px 0","font-size":"13px"}},un={style:{"font-size":"12px"}},dn={style:{"font-size":"12px",color:"#606266"}},rn={class:"memory-toolbar",style:{"margin-bottom":"12px",display:"flex",gap:"8px"}},mn={style:{display:"flex","align-items":"center",gap:"4px","font-size":"13px"}},pn={style:{display:"flex","align-items":"center","justify-content":"space-between"}},fn={style:{"margin-bottom":"16px",display:"flex","align-items":"center",gap:"8px"}},vn={class:"conv-drawer-body"},cn={key:0,style:{"text-align":"center","margin-bottom":"12px"}},yn={class:"conv-msg-list"},gn={class:"conv-msg-meta"},_n={class:"conv-msg-role"},bn={key:0,class:"conv-msg-sender"},wn={class:"conv-msg-time"},kn={class:"conv-msg-content"},xn={key:0,class:"conv-msg-empty"},Cn={style:{"margin-top":"8px",display:"flex",gap:"8px","align-items":"center"}},hn={style:{display:"flex","justify-content":"space-between","align-items":"center","margin-bottom":"16px"}},Vn={class:"channel-card-header"},zn={class:"channel-card-left"},$n={class:"channel-card-name"},Tn={key:0,class:"channel-bot-username"},Sn={class:"channel-card-actions"},Un={key:0,class:"channel-card-body"},In={class:"channel-info-row"},Ln={class:"channel-info-value"},An={class:"channel-info-row"},Fn={class:"channel-info-value"},Dn={key:1,class:"channel-card-body"},Nn={class:"channel-info-row"},Mn={class:"channel-info-value"},Bn={style:{opacity:"0.6","font-size":"11px","margin-left":"3px"}},En={class:"pending-section"},Pn=["onClick"],Rn={key:0,class:"pending-list"},Wn={key:0,style:{"text-align":"center",padding:"12px"}},jn={class:"pending-user-info"},Kn={class:"pending-user-name"},On={key:0,class:"pending-user-username"},Yn={class:"pending-user-id"},qn={class:"pending-user-actions"},Hn={key:2,class:"pending-empty"},Jn={style:{width:"100%"}},Gn={style:{display:"flex",gap:"6px","align-items":"center"}},Qn={key:0,style:{"margin-top":"6px",display:"flex","align-items":"center",gap:"6px",color:"#909399","font-size":"13px"}},Xn={key:1,style:{"margin-top":"6px",color:"#67c23a","font-size":"13px"}},Zn={key:2,style:{"margin-top":"6px",color:"#e6a23c","font-size":"13px"}},es={key:3,style:{"margin-top":"6px",color:"#f56c6c","font-size":"13px"}},ls={key:4,style:{"margin-top":"4px"}},ts={class:"channel-url-preview"},as={class:"channel-url-text"},ns={class:"channel-url-preview"},ss={class:"channel-url-text"},os=50,is=Zl({__name:"AgentDetailView",setup(Fl){const Z=Rt(),y=Z.params.id,j=d(null),ee=d("chat"),g=d(),W=d([]),C=d(!1),L=d();async function we(){C.value=!0;try{const n=await Jt.list({agentId:y,limit:50});W.value=n.data.sessions}catch{}finally{C.value=!1}}function re(n){L.value=n.id,g.value?.resumeSession(n.id)}function Ie(){L.value=void 0,g.value?.startNewSession()}function ke(n){L.value=n,setTimeout(we,500)}function se(n){if(!n)return"";const l=Date.now()-n;return l<6e4?"刚刚":l<36e5?`${Math.floor(l/6e4)}分前`:l<864e5?`${Math.floor(l/36e5)}小时前`:`${Math.floor(l/864e5)}天前`}const le=d(!1),me=d(""),pe=d(""),Le=d(!1),M=d([]);function qe(){le.value=!le.value,le.value&&!M.value.length&&Ae()}async function Ae(){try{const n=await Al.list();M.value=n.data.filter(l=>l.id!==y)}catch{M.value=[]}}function He(n){const l=M.value.find(u=>u.id===n);l&&g.value?.fillInput(`@${l.name}: `)}async function ul(){const n=me.value,l=pe.value.trim();if(!n||!l)return;const k=M.value.find(ge=>ge.id===n)?.name??n;Le.value=!0;const E={role:"user",text:`→ 转发给 ${k}：
${l}`};g.value?.appendMessage(E);try{const V=(await Al.message(n,l,y)).data.response,ae={role:"assistant",text:`← **${k}** 回复：

${V}`};g.value?.appendMessage(ae),pe.value="",me.value="",le.value=!1,v.success(`${k} 已回复`)}catch(ge){const V={role:"system",text:`[失败] 转发失败：${ge.response?.data?.error??ge.message??"网络错误"}`};g.value?.appendMessage(V),v.error("转发失败")}finally{Le.value=!1}}const xe=d(""),Ce=d(""),A=d({enabled:!1,schedule:"daily",keepTurns:3,focusHint:"",cronJobId:""}),Fe=d(!1),fe=d(!1);async function dl(){try{const n=await sl.getConfig(y);A.value=n.data,O()}catch{}}async function w(){Fe.value=!0;try{const n=await sl.setConfig(y,A.value);A.value=n.data,v.success(A.value.enabled?"自动记忆已开启":"自动记忆已关闭")}catch{v.error("保存失败")}finally{Fe.value=!1}}async function m(){fe.value=!0;try{await sl.consolidate(y),v.success("记忆整理已在后台启动（约需10~30秒），稍后自动刷新日志"),setTimeout(O,1e4)}catch{v.error("整理失败")}finally{fe.value=!1}}const K=d([]),T=d(!1);async function O(){T.value=!0;try{const n=await sl.runLog(y);K.value=n.data||[]}catch{K.value=[]}finally{T.value=!1}}const ve=d([]),oe=d(""),G=d(""),he=d(!1),De=d([]),ce=d(!1),Ve=d(""),ye=d(!1),ze=d(""),Je=d([]),ie=d(""),Q=d(""),Y=d(null),U=d([]),ue=d(!1),I=d({agentId:"",agentName:"",relationType:"平级协作",strength:"常用",desc:""});async function rl(){try{const n=await Ql.get(y);U.value=n.data.parsed||[]}catch{U.value=[]}}function ml(n){const l=M.value.find(u=>u.id===n);I.value.agentName=l?l.name:n}async function pl(){if(!I.value.agentId)return;if(U.value.find(l=>l.agentId===I.value.agentId)){v.warning("该成员关系已存在，请先删除再重新添加");return}U.value.push({...I.value}),I.value={agentId:"",agentName:"",relationType:"平级协作",strength:"常用",desc:""},await Ne()}async function fl(n){U.value.splice(n,1),await Ne()}function b(){if(U.value.length===0)return"";const n=`| 成员ID | 成员名称 | 关系类型 | 关系程度 | 说明 |
|--------|--------|--------|--------|------|`,l=U.value.map(u=>`| ${u.agentId} | ${u.agentName} | ${u.relationType} | ${u.strength} | ${u.desc||""} |`).join(`
`);return n+`
`+l}async function Ne(){ue.value=!0;try{await Ql.put(y,b()),v.success("关系已保存")}catch{v.error("保存失败")}finally{ue.value=!1}}function vl(n){const l=["#409EFF","#67C23A","#E6A23C","#F56C6C","#909399","#B45309","#7C3AED","#0891B2"];let u=0;for(let k=0;k<n.length;k++)u=n.charCodeAt(k)+((u<<5)-u);return l[Math.abs(u)%l.length]??"#409EFF"}function Dl(n){return n==="上级"?"danger":n==="下级"?"":n==="平级协作"?"success":"info"}function Nl(n){return n==="核心"?"danger":n==="常用"?"warning":"info"}const Ml=d([]),Me=d(!1),B=d({name:"",expr:"0 9 * * *",tz:"Asia/Shanghai",message:"",enabled:!0});function nt(n){return n==="running"?"success":n==="stopped"?"danger":"info"}function st(n){return n==="running"?"运行中":n==="stopped"?"已停止":"空闲"}function Bl(n){return n?n<1024?n+" B":n<1048576?(n/1024).toFixed(1)+" KB":(n/1048576).toFixed(1)+" MB":"0 B"}function ot(n){return new Date(n).toLocaleString()}function El(n){return n?new Date(n).toLocaleString():""}const te=d([]),cl=d(!1),$e=d(!1),X=d(""),Ge=d(""),yl=d(!1),gl=d(""),c=d({type:"telegram",name:"",enabled:!0,botToken:"",allowedFrom:"",webPassword:"",webWelcome:"",webTitle:""}),$=d({loading:!1,status:""});let _l=null;function bl(n){return/^\*+$/.test(n)}async function Pl(){const n=c.value.botToken;if(!(!n||bl(n))){$.value={loading:!0,status:""};try{const u=(await H.checkToken(y,n)).data;u.duplicate?$.value={loading:!1,status:"duplicate",usedBy:u.usedBy,usedByCh:u.usedByCh}:u.valid?($.value={loading:!1,status:"ok",botName:u.botName},!c.value.name&&u.botName&&(c.value.name=u.botName)):$.value={loading:!1,status:"error",error:u.error||"Token 无效"}}catch{$.value={loading:!1,status:"error",error:"网络错误，请重试"}}}}Il(()=>c.value.type,n=>{X.value||(Ge.value=wl(n))}),Il(()=>c.value.botToken,n=>{$.value={loading:!1,status:""},_l&&clearTimeout(_l),!(!n||bl(n)||n.length<20||!n.includes(":"))&&(_l=setTimeout(Pl,800))});function Te(n,l){return l?`${window.location.origin}/chat/${n}/${l}`:`${window.location.origin}/chat/${n}`}function Rl(n){navigator.clipboard.writeText(n).then(()=>v.success("链接已复制"))}async function Se(){cl.value=!0;try{const n=await H.list(y);te.value=n.data||[]}catch{te.value=[]}finally{cl.value=!1}}function wl(n){return n+"-"+Date.now().toString(36)}function it(){X.value="";const n=j.value?.name||"";Ge.value=wl("telegram"),c.value={type:"telegram",name:n,enabled:!0,botToken:"",allowedFrom:"",webPassword:"",webWelcome:"",webTitle:""},$.value={loading:!1,status:""},$e.value=!0}function ut(n){X.value=n.id,c.value={type:n.type,name:n.name,enabled:n.enabled,botToken:n.config?.botToken||"",allowedFrom:n.config?.allowedFrom||"",webPassword:"",webWelcome:n.config?.welcomeMsg||"",webTitle:n.config?.title||""},$.value={loading:!1,status:""},$e.value=!0}async function dt(){if(!c.value.name||!c.value.type){v.warning("请填写名称和类型");return}if($.value.status==="duplicate"){v.error(`Bot Token 已被成员「${$.value.usedBy}」使用，请更换`);return}yl.value=!0;try{const n={};if(c.value.type==="telegram"?(c.value.botToken&&(n.botToken=c.value.botToken),c.value.allowedFrom&&(n.allowedFrom=c.value.allowedFrom)):c.value.type==="web"&&(c.value.webPassword&&(n.password=c.value.webPassword),c.value.webWelcome&&(n.welcomeMsg=c.value.webWelcome),c.value.webTitle&&(n.title=c.value.webTitle)),X.value){const l=te.value.map(u=>u.id!==X.value?u:{...u,name:c.value.name,type:c.value.type,enabled:c.value.enabled,config:{...u.config,...n}});await H.set(y,l)}else{const l={id:Ge.value||wl(c.value.type),name:c.value.name,type:c.value.type,enabled:c.value.enabled,config:n,status:"untested"};await H.set(y,[...te.value,l])}v.success(c.value.type==="web"?"保存成功，Web 聊天页立即生效":"保存成功，重启后新渠道生效"),$e.value=!1,await Se()}catch(n){v.error(n.response?.data?.error||"保存失败")}finally{yl.value=!1}}async function rt(){try{await H.set(y,te.value)}catch(n){v.error(n.response?.data?.error||"保存失败"),await Se()}}async function mt(n){const l=te.value.filter(u=>u.id!==n.id);try{await H.set(y,l),te.value=l,v.success("已删除")}catch{v.error("删除失败")}}async function pt(n){gl.value=n.id;try{const l=await H.test(y,n.id);l.data.valid?v.success(l.data.botName?`测试成功 (@${l.data.botName})`:"测试成功"):v.error(l.data.error||"测试失败"),await Se()}catch{v.error("测试请求失败")}finally{gl.value=""}}const Ue=d({}),kl=d({}),Be=d(""),xl=d("");async function Qe(n){kl.value[n]=!0;try{const l=await H.listPending(y,n);Ue.value[n]=l.data||[]}catch{Ue.value[n]=[]}finally{kl.value[n]=!1}}function ft(n){Be.value===n?Be.value="":(Be.value=n,Qe(n))}async function vt(n,l){xl.value=`${n}-${l}`;try{await H.allowUser(y,n,l),v.success(`用户 ${l} 已加入白名单`),await Qe(n),await Se()}catch{v.error("操作失败")}finally{xl.value=""}}async function ct(n,l){try{await H.dismissUser(y,n,l),v.success("已忽略"),await Qe(n)}catch{v.error("操作失败")}}async function Wl(n,l){try{await qt.confirm(`确定将用户 ${l} 从白名单中移除？移除后该用户将无法使用此 Bot。`,"移除白名单",{confirmButtonText:"确认移除",cancelButtonText:"取消",type:"warning"})}catch{return}try{await H.removeAllowed(y,n,l),v.success(`用户 ${l} 已从白名单移除`),await Se()}catch{v.error("操作失败")}}et(async()=>{try{const u=await Al.get(y);j.value=u.data}catch{v.error("加载 Agent 失败")}yt(),rl(),Ae(),dl(),kt(),Xe(),Se(),await we();const n=Z.query.tab;n&&(ee.value=n);const l=Z.query.resumeSession;l&&(L.value=l,await new Promise(k=>setTimeout(k,100)),g.value?.resumeSession(l),W.value.find(k=>k.id===l)||(L.value=l))});async function yt(){try{const[n,l]=await Promise.all([be.read(y,"IDENTITY.md"),be.read(y,"SOUL.md")]);xe.value=n.data?.content||"",Ce.value=l.data?.content||""}catch{}Ee()}async function Cl(n,l){try{await be.write(y,n,l),v.success(`${n} 已保存`)}catch{v.error(`保存 ${n} 失败`)}}async function Ee(){try{const n=await Ke.tree(y);ve.value=n.data||[]}catch{ve.value=[]}}async function gt(n){if(!n.isDir){oe.value=n.path,De.value=n.path.split("/");try{const l=await Ke.readFile(y,n.path);G.value=l.data?.content||""}catch{G.value="(无法读取)"}}}async function _t(){if(oe.value){he.value=!0;try{await Ke.writeFile(y,oe.value,G.value),v.success("记忆文件已保存"),Ee()}catch{v.error("保存失败")}finally{he.value=!1}}}async function bt(){const n=Ve.value.trim();if(!n){v.warning("请输入路径");return}try{await Ke.writeFile(y,n,`# ${n.split("/").pop()?.replace(".md","")||"New File"}

`),v.success("文件已创建"),ce.value=!1,Ve.value="",Ee(),oe.value=n,De.value=n.split("/"),G.value=`# ${n.split("/").pop()?.replace(".md","")||"New File"}

`}catch{v.error("创建失败")}}async function wt(){const n=ze.value.trim();if(!n){v.warning("请输入内容");return}try{await Ke.dailyLog(y,n),v.success("日志已添加"),ye.value=!1,ze.value="",Ee()}catch{v.error("添加失败")}}async function kt(){try{const n=await be.read(y,"/");Array.isArray(n.data)&&(Je.value=n.data.map(l=>({name:l.name,isDir:l.isDir,size:l.size,modTime:l.modTime,path:l.name})))}catch{}}async function xt(n){if(!n.isDir){ie.value=n.path||n.name,Y.value=n;try{const l=await be.read(y,ie.value);Q.value=l.data?.content||""}catch{Q.value="(无法读取)"}}}async function Ct(){ie.value&&await Cl(ie.value,Q.value)}async function Xe(){try{const n=await Oe.list(y);Ml.value=n.data||[]}catch{}}async function ht(){try{await Oe.create({name:B.value.name,enabled:B.value.enabled,agentId:y,schedule:{kind:"cron",expr:B.value.expr,tz:B.value.tz},payload:{kind:"agentTurn",message:B.value.message},delivery:{mode:"announce"}}),v.success("任务创建成功"),Me.value=!1,Xe()}catch(n){v.error(n.response?.data?.error||"创建失败")}}async function Vt(n){try{await Oe.update(n.id,n)}catch{v.error("更新失败")}}async function jl(n){try{await Oe.run(n.id),v.success("已触发运行"),setTimeout(Xe,2e3)}catch{v.error("运行失败")}}async function zt(n){try{await Oe.delete(n.id),v.success("已删除"),Xe()}catch{v.error("删除失败")}}const Ze=d(!1),hl=d([]),Vl=d(!1),zl=d(""),de=d([]),$l=d(0),el=d(0),$t=il(()=>de.value.length<$l.value),Pe=d(!1);async function Kl(){Ze.value=!0;try{const n=await Xl.list(y);hl.value=n.data}catch{v.error("加载对话渠道失败")}finally{Ze.value=!1}}async function Tt(n){zl.value=n.channelId,de.value=[],$l.value=0,el.value=0,Vl.value=!0,await Ol()}async function Ol(){Pe.value=!0;try{const l=(await Xl.messages(y,zl.value,{limit:os,offset:el.value})).data;$l.value=l.total,el.value===0?de.value=l.messages:de.value=[...l.messages,...de.value],el.value+=l.messages.length}catch{v.error("加载消息失败")}finally{Pe.value=!1}}async function St(){await Ol()}return Il(ee,n=>{n==="convlogs"&&hl.value.length===0&&Kl()}),(n,l)=>{const u=p("el-button"),k=p("el-tag"),E=p("el-text"),ge=p("el-header"),V=p("el-option"),ae=p("el-select"),F=p("el-input"),ne=p("el-tab-pane"),q=p("el-card"),P=p("el-col"),_e=p("el-row"),z=p("el-form-item"),Re=p("el-form"),Yl=p("el-badge"),N=p("el-table-column"),ll=p("el-table"),We=p("el-switch"),Ut=p("el-input-number"),R=p("el-icon"),ql=p("el-tree"),Tl=p("el-empty"),Hl=p("el-breadcrumb-item"),It=p("el-breadcrumb"),tl=p("el-dialog"),Lt=p("el-drawer"),At=p("el-link"),Ft=p("CircleCheck"),Dt=p("Warning"),Nt=p("CircleClose"),Jl=p("InfoFilled"),Gl=p("Link"),Mt=p("el-tabs"),Bt=p("el-main"),Et=p("el-container"),Sl=Ht("loading");return i(),x(Et,{class:"agent-detail"},{default:t(()=>[e(ge,{class:"detail-header"},{default:t(()=>[s("div",Aa,[e(u,{icon:S(Wt),onClick:l[0]||(l[0]=a=>n.$router.push("/agents")),circle:""},null,8,["icon"]),s("h2",null,r(j.value?.name||"..."),1),e(k,{type:nt(j.value?.status)},{default:t(()=>[o(r(st(j.value?.status)),1)]),_:1},8,["type"])]),e(E,{type:"info"},{default:t(()=>[o(r(j.value?.model),1)]),_:1})]),_:1}),e(Bt,null,{default:t(()=>[e(Mt,{modelValue:ee.value,"onUpdate:modelValue":l[45]||(l[45]=a=>ee.value=a),type:"border-card"},{default:t(()=>[e(ne,{label:"对话",name:"chat"},{default:t(()=>[s("div",Fa,[s("div",Da,[s("div",Na,[l[47]||(l[47]=s("span",{class:"sidebar-title"},"历史对话",-1)),e(u,{size:"small",type:"primary",plain:"",onClick:Ie,icon:S(al)},{default:t(()=>[...l[46]||(l[46]=[o("新建",-1)])]),_:1},8,["icon"])]),ol((i(),f("div",Ma,[(i(!0),f(D,null,J(W.value,a=>(i(),f("div",{key:a.id,class:Ye(["session-item",{active:L.value===a.id}]),onClick:_=>re(a)},[s("div",Ea,r(a.title||"新对话"),1),s("div",Pa,[s("span",null,r(se(a.lastAt)),1),e(k,{size:"small",type:"info",effect:"plain",style:{"font-size":"10px",padding:"0 4px"}},{default:t(()=>[o(r(a.messageCount)+" 条 ",1)]),_:2},1024),a.tokenEstimate>6e4?(i(),x(k,{key:0,size:"small",type:"warning",effect:"plain",style:{"font-size":"10px",padding:"0 4px"}},{default:t(()=>[o("~"+r(Math.round(a.tokenEstimate/1e3))+"k",1)]),_:2},1024)):h("",!0)])],10,Ba))),128)),!C.value&&!W.value.length?(i(),f("div",Ra," 还没有对话记录 ")):h("",!0)])),[[Sl,C.value]]),s("div",Wa,[e(u,{size:"small",plain:"",class:"at-toggle-btn",onClick:qe},{default:t(()=>[...l[48]||(l[48]=[s("span",{class:"at-icon"},"@",-1),o(" 其他成员 ",-1)])]),_:1}),le.value?(i(),f("div",ja,[e(ae,{modelValue:me.value,"onUpdate:modelValue":l[1]||(l[1]=a=>me.value=a),placeholder:"选择成员",size:"small",style:{width:"100%","margin-bottom":"6px"},onChange:He},{default:t(()=>[(i(!0),f(D,null,J(M.value,a=>(i(),x(V,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),e(F,{modelValue:pe.value,"onUpdate:modelValue":l[2]||(l[2]=a=>pe.value=a),type:"textarea",rows:3,placeholder:"输入要转发的消息…",size:"small",style:{"margin-bottom":"6px"}},null,8,["modelValue"]),e(u,{type:"primary",size:"small",style:{width:"100%"},loading:Le.value,disabled:!me.value||!pe.value.trim(),onClick:ul},{default:t(()=>[...l[49]||(l[49]=[o(" 转发 ",-1)])]),_:1},8,["loading","disabled"])])):h("",!0)])]),s("div",Ka,[e(tt,{ref_key:"aiChatRef",ref:g,"agent-id":S(y),scenario:"agent-detail","welcome-message":`你好！我是 **${j.value?.name||"AI"}**，有什么可以帮你的？`,height:"calc(100vh - 145px)","show-thinking":!0,onSessionChange:ke},null,8,["agent-id","welcome-message"])])])]),_:1}),e(ne,{label:"身份 & 灵魂",name:"identity"},{default:t(()=>[e(_e,{gutter:20},{default:t(()=>[e(P,{span:12},{default:t(()=>[e(q,{header:"IDENTITY.md"},{default:t(()=>[e(F,{modelValue:xe.value,"onUpdate:modelValue":l[3]||(l[3]=a=>xe.value=a),type:"textarea",rows:15,onBlur:l[4]||(l[4]=a=>Cl("IDENTITY.md",xe.value))},null,8,["modelValue"])]),_:1})]),_:1}),e(P,{span:12},{default:t(()=>[e(q,{header:"SOUL.md"},{default:t(()=>[e(F,{modelValue:Ce.value,"onUpdate:modelValue":l[5]||(l[5]=a=>Ce.value=a),type:"textarea",rows:15,onBlur:l[6]||(l[6]=a=>Cl("SOUL.md",Ce.value))},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),e(ne,{label:"关系",name:"relations"},{default:t(()=>[e(_e,{gutter:20},{default:t(()=>[e(P,{span:14},{default:t(()=>[e(q,{style:{"margin-bottom":"16px"}},{header:t(()=>[...l[50]||(l[50]=[s("span",{style:{"font-weight":"600"}},"添加关系",-1)])]),default:t(()=>[e(Re,{model:I.value,"label-position":"top",size:"default"},{default:t(()=>[e(_e,{gutter:12},{default:t(()=>[e(P,{span:10},{default:t(()=>[e(z,{label:"关联成员"},{default:t(()=>[e(ae,{modelValue:I.value.agentId,"onUpdate:modelValue":l[7]||(l[7]=a=>I.value.agentId=a),placeholder:"选择系统成员",filterable:"",style:{width:"100%"},onChange:ml},{default:t(()=>[(i(!0),f(D,null,J(M.value,a=>(i(),x(V,{key:a.id,label:a.name,value:a.id},{default:t(()=>[s("div",Oa,[s("div",{style:nl([{width:"24px",height:"24px","border-radius":"50%",display:"flex","align-items":"center","justify-content":"center","font-size":"11px",color:"#fff","flex-shrink":"0"},{background:vl(a.id)}])},r(a.name.charAt(0)),5),s("span",null,r(a.name),1)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(P,{span:7},{default:t(()=>[e(z,{label:"关系类型"},{default:t(()=>[e(ae,{modelValue:I.value.relationType,"onUpdate:modelValue":l[8]||(l[8]=a=>I.value.relationType=a),style:{width:"100%"}},{default:t(()=>[e(V,{label:"上级",value:"上级"}),e(V,{label:"下级",value:"下级"}),e(V,{label:"平级协作",value:"平级协作"}),e(V,{label:"支持",value:"支持"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(P,{span:7},{default:t(()=>[e(z,{label:"协作程度"},{default:t(()=>[e(ae,{modelValue:I.value.strength,"onUpdate:modelValue":l[9]||(l[9]=a=>I.value.strength=a),style:{width:"100%"}},{default:t(()=>[e(V,{label:"核心",value:"核心"}),e(V,{label:"常用",value:"常用"}),e(V,{label:"偶尔",value:"偶尔"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(_e,{gutter:12},{default:t(()=>[e(P,{span:18},{default:t(()=>[e(z,{label:"说明（选填）"},{default:t(()=>[e(F,{modelValue:I.value.desc,"onUpdate:modelValue":l[10]||(l[10]=a=>I.value.desc=a),placeholder:"简要描述这段关系..."},null,8,["modelValue"])]),_:1})]),_:1}),e(P,{span:6},{default:t(()=>[e(z,{label:" "},{default:t(()=>[e(u,{type:"primary",style:{width:"100%"},disabled:!I.value.agentId||!I.value.relationType||!I.value.strength,loading:ue.value,onClick:pl},{default:t(()=>[...l[51]||(l[51]=[o(" 添加 ",-1)])]),_:1},8,["disabled","loading"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),e(q,null,{header:t(()=>[s("span",Ya,[l[52]||(l[52]=o("已有关系 ",-1)),e(Yl,{value:U.value.length,type:"info",style:{"margin-left":"4px"}},null,8,["value"])])]),default:t(()=>[U.value.length===0?(i(),f("div",qa," 暂无关系，请在上方添加 ")):(i(),x(ll,{key:1,data:U.value,size:"small",style:{width:"100%"}},{default:t(()=>[e(N,{label:"成员","min-width":"120"},{default:t(({row:a})=>[s("div",Ha,[s("div",{style:nl([{width:"28px",height:"28px","border-radius":"50%",display:"flex","align-items":"center","justify-content":"center","font-size":"12px",color:"#fff","flex-shrink":"0"},{background:vl(a.agentId)}])},r(a.agentName.charAt(0)),5),s("span",Ja,r(a.agentName),1)])]),_:1}),e(N,{label:"类型",width:"100"},{default:t(({row:a})=>[e(k,{type:Dl(a.relationType),size:"small"},{default:t(()=>[o(r(a.relationType),1)]),_:2},1032,["type"])]),_:1}),e(N,{label:"程度",width:"80"},{default:t(({row:a})=>[e(k,{type:Nl(a.strength),size:"small",effect:"plain"},{default:t(()=>[o(r(a.strength),1)]),_:2},1032,["type"])]),_:1}),e(N,{label:"说明","min-width":"120","show-overflow-tooltip":""},{default:t(({row:a})=>[s("span",Ga,r(a.desc||"—"),1)]),_:1}),e(N,{label:"操作",width:"70",fixed:"right"},{default:t(({$index:a})=>[e(u,{type:"danger",link:"",size:"small",onClick:_=>fl(a)},{default:t(()=>[...l[53]||(l[53]=[o("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]))]),_:1})]),_:1}),e(P,{span:10},{default:t(()=>[e(q,{header:"关系预览"},{default:t(()=>[U.value.length===0?(i(),f("div",Qa," 暂无关系数据 ")):(i(),f("div",Xa,[(i(!0),f(D,null,J(U.value,a=>(i(),f("div",{key:a.agentId,class:"relation-card"},[s("div",{class:"relation-avatar",style:nl({background:vl(a.agentId)})},r(a.agentName.charAt(0).toUpperCase()),5),s("div",Za,[s("div",en,r(a.agentName),1),s("div",ln,[e(k,{type:Dl(a.relationType),size:"small"},{default:t(()=>[o(r(a.relationType),1)]),_:2},1032,["type"]),e(k,{type:Nl(a.strength),size:"small",effect:"plain"},{default:t(()=>[o(r(a.strength),1)]),_:2},1032,["type"])]),s("div",tn,r(a.desc),1)])]))),128))]))]),_:1})]),_:1})]),_:1})]),_:1}),e(ne,{label:"记忆",name:"memory"},{default:t(()=>[e(q,{style:{"margin-bottom":"16px"},shadow:"never"},{header:t(()=>[s("div",an,[l[54]||(l[54]=s("span",{style:{"font-weight":"600"}},"自动记忆",-1)),e(We,{modelValue:A.value.enabled,"onUpdate:modelValue":l[11]||(l[11]=a=>A.value.enabled=a),"active-text":"已开启","inactive-text":"已关闭",onChange:w},null,8,["modelValue"])])]),default:t(()=>[e(Re,{model:A.value,"label-position":"top",size:"small",disabled:!A.value.enabled},{default:t(()=>[e(_e,{gutter:16},{default:t(()=>[e(P,{span:6},{default:t(()=>[e(z,{label:"整理频率"},{default:t(()=>[e(ae,{modelValue:A.value.schedule,"onUpdate:modelValue":l[12]||(l[12]=a=>A.value.schedule=a),style:{width:"100%"}},{default:t(()=>[e(V,{label:"每小时",value:"hourly"}),e(V,{label:"每6小时",value:"every6h"}),e(V,{label:"每天",value:"daily"}),e(V,{label:"每周",value:"weekly"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(P,{span:5},{default:t(()=>[e(z,{label:"每个会话保留轮数"},{default:t(()=>[e(Ut,{modelValue:A.value.keepTurns,"onUpdate:modelValue":l[13]||(l[13]=a=>A.value.keepTurns=a),min:1,max:20,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),e(P,{span:13},{default:t(()=>[e(z,{label:"记录重点（留空则自动）"},{default:t(()=>[e(F,{modelValue:A.value.focusHint,"onUpdate:modelValue":l[14]||(l[14]=a=>A.value.focusHint=a),placeholder:"例如：记录数学解题步骤和用户常见错误"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),s("div",nn,[e(u,{type:"primary",size:"small",loading:Fe.value,onClick:w},{default:t(()=>[...l[55]||(l[55]=[o(" 保存设置 ",-1)])]),_:1},8,["loading"]),e(u,{size:"small",loading:fe.value,onClick:m},{default:t(()=>[...l[56]||(l[56]=[o(" 立即整理 ",-1)])]),_:1},8,["loading"]),e(E,{type:"info",size:"small",style:{"align-self":"center","margin-left":"4px"}},{default:t(()=>[o(" 整理后：LLM提炼摘要写入 MEMORY.md，每个会话只保留最近 "+r(A.value.keepTurns)+" 轮对话 ",1)]),_:1})])]),_:1},8,["model","disabled"])]),_:1}),e(q,{style:{"margin-bottom":"16px"},shadow:"never"},{header:t(()=>[s("div",sn,[l[58]||(l[58]=s("span",{style:{"font-weight":"600"}},"整理日志",-1)),e(u,{size:"small",text:"",onClick:O,loading:T.value},{default:t(()=>[...l[57]||(l[57]=[o("刷新",-1)])]),_:1},8,["loading"])])]),default:t(()=>[K.value.length===0&&!T.value?(i(),f("div",on," 暂无运行记录，点击「立即整理」触发第一次 ")):(i(),x(ll,{key:1,data:K.value.slice(0,20),size:"small"},{default:t(()=>[e(N,{label:"时间",width:"160"},{default:t(({row:a})=>[s("span",un,r(El(a.timestamp)),1)]),_:1}),e(N,{label:"状态",width:"72"},{default:t(({row:a})=>[e(k,{type:a.status==="ok"?"success":"danger",size:"small"},{default:t(()=>[o(r(a.status),1)]),_:2},1032,["type"])]),_:1}),e(N,{label:"结果","min-width":"200","show-overflow-tooltip":""},{default:t(({row:a})=>[s("span",dn,r(a.message||"—"),1)]),_:1})]),_:1},8,["data"]))]),_:1}),s("div",rn,[e(u,{type:"primary",size:"small",onClick:l[15]||(l[15]=a=>ce.value=!0)},{default:t(()=>[e(R,null,{default:t(()=>[e(S(al))]),_:1}),l[59]||(l[59]=o(" 新建文件 ",-1))]),_:1}),e(u,{size:"small",onClick:l[16]||(l[16]=a=>ye.value=!0)},{default:t(()=>[e(R,null,{default:t(()=>[e(S(jt))]),_:1}),l[60]||(l[60]=o(" 添加日志 ",-1))]),_:1}),e(u,{size:"small",onClick:Ee},{default:t(()=>[e(R,null,{default:t(()=>[e(S(Ll))]),_:1}),l[61]||(l[61]=o(" 刷新 ",-1))]),_:1})]),e(_e,{gutter:16},{default:t(()=>[e(P,{span:7},{default:t(()=>[e(q,{header:"记忆目录",shadow:"hover"},{default:t(()=>[e(ql,{data:ve.value,props:{label:"name",children:"children",isLeaf:a=>!a.isDir},onNodeClick:gt,"highlight-current":"","default-expand-all":"","expand-on-click-node":!1},{default:t(({data:a})=>[s("span",mn,[a.isDir?(i(),x(R,{key:0,style:{color:"#E6A23C"}},{default:t(()=>[e(S(Kt))]),_:1})):(i(),x(R,{key:1,style:{color:"#409EFF"}},{default:t(()=>[e(S(Ot))]),_:1})),s("span",null,r(a.name),1),!a.isDir&&a.size?(i(),x(E,{key:2,type:"info",size:"small",style:{"margin-left":"auto"}},{default:t(()=>[o(r(Bl(a.size)),1)]),_:2},1024)):h("",!0)])]),_:1},8,["data","props"]),ve.value.length===0?(i(),x(Tl,{key:0,description:"记忆树为空","image-size":40})):h("",!0)]),_:1})]),_:1}),e(P,{span:17},{default:t(()=>[e(q,{shadow:"hover"},{header:t(()=>[s("div",pn,[e(It,{separator:"/"},{default:t(()=>[e(Hl,null,{default:t(()=>[...l[62]||(l[62]=[o("memory",-1)])]),_:1}),(i(!0),f(D,null,J(De.value,(a,_)=>(i(),x(Hl,{key:_},{default:t(()=>[o(r(a),1)]),_:2},1024))),128))]),_:1}),oe.value?(i(),x(u,{key:0,type:"primary",size:"small",onClick:_t,loading:he.value},{default:t(()=>[...l[63]||(l[63]=[o("保存",-1)])]),_:1},8,["loading"])):h("",!0)])]),default:t(()=>[oe.value?(i(),x(F,{key:0,modelValue:G.value,"onUpdate:modelValue":l[17]||(l[17]=a=>G.value=a),type:"textarea",rows:22,style:{"font-family":"monospace"}},null,8,["modelValue"])):(i(),x(Tl,{key:1,description:"点击左侧文件查看和编辑","image-size":60}))]),_:1})]),_:1})]),_:1}),e(tl,{modelValue:ce.value,"onUpdate:modelValue":l[20]||(l[20]=a=>ce.value=a),title:"新建记忆文件",width:"480px"},{footer:t(()=>[e(u,{onClick:l[19]||(l[19]=a=>ce.value=!1)},{default:t(()=>[...l[65]||(l[65]=[o("取消",-1)])]),_:1}),e(u,{type:"primary",onClick:bt},{default:t(()=>[...l[66]||(l[66]=[o("创建",-1)])]),_:1})]),default:t(()=>[e(Re,{"label-width":"80px"},{default:t(()=>[e(z,{label:"路径"},{default:t(()=>[e(F,{modelValue:Ve.value,"onUpdate:modelValue":l[18]||(l[18]=a=>Ve.value=a),placeholder:"例如: projects/my-project.md 或 topics/cooking.md"},null,8,["modelValue"]),e(E,{type:"info",size:"small",style:{"margin-top":"4px"}},{default:t(()=>[...l[64]||(l[64]=[o("相对于 memory/ 目录",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(tl,{modelValue:ye.value,"onUpdate:modelValue":l[23]||(l[23]=a=>ye.value=a),title:"添加今日日志",width:"600px"},{footer:t(()=>[e(u,{onClick:l[22]||(l[22]=a=>ye.value=!1)},{default:t(()=>[...l[67]||(l[67]=[o("取消",-1)])]),_:1}),e(u,{type:"primary",onClick:wt},{default:t(()=>[...l[68]||(l[68]=[o("提交",-1)])]),_:1})]),default:t(()=>[e(F,{modelValue:ze.value,"onUpdate:modelValue":l[21]||(l[21]=a=>ze.value=a),type:"textarea",rows:10,placeholder:"记录今天的重要事项、学习心得、待办..."},null,8,["modelValue"])]),_:1},8,["modelValue"])]),_:1}),e(ne,{label:"技能",name:"skills"},{default:t(()=>[e(La,{"agent-id":S(y)},null,8,["agent-id"])]),_:1}),e(ne,{label:"历史对话",name:"convlogs"},{default:t(()=>[s("div",fn,[l[69]||(l[69]=s("span",{style:{"font-weight":"600","font-size":"15px"}},"渠道对话记录",-1)),e(u,{size:"small",icon:S(Ll),circle:"",onClick:Kl,loading:Ze.value},null,8,["icon","loading"])]),ol((i(),x(ll,{data:hl.value,stripe:"","empty-text":"暂无对话记录"},{default:t(()=>[e(N,{label:"渠道","min-width":"200"},{default:t(({row:a})=>[s("span",null,r(a.channelType==="telegram"?"Telegram":"Web")+" "+r(a.channelId),1)]),_:1}),e(N,{label:"消息数",width:"100"},{default:t(({row:a})=>[o(r(a.messageCount)+" 条",1)]),_:1}),e(N,{label:"最后活跃",width:"180"},{default:t(({row:a})=>[o(r(a.lastAt?new Date(a.lastAt).toLocaleString("zh-CN"):"-"),1)]),_:1}),e(N,{label:"操作",width:"100"},{default:t(({row:a})=>[e(u,{size:"small",type:"primary",plain:"",onClick:_=>Tt(a)},{default:t(()=>[...l[70]||(l[70]=[o("查看",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[Sl,Ze.value]]),e(Lt,{modelValue:Vl.value,"onUpdate:modelValue":l[24]||(l[24]=a=>Vl.value=a),title:zl.value+" 对话记录",direction:"rtl",size:"520px","destroy-on-close":!1},{default:t(()=>[s("div",vn,[$t.value?(i(),f("div",cn,[e(u,{size:"small",plain:"",loading:Pe.value,onClick:St},{default:t(()=>[...l[71]||(l[71]=[o("加载更多",-1)])]),_:1},8,["loading"])])):h("",!0),ol((i(),f("div",yn,[(i(!0),f(D,null,J(de.value,(a,_)=>(i(),f("div",{key:_,class:Ye(["conv-msg-item",a.role==="user"?"conv-msg-user":"conv-msg-assistant"])},[s("div",gn,[s("span",_n,r(a.role==="user"?"用户":"助手"),1),a.sender?(i(),f("span",bn,r(a.sender),1)):h("",!0),s("span",wn,r(a.ts?new Date(a.ts).toLocaleString("zh-CN"):""),1)]),s("div",kn,r(a.content),1)],2))),128)),!Pe.value&&de.value.length===0?(i(),f("div",xn," 暂无消息记录 ")):h("",!0)])),[[Sl,Pe.value&&de.value.length===0]])])]),_:1},8,["modelValue","title"])]),_:1}),e(ne,{label:"工作区",name:"workspace"},{default:t(()=>[e(_e,{gutter:20},{default:t(()=>[e(P,{span:8},{default:t(()=>[e(q,{header:"文件列表"},{default:t(()=>[e(ql,{data:Je.value,props:{label:"name",children:"children"},onNodeClick:xt,"highlight-current":"","default-expand-all":""},null,8,["data"])]),_:1})]),_:1}),e(P,{span:16},{default:t(()=>[e(q,{header:ie.value||"选择文件查看"},{default:t(()=>[ie.value?(i(),f(D,{key:0},[e(F,{modelValue:Q.value,"onUpdate:modelValue":l[25]||(l[25]=a=>Q.value=a),type:"textarea",rows:20},null,8,["modelValue"]),s("div",Cn,[e(u,{type:"primary",onClick:Ct},{default:t(()=>[...l[72]||(l[72]=[o("保存",-1)])]),_:1}),Y.value?(i(),x(E,{key:0,type:"info",size:"small"},{default:t(()=>[o(r(Bl(Y.value.size))+" · "+r(ot(Y.value.modTime)),1)]),_:1})):h("",!0)])],64)):h("",!0)]),_:1},8,["header"])]),_:1})]),_:1})]),_:1}),e(ne,{label:"定时任务",name:"cron"},{default:t(()=>[e(u,{type:"primary",onClick:l[26]||(l[26]=a=>Me.value=!0),style:{"margin-bottom":"16px"}},{default:t(()=>[e(R,null,{default:t(()=>[e(S(al))]),_:1}),l[73]||(l[73]=o(" 新建任务 ",-1))]),_:1}),e(ll,{data:Ml.value,stripe:""},{default:t(()=>[e(N,{prop:"name",label:"名称"}),e(N,{label:"调度"},{default:t(({row:a})=>[o(r(a.schedule?.expr)+" ("+r(a.schedule?.tz)+")",1)]),_:1}),e(N,{label:"最近运行",width:"180"},{default:t(({row:a})=>[a.state?.lastRunAtMs?(i(),f(D,{key:0},[e(k,{type:a.state?.lastStatus==="ok"?"success":"danger",size:"small"},{default:t(()=>[o(r(a.state?.lastStatus),1)]),_:2},1032,["type"]),e(E,{type:"info",size:"small",style:{"margin-left":"4px"}},{default:t(()=>[o(r(El(a.state?.lastRunAtMs)),1)]),_:2},1024)],64)):(i(),x(E,{key:1,type:"info",size:"small"},{default:t(()=>[...l[74]||(l[74]=[o("未运行",-1)])]),_:1}))]),_:1}),e(N,{label:"启用",width:"80"},{default:t(({row:a})=>[e(We,{modelValue:a.enabled,"onUpdate:modelValue":_=>a.enabled=_,onChange:_=>Vt(a)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),e(N,{label:"操作",width:"220"},{default:t(({row:a})=>[a.payload?.message==="__MEMORY_CONSOLIDATE__"?(i(),f(D,{key:0},[e(k,{type:"info",size:"small",style:{"margin-right":"8px"}},{default:t(()=>[...l[75]||(l[75]=[o("记忆管理",-1)])]),_:1}),e(u,{size:"small",onClick:_=>jl(a)},{default:t(()=>[...l[76]||(l[76]=[o("立即运行",-1)])]),_:1},8,["onClick"])],64)):(i(),f(D,{key:1},[e(u,{size:"small",onClick:_=>jl(a)},{default:t(()=>[...l[77]||(l[77]=[o("立即运行",-1)])]),_:1},8,["onClick"]),e(u,{size:"small",type:"danger",onClick:_=>zt(a)},{default:t(()=>[...l[78]||(l[78]=[o("删除",-1)])]),_:1},8,["onClick"])],64))]),_:1})]),_:1},8,["data"]),e(tl,{modelValue:Me.value,"onUpdate:modelValue":l[33]||(l[33]=a=>Me.value=a),title:"新建定时任务",width:"520px"},{footer:t(()=>[e(u,{onClick:l[32]||(l[32]=a=>Me.value=!1)},{default:t(()=>[...l[79]||(l[79]=[o("取消",-1)])]),_:1}),e(u,{type:"primary",onClick:ht},{default:t(()=>[...l[80]||(l[80]=[o("创建",-1)])]),_:1})]),default:t(()=>[e(Re,{model:B.value,"label-width":"100px"},{default:t(()=>[e(z,{label:"名称"},{default:t(()=>[e(F,{modelValue:B.value.name,"onUpdate:modelValue":l[27]||(l[27]=a=>B.value.name=a)},null,8,["modelValue"])]),_:1}),e(z,{label:"Cron 表达式"},{default:t(()=>[e(F,{modelValue:B.value.expr,"onUpdate:modelValue":l[28]||(l[28]=a=>B.value.expr=a),placeholder:"30 3 * * *"},null,8,["modelValue"])]),_:1}),e(z,{label:"时区"},{default:t(()=>[e(ae,{modelValue:B.value.tz,"onUpdate:modelValue":l[29]||(l[29]=a=>B.value.tz=a)},{default:t(()=>[e(V,{label:"Asia/Shanghai",value:"Asia/Shanghai"}),e(V,{label:"UTC",value:"UTC"}),e(V,{label:"America/New_York",value:"America/New_York"})]),_:1},8,["modelValue"])]),_:1}),e(z,{label:"消息"},{default:t(()=>[e(F,{modelValue:B.value.message,"onUpdate:modelValue":l[30]||(l[30]=a=>B.value.message=a),type:"textarea",rows:3},null,8,["modelValue"])]),_:1}),e(z,{label:"启用"},{default:t(()=>[e(We,{modelValue:B.value.enabled,"onUpdate:modelValue":l[31]||(l[31]=a=>B.value.enabled=a)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])]),_:1}),e(ne,{label:"渠道",name:"channels"},{default:t(()=>[s("div",hn,[e(E,{type:"info",size:"small"},{default:t(()=>[...l[81]||(l[81]=[o("每个 AI 成员独立配置自己的消息通道（如 Telegram Bot Token）",-1)])]),_:1}),e(u,{type:"primary",size:"small",onClick:it},{default:t(()=>[e(R,null,{default:t(()=>[e(S(al))]),_:1}),l[82]||(l[82]=o(" 添加消息渠道 ",-1))]),_:1})]),(i(!0),f(D,null,J(te.value,a=>(i(),f("div",{key:a.id,class:"channel-card"},[s("div",Vn,[s("div",zn,[e(k,{size:"small",style:{"margin-right":"8px"}},{default:t(()=>[o(r(a.type),1)]),_:2},1024),s("span",$n,r(a.name),1),a.config?.botName?(i(),f("span",Tn,"@"+r(a.config.botName),1)):h("",!0),e(k,{type:a.status==="ok"?"success":a.status==="error"?"danger":"info",size:"small",effect:"plain",style:{"margin-left":"8px"}},{default:t(()=>[o(r(a.status==="ok"?"✓ 正常":a.status==="error"?"✗ 错误":"未测试"),1)]),_:2},1032,["type"])]),s("div",Sn,[e(We,{modelValue:a.enabled,"onUpdate:modelValue":_=>a.enabled=_,size:"small",onChange:rt,style:{"margin-right":"8px"}},null,8,["modelValue","onUpdate:modelValue"]),e(u,{size:"small",onClick:_=>pt(a),loading:gl.value===a.id},{default:t(()=>[...l[83]||(l[83]=[o("测试连接",-1)])]),_:1},8,["onClick","loading"]),e(u,{size:"small",onClick:_=>ut(a)},{default:t(()=>[...l[84]||(l[84]=[o("编辑",-1)])]),_:1},8,["onClick"]),e(u,{size:"small",type:"danger",plain:"",onClick:_=>mt(a)},{default:t(()=>[...l[85]||(l[85]=[o("删除",-1)])]),_:1},8,["onClick"])])]),a.type==="web"?(i(),f("div",Un,[s("div",In,[l[87]||(l[87]=s("span",{class:"channel-info-label"},"公开地址",-1)),s("span",Ln,[e(At,{href:Te(S(y),a.id),target:"_blank",type:"primary",style:{"font-size":"13px"}},{default:t(()=>[o(r(Te(S(y),a.id)),1)]),_:2},1032,["href"]),e(u,{size:"small",link:"",style:{"margin-left":"8px"},onClick:_=>Rl(Te(S(y),a.id))},{default:t(()=>[...l[86]||(l[86]=[o("复制",-1)])]),_:1},8,["onClick"])])]),s("div",An,[l[88]||(l[88]=s("span",{class:"channel-info-label"},"访问密码",-1)),s("span",Fn,[e(k,{size:"small",type:a.config?.password?"warning":"info",effect:"plain"},{default:t(()=>[o(r(a.config?.password?"已设置":"无密码"),1)]),_:2},1032,["type"])])])])):h("",!0),a.type==="telegram"?(i(),f("div",Dn,[s("div",Nn,[l[90]||(l[90]=s("span",{class:"channel-info-label"},"白名单用户",-1)),s("span",Mn,[a.allowedFromUsers?.length?(i(!0),f(D,{key:0},J(a.allowedFromUsers,_=>(i(),x(k,{key:_.id,size:"small",closable:"","disable-transitions":!0,style:{"margin-right":"4px","margin-bottom":"4px"},onClose:Ul=>Wl(a.id,_.id)},{default:t(()=>[o(r(_.username?"@"+_.username:_.firstName||String(_.id))+" ",1),s("span",Bn,"("+r(_.id)+")",1)]),_:2},1032,["onClose"]))),128)):a.config?.allowedFrom?(i(!0),f(D,{key:1},J(a.config.allowedFrom.split(","),_=>(i(),x(k,{key:_,size:"small",closable:"","disable-transitions":!0,style:{"margin-right":"4px","margin-bottom":"4px"},onClose:Ul=>Wl(a.id,Number(_.trim()))},{default:t(()=>[o(r(_.trim()),1)]),_:2},1032,["onClose"]))),128)):(i(),x(E,{key:2,type:"warning",size:"small"},{default:t(()=>[...l[89]||(l[89]=[o("未设置（配对模式，向用户返回其 ID）",-1)])]),_:1}))])]),s("div",En,[s("div",{class:"pending-section-header",onClick:_=>ft(a.id)},[l[92]||(l[92]=s("span",null,"待审核用户",-1)),e(Yl,{value:(Ue.value[a.id]||[]).length,hidden:!(Ue.value[a.id]||[]).length,type:"warning",style:{"margin-left":"6px"}},null,8,["value","hidden"]),e(u,{size:"small",link:"",onClick:lt(_=>Qe(a.id),["stop"]),style:{"margin-left":"8px"}},{default:t(()=>[...l[91]||(l[91]=[o("刷新",-1)])]),_:1},8,["onClick"]),e(R,{style:nl([{"margin-left":"4px",transition:"transform 0.2s"},{transform:Be.value===a.id?"rotate(180deg)":""}])},{default:t(()=>[e(S(Yt))]),_:1},8,["style"])],8,Pn),Be.value===a.id?(i(),f("div",Rn,[kl.value[a.id]?(i(),f("div",Wn,[e(E,{type:"info",size:"small"},{default:t(()=>[...l[93]||(l[93]=[o("加载中...",-1)])]),_:1})])):(Ue.value[a.id]||[]).length?(i(!0),f(D,{key:1},J(Ue.value[a.id],_=>(i(),f("div",{key:_.id,class:"pending-user-row"},[s("div",jn,[s("span",Kn,r(_.firstName||"未知"),1),_.username?(i(),f("span",On,"@"+r(_.username),1)):h("",!0),s("span",Yn,"ID: "+r(_.id),1),e(E,{type:"info",size:"small",style:{"margin-left":"8px"}},{default:t(()=>[o(r(se(_.lastSeen)),1)]),_:2},1024)]),s("div",qn,[e(u,{size:"small",type:"success",plain:"",onClick:Ul=>vt(a.id,_.id),loading:xl.value===`${a.id}-${_.id}`},{default:t(()=>[...l[94]||(l[94]=[o("加入白名单",-1)])]),_:1},8,["onClick","loading"]),e(u,{size:"small",type:"danger",plain:"",onClick:Ul=>ct(a.id,_.id)},{default:t(()=>[...l[95]||(l[95]=[o("忽略",-1)])]),_:1},8,["onClick"])])]))),128)):(i(),f("div",Hn," 暂无待审核用户。让用户向 Bot 发送 /start 即可出现在此处。 "))])):h("",!0)])])):h("",!0)]))),128)),!cl.value&&!te.value.length?(i(),x(Tl,{key:0,description:"暂无消息渠道，点击「添加消息渠道」开始配置","image-size":80,style:{"margin-top":"40px"}})):h("",!0),e(tl,{modelValue:$e.value,"onUpdate:modelValue":l[44]||(l[44]=a=>$e.value=a),title:X.value?"编辑消息渠道":"添加消息渠道",width:"540px"},{footer:t(()=>[e(u,{onClick:l[43]||(l[43]=a=>$e.value=!1)},{default:t(()=>[...l[105]||(l[105]=[o("取消",-1)])]),_:1}),e(u,{type:"primary",onClick:dt,loading:yl.value},{default:t(()=>[...l[106]||(l[106]=[o("保存",-1)])]),_:1},8,["loading"])]),default:t(()=>[e(Re,{model:c.value,"label-width":"120px"},{default:t(()=>[e(z,{label:"类型",required:""},{default:t(()=>[e(ae,{modelValue:c.value.type,"onUpdate:modelValue":l[34]||(l[34]=a=>c.value.type=a),style:{width:"100%"}},{default:t(()=>[e(V,{label:"Telegram",value:"telegram"}),e(V,{label:"Web 聊天页",value:"web"}),e(V,{label:"iMessage",value:"imessage"}),e(V,{label:"WhatsApp",value:"whatsapp"})]),_:1},8,["modelValue"])]),_:1}),e(z,{label:"名称",required:""},{default:t(()=>[e(F,{modelValue:c.value.name,"onUpdate:modelValue":l[35]||(l[35]=a=>c.value.name=a),placeholder:"如：客服 Bot"},null,8,["modelValue"])]),_:1}),c.value.type==="telegram"?(i(),f(D,{key:0},[e(z,{label:"Bot Token",required:""},{default:t(()=>[s("div",Jn,[s("div",Gn,[e(F,{modelValue:c.value.botToken,"onUpdate:modelValue":l[36]||(l[36]=a=>c.value.botToken=a),type:"password","show-password":"",placeholder:"从 @BotFather 获取",style:{flex:"1"},status:$.value.status==="error"?"error":$.value.status==="ok"?"success":""},null,8,["modelValue","status"]),e(u,{size:"default",loading:$.value.loading,type:$.value.status==="ok"?"success":$.value.status==="error"?"danger":"default",onClick:Pl,disabled:!c.value.botToken||bl(c.value.botToken)},{default:t(()=>[...l[96]||(l[96]=[o("验证",-1)])]),_:1},8,["loading","type","disabled"])]),$.value.loading?(i(),f("div",Qn,[e(R,{class:"is-loading"},{default:t(()=>[e(S(Ll))]),_:1}),l[97]||(l[97]=o(" 正在验证 Token… ",-1))])):$.value.status==="ok"?(i(),f("div",Xn,[e(R,{style:{"vertical-align":"-2px","margin-right":"4px"}},{default:t(()=>[e(Ft)]),_:1}),l[98]||(l[98]=o("Token 有效，Bot 名称：",-1)),s("b",null,"@"+r($.value.botName),1)])):$.value.status==="duplicate"?(i(),f("div",Zn,[e(R,{style:{"vertical-align":"-2px","margin-right":"4px"}},{default:t(()=>[e(Dt)]),_:1}),l[99]||(l[99]=o("此 Token 已被成员「",-1)),s("b",null,r($.value.usedBy),1),o("」的渠道「"+r($.value.usedByCh)+"」使用 ",1)])):$.value.status==="error"?(i(),f("div",es,[e(R,{style:{"vertical-align":"-2px","margin-right":"4px"}},{default:t(()=>[e(Nt)]),_:1}),o(r($.value.error),1)])):(i(),f("div",ls,[e(E,{type:"info",size:"small"},{default:t(()=>[e(R,{style:{"vertical-align":"-2px","margin-right":"4px"}},{default:t(()=>[e(Jl)]),_:1}),l[100]||(l[100]=o("输入完成后自动验证，也可点右侧「验证」按钮手动触发",-1))]),_:1})]))])]),_:1}),e(z,{label:"白名单用户"},{default:t(()=>[e(F,{modelValue:c.value.allowedFrom,"onUpdate:modelValue":l[37]||(l[37]=a=>c.value.allowedFrom=a),placeholder:"填入 Telegram 用户 ID，多个用逗号分隔"},null,8,["modelValue"]),e(E,{type:"info",size:"small",style:{display:"block","margin-top":"4px"}},{default:t(()=>[e(R,{style:{"vertical-align":"-2px","margin-right":"4px"}},{default:t(()=>[e(Jl)]),_:1}),l[101]||(l[101]=o("留空时 Bot 进入配对模式——向用户返回其 ID，引导联系管理员添加白名单 ",-1))]),_:1})]),_:1})],64)):h("",!0),c.value.type==="web"?(i(),f(D,{key:1},[X.value?(i(),x(z,{key:0,label:"访问链接"},{default:t(()=>[s("div",ts,[e(R,{style:{"flex-shrink":"0",color:"#909399"}},{default:t(()=>[e(Gl)]),_:1}),s("span",as,r(Te(S(y),X.value)),1),e(u,{size:"small",link:"",onClick:l[38]||(l[38]=a=>Rl(Te(S(y),X.value)))},{default:t(()=>[...l[102]||(l[102]=[o("复制",-1)])]),_:1})])]),_:1})):h("",!0),X.value?h("",!0):(i(),x(z,{key:1,label:"访问链接"},{default:t(()=>[s("div",ns,[e(R,{style:{"flex-shrink":"0",color:"#909399"}},{default:t(()=>[e(Gl)]),_:1}),s("span",ss,r(Te(S(y),Ge.value)),1),e(k,{size:"small",type:"info",effect:"plain"},{default:t(()=>[...l[103]||(l[103]=[o("保存后生效",-1)])]),_:1})]),e(E,{type:"info",size:"small",style:{display:"block","margin-top":"4px"}},{default:t(()=>[...l[104]||(l[104]=[o(" 每个 Web 渠道有独立链接，可同时开放多个入口 ",-1)])]),_:1})]),_:1})),e(z,{label:"访问密码"},{default:t(()=>[e(F,{modelValue:c.value.webPassword,"onUpdate:modelValue":l[39]||(l[39]=a=>c.value.webPassword=a),type:"password","show-password":"",placeholder:"留空则无需密码"},null,8,["modelValue"])]),_:1}),e(z,{label:"欢迎语"},{default:t(()=>[e(F,{modelValue:c.value.webWelcome,"onUpdate:modelValue":l[40]||(l[40]=a=>c.value.webWelcome=a),placeholder:"你好！有什么可以帮你的？"},null,8,["modelValue"])]),_:1}),e(z,{label:"页面标题"},{default:t(()=>[e(F,{modelValue:c.value.webTitle,"onUpdate:modelValue":l[41]||(l[41]=a=>c.value.webTitle=a),placeholder:"AI 助手"},null,8,["modelValue"])]),_:1})],64)):h("",!0),e(z,{label:"启用"},{default:t(()=>[e(We,{modelValue:c.value.enabled,"onUpdate:modelValue":l[42]||(l[42]=a=>c.value.enabled=a)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})}}}),ps=at(is,[["__scopeId","data-v-385962f3"]]);export{ps as default};
