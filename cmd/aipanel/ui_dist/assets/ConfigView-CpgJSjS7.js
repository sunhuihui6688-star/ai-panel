import{d as X,i as q,k,w as t,g as c,G as z,r as o,a as l,f as K,m as J,s as Q,e as u,t as F,n as Y,E as r,o as v,_ as Z}from"./index-DuuYJQLL.js";import{e as A}from"./index-BoGt_95K.js";const ee={style:{display:"flex","align-items":"center",gap:"12px"}},le={style:{"margin-top":"24px","text-align":"right"}},te=X({__name:"ConfigView",setup(ae){const _=c("anthropic/claude-sonnet-4-6"),V=c(!1),s=z({enabled:!1,botToken:"",defaultAgent:"main",allowedFromStr:""}),p=z({injectionMode:"index_only",dailyLogEnabled:!0,maxTokens:5e3}),x=c(!1),f=c(null),w=c([{id:"anthropic",name:"Anthropic",key:"",showKey:!1,testing:!1,testResult:null},{id:"openai",name:"OpenAI",key:"",showKey:!1,testing:!1,testResult:null},{id:"deepseek",name:"DeepSeek",key:"",showKey:!1,testing:!1,testResult:null}]);q(async()=>{try{const e=(await A.get()).data;if(_.value=e.models?.primary||"anthropic/claude-sonnet-4-6",e.models?.apiKeys)for(const n of w.value)e.models.apiKeys[n.id]&&(n.key=e.models.apiKeys[n.id]);e.channels?.telegram&&(s.enabled=e.channels.telegram.enabled,s.botToken=e.channels.telegram.botToken||"",s.defaultAgent=e.channels.telegram.defaultAgent||"main",e.channels.telegram.allowedFrom&&(s.allowedFromStr=e.channels.telegram.allowedFrom.join(",")))}catch{}});async function N(d){if(!d.key||d.key.endsWith("***")){r.warning("请输入完整的 API Key");return}d.testing=!0,d.testResult=null;try{const e=await A.testKey(d.id,d.key);d.testResult=e.data.valid,r[e.data.valid?"success":"error"](e.data.valid?"Key 有效":`Key 无效: ${e.data.error}`)}catch{d.testResult=!1,r.error("测试请求失败")}finally{d.testing=!1}}async function $(){x.value=!0,f.value=null;try{const d=s.botToken,n=await(await fetch(`https://api.telegram.org/bot${d}/getMe`)).json();f.value=n.ok===!0,n.ok?r.success(`Bot: @${n.result.username}`):r.error(`连接失败: ${n.description}`)}catch{f.value=!1,r.error("连接失败")}finally{x.value=!1}}async function B(){V.value=!0;try{const d={};for(const n of w.value)n.key&&!n.key.endsWith("***")&&(d[n.id]=n.key);const e=s.allowedFromStr.split(",").map(n=>n.trim()).filter(n=>n.length>0).map(n=>parseInt(n,10)).filter(n=>!isNaN(n));await A.patch({models:{primary:_.value,apiKeys:d},channels:{telegram:{enabled:s.enabled,botToken:s.botToken,defaultAgent:s.defaultAgent,allowedFrom:e}}}),r.success("配置已保存")}catch(d){r.error(d.response?.data?.error||"保存失败")}finally{V.value=!1}}return(d,e)=>{const n=o("el-button"),D=o("el-header"),y=o("el-table-column"),E=o("View"),M=o("Hide"),R=o("el-icon"),g=o("el-input"),I=o("el-tag"),j=o("el-table"),m=o("el-option"),S=o("el-select"),i=o("el-form-item"),h=o("el-form"),T=o("el-tab-pane"),b=o("el-text"),U=o("el-switch"),P=o("el-slider"),L=o("el-card"),W=o("el-tabs"),G=o("Check"),H=o("el-main"),O=o("el-container");return v(),k(O,{class:"config-page"},{default:t(()=>[l(D,{class:"config-header"},{default:t(()=>[K("div",ee,[l(n,{icon:J(Q),onClick:e[0]||(e[0]=a=>d.$router.push("/")),circle:""},null,8,["icon"]),e[9]||(e[9]=K("h2",null,"配置中心",-1))])]),_:1}),l(H,null,{default:t(()=>[l(W,{type:"border-card"},{default:t(()=>[l(T,{label:"模型 & API Keys"},{default:t(()=>[l(j,{data:w.value,stripe:""},{default:t(()=>[l(y,{prop:"name",label:"提供商",width:"140"}),l(y,{label:"API Key"},{default:t(({row:a})=>[l(g,{modelValue:a.key,"onUpdate:modelValue":C=>a.key=C,type:a.showKey?"text":"password",size:"small",style:{"max-width":"400px"}},{append:t(()=>[l(n,{onClick:C=>a.showKey=!a.showKey},{default:t(()=>[l(R,null,{default:t(()=>[a.showKey?(v(),k(M,{key:1})):(v(),k(E,{key:0}))]),_:2},1024)]),_:2},1032,["onClick"])]),_:2},1032,["modelValue","onUpdate:modelValue","type"])]),_:1}),l(y,{label:"状态",width:"120"},{default:t(({row:a})=>[l(I,{type:a.testResult===!0?"success":a.testResult===!1?"danger":"info",size:"small"},{default:t(()=>[u(F(a.testResult===!0?"有效":a.testResult===!1?"无效":"未测试"),1)]),_:2},1032,["type"])]),_:1}),l(y,{label:"操作",width:"100"},{default:t(({row:a})=>[l(n,{size:"small",onClick:C=>N(a),loading:a.testing},{default:t(()=>[...e[10]||(e[10]=[u("测试",-1)])]),_:1},8,["onClick","loading"])]),_:1})]),_:1},8,["data"]),l(h,{style:{"margin-top":"24px"},"label-width":"100px"},{default:t(()=>[l(i,{label:"默认模型"},{default:t(()=>[l(S,{modelValue:_.value,"onUpdate:modelValue":e[1]||(e[1]=a=>_.value=a)},{default:t(()=>[l(m,{label:"Claude Sonnet 4",value:"anthropic/claude-sonnet-4-6"}),l(m,{label:"Claude Opus 4",value:"anthropic/claude-opus-4-0"}),l(m,{label:"GPT-4o",value:"openai/gpt-4o"}),l(m,{label:"DeepSeek V3",value:"deepseek/deepseek-chat"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(T,{label:"记忆设置"},{default:t(()=>[l(h,{"label-width":"160px",style:{"max-width":"600px"}},{default:t(()=>[l(i,{label:"上下文注入模式"},{default:t(()=>[l(S,{modelValue:p.injectionMode,"onUpdate:modelValue":e[2]||(e[2]=a=>p.injectionMode=a)},{default:t(()=>[l(m,{label:"仅 INDEX.md（默认）",value:"index_only"}),l(m,{label:"Core 文件",value:"core_files"}),l(m,{label:"全部文件（不推荐）",value:"all_files"})]),_:1},8,["modelValue"]),l(b,{type:"info",size:"small",style:{display:"block","margin-top":"4px"}},{default:t(()=>[...e[11]||(e[11]=[u(" 控制系统提示词中注入多少记忆内容。INDEX.md 模式最轻量。 ",-1)])]),_:1})]),_:1}),l(i,{label:"每日日志"},{default:t(()=>[l(U,{modelValue:p.dailyLogEnabled,"onUpdate:modelValue":e[3]||(e[3]=a=>p.dailyLogEnabled=a)},null,8,["modelValue"]),l(b,{type:"info",size:"small",style:{"margin-left":"8px"}},{default:t(()=>[...e[12]||(e[12]=[u(" 启用后 Agent 可自动写入每日日志 ",-1)])]),_:1})]),_:1}),l(i,{label:"记忆最大 Token 数"},{default:t(()=>[l(P,{modelValue:p.maxTokens,"onUpdate:modelValue":e[4]||(e[4]=a=>p.maxTokens=a),min:0,max:5e4,step:1e3,"show-input":""},null,8,["modelValue"]),l(b,{type:"info",size:"small",style:{display:"block","margin-top":"4px"}},{default:t(()=>[...e[13]||(e[13]=[u(" 系统提示词中记忆内容的最大 token 数（0 = 无限制） ",-1)])]),_:1})]),_:1})]),_:1})]),_:1}),l(T,{label:"消息通道"},{default:t(()=>[l(L,{header:"Telegram Bot"},{default:t(()=>[l(h,{"label-width":"140px"},{default:t(()=>[l(i,{label:"启用"},{default:t(()=>[l(U,{modelValue:s.enabled,"onUpdate:modelValue":e[5]||(e[5]=a=>s.enabled=a)},null,8,["modelValue"])]),_:1}),l(i,{label:"Bot Token"},{default:t(()=>[l(g,{modelValue:s.botToken,"onUpdate:modelValue":e[6]||(e[6]=a=>s.botToken=a),type:"password","show-password":"",style:{"max-width":"400px"}},null,8,["modelValue"])]),_:1}),l(i,{label:"默认 Agent"},{default:t(()=>[l(g,{modelValue:s.defaultAgent,"onUpdate:modelValue":e[7]||(e[7]=a=>s.defaultAgent=a),placeholder:"main",style:{"max-width":"200px"}},null,8,["modelValue"])]),_:1}),l(i,{label:"允许的发送者 ID"},{default:t(()=>[l(g,{modelValue:s.allowedFromStr,"onUpdate:modelValue":e[8]||(e[8]=a=>s.allowedFromStr=a),placeholder:"逗号分隔，如 123456,789012（留空允许所有人）",style:{"max-width":"400px"}},null,8,["modelValue"]),l(b,{type:"info",size:"small",style:{display:"block","margin-top":"4px"}},{default:t(()=>[...e[14]||(e[14]=[u(" Telegram 用户 ID，用于限制谁可以与 Bot 对话 ",-1)])]),_:1})]),_:1}),l(i,null,{default:t(()=>[l(n,{onClick:$,loading:x.value,disabled:!s.botToken||s.botToken.endsWith("***")},{default:t(()=>[...e[15]||(e[15]=[u(" 测试连接 ",-1)])]),_:1},8,["loading","disabled"]),f.value!==null?(v(),k(I,{key:0,type:f.value?"success":"danger",style:{"margin-left":"8px"}},{default:t(()=>[u(F(f.value?"连接成功":"连接失败"),1)]),_:1},8,["type"])):Y("",!0)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),K("div",le,[l(n,{type:"primary",size:"large",onClick:B,loading:V.value},{default:t(()=>[l(R,null,{default:t(()=>[l(G)]),_:1}),e[16]||(e[16]=u(" 保存配置 ",-1))]),_:1},8,["loading"])])]),_:1})]),_:1})}}}),se=Z(te,[["__scopeId","data-v-7baf3697"]]);export{se as default};
