import{d as et,h as nt,c as i,f as n,a as h,w as g,m as ot,i as L,j as A,g as w,E as st,r as y,I as lt,o as l,e as _,F as k,l as C,t as f,n as rt,x as it,u as at}from"./index-NN8rIs10.js";import{r as ct}from"./index-CSvBSDR2.js";import{_ as dt}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ut={class:"team-view"},ft={class:"page-header"},pt={key:0,class:"empty-state"},ht={key:1,class:"empty-state"},gt=["id"],mt=["fill"],yt=["x1","y1","x2","y2","stroke","stroke-width","marker-end","onMouseenter"],_t=["transform","onClick"],vt=["fill"],xt={"text-anchor":"middle","dominant-baseline":"central",fill:"#fff","font-weight":"700","font-size":"15","font-family":"system-ui, sans-serif"},kt=["fill"],Ct={"text-anchor":"middle",y:"46","font-size":"12",fill:"#303133","font-family":"system-ui, sans-serif","paint-order":"stroke",stroke:"#f5f7fa","stroke-width":"3"},wt={"text-anchor":"middle",y:"58","font-size":"10",fill:"#909399","font-family":"system-ui, monospace"},bt={class:"tooltip-members"},Mt={class:"tooltip-from"},Et={class:"tooltip-to"},At={class:"tooltip-tags"},Tt={key:0,class:"tooltip-label"},zt={class:"legend"},Rt={width:"28",height:"6"},Ft=["stroke"],It={width:"28",height:"8"},Bt=["stroke-width"],P=820,D=580,W=28,$t=et({__name:"TeamView",setup(Nt){const q=at(),T=w(),x=w(!1),p=w({nodes:[],edges:[]}),b=P/2,M=D/2-10;function H(e){return e<=1?0:e<=4?160:e<=7?200:Math.min(240,60*e/(2*Math.PI)+40)}const O=it(()=>{const e=p.value.nodes,t={};if(e.length===1&&e[0])return t[e[0].id]={x:b,y:M},t;const s=H(e.length);return e.forEach((r,c)=>{const u=2*Math.PI*c/e.length-Math.PI/2;t[r.id]={x:Math.round(b+s*Math.cos(u)),y:Math.round(M+s*Math.sin(u))}}),t});function v(e){return O.value[e]??{x:b,y:M}}function z(e){const t=v(e.from),s=v(e.to),r=s.x-t.x,c=s.y-t.y,u=Math.sqrt(r*r+c*c)||1,m=W+2;return{x:t.x+r/u*m,y:t.y+c/u*m}}function R(e){const t=v(e.from),s=v(e.to),r=s.x-t.x,c=s.y-t.y,u=Math.sqrt(r*r+c*c)||1,m=W+12;return{x:s.x-r/u*m,y:s.y-c/u*m}}const F=["#409EFF","#67C23A","#E6A23C","#F56C6C","#7C3AED","#0891B2","#B45309","#64748B"];function U(e){let t=0;for(let s=0;s<e.length;s++)t=e.charCodeAt(s)+((t<<5)-t);return F[Math.abs(t)%F.length]??"#409EFF"}function X(e){return(e||"?").charAt(0).toUpperCase()}function I(e){return p.value.nodes.find(t=>t.id===e)?.name??e}const E={上级:"#F56C6C",下级:"#409EFF",平级协作:"#67C23A",支持:"#909399"},B={核心:4,常用:2.5,偶尔:1.5};function Y(e){return E[e]??"#909399"}function j(e){return B[e]??1.5}function $(e){return encodeURIComponent(e).replace(/%/g,"_")}function G(e){q.push(`/agents/${e}`)}const a=w({visible:!1,x:0,y:0,type:"",strength:"",label:"",from:"",to:""});function J(e,t){const s=T.value;if(!s)return;const r=s.getBoundingClientRect();a.value={visible:!0,x:e.clientX-r.left+14,y:e.clientY-r.top-10,type:t.type,strength:t.strength,label:t.label,from:t.from,to:t.to}}function K(){a.value.visible=!1}function Q(e){return e==="上级"?"danger":e==="下级"?"":e==="平级协作"?"success":"info"}function Z(e){return e==="核心"?"danger":e==="常用"?"warning":"info"}async function N(){x.value=!0;try{const e=await ct.graph();p.value=e.data}catch{st.error("加载图谱失败")}finally{x.value=!1}}return nt(N),(e,t)=>{const s=y("Refresh"),r=y("el-icon"),c=y("el-button"),u=y("Share"),m=y("Connection"),S=y("el-tag"),V=y("el-card"),tt=lt("loading");return l(),i("div",ut,[n("div",ft,[t[1]||(t[1]=n("h2",null,"团队关系图谱",-1)),h(c,{size:"small",onClick:N},{default:g(()=>[h(r,null,{default:g(()=>[h(s)]),_:1}),t[0]||(t[0]=_(" 刷新 ",-1))]),_:1})]),ot((l(),L(V,{class:"graph-card"},{default:g(()=>[!x.value&&!p.value.nodes.length?(l(),i("div",pt,[h(r,{style:{"font-size":"64px",color:"#c0c4cc",display:"block",margin:"0 auto 16px"}},{default:g(()=>[h(u)]),_:1}),t[2]||(t[2]=n("p",{style:{color:"#909399","text-align":"center",margin:"0"}}," 暂无成员数据 ",-1))])):!x.value&&p.value.nodes.length&&!p.value.edges.length?(l(),i("div",ht,[h(r,{style:{"font-size":"64px",color:"#c0c4cc",display:"block",margin:"0 auto 16px"}},{default:g(()=>[h(m)]),_:1}),t[3]||(t[3]=n("p",{style:{color:"#909399","text-align":"center",margin:"0"}}," 为成员配置 RELATIONS.md 即可自动生成关系图谱 ",-1)),t[4]||(t[4]=n("p",{style:{color:"#c0c4cc","text-align":"center","font-size":"13px",margin:"6px 0 0"}}," 前往成员详情页 → 「关系」Tab 编辑 RELATIONS.md ",-1))])):(l(),i("div",{key:2,class:"graph-container",ref_key:"containerRef",ref:T},[(l(),i("svg",{width:P,height:D,class:"graph-svg"},[n("defs",null,[(l(),i(k,null,C(E,(o,d)=>n("marker",{key:d,id:`arrow-${$(d)}`,markerWidth:"8",markerHeight:"8",refX:"6",refY:"3",orient:"auto"},[n("path",{d:"M0,0 L0,6 L8,3 z",fill:o},null,8,mt)],8,gt)),64))]),(l(!0),i(k,null,C(p.value.edges,o=>(l(),i("g",{key:`${o.from}-${o.to}`},[n("line",{x1:z(o).x,y1:z(o).y,x2:R(o).x,y2:R(o).y,stroke:Y(o.type),"stroke-width":j(o.strength),"stroke-opacity":"0.85","marker-end":`url(#arrow-${$(o.type)})`,class:"graph-edge",onMouseenter:d=>J(d,o),onMouseleave:K},null,40,yt)]))),128)),(l(!0),i(k,null,C(p.value.nodes,o=>(l(),i("g",{key:o.id,transform:`translate(${v(o.id).x}, ${v(o.id).y})`,class:"graph-node",onClick:d=>G(o.id)},[t[5]||(t[5]=n("circle",{r:"30",fill:"rgba(0,0,0,0.08)",transform:"translate(2,3)"},null,-1)),n("circle",{r:"28",fill:U(o.id),stroke:"#fff","stroke-width":"2.5"},null,8,vt),n("text",xt,f(X(o.id)),1),n("circle",{cx:"20",cy:"-20",r:"6",fill:o.status==="running"?"#67C23A":"#c0c4cc",stroke:"#fff","stroke-width":"1.5"},null,8,kt),n("text",Ct,f(o.name),1),n("text",wt,f(o.id),1)],8,_t))),128))])),a.value.visible?(l(),i("div",{key:0,class:"edge-tooltip",style:rt({left:a.value.x+"px",top:a.value.y+"px"})},[n("div",bt,[n("span",Mt,f(I(a.value.from)),1),t[6]||(t[6]=n("span",{class:"tooltip-arrow"},"→",-1)),n("span",Et,f(I(a.value.to)),1)]),n("div",At,[h(S,{type:Q(a.value.type),size:"small"},{default:g(()=>[_(f(a.value.type),1)]),_:1},8,["type"]),h(S,{type:Z(a.value.strength),size:"small",effect:"plain"},{default:g(()=>[_(f(a.value.strength),1)]),_:1},8,["type"])]),a.value.label?(l(),i("div",Tt,f(a.value.label),1)):A("",!0)],4)):A("",!0)],512))]),_:1})),[[tt,x.value]]),p.value.nodes.length?(l(),L(V,{key:0,class:"legend-card"},{default:g(()=>[n("div",zt,[t[7]||(t[7]=n("span",{class:"legend-title"},"关系类型：",-1)),(l(),i(k,null,C(E,(o,d)=>n("span",{key:d,class:"legend-item"},[(l(),i("svg",Rt,[n("line",{x1:"0",y1:"3",x2:"28",y2:"3",stroke:o,"stroke-width":"3"},null,8,Ft)])),_(" "+f(d),1)])),64)),t[8]||(t[8]=n("span",{class:"legend-divider"}," | ",-1)),t[9]||(t[9]=n("span",{class:"legend-title"},"关系程度（线粗）：",-1)),(l(),i(k,null,C(B,(o,d)=>n("span",{key:d,class:"legend-item"},[(l(),i("svg",It,[n("line",{x1:"0",y1:"4",x2:"28",y2:"4",stroke:"#606266","stroke-width":o},null,8,Bt)])),_(" "+f(d),1)])),64)),t[10]||(t[10]=n("span",{class:"legend-divider"}," | ",-1)),t[11]||(t[11]=n("span",{class:"legend-item"},[n("svg",{width:"12",height:"12"},[n("circle",{cx:"6",cy:"6",r:"5",fill:"#67C23A"})]),_(" 运行中 ")],-1)),t[12]||(t[12]=n("span",{class:"legend-item"},[n("svg",{width:"12",height:"12"},[n("circle",{cx:"6",cy:"6",r:"5",fill:"#c0c4cc"})]),_(" 空闲/停止 ")],-1))])]),_:1})):A("",!0)])}}}),Pt=dt($t,[["__scopeId","data-v-ab3eefcc"]]);export{Pt as default};
