import{d as Ue,e as m,D as ze,I as He,i as qe,c as a,f as j,n as Ke,s as F,a as b,w as O,S as Ve,b as l,h as B,t as f,k as d,F as $,m as I,p as We,G as Ge,g as de,z as pe,H as q,r as J,o as n,j as he,q as Xe}from"./index-Se2ENCi_.js";import{n as Ye,i as Qe,o as Ze}from"./index-B6SLQW8T.js";import{_ as et}from"./_plugin-vue_export-helper-DlAUqK2U.js";const tt={key:0,class:"drag-overlay"},st={key:0,class:"running-tasks-banner"},nt={key:0,class:"history-loading"},ot={key:1,class:"chat-empty"},at={key:0,class:"welcome-msg"},lt={key:1,class:"examples"},it=["onClick"],rt={key:0,class:"msg-row user"},ct={class:"msg-bubble user"},ut={key:0,class:"msg-images"},dt=["src","onClick"],pt={class:"msg-text"},ht={key:1,class:"msg-row assistant"},ft={class:"msg-col"},vt=["open"],_t={class:"thinking-summary"},gt={class:"thinking-len"},mt={class:"thinking-content"},kt={key:1,class:"tool-timeline"},yt=["onClick"],xt={class:"tool-step-header"},bt={key:0,class:"tool-spin"},wt={key:1},Ct={key:2},St={key:3},$t={class:"tool-step-icon"},It={class:"tool-step-name"},Tt={key:0,class:"tool-step-summary"},Dt={key:1,class:"tool-step-dur"},Mt={key:0},At={key:1},Nt={key:2},jt={key:3},Ft={key:4},Ot={class:"tool-step-chevron"},Bt={key:0,class:"tool-section"},Lt={class:"tool-pre"},Pt={key:1,class:"tool-section"},Et={class:"tool-pre result"},Jt={class:"msg-bubble assistant"},Rt=["innerHTML"],Ut={key:1,class:"apply-card"},zt={class:"apply-preview"},Ht={class:"apply-key"},qt={class:"apply-val"},Kt=["onClick"],Vt={class:"msg-actions"},Wt=["onClick","title"],Gt=["onClick"],Xt=["onClick"],Yt={key:2,class:"option-chips"},Qt=["onClick"],Zt={key:2,class:"msg-row system"},es={class:"msg-system"},ts={key:2,class:"msg-row assistant"},ss={class:"msg-col"},ns={key:0,class:"thinking-block",open:""},os={class:"thinking-summary"},as={class:"thinking-content"},ls={key:1,class:"tool-timeline"},is=["onClick"],rs={class:"tool-step-header"},cs={key:0,class:"tool-spin"},us={key:1},ds={key:2},ps={class:"tool-step-icon"},hs={class:"tool-step-name"},fs={key:0,class:"tool-step-summary"},vs={key:1,class:"tool-step-dur"},_s={key:0},gs={key:1},ms={key:2},ks={key:3},ys={key:4},xs={class:"tool-step-chevron"},bs={key:0,class:"tool-section"},ws={class:"tool-pre"},Cs={key:1,class:"tool-section"},Ss={class:"tool-pre result"},$s={key:2,class:"msg-bubble assistant"},Is={key:0,class:"typing-dots"},Ts=["innerHTML"],Ds={key:2,class:"blink"},Ms=["src"],As={class:"chat-input-area"},Ns={key:0,class:"attachments-bar"},js=["src"],Fs=["onClick"],Os={class:"attach-file-icon"},Bs={class:"attach-file-name"},Ls={class:"attach-file-size"},Ps=["onClick"],Es={class:"input-row"},Js={class:"textarea-wrap"},Rs=["placeholder","disabled","onKeydown"],Us={class:"input-actions"},zs={class:"icon-btn",title:"é™„åŠ æ–‡ä»¶ï¼ˆå›¾ç‰‡/ä»£ç /æ–‡æœ¬ï¼‰"},Hs=["disabled"],qs={key:0,class:"spinner"},Ks={key:1},Vs=Ue({__name:"AiChat",props:{agentId:{},sessionId:{},context:{},scenario:{},skillId:{},placeholder:{},welcomeMessage:{},examples:{default:()=>[]},showThinking:{type:Boolean,default:!1},compact:{type:Boolean,default:!1},bgColor:{},height:{},initialMessages:{},applyable:{type:Boolean,default:!1}},emits:["message","response","apply","session-change","streaming-change"],setup(w,{expose:fe,emit:ve}){const k=w,R=ve,_=m(k.initialMessages?[...k.initialMessages]:[]),L=m(""),M=m([]),A=m([]),C=m(!1);ze(C,t=>R("streaming-change",t));const y=m(""),P=m(""),T=m([]),U=Xe(new Map);let x=null;const te=pe(()=>{let t=0;for(const e of _.value)for(const o of e.toolCalls??[])o.taskId&&o.taskStatus&&!["done","error","killed"].includes(o.taskStatus)&&t++;return t}),z=m(!1);let H=0;const K=m(null),V=m(""),N=m(k.sessionId),E=m(!1),W=m(),D=m(),_e=pe(()=>({height:k.height??"100%","--bg":k.bgColor??"transparent"}));function ge(){x||(x=setInterval(me,3e3))}async function me(){if(U.size===0){x&&(clearInterval(x),x=null);return}const t=[];for(const[e,o]of U)try{const p=(await Ze.get(o)).data;for(const u of _.value){const h=u.toolCalls?.find(g=>g.id===e);h&&(h.taskStatus=p.status,(p.status==="done"||p.status==="error"||p.status==="killed")&&t.push(e))}}catch{t.push(e)}for(const e of t)U.delete(e);U.size===0&&x&&(clearInterval(x),x=null)}He(()=>{x&&(clearInterval(x),x=null)});function S(){q(()=>{W.value&&(W.value.scrollTop=W.value.scrollHeight)})}function ke(){D.value&&(D.value.style.height="auto",D.value.style.height=Math.min(D.value.scrollHeight,160)+"px")}function G(t){L.value=t,q(()=>D.value?.focus())}function se(t){try{return JSON.stringify(JSON.parse(t),null,2)}catch{return t}}function ye(t){navigator.clipboard?.writeText(t);const e=_.value.findIndex(o=>o.text===t);K.value=e,setTimeout(()=>{K.value=null},1500)}function xe(t){for(let e=t-1;e>=0;e--){const o=_.value[e];if(o&&o.role==="user"){const c=o.text,p=o.images??[];_.value.splice(e,_.value.length-e),ee(c,p);return}}}function be(t){V.value=t}function ne(t){return t?t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/```(\w*)\n([\s\S]*?)```/g,(o,c,p)=>`<pre class="code-block${c?" lang-"+c:""}"><code>${p}</code></pre>`).replace(/`([^`]+)`/g,'<code class="inline-code">$1</code>').replace(/\*\*(.+?)\*\*/g,"<strong>$1</strong>").replace(/\*(.+?)\*/g,"<em>$1</em>").replace(/\[(.+?)\]\((https?:\/\/[^\)]+)\)/g,'<a href="$2" target="_blank" rel="noopener">$1</a>').replace(/^### (.+)$/gm,"<h3>$1</h3>").replace(/^## (.+)$/gm,"<h2>$1</h2>").replace(/^# (.+)$/gm,"<h1>$1</h1>").replace(/^[-*] (.+)$/gm,"<li>$1</li>").replace(/^\d+\. (.+)$/gm,"<li>$1</li>").replace(/(<li>[\s\S]+?<\/li>)(\n(?!<li>)|$)/g,"<ul>$1</ul>$2").replace(/([^>])\n([^<])/g,"$1<br>$2"):""}function we(t){const e=t.split(`
`),o=[],c=/^([ğŸ™ğŸ˜„ğŸŒğŸ›ğŸ“šğŸ¨ğŸ’¼ğŸ¤–âš½ğŸ¯âœ…âŒğŸ”¥ğŸ’¡ğŸğŸš€ğŸŒŸğŸ’ğŸªğŸ­ğŸ¬ğŸ¤]|[\u{1F300}-\u{1FFFF}]|[\u{2600}-\u{27BF}])\s+(.{4,40})/u;for(const p of e){const u=p.replace(/^[-*â€¢]\s*/,"").trim();if(u.match(c)){const g=u.replace(/[ï¼š:ã€‚ï¼Œ,]$/,"").trim();g.length>=5&&o.push(g)}}return o.slice(0,5)}function Ce(t){return t?/\{[\s\S]{30,}\}/.test(t)&&(t.includes('"name"')||t.includes('"identity"')||t.includes('"soul"')||t.includes('"IDENTITY"')||t.includes('"SOUL"')):!1}function Se(t){const e=ae(t.text);console.log("[AiChat] manualApply result:",e),e?(t.applyData=e,q(()=>R("apply",e))):alert("æœªèƒ½ä»æ¶ˆæ¯ä¸­æå–åˆ°é…ç½® JSONï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶")}function oe(t,e=0){const o=t.indexOf("{",e);if(o===-1)return null;let c=0,p=!1,u=!1;for(let h=o;h<t.length;h++){const g=t[h];if(u){u=!1;continue}if(g==="\\"&&p){u=!0;continue}if(g==='"'){p=!p;continue}if(!p){if(g==="{")c++;else if(g==="}"&&(c--,c===0))return{raw:t.slice(o,h+1),end:h+1}}}return null}function ae(t){const e=/```(?:json)?\s*\n?([\s\S]*?)```/g,o=[];let c;for(;(c=e.exec(t))!==null;){const h=(c[1]??"").trim();h.startsWith("{")&&o.push(h)}for(let h=o.length-1;h>=0;h--){const g=o[h],s=oe(g);if(!s)continue;const r=X(s.raw)??X(le(s.raw));if(r)return r}const p=[];let u=0;for(;u<t.length;){const h=oe(t,u);if(!h)break;p.push(h.raw),u=h.end}for(let h=p.length-1;h>=0;h--){const g=p[h],s=X(g)??X(le(g));if(s)return s}return null}function X(t){try{const e=JSON.parse(t);if(e&&typeof e=="object"&&!Array.isArray(e)){const o=["name","id","description","identity","soul","IDENTITY","SOUL","NAME","DESCRIPTION"];if(Object.keys(e).some(c=>o.includes(c)))return e}}catch{}return null}function le(t){let e="",o=!1,c=!1;for(let p=0;p<t.length;p++){const u=t[p];if(c){e+=u,c=!1;continue}if(u==="\\"&&o){e+=u,c=!0;continue}if(u==='"'){o=!o,e+=u;continue}if(o&&u===`
`){e+="\\n";continue}if(o&&u==="\r"){e+="\\r";continue}e+=u}return e}const $e={exec:"âš¡",bash:"âš¡",read:"ğŸ“–",write:"âœï¸",edit:"âœï¸",web_search:"ğŸŒ",web_fetch:"ğŸŒ",browser:"ğŸŒ",agent_spawn:"ğŸš€",agent_tasks:"ğŸ“‹",agent_kill:"ğŸ›‘",agent_result:"ğŸ“Š",project_read:"ğŸ“",project_write:"ğŸ“",project_list:"ğŸ“",project_create:"ğŸ“",project_glob:"ğŸ“",memory_search:"ğŸ§ ",memory_get:"ğŸ§ ",image:"ğŸ–¼ï¸",tts:"ğŸ”Š",cron:"â±ï¸"};function ie(t){return $e[t]??"âš™ï¸"}function re(t,e){try{const o=JSON.parse(e);if(t==="exec"||t==="bash")return(o.command??"").slice(0,60);if(t==="read")return o.file_path??o.path??"";if(t==="write")return(o.file_path??o.path??"")+(o.content?` (${o.content.length}B)`:"");if(t==="edit")return o.file_path??o.path??"";if(t==="web_search")return o.query??"";if(t==="web_fetch")return o.url??"";if(t==="agent_spawn")return`â†’ ${o.agentId}: ${(o.task??"").slice(0,40)}`;if(t==="project_read"||t==="project_write")return o.path??"";if(t==="memory_search")return o.query??""}catch{}return""}const Ie=new Set(["txt","md","markdown","js","ts","jsx","tsx","vue","go","py","rs","java","kt","swift","html","css","scss","less","json","yaml","yml","toml","ini","cfg","env","sh","bash","zsh","fish","ps1","bat","cmd","dockerfile","makefile","sql","graphql","proto","xml","svg","gitignore","gitattributes"]);function ce(t){const e=t.split(".").pop()?.toLowerCase()??"";return Ie.has(e)}function Te(t){const e=t.split(".").pop()?.toLowerCase()??"";return{js:"ğŸŸ¨",ts:"ğŸ”µ",vue:"ğŸ’š",go:"ğŸ¹",py:"ğŸ",rs:"ğŸ¦€",html:"ğŸŒ",css:"ğŸ¨",json:"ğŸ“‹",md:"ğŸ“",sh:"âš¡",sql:"ğŸ—„ï¸",yaml:"âš™ï¸",yml:"âš™ï¸",dockerfile:"ğŸ³"}[e]??"ğŸ“„"}function De(t){return t<1024?`${t}B`:t<1024*1024?`${(t/1024).toFixed(1)}KB`:`${(t/1024/1024).toFixed(1)}MB`}function Me(t){const e=t.clipboardData?.items;if(e){for(const o of Array.from(e))if(o.type.startsWith("image/")){t.preventDefault();const c=o.getAsFile();c&&Z(c)}}}function Ae(t){t.preventDefault(),H++,z.value=!0}function Ne(t){t.preventDefault(),H--,H<=0&&(H=0,z.value=!1)}function je(t){H=0,z.value=!1;const e=t.dataTransfer?.files;if(e)for(const o of Array.from(e))o.type.startsWith("image/")?Z(o):ce(o.name)&&ue(o)}function Fe(t){const e=t.target.files;if(e){for(const o of Array.from(e))o.type.startsWith("image/")?Z(o):ce(o.name)&&ue(o);t.target.value=""}}function ue(t){const e=new FileReader;e.onload=()=>{typeof e.result=="string"&&A.value.push({name:t.name,content:e.result})},e.readAsText(t)}function Z(t){const e=new FileReader;e.onload=()=>{typeof e.result=="string"&&M.value.push(e.result)},e.readAsDataURL(t)}function Oe(t){M.value.splice(t,1)}function Y(){const t=L.value.trim(),e=[...M.value],o=[...A.value];if(!t&&!e.length&&!o.length||C.value)return;let c=t;if(o.length>0){const p=o.map(u=>{const h=u.name.split(".").pop()??"text";return`

ğŸ“ **${u.name}**
\`\`\`${h}
${u.content}
\`\`\``}).join("");c=t?t+p:p.trimStart()}L.value="",M.value=[],A.value=[],q(()=>{D.value&&(D.value.style.height="auto")}),R("message",c,e),ee(c,e)}function ee(t,e,o=!1){o||(_.value.push({role:"user",text:t,images:e.length?e:void 0}),S()),C.value=!0,y.value="",P.value="",T.value=[];const c={role:"assistant",text:"",toolCalls:[]};_.value.push(c),o&&S();const p=_.value.length-1;let u="",h;if(N.value)h=void 0;else{const s=_.value.slice(0,-1).filter(r=>(r.role==="user"||r.role==="assistant")&&r.text).slice(-20).map(r=>({role:r.role,content:r.text}));h=s.length>0?s:void 0}const g={sessionId:N.value,context:k.context,scenario:k.scenario,skillId:k.skillId,images:e.length?e:void 0,history:h};Ye(k.agentId,t,s=>{switch(s.type){case"thinking_delta":P.value+=s.text,S();break;case"text":case"text_delta":y.value+=s.text,S();break;case"tool_call":{const r={id:s.tool_call?.id??String(Date.now()),name:s.tool_call?.name??"tool",input:s.tool_call?.input?JSON.stringify(s.tool_call.input):void 0,status:"running",_startedAt:Date.now(),_expanded:!1};_.value[p].toolCalls.push(r),T.value.push(r),u=r.id,S();break}case"tool_result":{const r=_.value[p].toolCalls?.find(i=>i.id===u);if(r){if(r.result=s.text,r.status="done",r._startedAt){const v=Date.now()-r._startedAt;r.duration=v<1e3?`${v}ms`:`${(v/1e3).toFixed(1)}s`}if(r.name==="agent_spawn"&&s.text){const v=s.text.match(/ä»»åŠ¡\s*ID[ï¼š:]\s*([a-f0-9-]{8,})/i);v&&(r.taskId=v[1],r.taskStatus="pending",U.set(u,v[1]),ge())}const i=T.value.find(v=>v.id===u);i&&(i.result=r.result,i.status="done",i.duration=r.duration)}S();break}case"done":case"error":{if(s.type==="done"&&s.sessionId){const v=!N.value;N.value=s.sessionId,v&&R("session-change",s.sessionId)}const r=_.value[p];if(r.text=y.value,r.thinking=P.value||void 0,k.applyable){const v=ae(y.value);v?(r.applyData=v,console.log("[AiChat] applyData extracted:",v)):console.log("[AiChat] no applyData found in text length:",y.value.length)}const i=we(y.value);if(i.length>=2&&(r.options=i),s.type==="error"){r.text=`[é”™è¯¯] ${s.error}`;const v=r.toolCalls?.find(Q=>Q.status==="running");v&&(v.status="error")}C.value=!1,y.value="",P.value="",T.value=[],R("response",r.text),S();break}}},g)}function Be(){_.value=[]}function Le(t){_.value.push(t),S()}async function Pe(t){N.value=t,_.value=[],E.value=!0;try{const o=(await Qe.get(k.agentId,t)).data.messages??[],c=[];o.some(u=>u.isCompact||u.role==="compaction")&&c.push({role:"system",text:"æ›´æ—©çš„å†…å®¹å·²å‹ç¼©"});for(const u of o)u.role!=="compaction"&&c.push({role:u.role,text:u.text});_.value=c,S()}catch(e){e?.response?.status===404?_.value=[]:(console.error("[AiChat] resumeSession failed",e),_.value=[{role:"system",text:"å†å²åŠ è½½å¤±è´¥ï¼Œç»§ç»­å¯¹è¯ä»å¯æ¥ç»­"}])}finally{E.value=!1}}function Ee(){N.value=void 0,_.value=[]}function Je(t){G(t),q(Y)}function Re(t){ee(t,[],!0)}return fe({clearMessages:Be,appendMessage:Le,sendText:Je,sendSilent:Re,fillInput:G,messages:_,streaming:C,currentSessionId:N,resumeSession:Pe,startNewSession:Ee}),qe(()=>{S()}),(t,e)=>{const o=J("ChatRound"),c=J("el-icon"),p=J("Check"),u=J("CopyDocument"),h=J("Setting"),g=J("Paperclip");return n(),a("div",{class:F(["ai-chat",{compact:w.compact,"has-bg":w.bgColor,"drag-active":z.value}]),style:Ke(_e.value),onDragenter:j(Ae,["prevent"]),onDragover:e[4]||(e[4]=j(()=>{},["prevent"])),onDragleave:Ne,onDrop:j(je,["prevent","stop"])},[b(Ve,{name:"drag-fade"},{default:O(()=>[z.value?(n(),a("div",tt,[...e[5]||(e[5]=[l("div",{class:"drag-overlay-content"},[l("div",{class:"drag-overlay-icon"},"ğŸ“"),l("div",{class:"drag-overlay-title"},"æ¾å¼€ä»¥é™„åŠ æ–‡ä»¶"),l("div",{class:"drag-overlay-hint"},"æ”¯æŒå›¾ç‰‡ Â· ä»£ç  Â· æ–‡æœ¬æ–‡ä»¶")],-1)])])):d("",!0)]),_:1}),te.value>0?(n(),a("div",st,[e[6]||(e[6]=l("span",{class:"running-dot"},null,-1)),B(" åå°æœ‰ "+f(te.value)+" ä¸ªä»»åŠ¡æ­£åœ¨æ‰§è¡Œä¸­ï¼Œå…³é—­çª—å£åä»ä¼šç»§ç»­è¿è¡Œâ€¦ ",1)])):d("",!0),l("div",{class:"chat-messages",ref_key:"msgListRef",ref:W},[E.value?(n(),a("div",nt,[...e[7]||(e[7]=[l("div",{class:"history-loading-dots"},[l("span"),l("span"),l("span")],-1),l("div",{class:"history-loading-text"},"åŠ è½½å†å²å¯¹è¯â€¦",-1)])])):d("",!0),!_.value.length&&!E.value?(n(),a("div",ot,[w.welcomeMessage?(n(),a("div",at,f(w.welcomeMessage),1)):d("",!0),w.examples.length?(n(),a("div",lt,[(n(!0),a($,null,I(w.examples,(s,r)=>(n(),a("div",{key:r,class:"example-chip",onClick:i=>G(s)},f(s),9,it))),128))])):d("",!0)])):d("",!0),(n(!0),a($,null,I(C.value?_.value.slice(0,-1):_.value,(s,r)=>(n(),a($,{key:r},[s.role==="user"?(n(),a("div",rt,[l("div",ct,[s.images?.length?(n(),a("div",ut,[(n(!0),a($,null,I(s.images,(i,v)=>(n(),a("img",{key:v,src:i,class:"msg-img",onClick:Q=>be(i)},null,8,dt))),128))])):d("",!0),l("div",pt,f(s.text),1)])])):s.role==="assistant"?(n(),a("div",ht,[l("div",ft,[s.thinking?(n(),a("details",{key:0,class:"thinking-block",open:w.showThinking},[l("summary",_t,[b(c,{class:"thinking-icon"},{default:O(()=>[b(o)]),_:1}),e[8]||(e[8]=B(" æ€è€ƒè¿‡ç¨‹ ",-1)),l("span",gt,f(s.thinking.length)+" å­—ç¬¦",1)]),l("pre",mt,f(s.thinking),1)],8,vt)):d("",!0),s.toolCalls?.length?(n(),a("div",kt,[(n(!0),a($,null,I(s.toolCalls,(i,v)=>(n(),a("div",{key:v,class:F(["tool-step",i.status]),onClick:Q=>i._expanded=!i._expanded},[l("div",xt,[l("span",{class:F(["tool-step-dot",i.status])},[i.status==="running"?(n(),a("span",bt,"âŸ³")):i.status==="done"?(n(),a("span",wt,"âœ“")):i.status==="error"?(n(),a("span",Ct,"âœ—")):(n(),a("span",St,"â—‹"))],2),l("span",$t,f(ie(i.name)),1),l("code",It,f(i.name),1),i.input?(n(),a("span",Tt,f(re(i.name,i.input)),1)):d("",!0),e[10]||(e[10]=l("span",{class:"tool-step-flex"},null,-1)),i.duration?(n(),a("span",Dt,f(i.duration),1)):d("",!0),i.taskId?(n(),a("span",{key:2,class:F(["task-badge",i.taskStatus])},[i.taskStatus==="pending"?(n(),a("span",Mt,"ğŸŸ¡ æ’é˜Ÿä¸­")):i.taskStatus==="running"?(n(),a("span",At,[...e[9]||(e[9]=[l("span",{class:"tool-spin"},"âŸ³",-1),B(" æ‰§è¡Œä¸­ ",-1)])])):i.taskStatus==="done"?(n(),a("span",Nt,"âœ… å®Œæˆ")):i.taskStatus==="error"?(n(),a("span",jt,"âŒ å¤±è´¥")):i.taskStatus==="killed"?(n(),a("span",Ft,"ğŸ›‘ å·²ç»ˆæ­¢")):d("",!0)],2)):d("",!0),l("span",Ot,f(i._expanded?"â–²":"â–¼"),1)]),i._expanded?(n(),a("div",{key:0,class:"tool-step-body",onClick:e[0]||(e[0]=j(()=>{},["stop"]))},[i.input?(n(),a("div",Bt,[e[11]||(e[11]=l("div",{class:"tool-label"},"INPUT",-1)),l("pre",Lt,f(se(i.input)),1)])):d("",!0),i.result?(n(),a("div",Pt,[e[12]||(e[12]=l("div",{class:"tool-label"},"OUTPUT",-1)),l("pre",Et,f(i.result.slice(0,3e3))+f(i.result.length>3e3?`
â€¦ (æˆªæ–­)`:""),1)])):d("",!0)])):d("",!0)],10,yt))),128))])):d("",!0),l("div",Jt,[s.text?(n(),a("div",{key:0,class:"msg-text",innerHTML:ne(s.text)},null,8,Rt)):d("",!0),s.applyData&&k.applyable?(n(),a("div",Ut,[l("div",zt,[(n(!0),a($,null,I(s.applyData,(i,v)=>(n(),a("div",{key:v,class:"apply-row"},[l("span",Ht,f(v),1),l("span",qt,f(String(i).slice(0,60))+f(String(i).length>60?"â€¦":""),1)]))),128))]),l("button",{class:"apply-btn",onClick:i=>t.$emit("apply",s.applyData)}," åº”ç”¨åˆ°è¡¨å• â†™ ",8,Kt)])):d("",!0),l("div",Vt,[l("button",{class:"act-btn",onClick:i=>ye(s.text),title:K.value===r?"å·²å¤åˆ¶":"å¤åˆ¶"},[K.value===r?(n(),he(c,{key:0},{default:O(()=>[b(p)]),_:1})):(n(),he(c,{key:1},{default:O(()=>[b(u)]),_:1}))],8,Wt),l("button",{class:"act-btn",onClick:i=>xe(r),title:"é‡è¯•"},"â†º",8,Gt),k.applyable&&!s.applyData&&Ce(s.text)?(n(),a("button",{key:0,class:"act-btn apply-manual-btn",onClick:i=>Se(s),title:"æ£€æµ‹åˆ°é…ç½® JSONï¼Œç‚¹å‡»åº”ç”¨"},[b(c,null,{default:O(()=>[b(h)]),_:1}),e[13]||(e[13]=B(" åº”ç”¨é…ç½® ",-1))],8,Xt)):d("",!0)])]),s.options&&s.options.length?(n(),a("div",Yt,[(n(!0),a($,null,I(s.options,(i,v)=>(n(),a("button",{key:v,class:"option-chip",onClick:Q=>G(i)},f(i),9,Qt))),128))])):d("",!0)])])):s.role==="system"?(n(),a("div",Zt,[l("div",es,f(s.text),1)])):d("",!0)],64))),128)),C.value?(n(),a("div",ts,[l("div",ss,[P.value&&w.showThinking?(n(),a("details",ns,[l("summary",os,[b(c,{class:"thinking-icon"},{default:O(()=>[b(o)]),_:1}),e[14]||(e[14]=B(" æ€è€ƒä¸­â€¦ ",-1))]),l("pre",as,[B(f(P.value),1),e[15]||(e[15]=l("span",{class:"blink"},"â–Š",-1))])])):d("",!0),T.value.length?(n(),a("div",ls,[(n(!0),a($,null,I(T.value,(s,r)=>(n(),a("div",{key:r,class:F(["tool-step",s.status]),onClick:i=>s._expanded=!s._expanded},[l("div",rs,[l("span",{class:F(["tool-step-dot",s.status])},[s.status==="running"?(n(),a("span",cs,"âŸ³")):s.status==="done"?(n(),a("span",us,"âœ“")):s.status==="error"?(n(),a("span",ds,"âœ—")):d("",!0)],2),l("span",ps,f(ie(s.name)),1),l("code",hs,f(s.name),1),s.input?(n(),a("span",fs,f(re(s.name,s.input)),1)):d("",!0),e[17]||(e[17]=l("span",{class:"tool-step-flex"},null,-1)),s.duration?(n(),a("span",vs,f(s.duration),1)):d("",!0),s.taskId?(n(),a("span",{key:2,class:F(["task-badge",s.taskStatus])},[s.taskStatus==="pending"?(n(),a("span",_s,"ğŸŸ¡ æ’é˜Ÿä¸­")):s.taskStatus==="running"?(n(),a("span",gs,[...e[16]||(e[16]=[l("span",{class:"tool-spin"},"âŸ³",-1),B(" æ‰§è¡Œä¸­",-1)])])):s.taskStatus==="done"?(n(),a("span",ms,"âœ… å®Œæˆ")):s.taskStatus==="error"?(n(),a("span",ks,"âŒ å¤±è´¥")):s.taskStatus==="killed"?(n(),a("span",ys,"ğŸ›‘ å·²ç»ˆæ­¢")):d("",!0)],2)):d("",!0),l("span",xs,f(s._expanded?"â–²":"â–¼"),1)]),s._expanded?(n(),a("div",{key:0,class:"tool-step-body",onClick:e[1]||(e[1]=j(()=>{},["stop"]))},[s.input?(n(),a("div",bs,[e[18]||(e[18]=l("div",{class:"tool-label"},"INPUT",-1)),l("pre",ws,f(se(s.input)),1)])):d("",!0),s.result?(n(),a("div",Cs,[e[19]||(e[19]=l("div",{class:"tool-label"},"OUTPUT",-1)),l("pre",Ss,f(s.result.slice(0,3e3)),1)])):d("",!0)])):d("",!0)],10,is))),128))])):d("",!0),y.value||!T.value.length?(n(),a("div",$s,[!y.value&&!T.value.length?(n(),a("div",Is,[...e[20]||(e[20]=[l("span",null,null,-1),l("span",null,null,-1),l("span",null,null,-1)])])):d("",!0),y.value?(n(),a("div",{key:1,class:"msg-text",innerHTML:ne(y.value)},null,8,Ts)):d("",!0),y.value?(n(),a("span",Ds,"â–Š")):d("",!0)])):d("",!0)])])):d("",!0)],512),V.value?(n(),a("div",{key:1,class:"img-preview-mask",onClick:e[2]||(e[2]=s=>V.value="")},[l("img",{src:V.value,class:"img-preview-full"},null,8,Ms)])):d("",!0),l("div",As,[M.value.length||A.value.length?(n(),a("div",Ns,[(n(!0),a($,null,I(M.value,(s,r)=>(n(),a("div",{key:"img-"+r,class:"attach-thumb"},[l("img",{src:s},null,8,js),l("button",{class:"remove-attach",onClick:i=>Oe(r)},"Ã—",8,Fs)]))),128)),(n(!0),a($,null,I(A.value,(s,r)=>(n(),a("div",{key:"file-"+r,class:"attach-file-chip"},[l("span",Os,f(Te(s.name)),1),l("span",Bs,f(s.name),1),l("span",Ls,f(De(s.content.length)),1),l("button",{class:"attach-file-remove",onClick:i=>A.value.splice(r,1)},"Ã—",8,Ps)]))),128))])):d("",!0),l("div",Es,[l("div",Js,[We(l("textarea",{ref_key:"inputRef",ref:D,"onUpdate:modelValue":e[3]||(e[3]=s=>L.value=s),placeholder:w.placeholder||"è¾“å…¥æ¶ˆæ¯â€¦ æ”¯æŒæ‹–æ‹½å›¾ç‰‡æˆ–æ–‡ä»¶ (Ctrl+Enter å‘é€)",disabled:C.value||E.value,rows:"1",class:"chat-textarea",onKeydown:[de(j(Y,["ctrl","prevent"]),["enter"]),de(j(Y,["meta","prevent"]),["enter"])],onPaste:Me,onInput:ke},null,40,Rs),[[Ge,L.value]])]),l("div",Us,[l("label",zs,[b(c,null,{default:O(()=>[b(g)]),_:1}),l("input",{type:"file",multiple:"",hidden:"",onChange:Fe},null,32)]),l("button",{class:"send-btn",disabled:C.value||E.value||!L.value.trim()&&!M.value.length&&!A.value.length,onClick:Y},[C.value?(n(),a("span",qs)):(n(),a("span",Ks,"â†‘"))],8,Hs)])]),e[21]||(e[21]=l("div",{class:"input-hint"},"Ctrl+Enter å‘é€ Â· æ”¯æŒæ‹–æ‹½å›¾ç‰‡/æ–‡ä»¶",-1))])],38)}}}),Ys=et(Vs,[["__scopeId","data-v-c7c01c36"]]);export{Ys as A};
