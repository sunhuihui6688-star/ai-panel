import{d as Ue,i as Pe,c as p,b as n,a as l,w as t,F as J,m as Q,k as F,t as y,j as k,e as r,z as Ee,r as f,o as s,l as c,B as ie,s as Ne,O,Y as De,h as u,f as Ie,Z as Te,n as ue,_ as Me,$ as Ae,N as Ke,P as de,a0 as Le,M as qe,g as re,E as v,x as fe}from"./index-CdZnHZ0f.js";import{u as w,b as Oe}from"./index-B6SLQW8T.js";import{_ as Re}from"./_plugin-vue_export-helper-DlAUqK2U.js";const We={class:"projects-layout"},Ye={class:"projects-sidebar"},Ze={class:"sidebar-header"},Ge={class:"project-list"},He=["onClick"],Je={class:"project-item-body"},Qe={class:"project-name"},Xe={key:0,class:"project-desc"},he={key:0,class:"empty-projects"},el={key:0,class:"projects-main"},ll={class:"main-header"},tl={class:"main-title"},ol={style:{display:"flex","align-items":"center",gap:"8px"}},al={style:{"margin-bottom":"12px"}},nl={key:0,style:{"margin-top":"12px"}},sl={style:{display:"inline-flex","align-items":"center",gap:"8px"}},il={class:"file-panel"},ul={class:"file-panel-header"},dl={style:{display:"flex",gap:"4px"}},rl={style:{flex:"1","overflow-y":"auto"}},fl={class:"tree-node"},ml={class:"tree-label"},pl={key:2,class:"tree-size"},vl={class:"editor-panel"},cl={key:0,class:"editor-header"},yl={class:"editor-path"},_l={key:1,class:"editor-header"},gl={key:3,class:"binary-hint"},xl={key:4,class:"editor-empty"},kl={key:5,class:"editor-footer"},wl={key:1,class:"projects-main projects-empty"},Vl=Ue({__name:"ProjectsView",setup(Cl){const z=r([]),_=r(""),g=Ee(()=>z.value.find(a=>a.id===_.value)),I=r([]),m=r(""),C=r(""),$=r(null),P=r(!1),B=r(!1),T=r(!1),M=r(!1),j=r("open"),E=r([]),Z=r(!1),X=r([]);function me(){const a=g.value?.editors??[];a.length===0?(j.value="open",E.value=[]):a.includes("__none__")?(j.value="readonly",E.value=[]):(j.value="limited",E.value=[...a]),M.value=!0,Oe.list().then(e=>{X.value=e.data||[]}).catch(()=>{})}async function pe(){if(g.value){Z.value=!0;try{let a=[];j.value==="open"?a=[]:j.value==="readonly"?a=["__none__"]:a=E.value;const e=await w.setPermissions(g.value.id,a),d=z.value.findIndex(i=>i.id===g.value.id);d>=0&&(z.value[d]=e.data),v.success("权限已保存"),M.value=!1}catch{v.error("保存失败")}finally{Z.value=!1}}}const A=r(!1),K=r(!1),R=r(""),W=r(""),x=r({id:"",name:"",description:"",tagsStr:""}),b=r({id:"",name:"",description:"",tagsStr:""});Pe(Y);async function Y(){try{const a=await w.list();if(z.value=a.data||[],z.value.length&&!_.value){const e=z.value[0];e&&G(e.id)}}catch{}}async function G(a){_.value=a,m.value="",C.value="",$.value=null,await N()}async function N(){if(_.value)try{const a=await w.readTree(_.value);I.value=Array.isArray(a.data)?a.data:[]}catch{I.value=[]}}async function ve(a){if(!a.isDir){m.value=a.path||a.name,$.value=a,P.value=!1;try{const e=await w.readFile(_.value,m.value);e.data?.encoding==="base64"?(P.value=!0,C.value=""):C.value=e.data?.content??""}catch{C.value=""}}}async function ce(){if(m.value)try{await w.writeFile(_.value,m.value,C.value),v.success("已保存"),N()}catch{v.error("保存失败")}}async function ye(){if(m.value)try{await fe.confirm(`删除「${m.value}」？`,"删除文件",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning",confirmButtonClass:"el-button--danger"}),await w.deleteFile(_.value,m.value),v.success("已删除"),m.value="",C.value="",$.value=null,N()}catch(a){a!=="cancel"&&v.error("删除失败")}}async function h(){const a=R.value.trim();if(a)try{await w.writeFile(_.value,a,""),v.success(`已创建 ${a}`),A.value=!1,R.value="",await N(),m.value=a,C.value="",$.value=null,P.value=!1}catch{v.error("创建失败")}}async function ee(){const a=W.value.trim();if(a)try{await w.writeFile(_.value,a+"/.gitkeep",""),v.success(`已创建文件夹 ${a}`),K.value=!1,W.value="",N()}catch{v.error("创建失败")}}function le(){x.value={id:"",name:"",description:"",tagsStr:""}}async function _e(){const{id:a,name:e,description:d,tagsStr:i}=x.value;if(!a||!e){v.warning("请填写 ID 和名称");return}const D=i?i.split(",").map(S=>S.trim()).filter(Boolean):[];try{await w.create({id:a,name:e,description:d,tags:D}),v.success("项目已创建"),B.value=!1,le(),await Y(),G(a)}catch(S){v.error(S.response?.data?.error||"创建失败")}}function ge(a){b.value={id:a.id,name:a.name,description:a.description||"",tagsStr:(a.tags||[]).join(", ")},T.value=!0}async function xe(){const{id:a,name:e,description:d,tagsStr:i}=b.value,D=i?i.split(",").map(S=>S.trim()).filter(Boolean):[];try{await w.update(a,{name:e,description:d,tags:D}),v.success("已更新"),T.value=!1,Y()}catch{v.error("更新失败")}}async function ke(a){try{await fe.confirm(`删除项目「${a.name}」将删除其所有文件，不可恢复。`,"删除项目",{confirmButtonText:"确认删除",cancelButtonText:"取消",type:"warning",confirmButtonClass:"el-button--danger"}),await w.delete(a.id),v.success("已删除"),_.value===a.id&&(_.value="",I.value=[],m.value=""),Y()}catch(e){e!=="cancel"&&v.error("删除失败")}}function we(a){const e=a.split(".").pop()?.toLowerCase()||"";return["md","txt","rst"].includes(e)?"#409eff":["json","yaml","yml","toml"].includes(e)?"#67c23a":["go","py","js","ts","sh","vue","rs","java","c","cpp"].includes(e)?"#e6a23c":["jpg","jpeg","png","gif","svg","webp"].includes(e)?"#f56c6c":a.startsWith(".")?"#c0c4cc":"#909399"}function Ve(a){const e=a.split("/").pop()||a,d=e.lastIndexOf(".");return d>0?e.slice(d):"file"}function te(a){return a?a<1024?`${a} B`:a<1024*1024?`${(a/1024).toFixed(1)} KB`:`${(a/1024/1024).toFixed(1)} MB`:"0 B"}function Ce(a){return a?new Date(a).toLocaleString("zh-CN",{month:"numeric",day:"numeric",hour:"2-digit",minute:"2-digit"}):""}return(a,e)=>{const d=f("el-icon"),i=f("el-button"),D=f("el-dropdown-item"),S=f("el-dropdown-menu"),be=f("el-dropdown"),L=f("el-tag"),oe=f("el-text"),H=f("el-radio-button"),ze=f("el-radio-group"),je=f("el-checkbox"),Fe=f("el-checkbox-group"),q=f("el-dialog"),$e=f("el-tree"),Be=f("el-empty"),ae=f("el-col"),V=f("el-input"),Se=f("el-row"),U=f("el-form-item"),ne=f("el-form");return s(),p("div",We,[n("div",Ye,[n("div",Ze,[e[28]||(e[28]=n("span",{class:"sidebar-title"},"项目",-1)),l(i,{text:"",size:"small",onClick:e[0]||(e[0]=o=>B.value=!0),title:"新建项目"},{default:t(()=>[l(d,null,{default:t(()=>[l(c(ie))]),_:1})]),_:1})]),n("div",Ge,[(s(!0),p(J,null,Q(z.value,o=>(s(),p("div",{key:o.id,class:Ne(["project-item",{active:_.value===o.id}]),onClick:se=>G(o.id)},[l(d,{class:"project-icon"},{default:t(()=>[l(c(O))]),_:1}),n("div",Je,[n("div",Qe,y(o.name),1),o.description?(s(),p("div",Xe,y(o.description),1)):F("",!0)]),l(be,{trigger:"click",onClick:e[1]||(e[1]=Ie(()=>{},["stop"]))},{dropdown:t(()=>[l(S,null,{default:t(()=>[l(D,{onClick:se=>ge(o)},{default:t(()=>[...e[29]||(e[29]=[u("编辑信息",-1)])]),_:1},8,["onClick"]),l(D,{divided:"",onClick:se=>ke(o),style:{color:"#f56c6c"}},{default:t(()=>[...e[30]||(e[30]=[u("删除项目",-1)])]),_:1},8,["onClick"])]),_:2},1024)]),default:t(()=>[l(d,{class:"project-menu-btn"},{default:t(()=>[l(c(De))]),_:1})]),_:2},1024)],10,He))),128)),z.value.length?F("",!0):(s(),p("div",he,[l(d,{size:"32",style:{color:"#c0c4cc"}},{default:t(()=>[l(c(O))]),_:1}),e[32]||(e[32]=n("p",null,"暂无项目",-1)),l(i,{size:"small",type:"primary",plain:"",onClick:e[2]||(e[2]=o=>B.value=!0)},{default:t(()=>[...e[31]||(e[31]=[u("新建项目",-1)])]),_:1})]))])]),g.value?(s(),p("div",el,[n("div",ll,[n("div",tl,[l(d,{style:{color:"#e6a23c"}},{default:t(()=>[l(c(O))]),_:1}),n("span",null,y(g.value.name),1),(s(!0),p(J,null,Q(g.value.tags||[],o=>(s(),k(L,{key:o,size:"small",style:{"margin-left":"4px"}},{default:t(()=>[u(y(o),1)]),_:2},1024))),128)),g.value.editors?.length===0?(s(),k(L,{key:0,size:"small",type:"success",style:{"margin-left":"8px"}},{default:t(()=>[...e[33]||(e[33]=[u(" 全员可写 ",-1)])]),_:1})):(s(),k(L,{key:1,size:"small",type:"warning",style:{"margin-left":"8px"}},{default:t(()=>[u(" 限制编辑（"+y(g.value.editors?.length)+" 人） ",1)]),_:1}))]),n("div",ol,[g.value.description?(s(),k(oe,{key:0,type:"info",size:"small"},{default:t(()=>[u(y(g.value.description),1)]),_:1})):F("",!0),l(i,{size:"small",plain:"",onClick:me},{default:t(()=>[l(d,{style:{"margin-right":"4px"}},{default:t(()=>[l(c(Te))]),_:1}),e[34]||(e[34]=u("成员权限 ",-1))]),_:1})])]),l(q,{modelValue:M.value,"onUpdate:modelValue":e[6]||(e[6]=o=>M.value=o),title:"成员写入权限",width:"500px"},{footer:t(()=>[l(i,{onClick:e[5]||(e[5]=o=>M.value=!1)},{default:t(()=>[...e[40]||(e[40]=[u("取消",-1)])]),_:1}),l(i,{type:"primary",loading:Z.value,onClick:pe},{default:t(()=>[...e[41]||(e[41]=[u("保存权限",-1)])]),_:1},8,["loading"])]),default:t(()=>[e[42]||(e[42]=n("div",{style:{"margin-bottom":"16px",color:"#606266","font-size":"13px"}},[u(" 设置哪些 AI 成员可以写入此项目。"),n("br"),n("strong",null,"不选任何成员 = 全员可写（默认开放）")],-1)),n("div",al,[l(ze,{modelValue:j.value,"onUpdate:modelValue":e[3]||(e[3]=o=>j.value=o),size:"small"},{default:t(()=>[l(H,{label:"open"},{default:t(()=>[...e[35]||(e[35]=[u("全员可写",-1)])]),_:1}),l(H,{label:"limited"},{default:t(()=>[...e[36]||(e[36]=[u("指定成员",-1)])]),_:1}),l(H,{label:"readonly"},{default:t(()=>[...e[37]||(e[37]=[u("全员只读",-1)])]),_:1})]),_:1},8,["modelValue"])]),j.value==="limited"?(s(),p("div",nl,[e[39]||(e[39]=n("div",{style:{"font-size":"13px","font-weight":"600","margin-bottom":"8px"}},"选择有写入权限的成员：",-1)),l(Fe,{modelValue:E.value,"onUpdate:modelValue":e[4]||(e[4]=o=>E.value=o)},{default:t(()=>[(s(!0),p(J,null,Q(X.value,o=>(s(),p("div",{key:o.id,style:{"margin-bottom":"6px"}},[l(je,{label:o.id},{default:t(()=>[n("div",sl,[n("div",{style:ue({width:"20px",height:"20px",borderRadius:"50%",background:o.avatarColor||"#6366f1",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"10px",color:"#fff"})},y(o.name.charAt(0)),5),n("span",null,y(o.name),1),o.system?(s(),k(L,{key:0,size:"small",type:"info"},{default:t(()=>[...e[38]||(e[38]=[u("系统",-1)])]),_:1})):F("",!0)])]),_:2},1032,["label"])]))),128))]),_:1},8,["modelValue"])])):F("",!0)]),_:1},8,["modelValue"]),l(Se,{gutter:12,style:{flex:"1",overflow:"hidden"}},{default:t(()=>[l(ae,{span:6,style:{height:"100%",display:"flex","flex-direction":"column"}},{default:t(()=>[n("div",il,[n("div",ul,[e[43]||(e[43]=n("span",null,"文件",-1)),n("div",dl,[l(i,{text:"",size:"small",onClick:e[7]||(e[7]=o=>A.value=!0),title:"新建文件"},{default:t(()=>[l(d,null,{default:t(()=>[l(c(Me))]),_:1})]),_:1}),l(i,{text:"",size:"small",onClick:e[8]||(e[8]=o=>K.value=!0),title:"新建文件夹"},{default:t(()=>[l(d,null,{default:t(()=>[l(c(Ae))]),_:1})]),_:1}),l(i,{text:"",size:"small",onClick:N,title:"刷新"},{default:t(()=>[l(d,null,{default:t(()=>[l(c(Ke))]),_:1})]),_:1})])]),n("div",rl,[I.value.length?(s(),k($e,{key:0,data:I.value,props:{label:"name",children:"children"},"highlight-current":"","default-expand-all":"",onNodeClick:ve,style:{"font-size":"13px"}},{default:t(({data:o})=>[n("span",fl,[o.isDir?(s(),k(d,{key:0,style:{color:"#e6a23c","font-size":"13px","flex-shrink":"0"}},{default:t(()=>[l(c(O))]),_:1})):(s(),k(d,{key:1,style:ue({color:we(o.name),fontSize:"13px",flexShrink:0})},{default:t(()=>[l(c(de))]),_:1},8,["style"])),n("span",ml,y(o.name),1),o.isDir?F("",!0):(s(),p("span",pl,y(te(o.size)),1))])]),_:1},8,["data"])):(s(),k(Be,{key:1,description:"暂无文件","image-size":48}))])])]),_:1}),l(ae,{span:18,style:{height:"100%",display:"flex","flex-direction":"column"}},{default:t(()=>[n("div",vl,[m.value?(s(),p("div",cl,[n("span",yl,y(m.value),1),l(L,{size:"small",style:{"font-size":"11px"}},{default:t(()=>[u(y(Ve(m.value)),1)]),_:1}),e[44]||(e[44]=n("div",{style:{flex:"1"}},null,-1)),l(i,{text:"",size:"small",type:"danger",onClick:ye,title:"删除"},{default:t(()=>[l(d,null,{default:t(()=>[l(c(Le))]),_:1})]),_:1})])):(s(),p("div",_l,[...e[45]||(e[45]=[n("span",{style:{color:"#c0c4cc","font-size":"13px"}},"从左侧选择文件",-1)])])),m.value&&!P.value?(s(),k(V,{key:2,modelValue:C.value,"onUpdate:modelValue":e[9]||(e[9]=o=>C.value=o),type:"textarea",placeholder:"（空文件）",autosize:!1,style:{flex:"1","font-family":"monospace","font-size":"13px"}},null,8,["modelValue"])):m.value&&P.value?(s(),p("div",gl,[l(d,{size:"32"},{default:t(()=>[l(c(de))]),_:1}),e[46]||(e[46]=n("p",null,"二进制文件，无法编辑",-1))])):(s(),p("div",xl,[l(d,{size:"48",style:{color:"#e4e7ed"}},{default:t(()=>[l(c(qe))]),_:1}),e[47]||(e[47]=n("p",null,"选择文件后在此编辑",-1))])),m.value&&!P.value?(s(),p("div",kl,[l(i,{type:"primary",size:"small",onClick:ce},{default:t(()=>[...e[48]||(e[48]=[u("保存",-1)])]),_:1}),$.value?(s(),k(oe,{key:0,type:"info",size:"small"},{default:t(()=>[u(y(te($.value.size))+" · "+y(Ce($.value.modTime)),1)]),_:1})):F("",!0)])):F("",!0)])]),_:1})]),_:1})])):(s(),p("div",wl,[l(d,{size:"64",style:{color:"#e4e7ed","margin-bottom":"16px"}},{default:t(()=>[l(c(O))]),_:1}),e[50]||(e[50]=n("p",{style:{color:"#909399","font-size":"15px"}},"从左侧选择或新建一个项目",-1)),l(i,{type:"primary",onClick:e[10]||(e[10]=o=>B.value=!0)},{default:t(()=>[l(d,null,{default:t(()=>[l(c(ie))]),_:1}),e[49]||(e[49]=u(" 新建项目 ",-1))]),_:1})])),l(q,{modelValue:B.value,"onUpdate:modelValue":e[16]||(e[16]=o=>B.value=o),title:"新建项目",width:"440px",onClose:le},{footer:t(()=>[l(i,{onClick:e[15]||(e[15]=o=>B.value=!1)},{default:t(()=>[...e[51]||(e[51]=[u("取消",-1)])]),_:1}),l(i,{type:"primary",onClick:_e},{default:t(()=>[...e[52]||(e[52]=[u("创建",-1)])]),_:1})]),default:t(()=>[l(ne,{model:x.value,"label-width":"80px"},{default:t(()=>[l(U,{label:"项目 ID",required:""},{default:t(()=>[l(V,{modelValue:x.value.id,"onUpdate:modelValue":e[11]||(e[11]=o=>x.value.id=o),placeholder:"如 ai-panel（小写字母/数字/连字符）"},null,8,["modelValue"])]),_:1}),l(U,{label:"名称",required:""},{default:t(()=>[l(V,{modelValue:x.value.name,"onUpdate:modelValue":e[12]||(e[12]=o=>x.value.name=o),placeholder:"项目名称"},null,8,["modelValue"])]),_:1}),l(U,{label:"描述"},{default:t(()=>[l(V,{modelValue:x.value.description,"onUpdate:modelValue":e[13]||(e[13]=o=>x.value.description=o),placeholder:"简短描述（可选）"},null,8,["modelValue"])]),_:1}),l(U,{label:"标签"},{default:t(()=>[l(V,{modelValue:x.value.tagsStr,"onUpdate:modelValue":e[14]||(e[14]=o=>x.value.tagsStr=o),placeholder:"多个标签用逗号分隔，如 go,vue"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),l(q,{modelValue:T.value,"onUpdate:modelValue":e[21]||(e[21]=o=>T.value=o),title:"编辑项目信息",width:"440px"},{footer:t(()=>[l(i,{onClick:e[20]||(e[20]=o=>T.value=!1)},{default:t(()=>[...e[53]||(e[53]=[u("取消",-1)])]),_:1}),l(i,{type:"primary",onClick:xe},{default:t(()=>[...e[54]||(e[54]=[u("保存",-1)])]),_:1})]),default:t(()=>[l(ne,{model:b.value,"label-width":"80px"},{default:t(()=>[l(U,{label:"名称"},{default:t(()=>[l(V,{modelValue:b.value.name,"onUpdate:modelValue":e[17]||(e[17]=o=>b.value.name=o)},null,8,["modelValue"])]),_:1}),l(U,{label:"描述"},{default:t(()=>[l(V,{modelValue:b.value.description,"onUpdate:modelValue":e[18]||(e[18]=o=>b.value.description=o)},null,8,["modelValue"])]),_:1}),l(U,{label:"标签"},{default:t(()=>[l(V,{modelValue:b.value.tagsStr,"onUpdate:modelValue":e[19]||(e[19]=o=>b.value.tagsStr=o),placeholder:"多个标签用逗号分隔"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),l(q,{modelValue:A.value,"onUpdate:modelValue":e[24]||(e[24]=o=>A.value=o),title:"新建文件",width:"380px"},{footer:t(()=>[l(i,{onClick:e[23]||(e[23]=o=>A.value=!1)},{default:t(()=>[...e[55]||(e[55]=[u("取消",-1)])]),_:1}),l(i,{type:"primary",onClick:h},{default:t(()=>[...e[56]||(e[56]=[u("创建",-1)])]),_:1})]),default:t(()=>[l(V,{modelValue:R.value,"onUpdate:modelValue":e[22]||(e[22]=o=>R.value=o),placeholder:"如 README.md 或 src/main.go",onKeyup:re(h,["enter"])},null,8,["modelValue"])]),_:1},8,["modelValue"]),l(q,{modelValue:K.value,"onUpdate:modelValue":e[27]||(e[27]=o=>K.value=o),title:"新建文件夹",width:"380px"},{footer:t(()=>[l(i,{onClick:e[26]||(e[26]=o=>K.value=!1)},{default:t(()=>[...e[57]||(e[57]=[u("取消",-1)])]),_:1}),l(i,{type:"primary",onClick:ee},{default:t(()=>[...e[58]||(e[58]=[u("创建",-1)])]),_:1})]),default:t(()=>[l(V,{modelValue:W.value,"onUpdate:modelValue":e[25]||(e[25]=o=>W.value=o),placeholder:"如 src 或 docs/api",onKeyup:re(ee,["enter"])},null,8,["modelValue"])]),_:1},8,["modelValue"])])}}}),Fl=Re(Vl,[["__scopeId","data-v-a64256ba"]]);export{Fl as default};
