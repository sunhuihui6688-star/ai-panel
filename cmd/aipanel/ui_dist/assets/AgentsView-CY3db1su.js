import{d as pe,i as me,c as f,b as n,a as l,w as s,l as R,j as p,k as y,e as x,r,o as i,h as a,F as C,m as w,p as z,v as A,q as fe,u as ce,n as H,t as u,f as U,s as D,E as S,x as ye}from"./index-CdZnHZ0f.js";import{u as ve}from"./agents-w4mMMRga.js";import{b as J}from"./index-B6SLQW8T.js";import{_ as _e}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ge={class:"agents-page"},ke={style:{display:"flex","justify-content":"space-between","align-items":"center","margin-bottom":"20px"}},xe={style:{display:"flex","align-items":"center",gap:"12px","margin-bottom":"12px"}},Ce={style:{flex:"1"}},we={style:{"font-weight":"600","font-size":"16px"}},Ie={style:{"margin-bottom":"12px"}},Ve={style:{display:"flex",gap:"8px"}},be={style:{display:"flex",gap:"8px","flex-wrap":"wrap"}},he=["onClick"],$e={key:0,style:{"text-align":"center",padding:"20px"}},ze={style:{display:"flex","align-items":"center",gap:"12px"}},Ae={style:{flex:"1"}},De={style:{"font-weight":"600"}},Se={key:0,style:{"text-align":"center",padding:"20px"}},Be={style:{display:"flex","align-items":"center",gap:"12px"}},Ue={style:{flex:"1"}},Le={style:{"font-weight":"600"}},Ee={key:0,style:{"text-align":"center",padding:"20px"}},Me={style:{display:"flex","align-items":"center",gap:"12px"}},Ne={style:{flex:"1"}},Te={style:{"font-weight":"600"}},Fe={key:0,style:{"text-align":"center",padding:"20px"}},Re={style:{display:"flex","align-items":"center",gap:"12px"}},je={style:{flex:"1"}},qe={style:{"font-weight":"600"}},Pe=pe({__name:"AgentsView",setup(Oe){const K=ce(),I=ve(),_=x(!1),m=x(0),L=x(!1),Q=["#409eff","#67c23a","#e6a23c","#f56c6c","#909399","#9b59b6","#1abc9c","#e74c3c"],o=fe({id:"",name:"",description:"",avatarColor:"#409eff",modelId:"",channelIds:[],toolIds:[],skillIds:[]}),j=x([]),q=x([]),P=x([]),O=x([]);me(()=>{I.fetchAll()});function W(){(!o.id||o.id===G(o.name.slice(0,-1)))&&(o.id=G(o.name))}function G(d){return d.toLowerCase().replace(/[^a-z0-9\u4e00-\u9fff]+/g,"-").replace(/^-|-$/g,"").slice(0,30)}function X(){if(m.value===0&&(!o.name||!o.id)){S.warning("请填写名称和 ID");return}m.value++}function E(d,t){const k=d.indexOf(t);k===-1?d.push(t):d.splice(k,1)}async function Y(){L.value=!0;try{await J.create({id:o.id,name:o.name,description:o.description,modelId:o.modelId,channelIds:o.channelIds,toolIds:o.toolIds,skillIds:o.skillIds,avatarColor:o.avatarColor}),S.success("Agent 创建成功！"),_.value=!1,I.fetchAll(),K.push(`/agents/${o.id}`)}catch(d){S.error(d.response?.data?.error||"创建失败")}finally{L.value=!1}}function Z(d){return d==="running"?"success":d==="stopped"?"danger":"info"}function ee(d){return d==="running"?"运行中":d==="stopped"?"已停止":"空闲"}async function te(d,t){try{await ye.confirm(`删除成员「${t}」将同时删除其工作区、对话记录和所有配置，且无法恢复。确认吗？`,"删除 AI 成员",{confirmButtonText:"确认删除",cancelButtonText:"取消",type:"warning",confirmButtonClass:"el-button--danger"})}catch{return}try{await J.delete(d),S.success(`已删除「${t}」`),await I.fetchAll()}catch(k){S.error("删除失败："+(k?.response?.data?.error??k?.message??"未知错误"))}}return(d,t)=>{const k=r("Plus"),M=r("el-icon"),c=r("el-button"),V=r("el-text"),g=r("el-tag"),le=r("ChatDotRound"),se=r("Delete"),b=r("el-card"),oe=r("el-col"),ne=r("el-row"),h=r("el-empty"),$=r("el-step"),ie=r("el-steps"),N=r("el-input"),B=r("el-form-item"),ae=r("el-form"),de=r("el-radio"),re=r("el-radio-group"),T=r("el-checkbox"),F=r("el-checkbox-group"),ue=r("el-dialog");return i(),f("div",ge,[n("div",ke,[t[19]||(t[19]=n("h2",{style:{margin:"0"}},"AI 成员",-1)),l(c,{type:"primary",onClick:t[0]||(t[0]=e=>d.$router.push("/agents/new"))},{default:s(()=>[l(M,null,{default:s(()=>[l(k)]),_:1}),t[18]||(t[18]=a(" 新建 Agent ",-1))]),_:1})]),l(ne,{gutter:16},{default:s(()=>[(i(!0),f(C,null,w(R(I).list,e=>(i(),p(oe,{span:8,key:e.id},{default:s(()=>[l(b,{class:"agent-card",shadow:"hover"},{default:s(()=>[n("div",xe,[n("div",{class:"avatar-circle",style:H({background:e.avatarColor||"#409eff"})},u(e.name.charAt(0)),5),n("div",Ce,[n("div",we,u(e.name),1),l(V,{type:"info",size:"small"},{default:s(()=>[a(u(e.id),1)]),_:2},1024)]),e.system?(i(),p(g,{key:0,size:"small",type:"warning"},{default:s(()=>[...t[20]||(t[20]=[a("系统",-1)])]),_:1})):y("",!0),l(g,{type:Z(e.status),size:"small"},{default:s(()=>[a(u(ee(e.status)),1)]),_:2},1032,["type"])]),n("div",Ie,[l(g,{size:"small",type:"info",style:{"margin-right":"4px"}},{default:s(()=>[a(u(e.modelId||e.model||"未配置"),1)]),_:2},1024),(i(!0),f(C,null,w(e.channelIds||[],v=>(i(),p(g,{key:v,size:"small",style:{"margin-right":"4px"}},{default:s(()=>[a(u(v),1)]),_:2},1024))),128))]),e.description?(i(),p(V,{key:0,type:"info",size:"small",style:{display:"block","margin-bottom":"12px"}},{default:s(()=>[a(u(e.description),1)]),_:2},1024)):y("",!0),n("div",Ve,[l(c,{type:"primary",style:{flex:"1"},onClick:v=>d.$router.push(`/agents/${e.id}`)},{default:s(()=>[l(M,null,{default:s(()=>[l(le)]),_:1}),t[21]||(t[21]=a(" 进入 ",-1))]),_:1},8,["onClick"]),e.system?y("",!0):(i(),p(c,{key:0,type:"danger",plain:"",onClick:U(v=>te(e.id,e.name),["stop"])},{default:s(()=>[l(M,null,{default:s(()=>[l(se)]),_:1})]),_:1},8,["onClick"]))])]),_:2},1024)]),_:2},1024))),128))]),_:1}),!R(I).loading&&R(I).list.length===0?(i(),p(h,{key:0,description:"暂无 AI 成员，点击「新建 Agent」开始"})):y("",!0),l(ue,{modelValue:_.value,"onUpdate:modelValue":t[17]||(t[17]=e=>_.value=e),title:"新建 AI 成员",width:"680px","close-on-click-modal":!1},{footer:s(()=>[m.value>0?(i(),p(c,{key:0,onClick:t[16]||(t[16]=e=>m.value--)},{default:s(()=>[...t[27]||(t[27]=[a("上一步",-1)])]),_:1})):y("",!0),m.value<4?(i(),p(c,{key:1,type:"primary",onClick:X},{default:s(()=>[...t[28]||(t[28]=[a(" 下一步 ",-1)])]),_:1})):y("",!0),m.value===4?(i(),p(c,{key:2,type:"primary",onClick:Y,loading:L.value},{default:s(()=>[...t[29]||(t[29]=[a(" 创建 Agent ",-1)])]),_:1},8,["loading"])):y("",!0)]),default:s(()=>[l(ie,{active:m.value,"finish-status":"success",simple:"",style:{"margin-bottom":"24px"}},{default:s(()=>[l($,{title:"基本信息"}),l($,{title:"选择模型"}),l($,{title:"消息通道"}),l($,{title:"开启能力"}),l($,{title:"安装 Skills"})]),_:1},8,["active"]),z(n("div",null,[l(ae,{model:o,"label-width":"90px"},{default:s(()=>[l(B,{label:"名称",required:""},{default:s(()=>[l(N,{modelValue:o.name,"onUpdate:modelValue":t[1]||(t[1]=e=>o.name=e),placeholder:"如：数据分析师",onInput:W},null,8,["modelValue"])]),_:1}),l(B,{label:"ID"},{default:s(()=>[l(N,{modelValue:o.id,"onUpdate:modelValue":t[2]||(t[2]=e=>o.id=e),placeholder:"英文标识"},null,8,["modelValue"])]),_:1}),l(B,{label:"描述"},{default:s(()=>[l(N,{modelValue:o.description,"onUpdate:modelValue":t[3]||(t[3]=e=>o.description=e),type:"textarea",rows:2,placeholder:"简短描述这个 Agent 的职责"},null,8,["modelValue"])]),_:1}),l(B,{label:"头像颜色"},{default:s(()=>[n("div",be,[(i(),f(C,null,w(Q,e=>n("div",{key:e,class:D(["color-swatch",{active:o.avatarColor===e}]),style:H({background:e}),onClick:v=>o.avatarColor=e},null,14,he)),64))])]),_:1})]),_:1},8,["model"])],512),[[A,m.value===0]]),z(n("div",null,[j.value.length===0?(i(),f("div",$e,[l(h,{description:"暂无已配置模型","image-size":60}),l(c,{type:"primary",onClick:t[4]||(t[4]=e=>{d.$router.push("/config/models"),_.value=!1})},{default:s(()=>[...t[22]||(t[22]=[a(" 前往配置模型 ",-1)])]),_:1})])):y("",!0),l(re,{modelValue:o.modelId,"onUpdate:modelValue":t[5]||(t[5]=e=>o.modelId=e),style:{width:"100%"}},{default:s(()=>[(i(!0),f(C,null,w(j.value,e=>(i(),p(b,{key:e.id,shadow:"hover",class:D(["select-card",{selected:o.modelId===e.id}]),onClick:v=>o.modelId=e.id},{default:s(()=>[n("div",ze,[l(de,{value:e.id,style:{"margin-right":"0"}},null,8,["value"]),n("div",Ae,[n("div",De,u(e.name),1),l(V,{type:"info",size:"small"},{default:s(()=>[a(u(e.provider)+" / "+u(e.model),1)]),_:2},1024)]),l(g,{type:e.status==="ok"?"success":e.status==="error"?"danger":"info",size:"small"},{default:s(()=>[a(u(e.status==="ok"?"✓ 已配置":e.status==="error"?"✗ 错误":"? 未测试"),1)]),_:2},1032,["type"])])]),_:2},1032,["class","onClick"]))),128))]),_:1},8,["modelValue"]),l(c,{link:"",type:"primary",style:{"margin-top":"12px"},onClick:t[6]||(t[6]=e=>{d.$router.push("/config/models"),_.value=!1})},{default:s(()=>[...t[23]||(t[23]=[a(" + 配置新模型 ",-1)])]),_:1})],512),[[A,m.value===1]]),z(n("div",null,[q.value.length===0?(i(),f("div",Se,[l(h,{description:"暂无消息通道（可跳过）","image-size":60}),l(c,{link:"",type:"primary",onClick:t[7]||(t[7]=e=>{d.$router.push("/config/channels"),_.value=!1})},{default:s(()=>[...t[24]||(t[24]=[a(" 前往添加通道 ",-1)])]),_:1})])):y("",!0),l(F,{modelValue:o.channelIds,"onUpdate:modelValue":t[9]||(t[9]=e=>o.channelIds=e)},{default:s(()=>[(i(!0),f(C,null,w(q.value,e=>(i(),p(b,{key:e.id,shadow:"hover",class:D(["select-card",{selected:o.channelIds.includes(e.id)}]),onClick:v=>E(o.channelIds,e.id)},{default:s(()=>[n("div",Be,[l(T,{value:e.id,onClick:t[8]||(t[8]=U(()=>{},["stop"]))},null,8,["value"]),n("div",Ue,[n("div",Le,u(e.name),1),l(V,{type:"info",size:"small"},{default:s(()=>[a(u(e.type),1)]),_:2},1024)]),l(g,{type:e.enabled?"success":"info",size:"small"},{default:s(()=>[a(u(e.enabled?"启用":"停用"),1)]),_:2},1032,["type"])])]),_:2},1032,["class","onClick"]))),128))]),_:1},8,["modelValue"])],512),[[A,m.value===2]]),z(n("div",null,[P.value.length===0?(i(),f("div",Ee,[l(h,{description:"暂无能力配置（可跳过）","image-size":60}),l(c,{link:"",type:"primary",onClick:t[10]||(t[10]=e=>{d.$router.push("/config/tools"),_.value=!1})},{default:s(()=>[...t[25]||(t[25]=[a(" 前往添加能力 ",-1)])]),_:1})])):y("",!0),l(F,{modelValue:o.toolIds,"onUpdate:modelValue":t[12]||(t[12]=e=>o.toolIds=e)},{default:s(()=>[(i(!0),f(C,null,w(P.value,e=>(i(),p(b,{key:e.id,shadow:"hover",class:D(["select-card",{selected:o.toolIds.includes(e.id)}]),onClick:v=>E(o.toolIds,e.id)},{default:s(()=>[n("div",Me,[l(T,{value:e.id,onClick:t[11]||(t[11]=U(()=>{},["stop"]))},null,8,["value"]),n("div",Ne,[n("div",Te,u(e.name),1),l(V,{type:"info",size:"small"},{default:s(()=>[a(u(e.type),1)]),_:2},1024)]),l(g,{type:e.status==="ok"?"success":"info",size:"small"},{default:s(()=>[a(u(e.status==="ok"?"✓":"?"),1)]),_:2},1032,["type"])])]),_:2},1032,["class","onClick"]))),128))]),_:1},8,["modelValue"])],512),[[A,m.value===3]]),z(n("div",null,[O.value.length===0?(i(),f("div",Fe,[l(h,{description:"暂无已安装 Skills（可跳过）","image-size":60}),l(c,{link:"",type:"primary",onClick:t[13]||(t[13]=e=>{d.$router.push("/config/skills"),_.value=!1})},{default:s(()=>[...t[26]||(t[26]=[a(" 前往安装 Skill ",-1)])]),_:1})])):y("",!0),l(F,{modelValue:o.skillIds,"onUpdate:modelValue":t[15]||(t[15]=e=>o.skillIds=e)},{default:s(()=>[(i(!0),f(C,null,w(O.value,e=>(i(),p(b,{key:e.id,shadow:"hover",class:D(["select-card",{selected:o.skillIds.includes(e.id)}]),onClick:v=>E(o.skillIds,e.id)},{default:s(()=>[n("div",Re,[l(T,{value:e.id,onClick:t[14]||(t[14]=U(()=>{},["stop"]))},null,8,["value"]),n("div",je,[n("div",qe,u(e.name),1),l(V,{type:"info",size:"small"},{default:s(()=>[a(u(e.description),1)]),_:2},1024)]),l(g,{size:"small",type:"info"},{default:s(()=>[a("v"+u(e.version),1)]),_:2},1024)])]),_:2},1032,["class","onClick"]))),128))]),_:1},8,["modelValue"])],512),[[A,m.value===4]])]),_:1},8,["modelValue"])])}}}),Qe=_e(Pe,[["__scopeId","data-v-6c191397"]]);export{Qe as default};
