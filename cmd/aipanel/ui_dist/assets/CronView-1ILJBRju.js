import{d as W,h as X,c as i,f as I,a as t,w as a,g as U,r as d,o as u,k as Z,z as ee,e as s,F as k,l as E,i as c,t as p,j as le,x as te,p as ae,E as f,u as ne}from"./index-DcmuQsTK.js";import{b as oe,h as V}from"./index--WBji6XS.js";import{_ as se}from"./_plugin-vue_export-helper-DlAUqK2U.js";const de={class:"cron-page"},ue={style:{display:"flex","justify-content":"space-between","align-items":"center","margin-bottom":"16px"}},ie={style:{"margin-bottom":"12px",display:"flex",gap:"10px","align-items":"center","flex-wrap":"wrap"}},re={key:0,style:{"font-size":"13px",color:"#606266"}},me={key:1,style:{color:"#c0c4cc","font-size":"12px"}},pe={style:{"font-size":"12px","font-family":"monospace"}},fe=W({__name:"CronView",setup(_e){const B=ne(),A=U([]),x=U([]),N=U(""),b=U(!1),L=te(()=>{const o={};for(const e of x.value)o[e.id]=e.name;return o}),n=ae({agentId:"",name:"",remark:"",expr:"0 0 9 * * *",tz:"Asia/Shanghai",message:"",enabled:!0});X(async()=>{const o=await oe.list().catch(()=>({data:[]}));x.value=o.data||[],v()});async function v(){try{const o=await V.list(N.value||void 0);A.value=o.data||[]}catch{}}function R(o){return o?new Date(o).toLocaleString("zh-CN"):""}function S(o){return o.payload?.message==="__MEMORY_CONSOLIDATE__"}function T(o){o.agentId&&B.push({path:`/agents/${o.agentId}`,query:{tab:"cron"}})}function D(){n.agentId="",n.name="",n.remark="",n.expr="0 0 9 * * *",n.tz="Asia/Shanghai",n.message="",n.enabled=!0,b.value=!0}async function O(){try{await V.create({name:n.name,remark:n.remark||void 0,agentId:n.agentId||void 0,enabled:n.enabled,schedule:{kind:"cron",expr:n.expr,tz:n.tz},payload:{kind:"agentTurn",message:n.message},delivery:{mode:"announce"}}),f.success("åˆ›å»ºæˆåŠŸ"),b.value=!1,v()}catch(o){f.error(o.response?.data?.error||"åˆ›å»ºå¤±è´¥")}}async function Y(o){try{await V.update(o.id,o)}catch{f.error("æ›´æ–°å¤±è´¥")}}async function j(o){try{await V.run(o.id),f.success("å·²è§¦å‘"),setTimeout(v,2e3)}catch{f.error("è§¦å‘å¤±è´¥")}}async function F(o){try{await V.delete(o.id),f.success("å·²åˆ é™¤"),v()}catch{f.error("åˆ é™¤å¤±è´¥")}}return(o,e)=>{const J=d("el-icon"),_=d("el-button"),y=d("el-text"),h=d("el-radio-button"),q=d("el-radio-group"),r=d("el-table-column"),C=d("el-tag"),M=d("el-switch"),G=d("el-table"),H=d("el-empty"),K=d("el-card"),z=d("el-option"),$=d("el-select"),m=d("el-form-item"),w=d("el-input"),P=d("el-form"),Q=d("el-dialog");return u(),i("div",de,[I("div",ue,[e[11]||(e[11]=I("h2",{style:{margin:"0"}},"â° å®šæ—¶ä»»åŠ¡",-1)),t(_,{type:"primary",onClick:D},{default:a(()=>[t(J,null,{default:a(()=>[t(Z(ee))]),_:1}),e[10]||(e[10]=s(" æ–°å»ºä»»åŠ¡ ",-1))]),_:1})]),I("div",ie,[t(y,{type:"info",size:"small",style:{"margin-right":"2px"}},{default:a(()=>[...e[12]||(e[12]=[s("ç­›é€‰æˆå‘˜ï¼š",-1)])]),_:1}),t(q,{modelValue:N.value,"onUpdate:modelValue":e[0]||(e[0]=l=>N.value=l),size:"small",onChange:v},{default:a(()=>[t(h,{value:""},{default:a(()=>[...e[13]||(e[13]=[s("å…¨éƒ¨",-1)])]),_:1}),t(h,{value:"__global__"},{default:a(()=>[...e[14]||(e[14]=[s("å…¨å±€ä»»åŠ¡",-1)])]),_:1}),(u(!0),i(k,null,E(x.value,l=>(u(),c(h,{key:l.id,value:l.id},{default:a(()=>[s(p(l.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),t(K,{shadow:"hover"},{default:a(()=>[t(G,{data:A.value,stripe:""},{default:a(()=>[t(r,{prop:"name",label:"åç§°","min-width":"150"}),t(r,{label:"æ‰€å±žæˆå‘˜",width:"120"},{default:a(({row:l})=>[l.agentId?(u(),c(C,{key:0,size:"small",type:"primary",style:{cursor:"pointer"},onClick:g=>T(l)},{default:a(()=>[s(p(L.value[l.agentId]||l.agentId),1)]),_:2},1032,["onClick"])):(u(),c(C,{key:1,size:"small",type:"info"},{default:a(()=>[...e[15]||(e[15]=[s("å…¨å±€",-1)])]),_:1}))]),_:1}),t(r,{label:"å¤‡æ³¨","min-width":"150","show-overflow-tooltip":""},{default:a(({row:l})=>[l.remark?(u(),i("span",re,p(l.remark),1)):(u(),i("span",me,"â€”"))]),_:1}),t(r,{label:"è°ƒåº¦","min-width":"160"},{default:a(({row:l})=>[I("span",pe,p(l.schedule?.expr),1),t(y,{type:"info",size:"small",style:{"margin-left":"4px"}},{default:a(()=>[s("("+p(l.schedule?.tz)+")",1)]),_:2},1024)]),_:1}),t(r,{label:"æœ€è¿‘è¿è¡Œ",width:"170"},{default:a(({row:l})=>[l.state?.lastRunAtMs?(u(),i(k,{key:0},[t(C,{type:l.state?.lastStatus==="ok"?"success":"danger",size:"small"},{default:a(()=>[s(p(l.state?.lastStatus),1)]),_:2},1032,["type"]),t(y,{type:"info",size:"small",style:{"margin-left":"4px"}},{default:a(()=>[s(p(R(l.state?.lastRunAtMs)),1)]),_:2},1024)],64)):(u(),c(y,{key:1,type:"info",size:"small"},{default:a(()=>[...e[16]||(e[16]=[s("æœªè¿è¡Œ",-1)])]),_:1}))]),_:1}),t(r,{label:"å¯ç”¨",width:"70"},{default:a(({row:l})=>[t(M,{modelValue:l.enabled,"onUpdate:modelValue":g=>l.enabled=g,onChange:g=>Y(l),size:"small",disabled:S(l)},null,8,["modelValue","onUpdate:modelValue","onChange","disabled"])]),_:1}),t(r,{label:"æ“ä½œ",width:"190"},{default:a(({row:l})=>[S(l)?(u(),i(k,{key:0},[t(C,{type:"info",size:"small",style:{"margin-right":"6px"}},{default:a(()=>[...e[17]||(e[17]=[s("è®°å¿†ç®¡ç†",-1)])]),_:1}),t(_,{size:"small",onClick:g=>T(l)},{default:a(()=>[...e[18]||(e[18]=[s("æŸ¥çœ‹",-1)])]),_:1},8,["onClick"])],64)):(u(),i(k,{key:1},[t(_,{size:"small",onClick:g=>j(l)},{default:a(()=>[...e[19]||(e[19]=[s("ç«‹å³è¿è¡Œ",-1)])]),_:1},8,["onClick"]),t(_,{size:"small",type:"danger",onClick:g=>F(l)},{default:a(()=>[...e[20]||(e[20]=[s("åˆ é™¤",-1)])]),_:1},8,["onClick"])],64))]),_:1})]),_:1},8,["data"]),A.value.length===0?(u(),c(H,{key:0,description:"æš‚æ— å®šæ—¶ä»»åŠ¡"})):le("",!0)]),_:1}),t(Q,{modelValue:b.value,"onUpdate:modelValue":e[9]||(e[9]=l=>b.value=l),title:"æ–°å»ºå®šæ—¶ä»»åŠ¡",width:"520px"},{footer:a(()=>[t(_,{onClick:e[8]||(e[8]=l=>b.value=!1)},{default:a(()=>[...e[23]||(e[23]=[s("å–æ¶ˆ",-1)])]),_:1}),t(_,{type:"primary",onClick:O},{default:a(()=>[...e[24]||(e[24]=[s("åˆ›å»º",-1)])]),_:1})]),default:a(()=>[t(P,{model:n,"label-width":"110px"},{default:a(()=>[t(m,{label:"æ‰€å±žæˆå‘˜"},{default:a(()=>[t($,{modelValue:n.agentId,"onUpdate:modelValue":e[1]||(e[1]=l=>n.agentId=l),placeholder:"ä¸é€‰åˆ™ä¸ºå…¨å±€ä»»åŠ¡",clearable:"",style:{width:"100%"}},{default:a(()=>[(u(!0),i(k,null,E(x.value,l=>(u(),c(z,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),t(y,{type:"info",size:"small",style:{display:"block","margin-top":"4px"}},{default:a(()=>[...e[21]||(e[21]=[s(" ðŸ’¡ ä¸é€‰åˆ™ä¸ºå…¨å±€ä»»åŠ¡ï¼›é€‰æ‹©æˆå‘˜åŽè¯¥ä»»åŠ¡åªåœ¨æˆå‘˜çš„ã€Œå®šæ—¶ä»»åŠ¡ã€Tab æ˜¾ç¤º ",-1)])]),_:1})]),_:1}),t(m,{label:"åç§°"},{default:a(()=>[t(w,{modelValue:n.name,"onUpdate:modelValue":e[2]||(e[2]=l=>n.name=l),placeholder:"ä»»åŠ¡åç§°"},null,8,["modelValue"])]),_:1}),t(m,{label:"å¤‡æ³¨"},{default:a(()=>[t(w,{modelValue:n.remark,"onUpdate:modelValue":e[3]||(e[3]=l=>n.remark=l),placeholder:"å¯é€‰ï¼Œè¯´æ˜Žè¿™ä¸ªä»»åŠ¡çš„ç”¨é€”"},null,8,["modelValue"])]),_:1}),t(m,{label:"Cron è¡¨è¾¾å¼"},{default:a(()=>[t(w,{modelValue:n.expr,"onUpdate:modelValue":e[4]||(e[4]=l=>n.expr=l),placeholder:"0 9 * * *"},null,8,["modelValue"]),t(y,{type:"info",size:"small",style:{"margin-top":"4px",display:"block"}},{default:a(()=>[...e[22]||(e[22]=[s(" æ ¼å¼ï¼šç§’(å¯é€‰) åˆ† æ—¶ æ—¥ æœˆ å‘¨ã€‚ä¾‹ï¼š0 0 9 * * * = æ¯å¤©09:00 ",-1)])]),_:1})]),_:1}),t(m,{label:"æ—¶åŒº"},{default:a(()=>[t($,{modelValue:n.tz,"onUpdate:modelValue":e[5]||(e[5]=l=>n.tz=l),style:{width:"100%"}},{default:a(()=>[t(z,{label:"Asia/Shanghai",value:"Asia/Shanghai"}),t(z,{label:"UTC",value:"UTC"}),t(z,{label:"America/New_York",value:"America/New_York"})]),_:1},8,["modelValue"])]),_:1}),t(m,{label:"æ¶ˆæ¯å†…å®¹"},{default:a(()=>[t(w,{modelValue:n.message,"onUpdate:modelValue":e[6]||(e[6]=l=>n.message=l),type:"textarea",rows:3,placeholder:"å‘é€ç»™ Agent çš„æ¶ˆæ¯å†…å®¹"},null,8,["modelValue"])]),_:1}),t(m,{label:"å¯ç”¨"},{default:a(()=>[t(M,{modelValue:n.enabled,"onUpdate:modelValue":e[7]||(e[7]=l=>n.enabled=l)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),be=se(fe,[["__scopeId","data-v-999fa20d"]]);export{be as default};
