import{d as re,h as ue,c as p,f as n,t as d,a,w as s,k as _,D as ce,g as u,E as g,r,o as c,e as f,F as N,l as O,i as M,N as fe,m as pe,b as E,O as me,q as ve,P as _e,n as ge,j as ye,Q as xe,C as ke,J as we,x as Ce,I as he,u as be}from"./index-DWSoZvUH.js";import{i as T,b as ze}from"./index-BP-QbRJU.js";import{_ as Ve}from"./_plugin-vue_export-helper-DlAUqK2U.js";const $e={class:"chats-page"},Ie={class:"page-header"},Ee={style:{"font-size":"13px",color:"#909399","margin-top":"4px"}},Te={class:"filter-bar"},Le={style:{display:"flex","flex-direction":"column",gap:"2px"}},Se={style:{"font-weight":"500","font-size":"14px"}},Ae={style:{"font-size":"12px",color:"#909399"}},Ne={style:{"font-size":"13px",color:"#606266"}},Me={style:{"font-size":"13px"}},De={style:{flex:"1","min-width":"0"}},Be={key:0,style:{display:"flex","align-items":"center",gap:"8px"}},Ue={style:{"font-weight":"600","font-size":"16px",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap"}},Fe={key:1,style:{display:"flex","align-items":"center",gap:"8px"}},Ke={style:{"font-size":"12px",color:"#909399","margin-top":"4px"}},Re={key:0,style:{"text-align":"center",padding:"40px"}},je={key:1,class:"message-list"},He={key:0,class:"compact-marker"},Pe={style:{"font-size":"12px",color:"#606266","line-height":"1.6"}},qe={class:"msg-avatar"},Je={class:"msg-body"},Oe={class:"msg-meta"},Qe={class:"msg-role"},Ge={class:"msg-time"},We=["innerHTML"],Xe={style:{display:"flex","justify-content":"flex-end",gap:"10px",padding:"12px 0 0"}},Ye=re({__name:"ChatsView",setup(Ze){const Q=be(),w=u([]),D=u(0),C=u(!1),L=u(""),h=u(""),b=u("lastAt"),B=u([]),y=u(!1),i=u(null),z=u([]),V=u(!1),x=u(!1),v=u(""),G=Ce(()=>{let t=w.value;if(h.value){const e=h.value.toLowerCase();t=t.filter(o=>(o.title||"").toLowerCase().includes(e)||o.id.toLowerCase().includes(e)||(o.agentName||"").toLowerCase().includes(e))}return b.value==="messageCount"?t=[...t].sort((e,o)=>o.messageCount-e.messageCount):b.value==="tokenEstimate"&&(t=[...t].sort((e,o)=>o.tokenEstimate-e.tokenEstimate)),t});async function k(){C.value=!0;try{const t=await T.list({agentId:L.value||void 0,limit:200});w.value=t.data.sessions,D.value=t.data.total}catch(t){g.error("åŠ è½½å¤±è´¥ï¼š"+(t.message||""))}finally{C.value=!1}}async function W(){try{const t=await ze.list();B.value=t.data}catch{}}async function U(t){i.value=t,y.value=!0,x.value=!1,z.value=[],V.value=!0;try{const e=await T.get(t.agentId,t.id);z.value=e.data.messages}catch(e){g.error("åŠ è½½å¯¹è¯å¤±è´¥ï¼š"+(e.message||""))}finally{V.value=!1}}function F(t){t&&Q.push(`/agents/${t.agentId}?resumeSession=${t.id}`)}async function X(t){try{await T.delete(t.agentId,t.id),g.success("å·²åˆ é™¤"),i.value?.id===t.id&&(y.value=!1),k()}catch(e){g.error("åˆ é™¤å¤±è´¥ï¼š"+(e.message||""))}}function Y(){v.value=i.value?.title||"",x.value=!0}async function K(){if(i.value)try{await T.rename(i.value.agentId,i.value.id,v.value),i.value.title=v.value;const t=w.value.findIndex(e=>e.id===i.value.id);t>=0&&(w.value[t].title=v.value),x.value=!1,g.success("å·²é‡å‘½å")}catch(t){g.error("ä¿å­˜å¤±è´¥ï¼š"+(t.message||""))}}function Z({row:t}){return i.value?.id===t.id?"active-row":""}function S(t){return t?new Date(t).toLocaleString("zh-CN",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"â€”"}function ee(t){if(!t)return"â€”";const e=Date.now()-t;return e<6e4?"åˆšåˆš":e<36e5?`${Math.floor(e/6e4)} åˆ†é’Ÿå‰`:e<864e5?`${Math.floor(e/36e5)} å°æ—¶å‰`:e<7*864e5?`${Math.floor(e/864e5)} å¤©å‰`:S(t)}function R(t){return t?t>=1e3?`${(t/1e3).toFixed(1)}k`:String(t):"0"}function te(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/```[\s\S]*?```/g,e=>`<pre class="code-block">${e.slice(3,-3)}</pre>`).replace(/`([^`]+)`/g,"<code>$1</code>").replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\n/g,"<br>")}return ue(async()=>{await Promise.all([k(),W()])}),(t,e)=>{const o=r("el-button"),$=r("el-option"),j=r("el-select"),H=r("el-input"),A=r("el-card"),m=r("el-table-column"),P=r("el-tag"),le=r("el-badge"),ae=r("el-popconfirm"),q=r("el-empty"),se=r("el-table"),J=r("el-icon"),ne=r("el-divider"),oe=r("el-avatar"),ie=r("el-drawer"),de=he("loading");return c(),p("div",$e,[n("div",Ie,[n("div",null,[e[10]||(e[10]=n("h2",{style:{margin:"0"}},"ğŸ’¬ å¯¹è¯ç®¡ç†",-1)),n("div",Ee," å…± "+d(D.value)+" æ¡å¯¹è¯ Â· è·¨æ‰€æœ‰ AI æˆå‘˜ ",1)]),a(o,{onClick:k,loading:C.value,icon:_(ce)},{default:s(()=>[...e[11]||(e[11]=[f("åˆ·æ–°",-1)])]),_:1},8,["loading","icon"])]),a(A,{shadow:"never",style:{"margin-bottom":"16px",padding:"0"}},{default:s(()=>[n("div",Te,[a(j,{modelValue:L.value,"onUpdate:modelValue":e[0]||(e[0]=l=>L.value=l),placeholder:"å…¨éƒ¨æˆå‘˜",clearable:"",style:{width:"180px"},onChange:k},{default:s(()=>[(c(!0),p(N,null,O(B.value,l=>(c(),M($,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),a(H,{modelValue:h.value,"onUpdate:modelValue":e[1]||(e[1]=l=>h.value=l),placeholder:"æœç´¢å¯¹è¯æ ‡é¢˜â€¦",clearable:"",style:{width:"240px"},"prefix-icon":_(fe)},null,8,["modelValue","prefix-icon"]),a(j,{modelValue:b.value,"onUpdate:modelValue":e[2]||(e[2]=l=>b.value=l),style:{width:"140px"},onChange:k},{default:s(()=>[a($,{label:"æœ€è¿‘æ´»è·ƒ",value:"lastAt"}),a($,{label:"æ¶ˆæ¯æœ€å¤š",value:"messageCount"}),a($,{label:"Token æœ€å¤š",value:"tokenEstimate"})]),_:1},8,["modelValue"])])]),_:1}),a(A,{shadow:"never"},{default:s(()=>[pe((c(),M(se,{data:G.value,stripe:"","row-class-name":Z,onRowClick:U,style:{cursor:"pointer"}},{empty:s(()=>[a(q,{description:"æš‚æ— å¯¹è¯è®°å½•"})]),default:s(()=>[a(m,{label:"å¯¹è¯æ ‡é¢˜","min-width":"220"},{default:s(({row:l})=>[n("div",Le,[n("span",Se,d(l.title||"ï¼ˆæ— æ ‡é¢˜ï¼‰"),1),n("span",Ae,"ID: "+d(l.id),1)])]),_:1}),a(m,{label:"AI æˆå‘˜",width:"130"},{default:s(({row:l})=>[a(P,{size:"small",type:"primary",effect:"plain"},{default:s(()=>[f(d(l.agentName||l.agentId),1)]),_:2},1024)]),_:1}),a(m,{label:"æ¶ˆæ¯æ•°",width:"90",align:"center"},{default:s(({row:l})=>[a(le,{value:l.messageCount,type:"info"},null,8,["value"])]),_:1}),a(m,{label:"Token ç”¨é‡",width:"130",align:"center"},{default:s(({row:l})=>[a(P,{type:l.tokenEstimate>6e4?"danger":l.tokenEstimate>3e4?"warning":"success",size:"small",effect:"plain"},{default:s(()=>[f(d(R(l.tokenEstimate)),1)]),_:2},1032,["type"])]),_:1}),a(m,{label:"åˆ›å»ºæ—¶é—´",width:"150"},{default:s(({row:l})=>[n("span",Ne,d(S(l.createdAt)),1)]),_:1}),a(m,{label:"æœ€åæ´»è·ƒ",width:"150"},{default:s(({row:l})=>[n("span",Me,d(ee(l.lastAt)),1)]),_:1}),a(m,{label:"æ“ä½œ",width:"190",onClick:e[4]||(e[4]=E(()=>{},["stop"]))},{default:s(({row:l})=>[a(o,{size:"small",onClick:E(I=>U(l),["stop"])},{default:s(()=>[...e[12]||(e[12]=[f("æŸ¥çœ‹",-1)])]),_:1},8,["onClick"]),a(o,{size:"small",type:"primary",onClick:E(I=>F(l),["stop"])},{default:s(()=>[...e[13]||(e[13]=[f("ç»§ç»­å¯¹è¯",-1)])]),_:1},8,["onClick"]),a(ae,{title:"ç¡®è®¤åˆ é™¤æ­¤å¯¹è¯ï¼Ÿ",onConfirm:I=>X(l),width:"200"},{reference:s(()=>[a(o,{size:"small",type:"danger",onClick:e[3]||(e[3]=E(()=>{},["stop"]))},{default:s(()=>[...e[14]||(e[14]=[f("åˆ é™¤",-1)])]),_:1})]),_:1},8,["onConfirm"])]),_:1})]),_:1},8,["data"])),[[de,C.value]])]),_:1}),a(ie,{modelValue:y.value,"onUpdate:modelValue":e[9]||(e[9]=l=>y.value=l),title:i.value?.title||"å¯¹è¯è¯¦æƒ…",size:"50%",direction:"rtl"},{header:s(()=>[n("div",De,[x.value?(c(),p("div",Fe,[a(H,{modelValue:v.value,"onUpdate:modelValue":e[5]||(e[5]=l=>v.value=l),size:"small",style:{flex:"1"},onKeyup:we(K,["enter"])},null,8,["modelValue"]),a(o,{type:"primary",size:"small",onClick:K},{default:s(()=>[...e[15]||(e[15]=[f("ä¿å­˜",-1)])]),_:1}),a(o,{size:"small",onClick:e[6]||(e[6]=l=>x.value=!1)},{default:s(()=>[...e[16]||(e[16]=[f("å–æ¶ˆ",-1)])]),_:1})])):(c(),p("div",Be,[n("span",Ue,d(i.value?.title||"ï¼ˆæ— æ ‡é¢˜ï¼‰"),1),a(o,{icon:_(ke),circle:"",size:"small",onClick:Y},null,8,["icon"])])),n("div",Ke,d(i.value?.agentName)+" Â· "+d(i.value?.messageCount??0)+" æ¡æ¶ˆæ¯ Â· "+d(R(i.value?.tokenEstimate??0))+" tokens ",1)])]),footer:s(()=>[n("div",Xe,[a(o,{onClick:e[7]||(e[7]=l=>y.value=!1)},{default:s(()=>[...e[20]||(e[20]=[f("å…³é—­",-1)])]),_:1}),a(o,{type:"primary",icon:_(xe),onClick:e[8]||(e[8]=l=>F(i.value)),disabled:!i.value},{default:s(()=>[...e[21]||(e[21]=[f(" ç»§ç»­å¯¹è¯ ",-1)])]),_:1},8,["icon","disabled"])])]),default:s(()=>[V.value?(c(),p("div",Re,[a(J,{class:"is-loading",style:{"font-size":"32px",color:"#409eff"}},{default:s(()=>[a(_(me))]),_:1}),e[17]||(e[17]=n("div",{style:{"margin-top":"12px",color:"#909399"}},"åŠ è½½å¯¹è¯å†å²â€¦",-1))])):(c(),p("div",je,[(c(!0),p(N,null,O(z.value,(l,I)=>(c(),p("div",{key:I,class:ve(["message-item",`msg-${l.role}`])},[l.isCompact?(c(),p("div",He,[a(ne,null,{default:s(()=>[a(J,null,{default:s(()=>[a(_(_e))]),_:1}),e[18]||(e[18]=n("span",{style:{"margin-left":"6px","font-size":"12px",color:"#909399"}},"ä»¥ä¸Šå†…å®¹å·²å‹ç¼©",-1))]),_:1}),a(A,{class:"compact-summary",shadow:"never"},{default:s(()=>[n("div",Pe,[e[19]||(e[19]=n("strong",null,"æ‘˜è¦ï¼š",-1)),f(d(l.text),1)])]),_:2},1024)])):(c(),p(N,{key:1},[n("div",qe,[a(oe,{size:32,style:ge({background:l.role==="user"?"#409eff":"#67c23a"})},{default:s(()=>[f(d(l.role==="user"?"ç”¨":"AI"),1)]),_:2},1032,["style"])]),n("div",Je,[n("div",Oe,[n("span",Qe,d(l.role==="user"?"ç”¨æˆ·":"AI åŠ©æ‰‹"),1),n("span",Ge,d(S(l.timestamp)),1)]),n("div",{class:"msg-text",innerHTML:te(l.text)},null,8,We)])],64))],2))),128)),!z.value.length&&!V.value?(c(),M(q,{key:0,description:"æš‚æ— æ¶ˆæ¯è®°å½•"})):ye("",!0)]))]),_:1},8,["modelValue","title"])])}}}),at=Ve(Ye,[["__scopeId","data-v-19d65006"]]);export{at as default};
