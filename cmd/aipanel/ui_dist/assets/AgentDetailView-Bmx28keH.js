import{d as Zl,h as et,o as u,c as f,b as o,a as e,w as t,j as h,F as M,l as X,q as Ye,t as m,i as x,f as s,e as lt,m as ul,B as Pt,g as r,x as dl,E as v,r as p,C as Ll,D as Rt,k as I,y as jt,z as ol,n as sl,G as Wt,H as Al,I as Kt,J as Ot,K as qt,L as Yt,M as Ht}from"./index-CCk1e8Aq.js";import{g as Ke,f as ge,b as Fl,h as Oe,i as qe,j as Jt,e as il,r as Ql,k as Q,l as Xl}from"./index-sb85_xT4.js";import{A as tt}from"./AiChat-Bkf8KZj7.js";import{_ as at}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Gt={class:"skill-studio"},Qt={class:"studio-sidebar"},Xt={class:"sidebar-top"},Zt={class:"sidebar-acts"},ea={class:"skill-list"},la={key:0,class:"list-empty"},ta=["onClick"],aa={class:"sk-icon"},na={key:0},oa={class:"sk-info"},sa={class:"sk-name"},ia={class:"sk-id"},ua={class:"sk-right"},da={class:"studio-editor"},ra={key:0,class:"editor-empty"},ma={class:"editor-toolbar"},pa={class:"editor-breadcrumb"},va={class:"crumb-name"},fa={class:"toolbar-acts"},ca={class:"editor-body"},ya={class:"file-tree"},ga={class:"tree-item tree-dir"},_a={key:0,class:"file-editor"},ba={class:"file-editor-head"},wa={style:{display:"flex","align-items":"center",gap:"10px"}},ka={style:{"font-size":"12px",color:"#909399"}},xa={class:"json-preview"},Ca={key:1,class:"file-editor"},Va={class:"file-editor-head"},ha={style:{"margin-left":"auto",display:"flex",gap:"8px"}},za={style:{"font-size":"11px",color:"#c0c4cc"}},$a={class:"studio-chat"},Ta={class:"chat-panel-head"},Ua={key:0,style:{"margin-left":"auto","font-size":"11px",color:"#c0c4cc"}},Ia={class:"chat-wrap"},Sa=Zl({__name:"SkillStudio",props:{agentId:{}},setup(rl){const H=rl,y=r([]),Y=r(!1),b=r(null),B=r("meta"),C=r({name:"",icon:"",category:"",description:"",version:"1.0.0",enabled:!0}),P=r(""),le=r(!1),se=r(!1),Te=r(!1),de=r(!1),Ue=r(!1),V=r({id:"",name:"",icon:"",category:"",description:"",promptContent:""}),ie=r(null),re=dl(()=>b.value?`你是一个技能配置助手，正在帮助用户配置技能「${b.value.name}」（ID: ${b.value.id}）。

当前 SKILL.md 内容：
\`\`\`markdown
${P.value||"（空）"}
\`\`\`

你可以帮助：
- 优化或重写 SKILL.md 系统提示词
- 测试技能效果（用户发消息即可测试）
- 给出技能设计建议`:"你是一个技能配置助手，帮助用户设计和优化 AI 技能的系统提示词。"),me=dl(()=>b.value?`当前编辑「${b.value.name}」。你可以让我优化 SKILL.md、测试效果，或者直接对话体验当前技能。`:"选择一个技能后，我可以帮你优化配置、写 SKILL.md、测试效果。"),Ie=dl(()=>b.value?[`帮我优化「${b.value.name}」的 SKILL.md`,"这个技能怎么写效果更好？","用中文回答一道历史题，测试当前技能效果"]:["帮我设计一个代码审查技能","帮我写一个翻译助手的 SKILL.md"]);async function O(){Y.value=!0;try{const k=await Ke.list(H.agentId);if(y.value=k.data||[],b.value){const i=y.value.find(Fe=>Fe.id===b.value.id);i&&(b.value=i,He(i))}}catch{}finally{Y.value=!1}}function He(k){C.value={name:k.name,icon:k.icon||"",category:k.category||"",description:k.description||"",version:k.version||"1.0.0",enabled:k.enabled}}async function Se(k){b.value=k,He(k),B.value="meta",se.value=!1,P.value=""}async function Je(){if(b.value&&B.value!=="prompt"&&(B.value="prompt",!P.value)){le.value=!0;try{const k=await ge.read(H.agentId,`skills/${b.value.id}/SKILL.md`);P.value=k.data?.content||""}catch{P.value=""}finally{le.value=!1}se.value=!1}}async function ml(){if(b.value){Te.value=!0;try{await Ke.update(H.agentId,b.value.id,{name:C.value.name,icon:C.value.icon,category:C.value.category,description:C.value.description,enabled:C.value.enabled}),(B.value==="prompt"||P.value)&&(await ge.write(H.agentId,`skills/${b.value.id}/SKILL.md`,P.value),se.value=!1),v.success("保存成功"),await O()}catch(k){v.error(k.response?.data?.error||"保存失败")}finally{Te.value=!1}}}async function _e(k,i){try{await Ke.update(H.agentId,k.id,{enabled:i}),await O()}catch{v.error("操作失败")}}async function be(){if(b.value)try{await Ke.remove(H.agentId,b.value.id),v.success("已删除"),b.value=null,await O()}catch{v.error("删除失败")}}function A(){V.value={id:"",name:"",icon:"",category:"",description:"",promptContent:""},de.value=!0}async function Le(){if(!V.value.id||!V.value.name){v.warning("ID 和名称必填");return}Ue.value=!0;try{await Ke.create(H.agentId,{meta:{id:V.value.id,name:V.value.name,icon:V.value.icon,category:V.value.category,description:V.value.description,version:"1.0.0",enabled:!0,source:"local",installedAt:""},promptContent:V.value.promptContent}),v.success("创建成功"),de.value=!1,await O();const k=y.value.find(i=>i.id===V.value.id);k&&await Se(k)}catch(k){v.error(k.response?.data?.error||"创建失败")}finally{Ue.value=!1}}async function Ae(){if(!b.value)return;P.value||await Je();const k=`请用「${b.value.name}」技能效果回复：你好，请介绍一下你的功能。`;ie.value?.fillInput?.(k),v.info("测试消息已填入右侧聊天框，点击发送即可测试")}return et(O),(k,i)=>{const Fe=p("Refresh"),U=p("el-icon"),q=p("el-button"),we=p("Plus"),ke=p("Tools"),Z=p("el-tag"),te=p("el-switch"),De=p("Setting"),Ne=p("FolderOpened"),pe=p("VideoPlay"),xe=p("DocumentChecked"),ve=p("Delete"),Ce=p("el-popconfirm"),Ge=p("Folder"),J=p("Document"),F=p("el-input"),D=p("el-form-item"),S=p("el-col"),fe=p("el-row"),L=p("el-collapse-item"),pl=p("el-collapse"),Qe=p("el-form"),vl=p("ChatLineRound"),fl=p("el-dialog");return u(),f("div",Gt,[o("div",Qt,[o("div",Xt,[i[18]||(i[18]=o("span",{class:"sidebar-title"},"技能库",-1)),o("div",Zt,[e(q,{size:"small",loading:Y.value,circle:"",onClick:O},{default:t(()=>[e(U,null,{default:t(()=>[e(Fe)]),_:1})]),_:1},8,["loading"]),e(q,{size:"small",type:"primary",circle:"",onClick:A},{default:t(()=>[e(U,null,{default:t(()=>[e(we)]),_:1})]),_:1})])]),o("div",ea,[!Y.value&&y.value.length===0?(u(),f("div",la,"暂无技能")):h("",!0),(u(!0),f(M,null,X(y.value,g=>(u(),f("div",{key:g.id,class:Ye(["skill-item",{active:b.value?.id===g.id}]),onClick:Me=>Se(g)},[o("span",aa,[g.icon?(u(),f("span",na,m(g.icon),1)):(u(),x(U,{key:1},{default:t(()=>[e(ke)]),_:1}))]),o("div",oa,[o("div",sa,m(g.name),1),o("div",ia,m(g.id),1)]),o("div",ua,[g.category?(u(),x(Z,{key:0,size:"small",effect:"plain",style:{"margin-right":"6px","font-size":"11px"}},{default:t(()=>[s(m(g.category),1)]),_:2},1024)):h("",!0),e(te,{"model-value":g.enabled,size:"small",onChange:Me=>_e(g,Me),onClick:i[0]||(i[0]=lt(()=>{},["stop"]))},null,8,["model-value","onChange"])])],10,ta))),128))])]),o("div",da,[b.value?(u(),f(M,{key:1},[o("div",ma,[o("div",pa,[e(U,{style:{color:"#909399"}},{default:t(()=>[e(Ne)]),_:1}),i[21]||(i[21]=o("span",{class:"crumb-sep"},"skills /",-1)),o("span",va,m(b.value.id),1)]),o("div",fa,[e(q,{size:"small",onClick:Ae},{default:t(()=>[e(U,null,{default:t(()=>[e(pe)]),_:1}),i[22]||(i[22]=s(" 测试 ",-1))]),_:1}),e(q,{size:"small",type:"primary",loading:Te.value,onClick:ml},{default:t(()=>[e(U,null,{default:t(()=>[e(xe)]),_:1}),i[23]||(i[23]=s(" 保存 ",-1))]),_:1},8,["loading"]),e(Ce,{title:"确认删除该技能？",onConfirm:be},{reference:t(()=>[e(q,{size:"small",type:"danger",plain:""},{default:t(()=>[e(U,null,{default:t(()=>[e(ve)]),_:1})]),_:1})]),_:1})])]),o("div",ca,[o("div",ya,[i[27]||(i[27]=o("div",{class:"tree-title"},"目录",-1)),o("div",ga,[e(U,null,{default:t(()=>[e(Ge)]),_:1}),o("span",null,m(b.value.id)+"/",1)]),o("div",{class:Ye(["tree-item",{"tree-active":B.value==="meta"}]),onClick:i[1]||(i[1]=g=>B.value="meta")},[e(U,null,{default:t(()=>[e(J)]),_:1}),i[24]||(i[24]=o("span",null,"skill.json",-1))],2),o("div",{class:Ye(["tree-item",{"tree-active":B.value==="prompt"}]),onClick:Je},[e(U,null,{default:t(()=>[e(J)]),_:1}),i[26]||(i[26]=o("span",null,"SKILL.md",-1)),b.value.enabled?(u(),x(Z,{key:0,size:"small",type:"success",effect:"plain",style:{"margin-left":"4px","font-size":"10px"}},{default:t(()=>[...i[25]||(i[25]=[s("注入中",-1)])]),_:1})):h("",!0)],2)]),B.value==="meta"?(u(),f("div",_a,[o("div",ba,[e(U,null,{default:t(()=>[e(J)]),_:1}),i[28]||(i[28]=s(" skill.json ",-1)),i[29]||(i[29]=o("span",{class:"file-hint"},"技能元信息，影响列表展示和 runner 行为",-1))]),e(Qe,{model:C.value,"label-width":"72px",size:"small",style:{padding:"16px 20px"}},{default:t(()=>[e(D,{label:"技能 ID"},{default:t(()=>[e(F,{value:b.value.id,disabled:""},null,8,["value"])]),_:1}),e(fe,{gutter:12},{default:t(()=>[e(S,{span:14},{default:t(()=>[e(D,{label:"名称"},{default:t(()=>[e(F,{modelValue:C.value.name,"onUpdate:modelValue":i[2]||(i[2]=g=>C.value.name=g),placeholder:"如 翻译助手"},null,8,["modelValue"])]),_:1})]),_:1}),e(S,{span:10},{default:t(()=>[e(D,{label:"图标"},{default:t(()=>[e(F,{modelValue:C.value.icon,"onUpdate:modelValue":i[3]||(i[3]=g=>C.value.icon=g),placeholder:"emoji"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(fe,{gutter:12},{default:t(()=>[e(S,{span:14},{default:t(()=>[e(D,{label:"分类"},{default:t(()=>[e(F,{modelValue:C.value.category,"onUpdate:modelValue":i[4]||(i[4]=g=>C.value.category=g),placeholder:"如 语言"},null,8,["modelValue"])]),_:1})]),_:1}),e(S,{span:10},{default:t(()=>[e(D,{label:"版本"},{default:t(()=>[e(F,{modelValue:C.value.version,"onUpdate:modelValue":i[5]||(i[5]=g=>C.value.version=g),placeholder:"1.0.0"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(D,{label:"描述"},{default:t(()=>[e(F,{modelValue:C.value.description,"onUpdate:modelValue":i[6]||(i[6]=g=>C.value.description=g),type:"textarea",rows:2,placeholder:"简要描述技能功能"},null,8,["modelValue"])]),_:1}),e(D,{label:"状态"},{default:t(()=>[o("div",wa,[e(te,{modelValue:C.value.enabled,"onUpdate:modelValue":i[7]||(i[7]=g=>C.value.enabled=g)},null,8,["modelValue"]),o("span",ka,m(C.value.enabled?"已启用，SKILL.md 将注入系统提示":"已禁用"),1)])]),_:1}),e(pl,{style:{"margin-top":"8px"}},{default:t(()=>[e(L,{title:"查看 skill.json 原文"},{default:t(()=>[o("pre",xa,m(JSON.stringify({id:b.value.id,...C.value},null,2)),1)]),_:1})]),_:1})]),_:1},8,["model"])])):(u(),f("div",Ca,[o("div",Va,[e(U,null,{default:t(()=>[e(J)]),_:1}),i[31]||(i[31]=s(" SKILL.md ",-1)),i[32]||(i[32]=o("span",{class:"file-hint"},"注入到 AI System Prompt 的指令内容",-1)),o("div",ha,[se.value?(u(),x(Z,{key:0,type:"warning",size:"small"},{default:t(()=>[...i[30]||(i[30]=[s("未保存",-1)])]),_:1})):h("",!0),o("span",za,m(P.value.length)+" 字符",1)])]),ul(o("textarea",{"onUpdate:modelValue":i[8]||(i[8]=g=>P.value=g),class:"code-textarea",spellcheck:"false",placeholder:`# 技能名称

## 功能说明
描述该技能的用途…

## 行为规范
- 规范 1
- 规范 2`,onInput:i[9]||(i[9]=g=>se.value=!0)},null,544),[[Pt,P.value]])]))])],64)):(u(),f("div",ra,[e(U,{size:"48",color:"#c0c4cc"},{default:t(()=>[e(De)]),_:1}),i[20]||(i[20]=o("p",null,"从左侧选择一个技能开始编辑",-1)),e(q,{type:"primary",onClick:A},{default:t(()=>[e(U,null,{default:t(()=>[e(we)]),_:1}),i[19]||(i[19]=s(" 新建技能",-1))]),_:1})]))]),o("div",$a,[o("div",Ta,[e(U,null,{default:t(()=>[e(vl)]),_:1}),i[33]||(i[33]=s(" AI 协作配置 ",-1)),b.value?(u(),f("span",Ua,"当前: "+m(b.value.name),1)):h("",!0)]),o("div",Ia,[e(tt,{ref_key:"aiChatRef",ref:ie,"agent-id":rl.agentId,context:re.value,scenario:"skill-studio","welcome-message":me.value,examples:Ie.value,compact:""},null,8,["agent-id","context","welcome-message","examples"])])]),e(fl,{modelValue:de.value,"onUpdate:modelValue":i[17]||(i[17]=g=>de.value=g),title:"新建技能",width:"480px"},{footer:t(()=>[e(q,{onClick:i[16]||(i[16]=g=>de.value=!1)},{default:t(()=>[...i[34]||(i[34]=[s("取消",-1)])]),_:1}),e(q,{type:"primary",loading:Ue.value,onClick:Le},{default:t(()=>[...i[35]||(i[35]=[s("创建",-1)])]),_:1},8,["loading"])]),default:t(()=>[e(Qe,{model:V.value,"label-width":"80px",size:"small"},{default:t(()=>[e(D,{label:"技能 ID",required:""},{default:t(()=>[e(F,{modelValue:V.value.id,"onUpdate:modelValue":i[10]||(i[10]=g=>V.value.id=g),placeholder:"如 translate（小写字母+下划线）"},null,8,["modelValue"])]),_:1}),e(fe,{gutter:12},{default:t(()=>[e(S,{span:14},{default:t(()=>[e(D,{label:"名称",required:""},{default:t(()=>[e(F,{modelValue:V.value.name,"onUpdate:modelValue":i[11]||(i[11]=g=>V.value.name=g),placeholder:"如 翻译助手"},null,8,["modelValue"])]),_:1})]),_:1}),e(S,{span:10},{default:t(()=>[e(D,{label:"图标"},{default:t(()=>[e(F,{modelValue:V.value.icon,"onUpdate:modelValue":i[12]||(i[12]=g=>V.value.icon=g),placeholder:"emoji"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(D,{label:"分类"},{default:t(()=>[e(F,{modelValue:V.value.category,"onUpdate:modelValue":i[13]||(i[13]=g=>V.value.category=g),placeholder:"如 语言 / 开发 / 写作"},null,8,["modelValue"])]),_:1}),e(D,{label:"描述"},{default:t(()=>[e(F,{modelValue:V.value.description,"onUpdate:modelValue":i[14]||(i[14]=g=>V.value.description=g),type:"textarea",rows:2},null,8,["modelValue"])]),_:1}),e(D,{label:"SKILL.md"},{default:t(()=>[e(F,{modelValue:V.value.promptContent,"onUpdate:modelValue":i[15]||(i[15]=g=>V.value.promptContent=g),type:"textarea",rows:6,placeholder:`# 技能名称

## 功能说明
…`,style:{"font-family":"monospace","font-size":"12px"}},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),La=at(Sa,[["__scopeId","data-v-b407ae46"]]),Aa={class:"header-left"},Fa={class:"chat-layout"},Da={class:"session-sidebar"},Na={class:"session-sidebar-header"},Ma={class:"session-list"},Ba=["onClick"],Ea={class:"session-item-title"},Pa={class:"session-item-meta"},Ra={key:0,class:"session-empty"},ja={class:"at-panel"},Wa={key:0,class:"at-form"},Ka={class:"chat-area"},Oa={style:{display:"flex","align-items":"center",gap:"8px"}},qa={style:{"font-weight":"600"}},Ya={key:0,style:{"text-align":"center",color:"#c0c4cc",padding:"32px 0","font-size":"14px"}},Ha={style:{display:"flex","align-items":"center",gap:"8px"}},Ja={style:{"font-size":"13px"}},Ga={style:{"font-size":"13px",color:"#606266"}},Qa={key:0,style:{"text-align":"center",color:"#c0c4cc",padding:"40px 0"}},Xa={key:1,class:"relations-list"},Za={class:"relation-info"},en={class:"relation-name"},ln={class:"relation-tags"},tn={class:"relation-desc"},an={style:{display:"flex","align-items":"center","justify-content":"space-between"}},nn={style:{display:"flex",gap:"8px","margin-top":"4px"}},on={style:{display:"flex","align-items":"center","justify-content":"space-between"}},sn={key:0,style:{"text-align":"center",color:"#c0c4cc",padding:"16px 0","font-size":"13px"}},un={style:{"font-size":"12px"}},dn={style:{"font-size":"12px",color:"#606266"}},rn={class:"memory-toolbar",style:{"margin-bottom":"12px",display:"flex",gap:"8px"}},mn={style:{display:"flex","align-items":"center",gap:"4px","font-size":"13px"}},pn={style:{display:"flex","align-items":"center","justify-content":"space-between"}},vn={style:{"margin-bottom":"16px",display:"flex","align-items":"center",gap:"8px"}},fn={class:"conv-drawer-body"},cn={key:0,style:{"text-align":"center","margin-bottom":"12px"}},yn={class:"conv-msg-list"},gn={class:"conv-msg-meta"},_n={class:"conv-msg-role"},bn={key:0,class:"conv-msg-sender"},wn={class:"conv-msg-time"},kn={class:"conv-msg-content"},xn={key:0,class:"conv-msg-empty"},Cn={style:{"margin-top":"8px",display:"flex",gap:"8px","align-items":"center"}},Vn={style:{display:"flex","justify-content":"space-between","align-items":"center","margin-bottom":"16px"}},hn={class:"channel-card-header"},zn={class:"channel-card-left"},$n={class:"channel-card-name"},Tn={key:0,class:"channel-bot-username"},Un={class:"channel-card-actions"},In={key:0,class:"channel-card-body"},Sn={class:"channel-info-row"},Ln={class:"channel-info-value"},An={class:"channel-info-row"},Fn={class:"channel-info-value"},Dn={key:1,class:"channel-card-body"},Nn={class:"channel-info-row"},Mn={class:"channel-info-value"},Bn={style:{opacity:"0.6","font-size":"11px","margin-left":"3px"}},En={class:"pending-section"},Pn=["onClick"],Rn={key:0,class:"pending-list"},jn={key:0,style:{"text-align":"center",padding:"12px"}},Wn={class:"pending-user-info"},Kn={class:"pending-user-name"},On={key:0,class:"pending-user-username"},qn={class:"pending-user-id"},Yn={class:"pending-user-actions"},Hn={key:2,class:"pending-empty"},Jn={style:{width:"100%"}},Gn={style:{display:"flex",gap:"6px","align-items":"center"}},Qn={key:0,style:{"margin-top":"6px",display:"flex","align-items":"center",gap:"6px",color:"#909399","font-size":"13px"}},Xn={key:1,style:{"margin-top":"6px",color:"#67c23a","font-size":"13px"}},Zn={key:2,style:{"margin-top":"6px",color:"#e6a23c","font-size":"13px"}},eo={key:3,style:{"margin-top":"6px",color:"#f56c6c","font-size":"13px"}},lo={key:4,style:{"margin-top":"4px"}},to={class:"channel-url-preview"},ao={class:"channel-url-text"},no={class:"channel-url-preview"},oo={class:"channel-url-text"},so=50,io=Zl({__name:"AgentDetailView",setup(rl){const H=Rt(),y=H.params.id,Y=r(null),b=r("chat"),B=r(),C=r([]),P=r(!1),le=r();async function se(){P.value=!0;try{const n=await Jt.list({agentId:y,limit:50});C.value=n.data.sessions}catch{}finally{P.value=!1}}function Te(n){le.value=n.id,B.value?.resumeSession(n.id)}function de(){le.value=void 0,B.value?.startNewSession()}function Ue(n){le.value=n,setTimeout(se,500)}function V(n){if(!n)return"";const l=Date.now()-n;return l<6e4?"刚刚":l<36e5?`${Math.floor(l/6e4)}分前`:l<864e5?`${Math.floor(l/36e5)}小时前`:`${Math.floor(l/864e5)}天前`}const ie=r(!1),re=r(""),me=r(""),Ie=r(!1),O=r([]);function He(){ie.value=!ie.value,ie.value&&!O.value.length&&Se()}async function Se(){try{const n=await Fl.list();O.value=n.data.filter(l=>l.id!==y)}catch{O.value=[]}}function Je(n){const l=O.value.find(d=>d.id===n);l&&B.value?.fillInput(`@${l.name}: `)}async function ml(){const n=re.value,l=me.value.trim();if(!n||!l)return;const w=O.value.find(ce=>ce.id===n)?.name??n;Ie.value=!0;const j={role:"user",text:`→ 转发给 ${w}：
${l}`};B.value?.appendMessage(j);try{const z=(await Fl.message(n,l,y)).data.response,ne={role:"assistant",text:`← **${w}** 回复：

${z}`};B.value?.appendMessage(ne),me.value="",re.value="",ie.value=!1,v.success(`${w} 已回复`)}catch(ce){const z={role:"system",text:`[失败] 转发失败：${ce.response?.data?.error??ce.message??"网络错误"}`};B.value?.appendMessage(z),v.error("转发失败")}finally{Ie.value=!1}}const _e=r(""),be=r(""),A=r({enabled:!1,schedule:"daily",keepTurns:3,focusHint:"",cronJobId:""}),Le=r(!1),Ae=r(!1);async function k(){try{const n=await il.getConfig(y);A.value=n.data,we()}catch{}}async function i(){Le.value=!0;try{const n=await il.setConfig(y,A.value);A.value=n.data,v.success(A.value.enabled?"自动记忆已开启":"自动记忆已关闭")}catch{v.error("保存失败")}finally{Le.value=!1}}async function Fe(){Ae.value=!0;try{await il.consolidate(y),v.success("记忆整理已在后台启动（约需10~30秒），稍后自动刷新日志"),setTimeout(we,1e4)}catch{v.error("整理失败")}finally{Ae.value=!1}}const U=r([]),q=r(!1);async function we(){q.value=!0;try{const n=await il.runLog(y);U.value=n.data||[]}catch{U.value=[]}finally{q.value=!1}}const ke=r([]),Z=r(""),te=r(""),De=r(!1),Ne=r([]),pe=r(!1),xe=r(""),ve=r(!1),Ce=r(""),Ge=r([]),J=r(""),F=r(""),D=r(null),S=r([]),fe=r(!1),L=r({agentId:"",agentName:"",relationType:"平级协作",strength:"常用",desc:""});async function pl(){try{const n=await Ql.get(y);S.value=n.data.parsed||[]}catch{S.value=[]}}function Qe(n){const l=O.value.find(d=>d.id===n);L.value.agentName=l?l.name:n}async function vl(){if(!L.value.agentId)return;if(S.value.find(l=>l.agentId===L.value.agentId)){v.warning("该成员关系已存在，请先删除再重新添加");return}S.value.push({...L.value}),L.value={agentId:"",agentName:"",relationType:"平级协作",strength:"常用",desc:""},await Me()}async function fl(n){S.value.splice(n,1),await Me()}function g(){if(S.value.length===0)return"";const n=`| 成员ID | 成员名称 | 关系类型 | 关系程度 | 说明 |
|--------|--------|--------|--------|------|`,l=S.value.map(d=>`| ${d.agentId} | ${d.agentName} | ${d.relationType} | ${d.strength} | ${d.desc||""} |`).join(`
`);return n+`
`+l}async function Me(){fe.value=!0;try{await Ql.put(y,g()),v.success("关系已保存")}catch{v.error("保存失败")}finally{fe.value=!1}}function cl(n){const l=["#409EFF","#67C23A","#E6A23C","#F56C6C","#909399","#B45309","#7C3AED","#0891B2"];let d=0;for(let w=0;w<n.length;w++)d=n.charCodeAt(w)+((d<<5)-d);return l[Math.abs(d)%l.length]??"#409EFF"}function Dl(n){return n==="上级"?"danger":n==="下级"?"":n==="平级协作"?"success":"info"}function Nl(n){return n==="核心"?"danger":n==="常用"?"warning":"info"}const Ml=r([]),Be=r(!1),R=r({name:"",expr:"0 9 * * *",tz:"Asia/Shanghai",message:"",enabled:!0});function nt(n){return n==="running"?"success":n==="stopped"?"danger":"info"}function ot(n){return n==="running"?"运行中":n==="stopped"?"已停止":"空闲"}function Bl(n){return n?n<1024?n+" B":n<1048576?(n/1024).toFixed(1)+" KB":(n/1048576).toFixed(1)+" MB":"0 B"}function st(n){return new Date(n).toLocaleString()}function El(n){return n?new Date(n).toLocaleString():""}const ae=r([]),yl=r(!1),Ve=r(!1),ee=r(""),Xe=r(""),gl=r(!1),_l=r(""),c=r({type:"telegram",name:"",enabled:!0,botToken:"",allowedFrom:"",webPassword:"",webWelcome:"",webTitle:""}),T=r({loading:!1,status:""});let bl=null;function wl(n){return/^\*+$/.test(n)}async function Pl(){const n=c.value.botToken;if(!(!n||wl(n))){T.value={loading:!0,status:""};try{const d=(await Q.checkToken(y,n)).data;d.duplicate?T.value={loading:!1,status:"duplicate",usedBy:d.usedBy,usedByCh:d.usedByCh}:d.valid?(T.value={loading:!1,status:"ok",botName:d.botName},!c.value.name&&d.botName&&(c.value.name=d.botName)):T.value={loading:!1,status:"error",error:d.error||"Token 无效"}}catch{T.value={loading:!1,status:"error",error:"网络错误，请重试"}}}}Ll(()=>c.value.type,n=>{ee.value||(Xe.value=kl(n))}),Ll(()=>c.value.botToken,n=>{T.value={loading:!1,status:""},bl&&clearTimeout(bl),!(!n||wl(n)||n.length<20||!n.includes(":"))&&(bl=setTimeout(Pl,800))});function he(n,l){return l?`${window.location.origin}/chat/${n}/${l}`:`${window.location.origin}/chat/${n}`}function Rl(n){navigator.clipboard.writeText(n).then(()=>v.success("链接已复制"))}async function ze(){yl.value=!0;try{const n=await Q.list(y);ae.value=n.data||[]}catch{ae.value=[]}finally{yl.value=!1}}function kl(n){return n+"-"+Date.now().toString(36)}function it(){ee.value="";const n=Y.value?.name||"";Xe.value=kl("telegram"),c.value={type:"telegram",name:n,enabled:!0,botToken:"",allowedFrom:"",webPassword:"",webWelcome:"",webTitle:""},T.value={loading:!1,status:""},Ve.value=!0}function ut(n){ee.value=n.id,c.value={type:n.type,name:n.name,enabled:n.enabled,botToken:n.config?.botToken||"",allowedFrom:n.config?.allowedFrom||"",webPassword:"",webWelcome:n.config?.welcomeMsg||"",webTitle:n.config?.title||""},T.value={loading:!1,status:""},Ve.value=!0}async function dt(){if(!c.value.name||!c.value.type){v.warning("请填写名称和类型");return}if(T.value.status==="duplicate"){v.error(`Bot Token 已被成员「${T.value.usedBy}」使用，请更换`);return}gl.value=!0;try{const n={};if(c.value.type==="telegram"?(c.value.botToken&&(n.botToken=c.value.botToken),c.value.allowedFrom&&(n.allowedFrom=c.value.allowedFrom)):c.value.type==="web"&&(c.value.webPassword&&(n.password=c.value.webPassword),c.value.webWelcome&&(n.welcomeMsg=c.value.webWelcome),c.value.webTitle&&(n.title=c.value.webTitle)),ee.value){const l=ae.value.map(d=>d.id!==ee.value?d:{...d,name:c.value.name,type:c.value.type,enabled:c.value.enabled,config:{...d.config,...n}});await Q.set(y,l)}else{const l={id:Xe.value||kl(c.value.type),name:c.value.name,type:c.value.type,enabled:c.value.enabled,config:n,status:"untested"};await Q.set(y,[...ae.value,l])}v.success(c.value.type==="web"?"保存成功，Web 聊天页立即生效":"保存成功，重启后新渠道生效"),Ve.value=!1,await ze()}catch(n){v.error(n.response?.data?.error||"保存失败")}finally{gl.value=!1}}async function rt(){try{await Q.set(y,ae.value)}catch(n){v.error(n.response?.data?.error||"保存失败"),await ze()}}async function mt(n){const l=ae.value.filter(d=>d.id!==n.id);try{await Q.set(y,l),ae.value=l,v.success("已删除")}catch{v.error("删除失败")}}async function pt(n){_l.value=n.id;try{const l=await Q.test(y,n.id);l.data.valid?v.success(l.data.botName?`测试成功 (@${l.data.botName})`:"测试成功"):v.error(l.data.error||"测试失败"),await ze()}catch{v.error("测试请求失败")}finally{_l.value=""}}const $e=r({}),xl=r({}),Ee=r(""),Cl=r("");async function Ze(n){xl.value[n]=!0;try{const l=await Q.listPending(y,n);$e.value[n]=l.data||[]}catch{$e.value[n]=[]}finally{xl.value[n]=!1}}function vt(n){Ee.value===n?Ee.value="":(Ee.value=n,Ze(n))}async function ft(n,l){Cl.value=`${n}-${l}`;try{await Q.allowUser(y,n,l),v.success(`用户 ${l} 已加入白名单`),await Ze(n),await ze()}catch{v.error("操作失败")}finally{Cl.value=""}}async function ct(n,l){try{await Q.dismissUser(y,n,l),v.success("已忽略"),await Ze(n)}catch{v.error("操作失败")}}async function jl(n,l){try{await Yt.confirm(`确定将用户 ${l} 从白名单中移除？移除后该用户将无法使用此 Bot。`,"移除白名单",{confirmButtonText:"确认移除",cancelButtonText:"取消",type:"warning"})}catch{return}try{await Q.removeAllowed(y,n,l),v.success(`用户 ${l} 已从白名单移除`),await ze()}catch{v.error("操作失败")}}et(async()=>{try{const d=await Fl.get(y);Y.value=d.data}catch{v.error("加载 Agent 失败")}yt(),pl(),Se(),k(),kt(),el(),ze(),await se();const n=H.query.tab;n&&(b.value=n);const l=H.query.resumeSession;l&&(le.value=l,await new Promise(w=>setTimeout(w,100)),B.value?.resumeSession(l),C.value.find(w=>w.id===l)||(le.value=l))});async function yt(){try{const[n,l]=await Promise.all([ge.read(y,"IDENTITY.md"),ge.read(y,"SOUL.md")]);_e.value=n.data?.content||"",be.value=l.data?.content||""}catch{}Pe()}async function Vl(n,l){try{await ge.write(y,n,l),v.success(`${n} 已保存`)}catch{v.error(`保存 ${n} 失败`)}}async function Pe(){try{const n=await Oe.tree(y);ke.value=n.data||[]}catch{ke.value=[]}}async function gt(n){if(!n.isDir){Z.value=n.path,Ne.value=n.path.split("/");try{const l=await Oe.readFile(y,n.path);te.value=l.data?.content||""}catch{te.value="(无法读取)"}}}async function _t(){if(Z.value){De.value=!0;try{await Oe.writeFile(y,Z.value,te.value),v.success("记忆文件已保存"),Pe()}catch{v.error("保存失败")}finally{De.value=!1}}}async function bt(){const n=xe.value.trim();if(!n){v.warning("请输入路径");return}try{await Oe.writeFile(y,n,`# ${n.split("/").pop()?.replace(".md","")||"New File"}

`),v.success("文件已创建"),pe.value=!1,xe.value="",Pe(),Z.value=n,Ne.value=n.split("/"),te.value=`# ${n.split("/").pop()?.replace(".md","")||"New File"}

`}catch{v.error("创建失败")}}async function wt(){const n=Ce.value.trim();if(!n){v.warning("请输入内容");return}try{await Oe.dailyLog(y,n),v.success("日志已添加"),ve.value=!1,Ce.value="",Pe()}catch{v.error("添加失败")}}async function kt(){try{const n=await ge.read(y,"/");Array.isArray(n.data)&&(Ge.value=n.data.map(l=>({name:l.name,isDir:l.isDir,size:l.size,modTime:l.modTime,path:l.name})))}catch{}}async function xt(n){if(!n.isDir){J.value=n.path||n.name,D.value=n;try{const l=await ge.read(y,J.value);F.value=l.data?.content||""}catch{F.value="(无法读取)"}}}async function Ct(){J.value&&await Vl(J.value,F.value)}async function el(){try{const n=await qe.list(y);Ml.value=n.data||[]}catch{}}async function Vt(){try{await qe.create({name:R.value.name,enabled:R.value.enabled,agentId:y,schedule:{kind:"cron",expr:R.value.expr,tz:R.value.tz},payload:{kind:"agentTurn",message:R.value.message},delivery:{mode:"announce"}}),v.success("任务创建成功"),Be.value=!1,el()}catch(n){v.error(n.response?.data?.error||"创建失败")}}async function ht(n){try{await qe.update(n.id,n)}catch{v.error("更新失败")}}async function Wl(n){try{await qe.run(n.id),v.success("已触发运行"),setTimeout(el,2e3)}catch{v.error("运行失败")}}async function zt(n){try{await qe.delete(n.id),v.success("已删除"),el()}catch{v.error("删除失败")}}const ll=r(!1),hl=r([]),zl=r(!1),$l=r(""),ue=r([]),Tl=r(0),tl=r(0),$t=dl(()=>ue.value.length<Tl.value),Re=r(!1);async function Kl(){ll.value=!0;try{const n=await Xl.list(y);hl.value=n.data}catch{v.error("加载对话渠道失败")}finally{ll.value=!1}}async function Tt(n){$l.value=n.channelId,ue.value=[],Tl.value=0,tl.value=0,zl.value=!0,await Ol()}async function Ol(){Re.value=!0;try{const l=(await Xl.messages(y,$l.value,{limit:so,offset:tl.value})).data;Tl.value=l.total,tl.value===0?ue.value=l.messages:ue.value=[...l.messages,...ue.value],tl.value+=l.messages.length}catch{v.error("加载消息失败")}finally{Re.value=!1}}async function Ut(){await Ol()}return Ll(b,n=>{n==="convlogs"&&hl.value.length===0&&Kl()}),(n,l)=>{const d=p("el-button"),w=p("el-tag"),j=p("el-text"),ce=p("el-header"),z=p("el-option"),ne=p("el-select"),N=p("el-input"),oe=p("el-tab-pane"),G=p("el-card"),W=p("el-col"),ye=p("el-row"),$=p("el-form-item"),je=p("el-form"),ql=p("el-badge"),E=p("el-table-column"),al=p("el-table"),We=p("el-switch"),It=p("el-input-number"),K=p("el-icon"),Yl=p("el-tree"),Ul=p("el-empty"),Hl=p("el-breadcrumb-item"),St=p("el-breadcrumb"),nl=p("el-dialog"),Lt=p("el-drawer"),At=p("el-link"),Ft=p("CircleCheck"),Dt=p("Warning"),Nt=p("CircleClose"),Jl=p("InfoFilled"),Gl=p("Link"),Mt=p("el-tabs"),Bt=p("el-main"),Et=p("el-container"),Il=Ht("loading");return u(),x(Et,{class:"agent-detail"},{default:t(()=>[e(ce,{class:"detail-header"},{default:t(()=>[o("div",Aa,[e(d,{icon:I(jt),onClick:l[0]||(l[0]=a=>n.$router.push("/agents")),circle:""},null,8,["icon"]),o("h2",null,m(Y.value?.name||"..."),1),e(w,{type:nt(Y.value?.status)},{default:t(()=>[s(m(ot(Y.value?.status)),1)]),_:1},8,["type"])]),e(j,{type:"info"},{default:t(()=>[s(m(Y.value?.model),1)]),_:1})]),_:1}),e(Bt,null,{default:t(()=>[e(Mt,{modelValue:b.value,"onUpdate:modelValue":l[45]||(l[45]=a=>b.value=a),type:"border-card"},{default:t(()=>[e(oe,{label:"对话",name:"chat"},{default:t(()=>[o("div",Fa,[o("div",Da,[o("div",Na,[l[47]||(l[47]=o("span",{class:"sidebar-title"},"历史对话",-1)),e(d,{size:"small",type:"primary",plain:"",onClick:de,icon:I(ol)},{default:t(()=>[...l[46]||(l[46]=[s("新建",-1)])]),_:1},8,["icon"])]),ul((u(),f("div",Ma,[(u(!0),f(M,null,X(C.value,a=>(u(),f("div",{key:a.id,class:Ye(["session-item",{active:le.value===a.id}]),onClick:_=>Te(a)},[o("div",Ea,m(a.title||"新对话"),1),o("div",Pa,[o("span",null,m(V(a.lastAt)),1),e(w,{size:"small",type:"info",effect:"plain",style:{"font-size":"10px",padding:"0 4px"}},{default:t(()=>[s(m(a.messageCount)+" 条 ",1)]),_:2},1024),a.tokenEstimate>6e4?(u(),x(w,{key:0,size:"small",type:"warning",effect:"plain",style:{"font-size":"10px",padding:"0 4px"}},{default:t(()=>[s("~"+m(Math.round(a.tokenEstimate/1e3))+"k",1)]),_:2},1024)):h("",!0)])],10,Ba))),128)),!P.value&&!C.value.length?(u(),f("div",Ra," 还没有对话记录 ")):h("",!0)])),[[Il,P.value]]),o("div",ja,[e(d,{size:"small",plain:"",class:"at-toggle-btn",onClick:He},{default:t(()=>[...l[48]||(l[48]=[o("span",{class:"at-icon"},"@",-1),s(" 其他成员 ",-1)])]),_:1}),ie.value?(u(),f("div",Wa,[e(ne,{modelValue:re.value,"onUpdate:modelValue":l[1]||(l[1]=a=>re.value=a),placeholder:"选择成员",size:"small",style:{width:"100%","margin-bottom":"6px"},onChange:Je},{default:t(()=>[(u(!0),f(M,null,X(O.value,a=>(u(),x(z,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),e(N,{modelValue:me.value,"onUpdate:modelValue":l[2]||(l[2]=a=>me.value=a),type:"textarea",rows:3,placeholder:"输入要转发的消息…",size:"small",style:{"margin-bottom":"6px"}},null,8,["modelValue"]),e(d,{type:"primary",size:"small",style:{width:"100%"},loading:Ie.value,disabled:!re.value||!me.value.trim(),onClick:ml},{default:t(()=>[...l[49]||(l[49]=[s(" 转发 ",-1)])]),_:1},8,["loading","disabled"])])):h("",!0)])]),o("div",Ka,[e(tt,{ref_key:"aiChatRef",ref:B,"agent-id":I(y),scenario:"agent-detail","welcome-message":`你好！我是 **${Y.value?.name||"AI"}**，有什么可以帮你的？`,height:"calc(100vh - 145px)","show-thinking":!0,onSessionChange:Ue},null,8,["agent-id","welcome-message"])])])]),_:1}),e(oe,{label:"身份 & 灵魂",name:"identity"},{default:t(()=>[e(ye,{gutter:20},{default:t(()=>[e(W,{span:12},{default:t(()=>[e(G,{header:"IDENTITY.md"},{default:t(()=>[e(N,{modelValue:_e.value,"onUpdate:modelValue":l[3]||(l[3]=a=>_e.value=a),type:"textarea",rows:15,onBlur:l[4]||(l[4]=a=>Vl("IDENTITY.md",_e.value))},null,8,["modelValue"])]),_:1})]),_:1}),e(W,{span:12},{default:t(()=>[e(G,{header:"SOUL.md"},{default:t(()=>[e(N,{modelValue:be.value,"onUpdate:modelValue":l[5]||(l[5]=a=>be.value=a),type:"textarea",rows:15,onBlur:l[6]||(l[6]=a=>Vl("SOUL.md",be.value))},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),e(oe,{label:"关系",name:"relations"},{default:t(()=>[e(ye,{gutter:20},{default:t(()=>[e(W,{span:14},{default:t(()=>[e(G,{style:{"margin-bottom":"16px"}},{header:t(()=>[...l[50]||(l[50]=[o("span",{style:{"font-weight":"600"}},"添加关系",-1)])]),default:t(()=>[e(je,{model:L.value,"label-position":"top",size:"default"},{default:t(()=>[e(ye,{gutter:12},{default:t(()=>[e(W,{span:10},{default:t(()=>[e($,{label:"关联成员"},{default:t(()=>[e(ne,{modelValue:L.value.agentId,"onUpdate:modelValue":l[7]||(l[7]=a=>L.value.agentId=a),placeholder:"选择系统成员",filterable:"",style:{width:"100%"},onChange:Qe},{default:t(()=>[(u(!0),f(M,null,X(O.value,a=>(u(),x(z,{key:a.id,label:a.name,value:a.id},{default:t(()=>[o("div",Oa,[o("div",{style:sl([{width:"24px",height:"24px","border-radius":"50%",display:"flex","align-items":"center","justify-content":"center","font-size":"11px",color:"#fff","flex-shrink":"0"},{background:cl(a.id)}])},m(a.name.charAt(0)),5),o("span",null,m(a.name),1)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(W,{span:7},{default:t(()=>[e($,{label:"关系类型"},{default:t(()=>[e(ne,{modelValue:L.value.relationType,"onUpdate:modelValue":l[8]||(l[8]=a=>L.value.relationType=a),style:{width:"100%"}},{default:t(()=>[e(z,{label:"上级",value:"上级"}),e(z,{label:"下级",value:"下级"}),e(z,{label:"平级协作",value:"平级协作"}),e(z,{label:"支持",value:"支持"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(W,{span:7},{default:t(()=>[e($,{label:"协作程度"},{default:t(()=>[e(ne,{modelValue:L.value.strength,"onUpdate:modelValue":l[9]||(l[9]=a=>L.value.strength=a),style:{width:"100%"}},{default:t(()=>[e(z,{label:"核心",value:"核心"}),e(z,{label:"常用",value:"常用"}),e(z,{label:"偶尔",value:"偶尔"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(ye,{gutter:12},{default:t(()=>[e(W,{span:18},{default:t(()=>[e($,{label:"说明（选填）"},{default:t(()=>[e(N,{modelValue:L.value.desc,"onUpdate:modelValue":l[10]||(l[10]=a=>L.value.desc=a),placeholder:"简要描述这段关系..."},null,8,["modelValue"])]),_:1})]),_:1}),e(W,{span:6},{default:t(()=>[e($,{label:" "},{default:t(()=>[e(d,{type:"primary",style:{width:"100%"},disabled:!L.value.agentId||!L.value.relationType||!L.value.strength,loading:fe.value,onClick:vl},{default:t(()=>[...l[51]||(l[51]=[s(" 添加 ",-1)])]),_:1},8,["disabled","loading"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),e(G,null,{header:t(()=>[o("span",qa,[l[52]||(l[52]=s("已有关系 ",-1)),e(ql,{value:S.value.length,type:"info",style:{"margin-left":"4px"}},null,8,["value"])])]),default:t(()=>[S.value.length===0?(u(),f("div",Ya," 暂无关系，请在上方添加 ")):(u(),x(al,{key:1,data:S.value,size:"small",style:{width:"100%"}},{default:t(()=>[e(E,{label:"成员","min-width":"120"},{default:t(({row:a})=>[o("div",Ha,[o("div",{style:sl([{width:"28px",height:"28px","border-radius":"50%",display:"flex","align-items":"center","justify-content":"center","font-size":"12px",color:"#fff","flex-shrink":"0"},{background:cl(a.agentId)}])},m(a.agentName.charAt(0)),5),o("span",Ja,m(a.agentName),1)])]),_:1}),e(E,{label:"类型",width:"100"},{default:t(({row:a})=>[e(w,{type:Dl(a.relationType),size:"small"},{default:t(()=>[s(m(a.relationType),1)]),_:2},1032,["type"])]),_:1}),e(E,{label:"程度",width:"80"},{default:t(({row:a})=>[e(w,{type:Nl(a.strength),size:"small",effect:"plain"},{default:t(()=>[s(m(a.strength),1)]),_:2},1032,["type"])]),_:1}),e(E,{label:"说明","min-width":"120","show-overflow-tooltip":""},{default:t(({row:a})=>[o("span",Ga,m(a.desc||"—"),1)]),_:1}),e(E,{label:"操作",width:"70",fixed:"right"},{default:t(({$index:a})=>[e(d,{type:"danger",link:"",size:"small",onClick:_=>fl(a)},{default:t(()=>[...l[53]||(l[53]=[s("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]))]),_:1})]),_:1}),e(W,{span:10},{default:t(()=>[e(G,{header:"关系预览"},{default:t(()=>[S.value.length===0?(u(),f("div",Qa," 暂无关系数据 ")):(u(),f("div",Xa,[(u(!0),f(M,null,X(S.value,a=>(u(),f("div",{key:a.agentId,class:"relation-card"},[o("div",{class:"relation-avatar",style:sl({background:cl(a.agentId)})},m(a.agentName.charAt(0).toUpperCase()),5),o("div",Za,[o("div",en,m(a.agentName),1),o("div",ln,[e(w,{type:Dl(a.relationType),size:"small"},{default:t(()=>[s(m(a.relationType),1)]),_:2},1032,["type"]),e(w,{type:Nl(a.strength),size:"small",effect:"plain"},{default:t(()=>[s(m(a.strength),1)]),_:2},1032,["type"])]),o("div",tn,m(a.desc),1)])]))),128))]))]),_:1})]),_:1})]),_:1})]),_:1}),e(oe,{label:"记忆",name:"memory"},{default:t(()=>[e(G,{style:{"margin-bottom":"16px"},shadow:"never"},{header:t(()=>[o("div",an,[l[54]||(l[54]=o("span",{style:{"font-weight":"600"}},"自动记忆",-1)),e(We,{modelValue:A.value.enabled,"onUpdate:modelValue":l[11]||(l[11]=a=>A.value.enabled=a),"active-text":"已开启","inactive-text":"已关闭",onChange:i},null,8,["modelValue"])])]),default:t(()=>[e(je,{model:A.value,"label-position":"top",size:"small",disabled:!A.value.enabled},{default:t(()=>[e(ye,{gutter:16},{default:t(()=>[e(W,{span:6},{default:t(()=>[e($,{label:"整理频率"},{default:t(()=>[e(ne,{modelValue:A.value.schedule,"onUpdate:modelValue":l[12]||(l[12]=a=>A.value.schedule=a),style:{width:"100%"}},{default:t(()=>[e(z,{label:"每小时",value:"hourly"}),e(z,{label:"每6小时",value:"every6h"}),e(z,{label:"每天",value:"daily"}),e(z,{label:"每周",value:"weekly"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(W,{span:5},{default:t(()=>[e($,{label:"每个会话保留轮数"},{default:t(()=>[e(It,{modelValue:A.value.keepTurns,"onUpdate:modelValue":l[13]||(l[13]=a=>A.value.keepTurns=a),min:1,max:20,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),e(W,{span:13},{default:t(()=>[e($,{label:"记录重点（留空则自动）"},{default:t(()=>[e(N,{modelValue:A.value.focusHint,"onUpdate:modelValue":l[14]||(l[14]=a=>A.value.focusHint=a),placeholder:"例如：记录数学解题步骤和用户常见错误"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),o("div",nn,[e(d,{type:"primary",size:"small",loading:Le.value,onClick:i},{default:t(()=>[...l[55]||(l[55]=[s(" 保存设置 ",-1)])]),_:1},8,["loading"]),e(d,{size:"small",loading:Ae.value,onClick:Fe},{default:t(()=>[...l[56]||(l[56]=[s(" 立即整理 ",-1)])]),_:1},8,["loading"]),e(j,{type:"info",size:"small",style:{"align-self":"center","margin-left":"4px"}},{default:t(()=>[s(" 整理后：LLM提炼摘要写入 MEMORY.md，每个会话只保留最近 "+m(A.value.keepTurns)+" 轮对话 ",1)]),_:1})])]),_:1},8,["model","disabled"])]),_:1}),e(G,{style:{"margin-bottom":"16px"},shadow:"never"},{header:t(()=>[o("div",on,[l[58]||(l[58]=o("span",{style:{"font-weight":"600"}},"整理日志",-1)),e(d,{size:"small",text:"",onClick:we,loading:q.value},{default:t(()=>[...l[57]||(l[57]=[s("刷新",-1)])]),_:1},8,["loading"])])]),default:t(()=>[U.value.length===0&&!q.value?(u(),f("div",sn," 暂无运行记录，点击「立即整理」触发第一次 ")):(u(),x(al,{key:1,data:U.value.slice(0,20),size:"small"},{default:t(()=>[e(E,{label:"时间",width:"160"},{default:t(({row:a})=>[o("span",un,m(El(a.timestamp)),1)]),_:1}),e(E,{label:"状态",width:"72"},{default:t(({row:a})=>[e(w,{type:a.status==="ok"?"success":"danger",size:"small"},{default:t(()=>[s(m(a.status),1)]),_:2},1032,["type"])]),_:1}),e(E,{label:"结果","min-width":"200","show-overflow-tooltip":""},{default:t(({row:a})=>[o("span",dn,m(a.message||"—"),1)]),_:1})]),_:1},8,["data"]))]),_:1}),o("div",rn,[e(d,{type:"primary",size:"small",onClick:l[15]||(l[15]=a=>pe.value=!0)},{default:t(()=>[e(K,null,{default:t(()=>[e(I(ol))]),_:1}),l[59]||(l[59]=s(" 新建文件 ",-1))]),_:1}),e(d,{size:"small",onClick:l[16]||(l[16]=a=>ve.value=!0)},{default:t(()=>[e(K,null,{default:t(()=>[e(I(Wt))]),_:1}),l[60]||(l[60]=s(" 添加日志 ",-1))]),_:1}),e(d,{size:"small",onClick:Pe},{default:t(()=>[e(K,null,{default:t(()=>[e(I(Al))]),_:1}),l[61]||(l[61]=s(" 刷新 ",-1))]),_:1})]),e(ye,{gutter:16},{default:t(()=>[e(W,{span:7},{default:t(()=>[e(G,{header:"记忆目录",shadow:"hover"},{default:t(()=>[e(Yl,{data:ke.value,props:{label:"name",children:"children",isLeaf:a=>!a.isDir},onNodeClick:gt,"highlight-current":"","default-expand-all":"","expand-on-click-node":!1},{default:t(({data:a})=>[o("span",mn,[a.isDir?(u(),x(K,{key:0,style:{color:"#E6A23C"}},{default:t(()=>[e(I(Kt))]),_:1})):(u(),x(K,{key:1,style:{color:"#409EFF"}},{default:t(()=>[e(I(Ot))]),_:1})),o("span",null,m(a.name),1),!a.isDir&&a.size?(u(),x(j,{key:2,type:"info",size:"small",style:{"margin-left":"auto"}},{default:t(()=>[s(m(Bl(a.size)),1)]),_:2},1024)):h("",!0)])]),_:1},8,["data","props"]),ke.value.length===0?(u(),x(Ul,{key:0,description:"记忆树为空","image-size":40})):h("",!0)]),_:1})]),_:1}),e(W,{span:17},{default:t(()=>[e(G,{shadow:"hover"},{header:t(()=>[o("div",pn,[e(St,{separator:"/"},{default:t(()=>[e(Hl,null,{default:t(()=>[...l[62]||(l[62]=[s("memory",-1)])]),_:1}),(u(!0),f(M,null,X(Ne.value,(a,_)=>(u(),x(Hl,{key:_},{default:t(()=>[s(m(a),1)]),_:2},1024))),128))]),_:1}),Z.value?(u(),x(d,{key:0,type:"primary",size:"small",onClick:_t,loading:De.value},{default:t(()=>[...l[63]||(l[63]=[s("保存",-1)])]),_:1},8,["loading"])):h("",!0)])]),default:t(()=>[Z.value?(u(),x(N,{key:0,modelValue:te.value,"onUpdate:modelValue":l[17]||(l[17]=a=>te.value=a),type:"textarea",rows:22,style:{"font-family":"monospace"}},null,8,["modelValue"])):(u(),x(Ul,{key:1,description:"点击左侧文件查看和编辑","image-size":60}))]),_:1})]),_:1})]),_:1}),e(nl,{modelValue:pe.value,"onUpdate:modelValue":l[20]||(l[20]=a=>pe.value=a),title:"新建记忆文件",width:"480px"},{footer:t(()=>[e(d,{onClick:l[19]||(l[19]=a=>pe.value=!1)},{default:t(()=>[...l[65]||(l[65]=[s("取消",-1)])]),_:1}),e(d,{type:"primary",onClick:bt},{default:t(()=>[...l[66]||(l[66]=[s("创建",-1)])]),_:1})]),default:t(()=>[e(je,{"label-width":"80px"},{default:t(()=>[e($,{label:"路径"},{default:t(()=>[e(N,{modelValue:xe.value,"onUpdate:modelValue":l[18]||(l[18]=a=>xe.value=a),placeholder:"例如: projects/my-project.md 或 topics/cooking.md"},null,8,["modelValue"]),e(j,{type:"info",size:"small",style:{"margin-top":"4px"}},{default:t(()=>[...l[64]||(l[64]=[s("相对于 memory/ 目录",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(nl,{modelValue:ve.value,"onUpdate:modelValue":l[23]||(l[23]=a=>ve.value=a),title:"添加今日日志",width:"600px"},{footer:t(()=>[e(d,{onClick:l[22]||(l[22]=a=>ve.value=!1)},{default:t(()=>[...l[67]||(l[67]=[s("取消",-1)])]),_:1}),e(d,{type:"primary",onClick:wt},{default:t(()=>[...l[68]||(l[68]=[s("提交",-1)])]),_:1})]),default:t(()=>[e(N,{modelValue:Ce.value,"onUpdate:modelValue":l[21]||(l[21]=a=>Ce.value=a),type:"textarea",rows:10,placeholder:"记录今天的重要事项、学习心得、待办..."},null,8,["modelValue"])]),_:1},8,["modelValue"])]),_:1}),e(oe,{label:"技能",name:"skills"},{default:t(()=>[e(La,{"agent-id":I(y)},null,8,["agent-id"])]),_:1}),e(oe,{label:"历史对话",name:"convlogs"},{default:t(()=>[o("div",vn,[l[69]||(l[69]=o("span",{style:{"font-weight":"600","font-size":"15px"}},"渠道对话记录",-1)),e(d,{size:"small",icon:I(Al),circle:"",onClick:Kl,loading:ll.value},null,8,["icon","loading"])]),ul((u(),x(al,{data:hl.value,stripe:"","empty-text":"暂无对话记录"},{default:t(()=>[e(E,{label:"渠道","min-width":"200"},{default:t(({row:a})=>[o("span",null,m(a.channelType==="telegram"?"Telegram":"Web")+" "+m(a.channelId),1)]),_:1}),e(E,{label:"消息数",width:"100"},{default:t(({row:a})=>[s(m(a.messageCount)+" 条",1)]),_:1}),e(E,{label:"最后活跃",width:"180"},{default:t(({row:a})=>[s(m(a.lastAt?new Date(a.lastAt).toLocaleString("zh-CN"):"-"),1)]),_:1}),e(E,{label:"操作",width:"100"},{default:t(({row:a})=>[e(d,{size:"small",type:"primary",plain:"",onClick:_=>Tt(a)},{default:t(()=>[...l[70]||(l[70]=[s("查看",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[Il,ll.value]]),e(Lt,{modelValue:zl.value,"onUpdate:modelValue":l[24]||(l[24]=a=>zl.value=a),title:$l.value+" 对话记录",direction:"rtl",size:"520px","destroy-on-close":!1},{default:t(()=>[o("div",fn,[$t.value?(u(),f("div",cn,[e(d,{size:"small",plain:"",loading:Re.value,onClick:Ut},{default:t(()=>[...l[71]||(l[71]=[s("加载更多",-1)])]),_:1},8,["loading"])])):h("",!0),ul((u(),f("div",yn,[(u(!0),f(M,null,X(ue.value,(a,_)=>(u(),f("div",{key:_,class:Ye(["conv-msg-item",a.role==="user"?"conv-msg-user":"conv-msg-assistant"])},[o("div",gn,[o("span",_n,m(a.role==="user"?"用户":"助手"),1),a.sender?(u(),f("span",bn,m(a.sender),1)):h("",!0),o("span",wn,m(a.ts?new Date(a.ts).toLocaleString("zh-CN"):""),1)]),o("div",kn,m(a.content),1)],2))),128)),!Re.value&&ue.value.length===0?(u(),f("div",xn," 暂无消息记录 ")):h("",!0)])),[[Il,Re.value&&ue.value.length===0]])])]),_:1},8,["modelValue","title"])]),_:1}),e(oe,{label:"工作区",name:"workspace"},{default:t(()=>[e(ye,{gutter:20},{default:t(()=>[e(W,{span:8},{default:t(()=>[e(G,{header:"文件列表"},{default:t(()=>[e(Yl,{data:Ge.value,props:{label:"name",children:"children"},onNodeClick:xt,"highlight-current":"","default-expand-all":""},null,8,["data"])]),_:1})]),_:1}),e(W,{span:16},{default:t(()=>[e(G,{header:J.value||"选择文件查看"},{default:t(()=>[J.value?(u(),f(M,{key:0},[e(N,{modelValue:F.value,"onUpdate:modelValue":l[25]||(l[25]=a=>F.value=a),type:"textarea",rows:20},null,8,["modelValue"]),o("div",Cn,[e(d,{type:"primary",onClick:Ct},{default:t(()=>[...l[72]||(l[72]=[s("保存",-1)])]),_:1}),D.value?(u(),x(j,{key:0,type:"info",size:"small"},{default:t(()=>[s(m(Bl(D.value.size))+" · "+m(st(D.value.modTime)),1)]),_:1})):h("",!0)])],64)):h("",!0)]),_:1},8,["header"])]),_:1})]),_:1})]),_:1}),e(oe,{label:"定时任务",name:"cron"},{default:t(()=>[e(d,{type:"primary",onClick:l[26]||(l[26]=a=>Be.value=!0),style:{"margin-bottom":"16px"}},{default:t(()=>[e(K,null,{default:t(()=>[e(I(ol))]),_:1}),l[73]||(l[73]=s(" 新建任务 ",-1))]),_:1}),e(al,{data:Ml.value,stripe:""},{default:t(()=>[e(E,{prop:"name",label:"名称"}),e(E,{label:"调度"},{default:t(({row:a})=>[s(m(a.schedule?.expr)+" ("+m(a.schedule?.tz)+")",1)]),_:1}),e(E,{label:"最近运行",width:"180"},{default:t(({row:a})=>[a.state?.lastRunAtMs?(u(),f(M,{key:0},[e(w,{type:a.state?.lastStatus==="ok"?"success":"danger",size:"small"},{default:t(()=>[s(m(a.state?.lastStatus),1)]),_:2},1032,["type"]),e(j,{type:"info",size:"small",style:{"margin-left":"4px"}},{default:t(()=>[s(m(El(a.state?.lastRunAtMs)),1)]),_:2},1024)],64)):(u(),x(j,{key:1,type:"info",size:"small"},{default:t(()=>[...l[74]||(l[74]=[s("未运行",-1)])]),_:1}))]),_:1}),e(E,{label:"启用",width:"80"},{default:t(({row:a})=>[e(We,{modelValue:a.enabled,"onUpdate:modelValue":_=>a.enabled=_,onChange:_=>ht(a)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),e(E,{label:"操作",width:"220"},{default:t(({row:a})=>[a.payload?.message==="__MEMORY_CONSOLIDATE__"?(u(),f(M,{key:0},[e(w,{type:"info",size:"small",style:{"margin-right":"8px"}},{default:t(()=>[...l[75]||(l[75]=[s("记忆管理",-1)])]),_:1}),e(d,{size:"small",onClick:_=>Wl(a)},{default:t(()=>[...l[76]||(l[76]=[s("立即运行",-1)])]),_:1},8,["onClick"])],64)):(u(),f(M,{key:1},[e(d,{size:"small",onClick:_=>Wl(a)},{default:t(()=>[...l[77]||(l[77]=[s("立即运行",-1)])]),_:1},8,["onClick"]),e(d,{size:"small",type:"danger",onClick:_=>zt(a)},{default:t(()=>[...l[78]||(l[78]=[s("删除",-1)])]),_:1},8,["onClick"])],64))]),_:1})]),_:1},8,["data"]),e(nl,{modelValue:Be.value,"onUpdate:modelValue":l[33]||(l[33]=a=>Be.value=a),title:"新建定时任务",width:"520px"},{footer:t(()=>[e(d,{onClick:l[32]||(l[32]=a=>Be.value=!1)},{default:t(()=>[...l[79]||(l[79]=[s("取消",-1)])]),_:1}),e(d,{type:"primary",onClick:Vt},{default:t(()=>[...l[80]||(l[80]=[s("创建",-1)])]),_:1})]),default:t(()=>[e(je,{model:R.value,"label-width":"100px"},{default:t(()=>[e($,{label:"名称"},{default:t(()=>[e(N,{modelValue:R.value.name,"onUpdate:modelValue":l[27]||(l[27]=a=>R.value.name=a)},null,8,["modelValue"])]),_:1}),e($,{label:"Cron 表达式"},{default:t(()=>[e(N,{modelValue:R.value.expr,"onUpdate:modelValue":l[28]||(l[28]=a=>R.value.expr=a),placeholder:"30 3 * * *"},null,8,["modelValue"])]),_:1}),e($,{label:"时区"},{default:t(()=>[e(ne,{modelValue:R.value.tz,"onUpdate:modelValue":l[29]||(l[29]=a=>R.value.tz=a)},{default:t(()=>[e(z,{label:"Asia/Shanghai",value:"Asia/Shanghai"}),e(z,{label:"UTC",value:"UTC"}),e(z,{label:"America/New_York",value:"America/New_York"})]),_:1},8,["modelValue"])]),_:1}),e($,{label:"消息"},{default:t(()=>[e(N,{modelValue:R.value.message,"onUpdate:modelValue":l[30]||(l[30]=a=>R.value.message=a),type:"textarea",rows:3},null,8,["modelValue"])]),_:1}),e($,{label:"启用"},{default:t(()=>[e(We,{modelValue:R.value.enabled,"onUpdate:modelValue":l[31]||(l[31]=a=>R.value.enabled=a)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])]),_:1}),e(oe,{label:"渠道",name:"channels"},{default:t(()=>[o("div",Vn,[e(j,{type:"info",size:"small"},{default:t(()=>[...l[81]||(l[81]=[s("每个 AI 成员独立配置自己的消息通道（如 Telegram Bot Token）",-1)])]),_:1}),e(d,{type:"primary",size:"small",onClick:it},{default:t(()=>[e(K,null,{default:t(()=>[e(I(ol))]),_:1}),l[82]||(l[82]=s(" 添加消息渠道 ",-1))]),_:1})]),(u(!0),f(M,null,X(ae.value,a=>(u(),f("div",{key:a.id,class:"channel-card"},[o("div",hn,[o("div",zn,[e(w,{size:"small",style:{"margin-right":"8px"}},{default:t(()=>[s(m(a.type),1)]),_:2},1024),o("span",$n,m(a.name),1),a.config?.botName?(u(),f("span",Tn,"@"+m(a.config.botName),1)):h("",!0),e(w,{type:a.status==="ok"?"success":a.status==="error"?"danger":"info",size:"small",effect:"plain",style:{"margin-left":"8px"}},{default:t(()=>[s(m(a.status==="ok"?"✓ 正常":a.status==="error"?"✗ 错误":"未测试"),1)]),_:2},1032,["type"])]),o("div",Un,[e(We,{modelValue:a.enabled,"onUpdate:modelValue":_=>a.enabled=_,size:"small",onChange:rt,style:{"margin-right":"8px"}},null,8,["modelValue","onUpdate:modelValue"]),e(d,{size:"small",onClick:_=>pt(a),loading:_l.value===a.id},{default:t(()=>[...l[83]||(l[83]=[s("测试连接",-1)])]),_:1},8,["onClick","loading"]),e(d,{size:"small",onClick:_=>ut(a)},{default:t(()=>[...l[84]||(l[84]=[s("编辑",-1)])]),_:1},8,["onClick"]),e(d,{size:"small",type:"danger",plain:"",onClick:_=>mt(a)},{default:t(()=>[...l[85]||(l[85]=[s("删除",-1)])]),_:1},8,["onClick"])])]),a.type==="web"?(u(),f("div",In,[o("div",Sn,[l[87]||(l[87]=o("span",{class:"channel-info-label"},"公开地址",-1)),o("span",Ln,[e(At,{href:he(I(y),a.id),target:"_blank",type:"primary",style:{"font-size":"13px"}},{default:t(()=>[s(m(he(I(y),a.id)),1)]),_:2},1032,["href"]),e(d,{size:"small",link:"",style:{"margin-left":"8px"},onClick:_=>Rl(he(I(y),a.id))},{default:t(()=>[...l[86]||(l[86]=[s("复制",-1)])]),_:1},8,["onClick"])])]),o("div",An,[l[88]||(l[88]=o("span",{class:"channel-info-label"},"访问密码",-1)),o("span",Fn,[e(w,{size:"small",type:a.config?.password?"warning":"info",effect:"plain"},{default:t(()=>[s(m(a.config?.password?"已设置":"无密码"),1)]),_:2},1032,["type"])])])])):h("",!0),a.type==="telegram"?(u(),f("div",Dn,[o("div",Nn,[l[90]||(l[90]=o("span",{class:"channel-info-label"},"白名单用户",-1)),o("span",Mn,[a.allowedFromUsers?.length?(u(!0),f(M,{key:0},X(a.allowedFromUsers,_=>(u(),x(w,{key:_.id,size:"small",closable:"","disable-transitions":!0,style:{"margin-right":"4px","margin-bottom":"4px"},onClose:Sl=>jl(a.id,_.id)},{default:t(()=>[s(m(_.username?"@"+_.username:_.firstName||String(_.id))+" ",1),o("span",Bn,"("+m(_.id)+")",1)]),_:2},1032,["onClose"]))),128)):a.config?.allowedFrom?(u(!0),f(M,{key:1},X(a.config.allowedFrom.split(","),_=>(u(),x(w,{key:_,size:"small",closable:"","disable-transitions":!0,style:{"margin-right":"4px","margin-bottom":"4px"},onClose:Sl=>jl(a.id,Number(_.trim()))},{default:t(()=>[s(m(_.trim()),1)]),_:2},1032,["onClose"]))),128)):(u(),x(j,{key:2,type:"warning",size:"small"},{default:t(()=>[...l[89]||(l[89]=[s("未设置（配对模式，向用户返回其 ID）",-1)])]),_:1}))])]),o("div",En,[o("div",{class:"pending-section-header",onClick:_=>vt(a.id)},[l[92]||(l[92]=o("span",null,"待审核用户",-1)),e(ql,{value:($e.value[a.id]||[]).length,hidden:!($e.value[a.id]||[]).length,type:"warning",style:{"margin-left":"6px"}},null,8,["value","hidden"]),e(d,{size:"small",link:"",onClick:lt(_=>Ze(a.id),["stop"]),style:{"margin-left":"8px"}},{default:t(()=>[...l[91]||(l[91]=[s("刷新",-1)])]),_:1},8,["onClick"]),e(K,{style:sl([{"margin-left":"4px",transition:"transform 0.2s"},{transform:Ee.value===a.id?"rotate(180deg)":""}])},{default:t(()=>[e(I(qt))]),_:1},8,["style"])],8,Pn),Ee.value===a.id?(u(),f("div",Rn,[xl.value[a.id]?(u(),f("div",jn,[e(j,{type:"info",size:"small"},{default:t(()=>[...l[93]||(l[93]=[s("加载中...",-1)])]),_:1})])):($e.value[a.id]||[]).length?(u(!0),f(M,{key:1},X($e.value[a.id],_=>(u(),f("div",{key:_.id,class:"pending-user-row"},[o("div",Wn,[o("span",Kn,m(_.firstName||"未知"),1),_.username?(u(),f("span",On,"@"+m(_.username),1)):h("",!0),o("span",qn,"ID: "+m(_.id),1),e(j,{type:"info",size:"small",style:{"margin-left":"8px"}},{default:t(()=>[s(m(V(_.lastSeen)),1)]),_:2},1024)]),o("div",Yn,[e(d,{size:"small",type:"success",plain:"",onClick:Sl=>ft(a.id,_.id),loading:Cl.value===`${a.id}-${_.id}`},{default:t(()=>[...l[94]||(l[94]=[s("加入白名单",-1)])]),_:1},8,["onClick","loading"]),e(d,{size:"small",type:"danger",plain:"",onClick:Sl=>ct(a.id,_.id)},{default:t(()=>[...l[95]||(l[95]=[s("忽略",-1)])]),_:1},8,["onClick"])])]))),128)):(u(),f("div",Hn," 暂无待审核用户。让用户向 Bot 发送 /start 即可出现在此处。 "))])):h("",!0)])])):h("",!0)]))),128)),!yl.value&&!ae.value.length?(u(),x(Ul,{key:0,description:"暂无消息渠道，点击「添加消息渠道」开始配置","image-size":80,style:{"margin-top":"40px"}})):h("",!0),e(nl,{modelValue:Ve.value,"onUpdate:modelValue":l[44]||(l[44]=a=>Ve.value=a),title:ee.value?"编辑消息渠道":"添加消息渠道",width:"540px"},{footer:t(()=>[e(d,{onClick:l[43]||(l[43]=a=>Ve.value=!1)},{default:t(()=>[...l[105]||(l[105]=[s("取消",-1)])]),_:1}),e(d,{type:"primary",onClick:dt,loading:gl.value},{default:t(()=>[...l[106]||(l[106]=[s("保存",-1)])]),_:1},8,["loading"])]),default:t(()=>[e(je,{model:c.value,"label-width":"120px"},{default:t(()=>[e($,{label:"类型",required:""},{default:t(()=>[e(ne,{modelValue:c.value.type,"onUpdate:modelValue":l[34]||(l[34]=a=>c.value.type=a),style:{width:"100%"}},{default:t(()=>[e(z,{label:"Telegram",value:"telegram"}),e(z,{label:"Web 聊天页",value:"web"}),e(z,{label:"iMessage",value:"imessage"}),e(z,{label:"WhatsApp",value:"whatsapp"})]),_:1},8,["modelValue"])]),_:1}),e($,{label:"名称",required:""},{default:t(()=>[e(N,{modelValue:c.value.name,"onUpdate:modelValue":l[35]||(l[35]=a=>c.value.name=a),placeholder:"如：客服 Bot"},null,8,["modelValue"])]),_:1}),c.value.type==="telegram"?(u(),f(M,{key:0},[e($,{label:"Bot Token",required:""},{default:t(()=>[o("div",Jn,[o("div",Gn,[e(N,{modelValue:c.value.botToken,"onUpdate:modelValue":l[36]||(l[36]=a=>c.value.botToken=a),type:"password","show-password":"",placeholder:"从 @BotFather 获取",style:{flex:"1"},status:T.value.status==="error"?"error":T.value.status==="ok"?"success":""},null,8,["modelValue","status"]),e(d,{size:"default",loading:T.value.loading,type:T.value.status==="ok"?"success":T.value.status==="error"?"danger":"default",onClick:Pl,disabled:!c.value.botToken||wl(c.value.botToken)},{default:t(()=>[...l[96]||(l[96]=[s("验证",-1)])]),_:1},8,["loading","type","disabled"])]),T.value.loading?(u(),f("div",Qn,[e(K,{class:"is-loading"},{default:t(()=>[e(I(Al))]),_:1}),l[97]||(l[97]=s(" 正在验证 Token… ",-1))])):T.value.status==="ok"?(u(),f("div",Xn,[e(K,{style:{"vertical-align":"-2px","margin-right":"4px"}},{default:t(()=>[e(Ft)]),_:1}),l[98]||(l[98]=s("Token 有效，Bot 名称：",-1)),o("b",null,"@"+m(T.value.botName),1)])):T.value.status==="duplicate"?(u(),f("div",Zn,[e(K,{style:{"vertical-align":"-2px","margin-right":"4px"}},{default:t(()=>[e(Dt)]),_:1}),l[99]||(l[99]=s("此 Token 已被成员「",-1)),o("b",null,m(T.value.usedBy),1),s("」的渠道「"+m(T.value.usedByCh)+"」使用 ",1)])):T.value.status==="error"?(u(),f("div",eo,[e(K,{style:{"vertical-align":"-2px","margin-right":"4px"}},{default:t(()=>[e(Nt)]),_:1}),s(m(T.value.error),1)])):(u(),f("div",lo,[e(j,{type:"info",size:"small"},{default:t(()=>[e(K,{style:{"vertical-align":"-2px","margin-right":"4px"}},{default:t(()=>[e(Jl)]),_:1}),l[100]||(l[100]=s("输入完成后自动验证，也可点右侧「验证」按钮手动触发",-1))]),_:1})]))])]),_:1}),e($,{label:"白名单用户"},{default:t(()=>[e(N,{modelValue:c.value.allowedFrom,"onUpdate:modelValue":l[37]||(l[37]=a=>c.value.allowedFrom=a),placeholder:"填入 Telegram 用户 ID，多个用逗号分隔"},null,8,["modelValue"]),e(j,{type:"info",size:"small",style:{display:"block","margin-top":"4px"}},{default:t(()=>[e(K,{style:{"vertical-align":"-2px","margin-right":"4px"}},{default:t(()=>[e(Jl)]),_:1}),l[101]||(l[101]=s("留空时 Bot 进入配对模式——向用户返回其 ID，引导联系管理员添加白名单 ",-1))]),_:1})]),_:1})],64)):h("",!0),c.value.type==="web"?(u(),f(M,{key:1},[ee.value?(u(),x($,{key:0,label:"访问链接"},{default:t(()=>[o("div",to,[e(K,{style:{"flex-shrink":"0",color:"#909399"}},{default:t(()=>[e(Gl)]),_:1}),o("span",ao,m(he(I(y),ee.value)),1),e(d,{size:"small",link:"",onClick:l[38]||(l[38]=a=>Rl(he(I(y),ee.value)))},{default:t(()=>[...l[102]||(l[102]=[s("复制",-1)])]),_:1})])]),_:1})):h("",!0),ee.value?h("",!0):(u(),x($,{key:1,label:"访问链接"},{default:t(()=>[o("div",no,[e(K,{style:{"flex-shrink":"0",color:"#909399"}},{default:t(()=>[e(Gl)]),_:1}),o("span",oo,m(he(I(y),Xe.value)),1),e(w,{size:"small",type:"info",effect:"plain"},{default:t(()=>[...l[103]||(l[103]=[s("保存后生效",-1)])]),_:1})]),e(j,{type:"info",size:"small",style:{display:"block","margin-top":"4px"}},{default:t(()=>[...l[104]||(l[104]=[s(" 每个 Web 渠道有独立链接，可同时开放多个入口 ",-1)])]),_:1})]),_:1})),e($,{label:"访问密码"},{default:t(()=>[e(N,{modelValue:c.value.webPassword,"onUpdate:modelValue":l[39]||(l[39]=a=>c.value.webPassword=a),type:"password","show-password":"",placeholder:"留空则无需密码"},null,8,["modelValue"])]),_:1}),e($,{label:"欢迎语"},{default:t(()=>[e(N,{modelValue:c.value.webWelcome,"onUpdate:modelValue":l[40]||(l[40]=a=>c.value.webWelcome=a),placeholder:"你好！有什么可以帮你的？"},null,8,["modelValue"])]),_:1}),e($,{label:"页面标题"},{default:t(()=>[e(N,{modelValue:c.value.webTitle,"onUpdate:modelValue":l[41]||(l[41]=a=>c.value.webTitle=a),placeholder:"AI 助手"},null,8,["modelValue"])]),_:1})],64)):h("",!0),e($,{label:"启用"},{default:t(()=>[e(We,{modelValue:c.value.enabled,"onUpdate:modelValue":l[42]||(l[42]=a=>c.value.enabled=a)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})}}}),vo=at(io,[["__scopeId","data-v-385962f3"]]);export{vo as default};
