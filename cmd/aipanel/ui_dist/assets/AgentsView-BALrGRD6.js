import{d as ue,h as re,c as m,f as n,a as t,w as s,i as q,k as c,l as y,g as k,r as u,o as i,e as a,F as x,j as I,p as $,v as A,q as pe,u as me,n as G,t as r,s as S,b as O,E as T}from"./index-C4eNWLrR.js";import{u as ce}from"./agents-D-Erp4sp.js";import{m as fe,c as ve,t as ye,s as _e,b as ge}from"./index-Crfy7OVn.js";import{_ as ke}from"./_plugin-vue_export-helper-DlAUqK2U.js";const xe={class:"agents-page"},Ie={style:{display:"flex","justify-content":"space-between","align-items":"center","margin-bottom":"20px"}},Ce={style:{display:"flex","align-items":"center",gap:"12px","margin-bottom":"12px"}},we={style:{flex:"1"}},Ve={style:{"font-weight":"600","font-size":"16px"}},be={style:{"margin-bottom":"12px"}},he={style:{display:"flex",gap:"8px","flex-wrap":"wrap"}},ze=["onClick"],$e={key:0,style:{"text-align":"center",padding:"20px"}},Ae={style:{display:"flex","align-items":"center",gap:"12px"}},Se={style:{flex:"1"}},Ue={style:{"font-weight":"600"}},Le={key:0,style:{"text-align":"center",padding:"20px"}},Re={style:{display:"flex","align-items":"center",gap:"12px"}},De={style:{flex:"1"}},Be={style:{"font-weight":"600"}},Ne={key:0,style:{"text-align":"center",padding:"20px"}},je={style:{display:"flex","align-items":"center",gap:"12px"}},Ee={style:{flex:"1"}},Fe={style:{"font-weight":"600"}},Me={key:0,style:{"text-align":"center",padding:"20px"}},Pe={style:{display:"flex","align-items":"center",gap:"12px"}},qe={style:{flex:"1"}},Oe={style:{"font-weight":"600"}},Te=ue({__name:"AgentsView",setup(We){const H=me(),V=ce(),v=k(!1),p=k(0),R=k(!1),J=["#409eff","#67c23a","#e6a23c","#f56c6c","#909399","#9b59b6","#1abc9c","#e74c3c"],o=pe({id:"",name:"",description:"",avatarColor:"#409eff",modelId:"",channelIds:[],toolIds:[],skillIds:[]}),D=k([]),B=k([]),N=k([]),j=k([]);re(()=>{V.fetchAll()});async function K(){p.value=0,Object.assign(o,{id:"",name:"",description:"",avatarColor:"#409eff",modelId:"",channelIds:[],toolIds:[],skillIds:[]});try{const[d,l,C,U]=await Promise.all([fe.list(),ve.list(),ye.list(),_e.list()]);D.value=d.data,B.value=l.data,N.value=C.data,j.value=U.data}catch{}v.value=!0}function Q(){(!o.id||o.id===W(o.name.slice(0,-1)))&&(o.id=W(o.name))}function W(d){return d.toLowerCase().replace(/[^a-z0-9\u4e00-\u9fff]+/g,"-").replace(/^-|-$/g,"").slice(0,30)}function X(){if(p.value===0&&(!o.name||!o.id)){T.warning("请填写名称和 ID");return}p.value++}function E(d,l){const C=d.indexOf(l);C===-1?d.push(l):d.splice(C,1)}async function Y(){R.value=!0;try{await ge.create({id:o.id,name:o.name,description:o.description,modelId:o.modelId,channelIds:o.channelIds,toolIds:o.toolIds,skillIds:o.skillIds,avatarColor:o.avatarColor}),T.success("Agent 创建成功！"),v.value=!1,V.fetchAll(),H.push(`/agents/${o.id}`)}catch(d){T.error(d.response?.data?.error||"创建失败")}finally{R.value=!1}}function Z(d){return d==="running"?"success":d==="stopped"?"danger":"info"}function ee(d){return d==="running"?"运行中":d==="stopped"?"已停止":"空闲"}return(d,l)=>{const C=u("Plus"),U=u("el-icon"),f=u("el-button"),w=u("el-text"),g=u("el-tag"),le=u("ChatDotRound"),b=u("el-card"),te=u("el-col"),se=u("el-row"),h=u("el-empty"),z=u("el-step"),oe=u("el-steps"),F=u("el-input"),L=u("el-form-item"),ne=u("el-form"),ie=u("el-radio"),ae=u("el-radio-group"),M=u("el-checkbox"),P=u("el-checkbox-group"),de=u("el-dialog");return i(),m("div",xe,[n("div",Ie,[l[18]||(l[18]=n("h2",{style:{margin:"0"}},"AI 员工",-1)),t(f,{type:"primary",onClick:K},{default:s(()=>[t(U,null,{default:s(()=>[t(C)]),_:1}),l[17]||(l[17]=a(" 新建 Agent ",-1))]),_:1})]),t(se,{gutter:16},{default:s(()=>[(i(!0),m(x,null,I(q(V).list,e=>(i(),c(te,{span:8,key:e.id},{default:s(()=>[t(b,{class:"agent-card",shadow:"hover"},{default:s(()=>[n("div",Ce,[n("div",{class:"avatar-circle",style:G({background:e.avatarColor||"#409eff"})},r(e.name.charAt(0)),5),n("div",we,[n("div",Ve,r(e.name),1),t(w,{type:"info",size:"small"},{default:s(()=>[a(r(e.id),1)]),_:2},1024)]),t(g,{type:Z(e.status),size:"small"},{default:s(()=>[a(r(ee(e.status)),1)]),_:2},1032,["type"])]),n("div",be,[t(g,{size:"small",type:"info",style:{"margin-right":"4px"}},{default:s(()=>[a(r(e.modelId||e.model||"未配置"),1)]),_:2},1024),(i(!0),m(x,null,I(e.channelIds||[],_=>(i(),c(g,{key:_,size:"small",style:{"margin-right":"4px"}},{default:s(()=>[a(r(_),1)]),_:2},1024))),128))]),e.description?(i(),c(w,{key:0,type:"info",size:"small",style:{display:"block","margin-bottom":"12px"}},{default:s(()=>[a(r(e.description),1)]),_:2},1024)):y("",!0),t(f,{type:"primary",style:{width:"100%"},onClick:_=>d.$router.push(`/agents/${e.id}`)},{default:s(()=>[t(U,null,{default:s(()=>[t(le)]),_:1}),l[19]||(l[19]=a(" 进入 ",-1))]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1}),!q(V).loading&&q(V).list.length===0?(i(),c(h,{key:0,description:"暂无 AI 员工，点击「新建 Agent」开始"})):y("",!0),t(de,{modelValue:v.value,"onUpdate:modelValue":l[16]||(l[16]=e=>v.value=e),title:"新建 AI 员工",width:"680px","close-on-click-modal":!1},{footer:s(()=>[p.value>0?(i(),c(f,{key:0,onClick:l[15]||(l[15]=e=>p.value--)},{default:s(()=>[...l[25]||(l[25]=[a("上一步",-1)])]),_:1})):y("",!0),p.value<4?(i(),c(f,{key:1,type:"primary",onClick:X},{default:s(()=>[...l[26]||(l[26]=[a(" 下一步 ",-1)])]),_:1})):y("",!0),p.value===4?(i(),c(f,{key:2,type:"primary",onClick:Y,loading:R.value},{default:s(()=>[...l[27]||(l[27]=[a(" 创建 Agent ",-1)])]),_:1},8,["loading"])):y("",!0)]),default:s(()=>[t(oe,{active:p.value,"finish-status":"success",simple:"",style:{"margin-bottom":"24px"}},{default:s(()=>[t(z,{title:"基本信息"}),t(z,{title:"选择模型"}),t(z,{title:"消息通道"}),t(z,{title:"开启能力"}),t(z,{title:"安装 Skills"})]),_:1},8,["active"]),$(n("div",null,[t(ne,{model:o,"label-width":"90px"},{default:s(()=>[t(L,{label:"名称",required:""},{default:s(()=>[t(F,{modelValue:o.name,"onUpdate:modelValue":l[0]||(l[0]=e=>o.name=e),placeholder:"如：数据分析师",onInput:Q},null,8,["modelValue"])]),_:1}),t(L,{label:"ID"},{default:s(()=>[t(F,{modelValue:o.id,"onUpdate:modelValue":l[1]||(l[1]=e=>o.id=e),placeholder:"英文标识"},null,8,["modelValue"])]),_:1}),t(L,{label:"描述"},{default:s(()=>[t(F,{modelValue:o.description,"onUpdate:modelValue":l[2]||(l[2]=e=>o.description=e),type:"textarea",rows:2,placeholder:"简短描述这个 Agent 的职责"},null,8,["modelValue"])]),_:1}),t(L,{label:"头像颜色"},{default:s(()=>[n("div",he,[(i(),m(x,null,I(J,e=>n("div",{key:e,class:S(["color-swatch",{active:o.avatarColor===e}]),style:G({background:e}),onClick:_=>o.avatarColor=e},null,14,ze)),64))])]),_:1})]),_:1},8,["model"])],512),[[A,p.value===0]]),$(n("div",null,[D.value.length===0?(i(),m("div",$e,[t(h,{description:"暂无已配置模型","image-size":60}),t(f,{type:"primary",onClick:l[3]||(l[3]=e=>{d.$router.push("/config/models"),v.value=!1})},{default:s(()=>[...l[20]||(l[20]=[a(" 前往配置模型 ",-1)])]),_:1})])):y("",!0),t(ae,{modelValue:o.modelId,"onUpdate:modelValue":l[4]||(l[4]=e=>o.modelId=e),style:{width:"100%"}},{default:s(()=>[(i(!0),m(x,null,I(D.value,e=>(i(),c(b,{key:e.id,shadow:"hover",class:S(["select-card",{selected:o.modelId===e.id}]),onClick:_=>o.modelId=e.id},{default:s(()=>[n("div",Ae,[t(ie,{value:e.id,style:{"margin-right":"0"}},null,8,["value"]),n("div",Se,[n("div",Ue,r(e.name),1),t(w,{type:"info",size:"small"},{default:s(()=>[a(r(e.provider)+" / "+r(e.model),1)]),_:2},1024)]),t(g,{type:e.status==="ok"?"success":e.status==="error"?"danger":"info",size:"small"},{default:s(()=>[a(r(e.status==="ok"?"✓ 已配置":e.status==="error"?"✗ 错误":"? 未测试"),1)]),_:2},1032,["type"])])]),_:2},1032,["class","onClick"]))),128))]),_:1},8,["modelValue"]),t(f,{link:"",type:"primary",style:{"margin-top":"12px"},onClick:l[5]||(l[5]=e=>{d.$router.push("/config/models"),v.value=!1})},{default:s(()=>[...l[21]||(l[21]=[a(" + 配置新模型 ",-1)])]),_:1})],512),[[A,p.value===1]]),$(n("div",null,[B.value.length===0?(i(),m("div",Le,[t(h,{description:"暂无消息通道（可跳过）","image-size":60}),t(f,{link:"",type:"primary",onClick:l[6]||(l[6]=e=>{d.$router.push("/config/channels"),v.value=!1})},{default:s(()=>[...l[22]||(l[22]=[a(" 前往添加通道 ",-1)])]),_:1})])):y("",!0),t(P,{modelValue:o.channelIds,"onUpdate:modelValue":l[8]||(l[8]=e=>o.channelIds=e)},{default:s(()=>[(i(!0),m(x,null,I(B.value,e=>(i(),c(b,{key:e.id,shadow:"hover",class:S(["select-card",{selected:o.channelIds.includes(e.id)}]),onClick:_=>E(o.channelIds,e.id)},{default:s(()=>[n("div",Re,[t(M,{value:e.id,onClick:l[7]||(l[7]=O(()=>{},["stop"]))},null,8,["value"]),n("div",De,[n("div",Be,r(e.name),1),t(w,{type:"info",size:"small"},{default:s(()=>[a(r(e.type),1)]),_:2},1024)]),t(g,{type:e.enabled?"success":"info",size:"small"},{default:s(()=>[a(r(e.enabled?"启用":"停用"),1)]),_:2},1032,["type"])])]),_:2},1032,["class","onClick"]))),128))]),_:1},8,["modelValue"])],512),[[A,p.value===2]]),$(n("div",null,[N.value.length===0?(i(),m("div",Ne,[t(h,{description:"暂无能力配置（可跳过）","image-size":60}),t(f,{link:"",type:"primary",onClick:l[9]||(l[9]=e=>{d.$router.push("/config/tools"),v.value=!1})},{default:s(()=>[...l[23]||(l[23]=[a(" 前往添加能力 ",-1)])]),_:1})])):y("",!0),t(P,{modelValue:o.toolIds,"onUpdate:modelValue":l[11]||(l[11]=e=>o.toolIds=e)},{default:s(()=>[(i(!0),m(x,null,I(N.value,e=>(i(),c(b,{key:e.id,shadow:"hover",class:S(["select-card",{selected:o.toolIds.includes(e.id)}]),onClick:_=>E(o.toolIds,e.id)},{default:s(()=>[n("div",je,[t(M,{value:e.id,onClick:l[10]||(l[10]=O(()=>{},["stop"]))},null,8,["value"]),n("div",Ee,[n("div",Fe,r(e.name),1),t(w,{type:"info",size:"small"},{default:s(()=>[a(r(e.type),1)]),_:2},1024)]),t(g,{type:e.status==="ok"?"success":"info",size:"small"},{default:s(()=>[a(r(e.status==="ok"?"✓":"?"),1)]),_:2},1032,["type"])])]),_:2},1032,["class","onClick"]))),128))]),_:1},8,["modelValue"])],512),[[A,p.value===3]]),$(n("div",null,[j.value.length===0?(i(),m("div",Me,[t(h,{description:"暂无已安装 Skills（可跳过）","image-size":60}),t(f,{link:"",type:"primary",onClick:l[12]||(l[12]=e=>{d.$router.push("/config/skills"),v.value=!1})},{default:s(()=>[...l[24]||(l[24]=[a(" 前往安装 Skill ",-1)])]),_:1})])):y("",!0),t(P,{modelValue:o.skillIds,"onUpdate:modelValue":l[14]||(l[14]=e=>o.skillIds=e)},{default:s(()=>[(i(!0),m(x,null,I(j.value,e=>(i(),c(b,{key:e.id,shadow:"hover",class:S(["select-card",{selected:o.skillIds.includes(e.id)}]),onClick:_=>E(o.skillIds,e.id)},{default:s(()=>[n("div",Pe,[t(M,{value:e.id,onClick:l[13]||(l[13]=O(()=>{},["stop"]))},null,8,["value"]),n("div",qe,[n("div",Oe,r(e.name),1),t(w,{type:"info",size:"small"},{default:s(()=>[a(r(e.description),1)]),_:2},1024)]),t(g,{size:"small",type:"info"},{default:s(()=>[a("v"+r(e.version),1)]),_:2},1024)])]),_:2},1032,["class","onClick"]))),128))]),_:1},8,["modelValue"])],512),[[A,p.value===4]])]),_:1},8,["modelValue"])])}}}),Qe=ke(Te,[["__scopeId","data-v-6c88ff31"]]);export{Qe as default};
