import{d as Z,h as tt,c as f,b as e,a as p,w as g,m as et,i as P,j as D,g as M,E as st,r as y,L as ot,o as c,f as x,F as L,l as T,t as _,n as nt,x as B,u as lt}from"./index-BDtXQ_Sq.js";import{r as at}from"./index-Do6KhBZp.js";import{_ as it}from"./_plugin-vue_export-helper-DlAUqK2U.js";const rt={class:"team-view"},ct={class:"page-header"},dt={key:0,class:"empty-state"},ut={key:1,class:"empty-state"},ft=["height"],pt=["x1","y1","x2","y2","stroke-width","onMouseenter"],mt=["transform","onClick"],vt=["fill"],gt={"text-anchor":"middle","dominant-baseline":"central",fill:"#fff","font-weight":"700","font-size":"15","font-family":"system-ui, sans-serif"},ht=["fill"],yt={"text-anchor":"middle",y:"46","font-size":"12",fill:"#303133","font-family":"system-ui, sans-serif","paint-order":"stroke",stroke:"#f5f7fa","stroke-width":"3"},_t={"text-anchor":"middle",y:"58","font-size":"10",fill:"#909399","font-family":"system-ui, monospace"},xt={class:"tooltip-members"},kt={class:"tooltip-name"},bt={class:"tooltip-name"},wt={class:"tooltip-tags"},Ct={key:0,class:"tooltip-label"},At={class:"legend"},Et={class:"legend-item"},Mt={class:"legend-item"},zt={width:"28",height:"8"},Dt=["stroke-width"],z=820,Lt=28,j=150,N=80,I=80,Tt=Z({__name:"TeamView",setup(Bt){const W=lt(),R=M(),w=M(!1),m=M({nodes:[],edges:[]}),F={核心:4,常用:2.5,偶尔:1.5};function U(s,t){const o={};s.forEach(a=>{o[a.id]=0});const r=s.length+2;for(let a=0;a<r;a++){let u=!1;for(const i of t){const k=o[i.from]??0,b=o[i.to]??0;if(i.type==="上级"){const h=k-1;b>h&&(o[i.to]=h,u=!0)}else if(i.type==="下级"){const h=k+1;b<h&&(o[i.to]=h,u=!0)}}if(!u)break}const d=Object.values(o),l=d.length?Math.min(...d):0;return s.forEach(a=>{o[a.id]=(o[a.id]??0)-l}),o}const V=B(()=>U(m.value.nodes,m.value.edges)),H=B(()=>{const s=Object.values(V.value).reduce((t,o)=>Math.max(t,o),0);return Math.max(400,N+s*j+140)}),X=B(()=>{const s=m.value.nodes,t=V.value,o={};s.forEach(d=>{const l=t[d.id]??0;o[l]||(o[l]=[]),o[l].push(d.id)});const r={};for(const[d,l]of Object.entries(o)){const a=Number(d),u=N+a*j,i=z-I*2,k=l.length>1?i/(l.length-1):0;l.forEach((b,h)=>{const n=l.length===1?z/2:I+h*k;r[b]={x:Math.round(n),y:Math.round(u)}})}return r});function A(s){return X.value[s]??{x:z/2,y:N}}function E(s,t,o){const r=A(s),d=A(t),l=d.x-r.x,a=d.y-r.y,u=Math.sqrt(l*l+a*a)||1,i=Lt+3;return o==="start"?{x:r.x+l/u*i,y:r.y+a/u*i}:{x:d.x-l/u*i,y:d.y-a/u*i}}function q(s){return F[s]??1.5}const O=["#409EFF","#67C23A","#E6A23C","#F56C6C","#7C3AED","#0891B2","#B45309","#64748B"];function G(s){let t=0;for(let o=0;o<s.length;o++)t=s.charCodeAt(o)+((t<<5)-t);return O[Math.abs(t)%O.length]??"#409EFF"}function Y(s){return(s||"?").charAt(0).toUpperCase()}function S(s){return m.value.nodes.find(t=>t.id===s)?.name??s}function J(s){W.push(`/agents/${s}`)}const v=M({visible:!1,x:0,y:0,type:"",strength:"",label:"",from:"",to:""});function K(s,t){const o=R.value?.getBoundingClientRect();o&&(v.value={visible:!0,x:s.clientX-o.left+14,y:s.clientY-o.top-10,type:t.type,strength:t.strength,label:t.label,from:t.from,to:t.to})}function Q(){v.value.visible=!1}async function $(){w.value=!0;try{const s=await at.graph();m.value=s.data}catch{st.error("加载图谱失败")}finally{w.value=!1}}return tt($),(s,t)=>{const o=y("Refresh"),r=y("el-icon"),d=y("el-button"),l=y("Share"),a=y("Connection"),u=y("el-tag"),i=y("el-card"),k=y("ArrowUp"),b=y("ArrowDown"),h=ot("loading");return c(),f("div",rt,[e("div",ct,[t[1]||(t[1]=e("h2",null,"团队关系图谱",-1)),p(d,{size:"small",onClick:$},{default:g(()=>[p(r,null,{default:g(()=>[p(o)]),_:1}),t[0]||(t[0]=x(" 刷新 ",-1))]),_:1})]),et((c(),P(i,{class:"graph-card"},{default:g(()=>[!w.value&&!m.value.nodes.length?(c(),f("div",dt,[p(r,{style:{"font-size":"64px",color:"#c0c4cc",display:"block",margin:"0 auto 16px"}},{default:g(()=>[p(l)]),_:1}),t[2]||(t[2]=e("p",{style:{color:"#909399","text-align":"center",margin:"0"}},"暂无成员数据",-1))])):!w.value&&m.value.nodes.length&&!m.value.edges.length?(c(),f("div",ut,[p(r,{style:{"font-size":"64px",color:"#c0c4cc",display:"block",margin:"0 auto 16px"}},{default:g(()=>[p(a)]),_:1}),t[3]||(t[3]=e("p",{style:{color:"#909399","text-align":"center",margin:"0"}},"为成员配置 RELATIONS.md 即可自动生成关系图谱",-1)),t[4]||(t[4]=e("p",{style:{color:"#c0c4cc","text-align":"center","font-size":"13px",margin:"6px 0 0"}}," 前往成员详情页 → 「关系」Tab 编辑 ",-1))])):(c(),f("div",{key:2,class:"graph-container",ref_key:"containerRef",ref:R},[(c(),f("svg",{width:z,height:H.value,class:"graph-svg"},[(c(!0),f(L,null,T(m.value.edges,n=>(c(),f("g",{key:`${n.from}-${n.to}`},[e("line",{x1:E(n.from,n.to,"start").x,y1:E(n.from,n.to,"start").y,x2:E(n.from,n.to,"end").x,y2:E(n.from,n.to,"end").y,stroke:"#94a3b8","stroke-width":q(n.strength),"stroke-opacity":"0.6","stroke-linecap":"round",class:"graph-edge",onMouseenter:C=>K(C,n),onMouseleave:Q},null,40,pt)]))),128)),(c(!0),f(L,null,T(m.value.nodes,n=>(c(),f("g",{key:n.id,transform:`translate(${A(n.id).x}, ${A(n.id).y})`,class:"graph-node",onClick:C=>J(n.id)},[t[5]||(t[5]=e("circle",{r:"30",fill:"rgba(0,0,0,0.07)",transform:"translate(2,3)"},null,-1)),e("circle",{r:"28",fill:G(n.id),stroke:"#fff","stroke-width":"2.5"},null,8,vt),e("text",gt,_(Y(n.id)),1),e("circle",{cx:"20",cy:"-20",r:"6",fill:n.status==="running"?"#67C23A":"#c0c4cc",stroke:"#fff","stroke-width":"1.5"},null,8,ht),e("text",yt,_(n.name),1),e("text",_t,_(n.id),1)],8,mt))),128))],8,ft)),v.value.visible?(c(),f("div",{key:0,class:"edge-tooltip",style:nt({left:v.value.x+"px",top:v.value.y+"px"})},[e("div",xt,[e("span",kt,_(S(v.value.from)),1),t[6]||(t[6]=e("span",{class:"tooltip-sep"},"↔",-1)),e("span",bt,_(S(v.value.to)),1)]),e("div",wt,[p(u,{size:"small",type:"info",effect:"plain"},{default:g(()=>[x(_(v.value.type),1)]),_:1}),p(u,{size:"small",effect:"plain"},{default:g(()=>[x(_(v.value.strength),1)]),_:1})]),v.value.label?(c(),f("div",Ct,_(v.value.label),1)):D("",!0)],4)):D("",!0)],512))]),_:1})),[[h,w.value]]),m.value.nodes.length?(c(),P(i,{key:0,class:"legend-card"},{default:g(()=>[e("div",At,[t[9]||(t[9]=e("span",{class:"legend-title"},"布局规则：",-1)),e("span",Et,[p(r,null,{default:g(()=>[p(k)]),_:1}),t[7]||(t[7]=x(" 上方 = 上级",-1))]),t[10]||(t[10]=e("span",{class:"legend-item"},"— 同层 = 平级协作",-1)),e("span",Mt,[p(r,null,{default:g(()=>[p(b)]),_:1}),t[8]||(t[8]=x(" 下方 = 下级",-1))]),t[11]||(t[11]=e("span",{class:"legend-divider"}," | ",-1)),t[12]||(t[12]=e("span",{class:"legend-title"},"线粗：",-1)),(c(),f(L,null,T(F,(n,C)=>e("span",{key:C,class:"legend-item"},[(c(),f("svg",zt,[e("line",{x1:"0",y1:"4",x2:"28",y2:"4",stroke:"#64748b","stroke-width":n,"stroke-linecap":"round"},null,8,Dt)])),x(" "+_(C),1)])),64)),t[13]||(t[13]=e("span",{class:"legend-divider"}," | ",-1)),t[14]||(t[14]=e("span",{class:"legend-item"},[e("svg",{width:"12",height:"12"},[e("circle",{cx:"6",cy:"6",r:"5",fill:"#67C23A"})]),x(" 运行中 ")],-1)),t[15]||(t[15]=e("span",{class:"legend-item"},[e("svg",{width:"12",height:"12"},[e("circle",{cx:"6",cy:"6",r:"5",fill:"#c0c4cc"})]),x(" 空闲 ")],-1))])]),_:1})):D("",!0)])}}}),Vt=it(Tt,[["__scopeId","data-v-a43fe0a5"]]);export{Vt as default};
