import{d as pe,i as me,c as m,b as n,a as l,w as o,l as R,j as f,k as v,e as x,r,o as a,h as d,F as C,m as I,p as z,v as A,q as ce,u as fe,n as H,t as u,f as U,s as D,E as S,x as ye}from"./index-CV4GoklC.js";import{u as ve}from"./agents-6yym_KlU.js";import{b as J}from"./index-CDWofbfP.js";import{_ as _e}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ge={class:"agents-page"},ke={style:{display:"flex","justify-content":"space-between","align-items":"center","margin-bottom":"20px"}},xe={style:{display:"flex","align-items":"center",gap:"12px","margin-bottom":"12px"}},Ce={style:{flex:"1"}},Ie={style:{"font-weight":"600","font-size":"16px"}},we={style:{"margin-bottom":"12px"}},Ve={style:{display:"flex",gap:"8px"}},be={style:{display:"flex",gap:"8px","flex-wrap":"wrap"}},he=["onClick"],$e={key:0,style:{"text-align":"center",padding:"20px"}},ze={style:{display:"flex","align-items":"center",gap:"12px"}},Ae={style:{flex:"1"}},De={style:{"font-weight":"600"}},Se={key:0,style:{"text-align":"center",padding:"20px"}},Be={style:{display:"flex","align-items":"center",gap:"12px"}},Ue={style:{flex:"1"}},Le={style:{"font-weight":"600"}},Ee={key:0,style:{"text-align":"center",padding:"20px"}},Me={style:{display:"flex","align-items":"center",gap:"12px"}},Ne={style:{flex:"1"}},Te={style:{"font-weight":"600"}},Fe={key:0,style:{"text-align":"center",padding:"20px"}},Re={style:{display:"flex","align-items":"center",gap:"12px"}},je={style:{flex:"1"}},qe={style:{"font-weight":"600"}},Pe=pe({__name:"AgentsView",setup(Oe){const K=fe(),w=ve(),_=x(!1),p=x(0),L=x(!1),Q=["#409eff","#67c23a","#e6a23c","#f56c6c","#909399","#9b59b6","#1abc9c","#e74c3c"],s=ce({id:"",name:"",description:"",avatarColor:"#409eff",modelId:"",channelIds:[],toolIds:[],skillIds:[]}),j=x([]),q=x([]),P=x([]),O=x([]);me(()=>{w.fetchAll()});function W(){(!s.id||s.id===G(s.name.slice(0,-1)))&&(s.id=G(s.name))}function G(i){return i.toLowerCase().replace(/[^a-z0-9\u4e00-\u9fff]+/g,"-").replace(/^-|-$/g,"").slice(0,30)}function X(){if(p.value===0&&(!s.name||!s.id)){S.warning("请填写名称和 ID");return}p.value++}function E(i,t){const g=i.indexOf(t);g===-1?i.push(t):i.splice(g,1)}async function Y(){L.value=!0;try{await J.create({id:s.id,name:s.name,description:s.description,modelId:s.modelId,channelIds:s.channelIds,toolIds:s.toolIds,skillIds:s.skillIds,avatarColor:s.avatarColor}),S.success("Agent 创建成功！"),_.value=!1,w.fetchAll(),K.push(`/agents/${s.id}`)}catch(i){S.error(i.response?.data?.error||"创建失败")}finally{L.value=!1}}function Z(i){return i==="running"?"success":i==="stopped"?"danger":"info"}function ee(i){return i==="running"?"运行中":i==="stopped"?"已停止":"空闲"}async function te(i,t){try{await ye.confirm(`删除成员「${t}」将同时删除其工作区、对话记录和所有配置，且无法恢复。确认吗？`,"删除 AI 成员",{confirmButtonText:"确认删除",cancelButtonText:"取消",type:"warning",confirmButtonClass:"el-button--danger"})}catch{return}try{await J.delete(i),S.success(`已删除「${t}」`),await w.fetchAll()}catch(g){S.error("删除失败："+(g?.response?.data?.error??g?.message??"未知错误"))}}return(i,t)=>{const g=r("Plus"),M=r("el-icon"),c=r("el-button"),V=r("el-text"),k=r("el-tag"),le=r("ChatDotRound"),oe=r("Delete"),b=r("el-card"),se=r("el-col"),ne=r("el-row"),h=r("el-empty"),$=r("el-step"),ie=r("el-steps"),N=r("el-input"),B=r("el-form-item"),ae=r("el-form"),de=r("el-radio"),re=r("el-radio-group"),T=r("el-checkbox"),F=r("el-checkbox-group"),ue=r("el-dialog");return a(),m("div",ge,[n("div",ke,[t[19]||(t[19]=n("h2",{style:{margin:"0"}},"AI 成员",-1)),l(c,{type:"primary",onClick:t[0]||(t[0]=e=>i.$router.push("/agents/new"))},{default:o(()=>[l(M,null,{default:o(()=>[l(g)]),_:1}),t[18]||(t[18]=d(" 新建 Agent ",-1))]),_:1})]),l(ne,{gutter:16},{default:o(()=>[(a(!0),m(C,null,I(R(w).list,e=>(a(),f(se,{span:8,key:e.id},{default:o(()=>[l(b,{class:"agent-card",shadow:"hover"},{default:o(()=>[n("div",xe,[n("div",{class:"avatar-circle",style:H({background:e.avatarColor||"#409eff"})},u(e.name.charAt(0)),5),n("div",Ce,[n("div",Ie,u(e.name),1),l(V,{type:"info",size:"small"},{default:o(()=>[d(u(e.id),1)]),_:2},1024)]),l(k,{type:Z(e.status),size:"small"},{default:o(()=>[d(u(ee(e.status)),1)]),_:2},1032,["type"])]),n("div",we,[l(k,{size:"small",type:"info",style:{"margin-right":"4px"}},{default:o(()=>[d(u(e.modelId||e.model||"未配置"),1)]),_:2},1024),(a(!0),m(C,null,I(e.channelIds||[],y=>(a(),f(k,{key:y,size:"small",style:{"margin-right":"4px"}},{default:o(()=>[d(u(y),1)]),_:2},1024))),128))]),e.description?(a(),f(V,{key:0,type:"info",size:"small",style:{display:"block","margin-bottom":"12px"}},{default:o(()=>[d(u(e.description),1)]),_:2},1024)):v("",!0),n("div",Ve,[l(c,{type:"primary",style:{flex:"1"},onClick:y=>i.$router.push(`/agents/${e.id}`)},{default:o(()=>[l(M,null,{default:o(()=>[l(le)]),_:1}),t[20]||(t[20]=d(" 进入 ",-1))]),_:1},8,["onClick"]),l(c,{type:"danger",plain:"",onClick:U(y=>te(e.id,e.name),["stop"])},{default:o(()=>[l(M,null,{default:o(()=>[l(oe)]),_:1})]),_:1},8,["onClick"])])]),_:2},1024)]),_:2},1024))),128))]),_:1}),!R(w).loading&&R(w).list.length===0?(a(),f(h,{key:0,description:"暂无 AI 成员，点击「新建 Agent」开始"})):v("",!0),l(ue,{modelValue:_.value,"onUpdate:modelValue":t[17]||(t[17]=e=>_.value=e),title:"新建 AI 成员",width:"680px","close-on-click-modal":!1},{footer:o(()=>[p.value>0?(a(),f(c,{key:0,onClick:t[16]||(t[16]=e=>p.value--)},{default:o(()=>[...t[26]||(t[26]=[d("上一步",-1)])]),_:1})):v("",!0),p.value<4?(a(),f(c,{key:1,type:"primary",onClick:X},{default:o(()=>[...t[27]||(t[27]=[d(" 下一步 ",-1)])]),_:1})):v("",!0),p.value===4?(a(),f(c,{key:2,type:"primary",onClick:Y,loading:L.value},{default:o(()=>[...t[28]||(t[28]=[d(" 创建 Agent ",-1)])]),_:1},8,["loading"])):v("",!0)]),default:o(()=>[l(ie,{active:p.value,"finish-status":"success",simple:"",style:{"margin-bottom":"24px"}},{default:o(()=>[l($,{title:"基本信息"}),l($,{title:"选择模型"}),l($,{title:"消息通道"}),l($,{title:"开启能力"}),l($,{title:"安装 Skills"})]),_:1},8,["active"]),z(n("div",null,[l(ae,{model:s,"label-width":"90px"},{default:o(()=>[l(B,{label:"名称",required:""},{default:o(()=>[l(N,{modelValue:s.name,"onUpdate:modelValue":t[1]||(t[1]=e=>s.name=e),placeholder:"如：数据分析师",onInput:W},null,8,["modelValue"])]),_:1}),l(B,{label:"ID"},{default:o(()=>[l(N,{modelValue:s.id,"onUpdate:modelValue":t[2]||(t[2]=e=>s.id=e),placeholder:"英文标识"},null,8,["modelValue"])]),_:1}),l(B,{label:"描述"},{default:o(()=>[l(N,{modelValue:s.description,"onUpdate:modelValue":t[3]||(t[3]=e=>s.description=e),type:"textarea",rows:2,placeholder:"简短描述这个 Agent 的职责"},null,8,["modelValue"])]),_:1}),l(B,{label:"头像颜色"},{default:o(()=>[n("div",be,[(a(),m(C,null,I(Q,e=>n("div",{key:e,class:D(["color-swatch",{active:s.avatarColor===e}]),style:H({background:e}),onClick:y=>s.avatarColor=e},null,14,he)),64))])]),_:1})]),_:1},8,["model"])],512),[[A,p.value===0]]),z(n("div",null,[j.value.length===0?(a(),m("div",$e,[l(h,{description:"暂无已配置模型","image-size":60}),l(c,{type:"primary",onClick:t[4]||(t[4]=e=>{i.$router.push("/config/models"),_.value=!1})},{default:o(()=>[...t[21]||(t[21]=[d(" 前往配置模型 ",-1)])]),_:1})])):v("",!0),l(re,{modelValue:s.modelId,"onUpdate:modelValue":t[5]||(t[5]=e=>s.modelId=e),style:{width:"100%"}},{default:o(()=>[(a(!0),m(C,null,I(j.value,e=>(a(),f(b,{key:e.id,shadow:"hover",class:D(["select-card",{selected:s.modelId===e.id}]),onClick:y=>s.modelId=e.id},{default:o(()=>[n("div",ze,[l(de,{value:e.id,style:{"margin-right":"0"}},null,8,["value"]),n("div",Ae,[n("div",De,u(e.name),1),l(V,{type:"info",size:"small"},{default:o(()=>[d(u(e.provider)+" / "+u(e.model),1)]),_:2},1024)]),l(k,{type:e.status==="ok"?"success":e.status==="error"?"danger":"info",size:"small"},{default:o(()=>[d(u(e.status==="ok"?"✓ 已配置":e.status==="error"?"✗ 错误":"? 未测试"),1)]),_:2},1032,["type"])])]),_:2},1032,["class","onClick"]))),128))]),_:1},8,["modelValue"]),l(c,{link:"",type:"primary",style:{"margin-top":"12px"},onClick:t[6]||(t[6]=e=>{i.$router.push("/config/models"),_.value=!1})},{default:o(()=>[...t[22]||(t[22]=[d(" + 配置新模型 ",-1)])]),_:1})],512),[[A,p.value===1]]),z(n("div",null,[q.value.length===0?(a(),m("div",Se,[l(h,{description:"暂无消息通道（可跳过）","image-size":60}),l(c,{link:"",type:"primary",onClick:t[7]||(t[7]=e=>{i.$router.push("/config/channels"),_.value=!1})},{default:o(()=>[...t[23]||(t[23]=[d(" 前往添加通道 ",-1)])]),_:1})])):v("",!0),l(F,{modelValue:s.channelIds,"onUpdate:modelValue":t[9]||(t[9]=e=>s.channelIds=e)},{default:o(()=>[(a(!0),m(C,null,I(q.value,e=>(a(),f(b,{key:e.id,shadow:"hover",class:D(["select-card",{selected:s.channelIds.includes(e.id)}]),onClick:y=>E(s.channelIds,e.id)},{default:o(()=>[n("div",Be,[l(T,{value:e.id,onClick:t[8]||(t[8]=U(()=>{},["stop"]))},null,8,["value"]),n("div",Ue,[n("div",Le,u(e.name),1),l(V,{type:"info",size:"small"},{default:o(()=>[d(u(e.type),1)]),_:2},1024)]),l(k,{type:e.enabled?"success":"info",size:"small"},{default:o(()=>[d(u(e.enabled?"启用":"停用"),1)]),_:2},1032,["type"])])]),_:2},1032,["class","onClick"]))),128))]),_:1},8,["modelValue"])],512),[[A,p.value===2]]),z(n("div",null,[P.value.length===0?(a(),m("div",Ee,[l(h,{description:"暂无能力配置（可跳过）","image-size":60}),l(c,{link:"",type:"primary",onClick:t[10]||(t[10]=e=>{i.$router.push("/config/tools"),_.value=!1})},{default:o(()=>[...t[24]||(t[24]=[d(" 前往添加能力 ",-1)])]),_:1})])):v("",!0),l(F,{modelValue:s.toolIds,"onUpdate:modelValue":t[12]||(t[12]=e=>s.toolIds=e)},{default:o(()=>[(a(!0),m(C,null,I(P.value,e=>(a(),f(b,{key:e.id,shadow:"hover",class:D(["select-card",{selected:s.toolIds.includes(e.id)}]),onClick:y=>E(s.toolIds,e.id)},{default:o(()=>[n("div",Me,[l(T,{value:e.id,onClick:t[11]||(t[11]=U(()=>{},["stop"]))},null,8,["value"]),n("div",Ne,[n("div",Te,u(e.name),1),l(V,{type:"info",size:"small"},{default:o(()=>[d(u(e.type),1)]),_:2},1024)]),l(k,{type:e.status==="ok"?"success":"info",size:"small"},{default:o(()=>[d(u(e.status==="ok"?"✓":"?"),1)]),_:2},1032,["type"])])]),_:2},1032,["class","onClick"]))),128))]),_:1},8,["modelValue"])],512),[[A,p.value===3]]),z(n("div",null,[O.value.length===0?(a(),m("div",Fe,[l(h,{description:"暂无已安装 Skills（可跳过）","image-size":60}),l(c,{link:"",type:"primary",onClick:t[13]||(t[13]=e=>{i.$router.push("/config/skills"),_.value=!1})},{default:o(()=>[...t[25]||(t[25]=[d(" 前往安装 Skill ",-1)])]),_:1})])):v("",!0),l(F,{modelValue:s.skillIds,"onUpdate:modelValue":t[15]||(t[15]=e=>s.skillIds=e)},{default:o(()=>[(a(!0),m(C,null,I(O.value,e=>(a(),f(b,{key:e.id,shadow:"hover",class:D(["select-card",{selected:s.skillIds.includes(e.id)}]),onClick:y=>E(s.skillIds,e.id)},{default:o(()=>[n("div",Re,[l(T,{value:e.id,onClick:t[14]||(t[14]=U(()=>{},["stop"]))},null,8,["value"]),n("div",je,[n("div",qe,u(e.name),1),l(V,{type:"info",size:"small"},{default:o(()=>[d(u(e.description),1)]),_:2},1024)]),l(k,{size:"small",type:"info"},{default:o(()=>[d("v"+u(e.version),1)]),_:2},1024)])]),_:2},1032,["class","onClick"]))),128))]),_:1},8,["modelValue"])],512),[[A,p.value===4]])]),_:1},8,["modelValue"])])}}}),Qe=_e(Pe,[["__scopeId","data-v-87a29498"]]);export{Qe as default};
