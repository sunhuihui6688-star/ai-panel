import{d as st,h as ot,c as p,b as e,a as u,w as h,m as nt,i as j,j as M,g as B,E as z,r as y,N as lt,o as d,f as _,F as N,l as R,t as x,n as at,x as L,u as it,M as rt}from"./index-DOQftSxo.js";import{r as I}from"./index-DOB2ih9P.js";import{_ as ct}from"./_plugin-vue_export-helper-DlAUqK2U.js";const dt={class:"team-view"},ut={class:"page-header"},ft={style:{display:"flex",gap:"8px"}},pt={key:0,class:"empty-state"},mt=["height"],ht=["x1","y1","x2","y2","stroke-width","onMouseenter"],gt=["transform","onClick"],vt=["fill"],yt={"text-anchor":"middle","dominant-baseline":"central",fill:"#fff","font-weight":"700","font-size":"15","font-family":"system-ui, sans-serif"},_t=["fill"],xt={"text-anchor":"middle",y:"46","font-size":"12",fill:"#303133","font-family":"system-ui, sans-serif","paint-order":"stroke",stroke:"#f5f7fa","stroke-width":"3"},kt={"text-anchor":"middle",y:"58","font-size":"10",fill:"#909399","font-family":"system-ui, monospace"},wt={key:0,style:{"text-align":"center",color:"#c0c4cc","font-size":"13px",padding:"8px 0 16px"}},bt={class:"tooltip-members"},Ct={class:"tooltip-name"},At={class:"tooltip-name"},Et={class:"tooltip-tags"},Mt={key:0,class:"tooltip-label"},Bt={class:"legend"},Dt={class:"legend-item"},Tt={class:"legend-item"},zt={width:"28",height:"8"},Nt=["stroke-width"],D=820,Rt=28,W=150,F=80,U=80,Lt=st({__name:"TeamView",setup(Ft){const H=it(),V=B(),C=B(!1),g=B({nodes:[],edges:[]}),O={核心:4,常用:2.5,偶尔:1.5};function X(s,t){const o={};s.forEach(a=>{o[a.id]=0});const r=s.length+2;for(let a=0;a<r;a++){let f=!1;for(const i of t){const k=o[i.from]??0,w=o[i.to]??0;if(i.type==="上级"){const v=k-1;w>v&&(o[i.to]=v,f=!0)}else if(i.type==="下级"){const v=k+1;w<v&&(o[i.to]=v,f=!0)}}if(!f)break}const c=Object.values(o),l=c.length?Math.min(...c):0;return s.forEach(a=>{o[a.id]=(o[a.id]??0)-l}),o}const S=L(()=>X(g.value.nodes,g.value.edges)),q=L(()=>{const s=Object.values(S.value).reduce((t,o)=>Math.max(t,o),0);return Math.max(400,F+s*W+140)}),G=L(()=>{const s=g.value.nodes,t=S.value,o={};s.forEach(c=>{const l=t[c.id]??0;o[l]||(o[l]=[]),o[l].push(c.id)});const r={};for(const[c,l]of Object.entries(o)){const a=Number(c),f=F+a*W,i=D-U*2,k=l.length>1?i/(l.length-1):0;l.forEach((w,v)=>{const n=l.length===1?D/2:U+v*k;r[w]={x:Math.round(n),y:Math.round(f)}})}return r});function A(s){return G.value[s]??{x:D/2,y:F}}function E(s,t,o){const r=A(s),c=A(t),l=c.x-r.x,a=c.y-r.y,f=Math.sqrt(l*l+a*a)||1,i=Rt+3;return o==="start"?{x:r.x+l/f*i,y:r.y+a/f*i}:{x:c.x-l/f*i,y:c.y-a/f*i}}function Y(s){return O[s]??1.5}const $=["#409EFF","#67C23A","#E6A23C","#F56C6C","#7C3AED","#0891B2","#B45309","#64748B"];function J(s){let t=0;for(let o=0;o<s.length;o++)t=s.charCodeAt(o)+((t<<5)-t);return $[Math.abs(t)%$.length]??"#409EFF"}function K(s){return(s||"?").charAt(0).toUpperCase()}function P(s){return g.value.nodes.find(t=>t.id===s)?.name??s}function Q(s){H.push(`/agents/${s}`)}const m=B({visible:!1,x:0,y:0,type:"",strength:"",label:"",from:"",to:""});function Z(s,t){const o=V.value?.getBoundingClientRect();o&&(m.value={visible:!0,x:s.clientX-o.left+14,y:s.clientY-o.top-10,type:t.type,strength:t.strength,label:t.label,from:t.from,to:t.to})}function tt(){m.value.visible=!1}async function T(){C.value=!0;try{const s=await I.graph();g.value=s.data}catch{z.error("加载图谱失败")}finally{C.value=!1}}async function et(){try{await rt.confirm("将清空所有成员的 RELATIONS.md，此操作不可恢复。确认吗？","清空所有关系",{confirmButtonText:"确认清空",cancelButtonText:"取消",type:"warning"})}catch{return}try{await I.clearAll(),z.success("已清空所有成员关系"),await T()}catch{z.error("清空失败")}}return ot(T),(s,t)=>{const o=y("Refresh"),r=y("el-icon"),c=y("el-button"),l=y("Delete"),a=y("Share"),f=y("el-tag"),i=y("el-card"),k=y("ArrowUp"),w=y("ArrowDown"),v=lt("loading");return d(),p("div",dt,[e("div",ut,[t[2]||(t[2]=e("h2",null,"团队关系图谱",-1)),e("div",ft,[u(c,{size:"small",onClick:T},{default:h(()=>[u(r,null,{default:h(()=>[u(o)]),_:1}),t[0]||(t[0]=_(" 刷新 ",-1))]),_:1}),u(c,{size:"small",type:"danger",plain:"",onClick:et},{default:h(()=>[u(r,null,{default:h(()=>[u(l)]),_:1}),t[1]||(t[1]=_(" 清空所有关系 ",-1))]),_:1})])]),nt((d(),j(i,{class:"graph-card"},{default:h(()=>[!C.value&&!g.value.nodes.length?(d(),p("div",pt,[u(r,{style:{"font-size":"64px",color:"#c0c4cc",display:"block",margin:"0 auto 16px"}},{default:h(()=>[u(a)]),_:1}),t[3]||(t[3]=e("p",{style:{color:"#909399","text-align":"center",margin:"0"}},"暂无成员数据",-1))])):(d(),p("div",{key:1,class:"graph-container",ref_key:"containerRef",ref:V},[(d(),p("svg",{width:D,height:q.value,class:"graph-svg"},[(d(!0),p(N,null,R(g.value.edges,n=>(d(),p("g",{key:`${n.from}-${n.to}`},[e("line",{x1:E(n.from,n.to,"start").x,y1:E(n.from,n.to,"start").y,x2:E(n.from,n.to,"end").x,y2:E(n.from,n.to,"end").y,stroke:"#94a3b8","stroke-width":Y(n.strength),"stroke-opacity":"0.6","stroke-linecap":"round",class:"graph-edge",onMouseenter:b=>Z(b,n),onMouseleave:tt},null,40,ht)]))),128)),(d(!0),p(N,null,R(g.value.nodes,n=>(d(),p("g",{key:n.id,transform:`translate(${A(n.id).x}, ${A(n.id).y})`,class:"graph-node",onClick:b=>Q(n.id)},[t[4]||(t[4]=e("circle",{r:"30",fill:"rgba(0,0,0,0.07)",transform:"translate(2,3)"},null,-1)),e("circle",{r:"28",fill:J(n.id),stroke:"#fff","stroke-width":"2.5"},null,8,vt),e("text",yt,x(K(n.id)),1),e("circle",{cx:"20",cy:"-20",r:"6",fill:n.status==="running"?"#67C23A":"#c0c4cc",stroke:"#fff","stroke-width":"1.5"},null,8,_t),e("text",xt,x(n.name),1),e("text",kt,x(n.id),1)],8,gt))),128))],8,mt)),g.value.edges.length?M("",!0):(d(),p("div",wt," 暂无关系连线 — 前往成员详情页 →「关系」Tab 添加 ")),m.value.visible?(d(),p("div",{key:1,class:"edge-tooltip",style:at({left:m.value.x+"px",top:m.value.y+"px"})},[e("div",bt,[e("span",Ct,x(P(m.value.from)),1),t[5]||(t[5]=e("span",{class:"tooltip-sep"},"↔",-1)),e("span",At,x(P(m.value.to)),1)]),e("div",Et,[u(f,{size:"small",type:"info",effect:"plain"},{default:h(()=>[_(x(m.value.type),1)]),_:1}),u(f,{size:"small",effect:"plain"},{default:h(()=>[_(x(m.value.strength),1)]),_:1})]),m.value.label?(d(),p("div",Mt,x(m.value.label),1)):M("",!0)],4)):M("",!0)],512))]),_:1})),[[v,C.value]]),g.value.nodes.length?(d(),j(i,{key:0,class:"legend-card"},{default:h(()=>[e("div",Bt,[t[8]||(t[8]=e("span",{class:"legend-title"},"布局规则：",-1)),e("span",Dt,[u(r,null,{default:h(()=>[u(k)]),_:1}),t[6]||(t[6]=_(" 上方 = 上级",-1))]),t[9]||(t[9]=e("span",{class:"legend-item"},"— 同层 = 平级协作",-1)),e("span",Tt,[u(r,null,{default:h(()=>[u(w)]),_:1}),t[7]||(t[7]=_(" 下方 = 下级",-1))]),t[10]||(t[10]=e("span",{class:"legend-divider"}," | ",-1)),t[11]||(t[11]=e("span",{class:"legend-title"},"线粗：",-1)),(d(),p(N,null,R(O,(n,b)=>e("span",{key:b,class:"legend-item"},[(d(),p("svg",zt,[e("line",{x1:"0",y1:"4",x2:"28",y2:"4",stroke:"#64748b","stroke-width":n,"stroke-linecap":"round"},null,8,Nt)])),_(" "+x(b),1)])),64)),t[12]||(t[12]=e("span",{class:"legend-divider"}," | ",-1)),t[13]||(t[13]=e("span",{class:"legend-item"},[e("svg",{width:"12",height:"12"},[e("circle",{cx:"6",cy:"6",r:"5",fill:"#67C23A"})]),_(" 运行中 ")],-1)),t[14]||(t[14]=e("span",{class:"legend-item"},[e("svg",{width:"12",height:"12"},[e("circle",{cx:"6",cy:"6",r:"5",fill:"#c0c4cc"})]),_(" 空闲 ")],-1))])]),_:1})):M("",!0)])}}}),$t=ct(Lt,[["__scopeId","data-v-e507c681"]]);export{$t as default};
