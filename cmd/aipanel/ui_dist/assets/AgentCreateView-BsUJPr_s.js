import{d as fe,i as pe,c as r,b as a,a as o,w as n,s as V,h as d,F as g,m as y,j as p,k as $,q as R,e as k,z as S,r as m,o as i,l as U,A as ve,B as ce,C as _e,u as ge,n as H,t as b,D as ye,f as ke,p as be,v as Ie,E as C}from"./index-CV4GoklC.js";import{m as we,c as Ce,t as Ve,d as $e,b as K,f as G,e as Ae}from"./index-CDWofbfP.js";import{A as Q}from"./AiChat-DMiZdJY8.js";import{_ as Te}from"./_plugin-vue_export-helper-DlAUqK2U.js";const xe={class:"create-layout"},Le={class:"create-left"},Se={class:"create-header"},Ue={class:"form-section"},De={class:"color-row"},Ne=["onClick"],ze={class:"form-section"},Ee={class:"section-title"},he={key:0,class:"ai-badge"},Oe={class:"form-section"},Fe={class:"form-section"},Ye={key:0,class:"empty-hint"},Be={class:"form-section"},Me={key:0,class:"empty-hint"},je={class:"form-section"},Pe={key:0,class:"empty-hint"},qe={class:"create-footer"},Je={class:"create-right"},Re={class:"agent-tabs-bar"},He={class:"agent-tabs-scroll"},Ke=["onClick"],Ge={class:"agent-tab add-tab"},Qe={key:1,class:"no-agent-hint"},We=fe({__name:"AgentCreateView",setup(Xe){const W=ge(),l=R({name:"",id:"",description:"",avatarColor:"#409eff",identity:"",soul:"",modelId:"",channelIds:[],toolIds:[],skillIds:[]}),_=R(new Set),O={},A=k(!1),X=["#409eff","#67c23a","#e6a23c","#f56c6c","#909399","#9b59b6","#1abc9c","#e74c3c"];function F(){const s=l.name.toLowerCase().replace(/[^a-z0-9\u4e00-\u9fff\s-]/g,"").trim();let e=s.replace(/[\u4e00-\u9fff]/g,"").replace(/[\s_]+/g,"-").replace(/-+/g,"-").replace(/^-+|-+$/g,"");if(e.length<2){const f=Date.now().toString(36).slice(-4),u=(s.match(/[\u4e00-\u9fff]/g)||[]).length;e=u>0?`agent-${u}ch-${f}`:`agent-${f}`}l.id=e.slice(0,32)}function Y(s){const e=s;l[e]=O[s]||"",_.delete(s)}function Z(s){const e={name:"name",NAME:"name",id:"id",ID:"id",description:"description",DESCRIPTION:"description",desc:"description",identity:"identity",IDENTITY:"identity",soul:"soul",SOUL:"soul"};let f=0;for(const[u,v]of Object.entries(s)){const c=e[u];c&&v&&(O[u.toLowerCase()]=l[c],l[c]=v,_.add(u.toLowerCase()),u.toLowerCase()==="name"&&F(),f++)}f>0?C.success(`已填入 ${f} 个字段到左侧表单 ✓`):C.warning("未识别到可填入的字段，请手动复制")}async function ee(){if(!l.name.trim()){C.warning("请填写名称");return}if(!l.id.trim()||l.id==="-"||!/^[a-z0-9][a-z0-9-_]{0,30}$/.test(l.id)){C.warning("ID 格式不对，请手动填写（只能用小写字母、数字、连字符）");return}if(!A.value){A.value=!0;try{await K.create({...l,model:l.modelId||""});const s=[];l.identity.trim()&&s.push(G.write(l.id,"IDENTITY.md",l.identity)),l.soul.trim()&&s.push(G.write(l.id,"SOUL.md",l.soul)),s.length&&await Promise.all(s);try{await Ae.setConfig(l.id,{enabled:!0,schedule:"daily",keepTurns:3,focusHint:"",cronJobId:""})}catch{}C.success("Agent 创建成功！"),W.push(`/agents/${l.id}`)}catch(s){C.error(s.response?.data?.error||"创建失败")}finally{A.value=!1}}}const T=k([]),D=k([]),N=k([]),z=k([]),x=k([]),I=k("__assist__"),w=k([]),B=S(()=>x.value.filter(s=>w.value.includes(s.id))),M=S(()=>x.value.filter(s=>!w.value.includes(s.id))),j=S(()=>x.value[0]?.id||""),te=S(()=>["你是一个 AI 配置助手，帮助用户设计和生成 AI Agent 的配置文件（IDENTITY 和 SOUL）。","用户正在新建一个 Agent，当前表单状态如下（未填字段为空）：",`- 名称: ${l.name||"（未填）"}`,`- ID: ${l.id||"（未填）"}`,`- 描述: ${l.description||"（未填）"}`,l.identity?`- IDENTITY（已填）: ${l.identity.slice(0,100)}...`:"- IDENTITY: （未填）",l.soul?`- SOUL（已填）: ${l.soul.slice(0,100)}...`:"- SOUL: （未填）","","当你为用户生成配置时，请在回答末尾附上如下格式的 JSON 块，方便用户一键应用：","```json",'{"name":"...","description":"...","identity":"...","soul":"..."}',"```","如果某个字段不需要更改，就省略它。"].join(`
`));function L(s){I.value=s}function le(s){w.value.includes(s)||w.value.push(s),L(s)}function se(s){w.value=w.value.filter(e=>e!==s),I.value===s&&L("__assist__")}return pe(async()=>{const[s,e,f,u,v]=await Promise.allSettled([we.list(),Ce.list(),Ve.list(),$e.list(),K.list()]);s.status==="fulfilled"&&(T.value=s.value.data),e.status==="fulfilled"&&(D.value=e.value.data),f.status==="fulfilled"&&(N.value=f.value.data),u.status==="fulfilled"&&(z.value=u.value.data),v.status==="fulfilled"&&(x.value=v.value.data),T.value.length>0&&(l.modelId=T.value[0]?.id??"")}),(s,e)=>{const f=m("el-icon"),u=m("el-button"),v=m("el-input"),c=m("el-form-item"),ne=m("el-option"),oe=m("el-select"),P=m("el-link"),ae=m("el-tag"),E=m("el-checkbox"),h=m("el-checkbox-group"),ie=m("el-text"),de=m("el-form"),ue=m("User"),q=m("el-dropdown-item"),re=m("el-dropdown-menu"),me=m("el-dropdown");return i(),r("div",xe,[a("div",Le,[a("div",Se,[o(u,{text:"",onClick:e[0]||(e[0]=t=>s.$router.push("/agents")),class:"back-btn"},{default:n(()=>[o(f,null,{default:n(()=>[o(U(ve))]),_:1}),e[18]||(e[18]=d(" 返回 ",-1))]),_:1}),e[19]||(e[19]=a("h2",{style:{margin:"0"}},"新建 AI 成员",-1))]),o(de,{model:l,"label-position":"top",class:"create-form"},{default:n(()=>[a("div",Ue,[e[20]||(e[20]=a("div",{class:"section-title"},"基本信息",-1)),o(c,{label:"名称",required:""},{default:n(()=>[o(v,{modelValue:l.name,"onUpdate:modelValue":e[1]||(e[1]=t=>l.name=t),placeholder:"如：电商客服助手",onInput:F},null,8,["modelValue"])]),_:1}),o(c,{label:"ID"},{default:n(()=>[o(v,{modelValue:l.id,"onUpdate:modelValue":e[2]||(e[2]=t=>l.id=t),placeholder:"英文标识（自动生成）"},null,8,["modelValue"])]),_:1}),o(c,{label:"描述"},{default:n(()=>[o(v,{modelValue:l.description,"onUpdate:modelValue":e[3]||(e[3]=t=>l.description=t),type:"textarea",rows:2,placeholder:"简短描述这个 Agent 的职责"},null,8,["modelValue"])]),_:1}),o(c,{label:"头像颜色"},{default:n(()=>[a("div",De,[(i(),r(g,null,y(X,t=>a("div",{key:t,class:V(["color-swatch",{active:l.avatarColor===t}]),style:H({background:t}),onClick:J=>l.avatarColor=t},null,14,Ne)),64))])]),_:1})]),a("div",ze,[a("div",Ee,[e[21]||(e[21]=d(" 身份 & 灵魂 ",-1)),_.has("identity")||_.has("soul")?(i(),r("span",he,"AI 生成")):$("",!0)]),o(c,null,{label:n(()=>[e[23]||(e[23]=a("span",null,[d("IDENTITY "),a("span",{class:"field-hint"},"— 角色定义")],-1)),_.has("identity")?(i(),p(u,{key:0,text:"",size:"small",onClick:e[4]||(e[4]=t=>Y("identity")),class:"revert-btn"},{default:n(()=>[...e[22]||(e[22]=[d("↺ 撤销",-1)])]),_:1})):$("",!0)]),default:n(()=>[o(v,{modelValue:l.identity,"onUpdate:modelValue":e[5]||(e[5]=t=>l.identity=t),type:"textarea",rows:5,class:V({"ai-filled":_.has("identity")}),placeholder:"你是一个...（描述 Agent 的角色和能力）",onInput:e[6]||(e[6]=t=>_.delete("identity"))},null,8,["modelValue","class"])]),_:1}),o(c,null,{label:n(()=>[e[25]||(e[25]=a("span",null,[d("SOUL "),a("span",{class:"field-hint"},"— 行为风格")],-1)),_.has("soul")?(i(),p(u,{key:0,text:"",size:"small",onClick:e[7]||(e[7]=t=>Y("soul")),class:"revert-btn"},{default:n(()=>[...e[24]||(e[24]=[d("↺ 撤销",-1)])]),_:1})):$("",!0)]),default:n(()=>[o(v,{modelValue:l.soul,"onUpdate:modelValue":e[8]||(e[8]=t=>l.soul=t),type:"textarea",rows:5,class:V({"ai-filled":_.has("soul")}),placeholder:"语气亲切，回答简洁...（描述 Agent 的个性风格）",onInput:e[9]||(e[9]=t=>_.delete("soul"))},null,8,["modelValue","class"])]),_:1})]),a("div",Oe,[e[26]||(e[26]=a("div",{class:"section-title"},"模型",-1)),o(c,{label:"选择模型"},{default:n(()=>[o(oe,{modelValue:l.modelId,"onUpdate:modelValue":e[10]||(e[10]=t=>l.modelId=t),placeholder:"选择模型",style:{width:"100%"}},{default:n(()=>[(i(!0),r(g,null,y(T.value,t=>(i(),p(ne,{key:t.id,label:`${t.name}（${t.provider}）`,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),a("div",Fe,[e[30]||(e[30]=a("div",{class:"section-title"},"消息通道",-1)),D.value.length===0?(i(),r("div",Ye,[e[28]||(e[28]=d(" 暂无通道，先在",-1)),o(P,{onClick:e[11]||(e[11]=t=>s.$router.push("/config/channels")),type:"primary"},{default:n(()=>[...e[27]||(e[27]=[d(" 全局配置 ",-1)])]),_:1}),e[29]||(e[29]=d("添加 ",-1))])):(i(),p(h,{key:1,modelValue:l.channelIds,"onUpdate:modelValue":e[12]||(e[12]=t=>l.channelIds=t)},{default:n(()=>[(i(!0),r(g,null,y(D.value,t=>(i(),p(E,{key:t.id,label:t.id,value:t.id},{default:n(()=>[d(b(t.name)+" ",1),o(ae,{size:"small",style:{"margin-left":"4px"}},{default:n(()=>[d(b(t.type),1)]),_:2},1024)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"]))]),a("div",Be,[e[34]||(e[34]=a("div",{class:"section-title"},"开启能力",-1)),N.value.length===0?(i(),r("div",Me,[e[32]||(e[32]=d(" 暂无能力，先在",-1)),o(P,{onClick:e[13]||(e[13]=t=>s.$router.push("/config/tools")),type:"primary"},{default:n(()=>[...e[31]||(e[31]=[d(" 全局配置 ",-1)])]),_:1}),e[33]||(e[33]=d("添加 ",-1))])):(i(),p(h,{key:1,modelValue:l.toolIds,"onUpdate:modelValue":e[14]||(e[14]=t=>l.toolIds=t)},{default:n(()=>[(i(!0),r(g,null,y(N.value,t=>(i(),p(E,{key:t.id,label:t.id,value:t.id},{default:n(()=>[d(b(t.name),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"]))]),a("div",je,[e[35]||(e[35]=a("div",{class:"section-title"},"Skills",-1)),z.value.length===0?(i(),r("div",Pe,"暂无已安装的 Skills")):(i(),p(h,{key:1,modelValue:l.skillIds,"onUpdate:modelValue":e[15]||(e[15]=t=>l.skillIds=t)},{default:n(()=>[(i(!0),r(g,null,y(z.value,t=>(i(),p(E,{key:t.id,label:t.id,value:t.id},{default:n(()=>[d(b(t.name)+" ",1),o(ie,{type:"info",size:"small",style:{"margin-left":"4px"}},{default:n(()=>[d("v"+b(t.version),1)]),_:2},1024)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"]))])]),_:1},8,["model"]),a("div",qe,[o(u,{onClick:e[16]||(e[16]=t=>s.$router.push("/agents"))},{default:n(()=>[...e[36]||(e[36]=[d("取消",-1)])]),_:1}),o(u,{type:"primary",loading:A.value,onClick:ee},{default:n(()=>[...e[37]||(e[37]=[d(" 保存 Agent ",-1)])]),_:1},8,["loading"])])]),a("div",Je,[a("div",Re,[a("div",He,[a("div",{class:V(["agent-tab",{active:I.value==="__assist__"}]),onClick:e[17]||(e[17]=t=>L("__assist__"))},[o(f,{class:"tab-icon"},{default:n(()=>[o(ue)]),_:1}),e[38]||(e[38]=d(" 配置助手 ",-1))],2),(i(!0),r(g,null,y(B.value,t=>(i(),r("div",{key:t.id,class:V(["agent-tab",{active:I.value===t.id}]),onClick:J=>L(t.id)},[a("div",{class:"tab-avatar",style:H({background:t.avatarColor||"#409eff"})},b(t.name.charAt(0)),5),d(" "+b(t.name)+" ",1),o(f,{class:"tab-close",onClick:ke(J=>se(t.id),["stop"])},{default:n(()=>[o(U(ye))]),_:1},8,["onClick"])],10,Ke))),128)),o(me,{onCommand:le,trigger:"click"},{dropdown:n(()=>[o(re,null,{default:n(()=>[(i(!0),r(g,null,y(M.value,t=>(i(),p(q,{key:t.id,command:t.id},{default:n(()=>[d(b(t.name),1)]),_:2},1032,["command"]))),128)),M.value.length===0?(i(),p(q,{key:0,disabled:""},{default:n(()=>[...e[40]||(e[40]=[d("暂无其他 Agent",-1)])]),_:1})):$("",!0)]),_:1})]),default:n(()=>[a("div",Ge,[o(f,null,{default:n(()=>[o(U(ce))]),_:1}),e[39]||(e[39]=d(" 更多",-1))])]),_:1})])]),I.value==="__assist__"?(i(),r(g,{key:0},[j.value?(i(),p(Q,{key:0,"agent-id":j.value,context:te.value,scenario:"agent-creation",placeholder:"告诉我这个 Agent 要做什么...",examples:["我需要一个电商客服 Agent，负责解答订单问题，语气亲切","帮我创建一个代码审查助手，专注于 Python 代码规范","创建一个每天早上发送天气报告的 Agent"],height:"100%",compact:!0,"show-thinking":!0,applyable:!0,onApply:Z},null,8,["agent-id","context"])):(i(),r("div",Qe,[o(f,{size:"32"},{default:n(()=>[o(U(_e))]),_:1}),e[41]||(e[41]=a("p",null,"配置助手需要至少一个 AI 成员才能运行",-1)),e[42]||(e[42]=a("p",{class:"hint-sub"},"请先在左侧填写基本信息并创建第一个成员",-1))]))],64)):$("",!0),(i(!0),r(g,null,y(B.value,t=>be((i(),p(Q,{key:t.id,"agent-id":t.id,scenario:"general","welcome-message":`你好，我是 **${t.name}**，有什么需要帮忙的？`,height:"100%",compact:!0,"show-thinking":!0},null,8,["agent-id","welcome-message"])),[[Ie,I.value===t.id]])),128))])])}}}),st=Te(We,[["__scopeId","data-v-cf36e89f"]]);export{st as default};
