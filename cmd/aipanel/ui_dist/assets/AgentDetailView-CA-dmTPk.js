import{d as Je,h as Ge,E as m,y as We,k as y,w as t,z as qe,g as u,r as o,o as r,a as l,f as i,i as k,A as Qe,t as c,e as s,c as g,j as ge,F as X,l as C,B as Xe,b as Ze,C as be,D as el,G as ll,H as tl,I as al,J as we,s as nl}from"./index-C4eNWLrR.js";import{b as ol,f as H,d as P,e as R,g as sl}from"./index-Crfy7OVn.js";import{_ as ul}from"./_plugin-vue_export-helper-DlAUqK2U.js";const rl={class:"header-left"},il={class:"chat-container"},dl={class:"msg-bubble"},ml={key:0,class:"tool-block"},pl={class:"tool-result"},cl=["innerHTML"],fl={key:0,class:"chat-msg assistant"},vl={key:1,class:"chat-msg assistant"},yl={class:"msg-bubble"},_l=["innerHTML"],gl={class:"chat-input"},bl={class:"memory-toolbar",style:{"margin-bottom":"12px",display:"flex",gap:"8px"}},wl={style:{display:"flex","align-items":"center",gap:"4px","font-size":"13px"}},Vl={style:{display:"flex","align-items":"center","justify-content":"space-between"}},xl={style:{"margin-top":"8px",display:"flex",gap:"8px","align-items":"center"}},kl=Je({__name:"AgentDetailView",setup(Cl){const f=qe().params.id,$=u(null),oe=u("chat"),w=u([]),Y=u(""),V=u(!1),v=u(""),se=u(),K=u(""),j=u(""),O=u([]),h=u(""),z=u(""),Z=u(!1),ee=u([]),N=u(!1),J=u(""),A=u(!1),G=u(""),ue=u([]),T=u(""),E=u(""),W=u(null),re=u([]),S=u(!1),p=u({name:"",expr:"0 9 * * *",tz:"Asia/Shanghai",message:"",enabled:!0});function Ve(a){return a==="running"?"success":a==="stopped"?"danger":"info"}function xe(a){return a==="running"?"ËøêË°å‰∏≠":a==="stopped"?"Â∑≤ÂÅúÊ≠¢":"Á©∫Èó≤"}function ie(a){return(a||"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/`(.*?)`/g,"<code>$1</code>").replace(/\n/g,"<br>")}function de(a){return a?a<1024?a+" B":a<1048576?(a/1024).toFixed(1)+" KB":(a/1048576).toFixed(1)+" MB":"0 B"}function ke(a){return new Date(a).toLocaleString()}function Ce(a){return a?new Date(a).toLocaleString():""}Ge(async()=>{try{const a=await ol.get(f);$.value=a.data}catch{m.error("Âä†ËΩΩ Agent Â§±Ë¥•")}he(),Me(),Q()}),We(v,()=>q());async function me(){const a=Y.value.trim();!a||V.value||(w.value.push({role:"user",text:a}),Y.value="",V.value=!0,v.value="",await we(),q(),sl(f,a,e=>{if(e.type==="text_delta")v.value+=e.text;else if(e.type==="tool_call")v.value&&(w.value.push({role:"assistant",text:v.value}),v.value=""),w.value.push({role:"tool",text:"",toolName:e.tool_call?.name||"tool"}),q();else if(e.type==="tool_result"){const d=w.value[w.value.length-1];d?.role==="tool"&&(d.text=e.text)}else e.type==="done"?(v.value&&w.value.push({role:"assistant",text:v.value}),v.value="",V.value=!1,q()):e.type==="error"&&(m.error(e.error||"ËØ∑Ê±ÇÂ§±Ë¥•"),V.value=!1)}))}function q(){we(()=>{const a=se.value;a&&(a.scrollTop=a.scrollHeight)})}async function he(){try{const[a,e]=await Promise.all([H.read(f,"IDENTITY.md"),H.read(f,"SOUL.md")]);K.value=a.data?.content||"",j.value=e.data?.content||""}catch{}L()}async function le(a,e){try{await H.write(f,a,e),m.success(`${a} Â∑≤‰øùÂ≠ò`)}catch{m.error(`‰øùÂ≠ò ${a} Â§±Ë¥•`)}}async function L(){try{const a=await P.tree(f);O.value=a.data||[]}catch{O.value=[]}}async function ze(a){if(!a.isDir){h.value=a.path,ee.value=a.path.split("/");try{const e=await P.readFile(f,a.path);z.value=e.data?.content||""}catch{z.value="(Êó†Ê≥ïËØªÂèñ)"}}}async function Te(){if(h.value){Z.value=!0;try{await P.writeFile(f,h.value,z.value),m.success("ËÆ∞ÂøÜÊñá‰ª∂Â∑≤‰øùÂ≠ò"),L()}catch{m.error("‰øùÂ≠òÂ§±Ë¥•")}finally{Z.value=!1}}}async function Fe(){const a=J.value.trim();if(!a){m.warning("ËØ∑ËæìÂÖ•Ë∑ØÂæÑ");return}try{await P.writeFile(f,a,`# ${a.split("/").pop()?.replace(".md","")||"New File"}

`),m.success("Êñá‰ª∂Â∑≤ÂàõÂª∫"),N.value=!1,J.value="",L(),h.value=a,ee.value=a.split("/"),z.value=`# ${a.split("/").pop()?.replace(".md","")||"New File"}

`}catch{m.error("ÂàõÂª∫Â§±Ë¥•")}}async function Ue(){const a=G.value.trim();if(!a){m.warning("ËØ∑ËæìÂÖ•ÂÜÖÂÆπ");return}try{await P.dailyLog(f,a),m.success("Êó•ÂøóÂ∑≤Ê∑ªÂä†"),A.value=!1,G.value="",L()}catch{m.error("Ê∑ªÂä†Â§±Ë¥•")}}async function Me(){try{const a=await H.read(f,"/");Array.isArray(a.data)&&(ue.value=a.data.map(e=>({name:e.name,isDir:e.isDir,size:e.size,modTime:e.modTime,path:e.name})))}catch{}}async function De(a){if(!a.isDir){T.value=a.path||a.name,W.value=a;try{const e=await H.read(f,T.value);E.value=e.data?.content||""}catch{E.value="(Êó†Ê≥ïËØªÂèñ)"}}}async function $e(){T.value&&await le(T.value,E.value)}async function Q(){try{const a=await R.list();re.value=a.data||[]}catch{}}async function Ne(){try{await R.create({name:p.value.name,enabled:p.value.enabled,schedule:{kind:"cron",expr:p.value.expr,tz:p.value.tz},payload:{kind:"agentTurn",message:p.value.message},delivery:{mode:"announce"}}),m.success("‰ªªÂä°ÂàõÂª∫ÊàêÂäü"),S.value=!1,Q()}catch(a){m.error(a.response?.data?.error||"ÂàõÂª∫Â§±Ë¥•")}}async function Ae(a){try{await R.update(a.id,a)}catch{m.error("Êõ¥Êñ∞Â§±Ë¥•")}}async function Ee(a){try{await R.run(a.id),m.success("Â∑≤Ëß¶ÂèëËøêË°å"),setTimeout(Q,2e3)}catch{m.error("ËøêË°åÂ§±Ë¥•")}}async function Se(a){try{await R.delete(a.id),m.success("Â∑≤Âà†Èô§"),Q()}catch{m.error("Âà†Èô§Â§±Ë¥•")}}return(a,e)=>{const d=o("el-button"),pe=o("el-tag"),F=o("el-text"),Le=o("el-header"),Be=o("el-collapse-item"),Ie=o("el-collapse"),_=o("el-input"),He=o("Promotion"),x=o("el-icon"),B=o("el-tab-pane"),U=o("el-card"),M=o("el-col"),te=o("el-row"),ce=o("el-tree"),fe=o("el-empty"),ve=o("el-breadcrumb-item"),Pe=o("el-breadcrumb"),D=o("el-form-item"),ye=o("el-form"),ae=o("el-dialog"),I=o("el-table-column"),_e=o("el-switch"),Re=o("el-table"),ne=o("el-option"),Ye=o("el-select"),Ke=o("el-tabs"),je=o("el-main"),Oe=o("el-container");return r(),y(Oe,{class:"agent-detail"},{default:t(()=>[l(Le,{class:"detail-header"},{default:t(()=>[i("div",rl,[l(d,{icon:k(Qe),onClick:e[0]||(e[0]=n=>a.$router.push("/agents")),circle:""},null,8,["icon"]),i("h2",null,c($.value?.name||"..."),1),l(pe,{type:Ve($.value?.status)},{default:t(()=>[s(c(xe($.value?.status)),1)]),_:1},8,["type"])]),l(F,{type:"info"},{default:t(()=>[s(c($.value?.model),1)]),_:1})]),_:1}),l(je,null,{default:t(()=>[l(Ke,{modelValue:oe.value,"onUpdate:modelValue":e[24]||(e[24]=n=>oe.value=n),type:"border-card"},{default:t(()=>[l(B,{label:"ÂØπËØù",name:"chat"},{default:t(()=>[i("div",il,[i("div",{class:"chat-messages",ref_key:"chatMessagesRef",ref:se},[(r(!0),g(X,null,ge(w.value,(n,b)=>(r(),g("div",{key:b,class:nl(["chat-msg",n.role])},[i("div",dl,[n.role==="tool"?(r(),g("div",ml,[l(Ie,null,{default:t(()=>[l(Be,{title:"üîß "+(n.toolName||"tool")},{default:t(()=>[i("pre",pl,c(n.text?.slice(0,500)),1)]),_:2},1032,["title"])]),_:2},1024)])):(r(),g("div",{key:1,class:"msg-text",innerHTML:ie(n.text)},null,8,cl))])],2))),128)),V.value&&!v.value?(r(),g("div",fl,[...e[25]||(e[25]=[i("div",{class:"msg-bubble"},[i("div",{class:"typing-indicator"},[i("span"),i("span"),i("span")])],-1)])])):C("",!0),V.value&&v.value?(r(),g("div",vl,[i("div",yl,[i("div",{class:"msg-text",innerHTML:ie(v.value)},null,8,_l),e[26]||(e[26]=i("span",{class:"cursor"},"‚ñä",-1))])])):C("",!0)],512),i("div",gl,[l(_,{modelValue:Y.value,"onUpdate:modelValue":e[1]||(e[1]=n=>Y.value=n),type:"textarea",rows:2,placeholder:"ËæìÂÖ•Ê∂àÊÅØ... (Ctrl+Enter ÂèëÈÄÅ)",onKeydown:Xe(Ze(me,["ctrl"]),["enter"])},null,8,["modelValue","onKeydown"]),l(d,{type:"primary",onClick:me,loading:V.value,style:{"margin-top":"8px"}},{default:t(()=>[l(x,null,{default:t(()=>[l(He)]),_:1}),e[27]||(e[27]=s(" ÂèëÈÄÅ ",-1))]),_:1},8,["loading"])])])]),_:1}),l(B,{label:"Ë∫´‰ªΩ & ÁÅµÈ≠Ç",name:"identity"},{default:t(()=>[l(te,{gutter:20},{default:t(()=>[l(M,{span:12},{default:t(()=>[l(U,{header:"IDENTITY.md"},{default:t(()=>[l(_,{modelValue:K.value,"onUpdate:modelValue":e[2]||(e[2]=n=>K.value=n),type:"textarea",rows:15,onBlur:e[3]||(e[3]=n=>le("IDENTITY.md",K.value))},null,8,["modelValue"])]),_:1})]),_:1}),l(M,{span:12},{default:t(()=>[l(U,{header:"SOUL.md"},{default:t(()=>[l(_,{modelValue:j.value,"onUpdate:modelValue":e[4]||(e[4]=n=>j.value=n),type:"textarea",rows:15,onBlur:e[5]||(e[5]=n=>le("SOUL.md",j.value))},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),l(B,{label:"ËÆ∞ÂøÜ",name:"memory"},{default:t(()=>[i("div",bl,[l(d,{type:"primary",size:"small",onClick:e[6]||(e[6]=n=>N.value=!0)},{default:t(()=>[l(x,null,{default:t(()=>[l(k(be))]),_:1}),e[28]||(e[28]=s(" Êñ∞Âª∫Êñá‰ª∂ ",-1))]),_:1}),l(d,{size:"small",onClick:e[7]||(e[7]=n=>A.value=!0)},{default:t(()=>[l(x,null,{default:t(()=>[l(k(el))]),_:1}),e[29]||(e[29]=s(" Ê∑ªÂä†Êó•Âøó ",-1))]),_:1}),l(d,{size:"small",onClick:L},{default:t(()=>[l(x,null,{default:t(()=>[l(k(ll))]),_:1}),e[30]||(e[30]=s(" Âà∑Êñ∞ ",-1))]),_:1})]),l(te,{gutter:16},{default:t(()=>[l(M,{span:7},{default:t(()=>[l(U,{header:"ËÆ∞ÂøÜÁõÆÂΩï",shadow:"hover"},{default:t(()=>[l(ce,{data:O.value,props:{label:"name",children:"children",isLeaf:n=>!n.isDir},onNodeClick:ze,"highlight-current":"","default-expand-all":"","expand-on-click-node":!1},{default:t(({data:n})=>[i("span",wl,[n.isDir?(r(),y(x,{key:0,style:{color:"#E6A23C"}},{default:t(()=>[l(k(tl))]),_:1})):(r(),y(x,{key:1,style:{color:"#409EFF"}},{default:t(()=>[l(k(al))]),_:1})),i("span",null,c(n.name),1),!n.isDir&&n.size?(r(),y(F,{key:2,type:"info",size:"small",style:{"margin-left":"auto"}},{default:t(()=>[s(c(de(n.size)),1)]),_:2},1024)):C("",!0)])]),_:1},8,["data","props"]),O.value.length===0?(r(),y(fe,{key:0,description:"ËÆ∞ÂøÜÊ†ë‰∏∫Á©∫","image-size":40})):C("",!0)]),_:1})]),_:1}),l(M,{span:17},{default:t(()=>[l(U,{shadow:"hover"},{header:t(()=>[i("div",Vl,[l(Pe,{separator:"/"},{default:t(()=>[l(ve,null,{default:t(()=>[...e[31]||(e[31]=[s("memory",-1)])]),_:1}),(r(!0),g(X,null,ge(ee.value,(n,b)=>(r(),y(ve,{key:b},{default:t(()=>[s(c(n),1)]),_:2},1024))),128))]),_:1}),h.value?(r(),y(d,{key:0,type:"primary",size:"small",onClick:Te,loading:Z.value},{default:t(()=>[...e[32]||(e[32]=[s("‰øùÂ≠ò",-1)])]),_:1},8,["loading"])):C("",!0)])]),default:t(()=>[h.value?(r(),y(_,{key:0,modelValue:z.value,"onUpdate:modelValue":e[8]||(e[8]=n=>z.value=n),type:"textarea",rows:22,style:{"font-family":"monospace"}},null,8,["modelValue"])):(r(),y(fe,{key:1,description:"ÁÇπÂáªÂ∑¶‰æßÊñá‰ª∂Êü•ÁúãÂíåÁºñËæë","image-size":60}))]),_:1})]),_:1})]),_:1}),l(ae,{modelValue:N.value,"onUpdate:modelValue":e[11]||(e[11]=n=>N.value=n),title:"Êñ∞Âª∫ËÆ∞ÂøÜÊñá‰ª∂",width:"480px"},{footer:t(()=>[l(d,{onClick:e[10]||(e[10]=n=>N.value=!1)},{default:t(()=>[...e[34]||(e[34]=[s("ÂèñÊ∂à",-1)])]),_:1}),l(d,{type:"primary",onClick:Fe},{default:t(()=>[...e[35]||(e[35]=[s("ÂàõÂª∫",-1)])]),_:1})]),default:t(()=>[l(ye,{"label-width":"80px"},{default:t(()=>[l(D,{label:"Ë∑ØÂæÑ"},{default:t(()=>[l(_,{modelValue:J.value,"onUpdate:modelValue":e[9]||(e[9]=n=>J.value=n),placeholder:"‰æãÂ¶Ç: projects/my-project.md Êàñ topics/cooking.md"},null,8,["modelValue"]),l(F,{type:"info",size:"small",style:{"margin-top":"4px"}},{default:t(()=>[...e[33]||(e[33]=[s("Áõ∏ÂØπ‰∫é memory/ ÁõÆÂΩï",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(ae,{modelValue:A.value,"onUpdate:modelValue":e[14]||(e[14]=n=>A.value=n),title:"Ê∑ªÂä†‰ªäÊó•Êó•Âøó",width:"600px"},{footer:t(()=>[l(d,{onClick:e[13]||(e[13]=n=>A.value=!1)},{default:t(()=>[...e[36]||(e[36]=[s("ÂèñÊ∂à",-1)])]),_:1}),l(d,{type:"primary",onClick:Ue},{default:t(()=>[...e[37]||(e[37]=[s("Êèê‰∫§",-1)])]),_:1})]),default:t(()=>[l(_,{modelValue:G.value,"onUpdate:modelValue":e[12]||(e[12]=n=>G.value=n),type:"textarea",rows:10,placeholder:"ËÆ∞ÂΩï‰ªäÂ§©ÁöÑÈáçË¶Å‰∫ãÈ°π„ÄÅÂ≠¶‰π†ÂøÉÂæó„ÄÅÂæÖÂäû..."},null,8,["modelValue"])]),_:1},8,["modelValue"])]),_:1}),l(B,{label:"Â∑•‰ΩúÂå∫",name:"workspace"},{default:t(()=>[l(te,{gutter:20},{default:t(()=>[l(M,{span:8},{default:t(()=>[l(U,{header:"Êñá‰ª∂ÂàóË°®"},{default:t(()=>[l(ce,{data:ue.value,props:{label:"name",children:"children"},onNodeClick:De,"highlight-current":"","default-expand-all":""},null,8,["data"])]),_:1})]),_:1}),l(M,{span:16},{default:t(()=>[l(U,{header:T.value||"ÈÄâÊã©Êñá‰ª∂Êü•Áúã"},{default:t(()=>[T.value?(r(),g(X,{key:0},[l(_,{modelValue:E.value,"onUpdate:modelValue":e[15]||(e[15]=n=>E.value=n),type:"textarea",rows:20},null,8,["modelValue"]),i("div",xl,[l(d,{type:"primary",onClick:$e},{default:t(()=>[...e[38]||(e[38]=[s("‰øùÂ≠ò",-1)])]),_:1}),W.value?(r(),y(F,{key:0,type:"info",size:"small"},{default:t(()=>[s(c(de(W.value.size))+" ¬∑ "+c(ke(W.value.modTime)),1)]),_:1})):C("",!0)])],64)):C("",!0)]),_:1},8,["header"])]),_:1})]),_:1})]),_:1}),l(B,{label:"ÂÆöÊó∂‰ªªÂä°",name:"cron"},{default:t(()=>[l(d,{type:"primary",onClick:e[16]||(e[16]=n=>S.value=!0),style:{"margin-bottom":"16px"}},{default:t(()=>[l(x,null,{default:t(()=>[l(k(be))]),_:1}),e[39]||(e[39]=s(" Êñ∞Âª∫‰ªªÂä° ",-1))]),_:1}),l(Re,{data:re.value,stripe:""},{default:t(()=>[l(I,{prop:"name",label:"ÂêçÁß∞"}),l(I,{label:"Ë∞ÉÂ∫¶"},{default:t(({row:n})=>[s(c(n.schedule?.expr)+" ("+c(n.schedule?.tz)+")",1)]),_:1}),l(I,{label:"ÊúÄËøëËøêË°å",width:"180"},{default:t(({row:n})=>[n.state?.lastRunAtMs?(r(),g(X,{key:0},[l(pe,{type:n.state?.lastStatus==="ok"?"success":"danger",size:"small"},{default:t(()=>[s(c(n.state?.lastStatus),1)]),_:2},1032,["type"]),l(F,{type:"info",size:"small",style:{"margin-left":"4px"}},{default:t(()=>[s(c(Ce(n.state?.lastRunAtMs)),1)]),_:2},1024)],64)):(r(),y(F,{key:1,type:"info",size:"small"},{default:t(()=>[...e[40]||(e[40]=[s("Êú™ËøêË°å",-1)])]),_:1}))]),_:1}),l(I,{label:"ÂêØÁî®",width:"80"},{default:t(({row:n})=>[l(_e,{modelValue:n.enabled,"onUpdate:modelValue":b=>n.enabled=b,onChange:b=>Ae(n)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),l(I,{label:"Êìç‰Ωú",width:"200"},{default:t(({row:n})=>[l(d,{size:"small",onClick:b=>Ee(n)},{default:t(()=>[...e[41]||(e[41]=[s("Á´ãÂç≥ËøêË°å",-1)])]),_:1},8,["onClick"]),l(d,{size:"small",type:"danger",onClick:b=>Se(n)},{default:t(()=>[...e[42]||(e[42]=[s("Âà†Èô§",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]),l(ae,{modelValue:S.value,"onUpdate:modelValue":e[23]||(e[23]=n=>S.value=n),title:"Êñ∞Âª∫ÂÆöÊó∂‰ªªÂä°",width:"520px"},{footer:t(()=>[l(d,{onClick:e[22]||(e[22]=n=>S.value=!1)},{default:t(()=>[...e[43]||(e[43]=[s("ÂèñÊ∂à",-1)])]),_:1}),l(d,{type:"primary",onClick:Ne},{default:t(()=>[...e[44]||(e[44]=[s("ÂàõÂª∫",-1)])]),_:1})]),default:t(()=>[l(ye,{model:p.value,"label-width":"100px"},{default:t(()=>[l(D,{label:"ÂêçÁß∞"},{default:t(()=>[l(_,{modelValue:p.value.name,"onUpdate:modelValue":e[17]||(e[17]=n=>p.value.name=n)},null,8,["modelValue"])]),_:1}),l(D,{label:"Cron Ë°®ËææÂºè"},{default:t(()=>[l(_,{modelValue:p.value.expr,"onUpdate:modelValue":e[18]||(e[18]=n=>p.value.expr=n),placeholder:"30 3 * * *"},null,8,["modelValue"])]),_:1}),l(D,{label:"Êó∂Âå∫"},{default:t(()=>[l(Ye,{modelValue:p.value.tz,"onUpdate:modelValue":e[19]||(e[19]=n=>p.value.tz=n)},{default:t(()=>[l(ne,{label:"Asia/Shanghai",value:"Asia/Shanghai"}),l(ne,{label:"UTC",value:"UTC"}),l(ne,{label:"America/New_York",value:"America/New_York"})]),_:1},8,["modelValue"])]),_:1}),l(D,{label:"Ê∂àÊÅØ"},{default:t(()=>[l(_,{modelValue:p.value.message,"onUpdate:modelValue":e[20]||(e[20]=n=>p.value.message=n),type:"textarea",rows:3},null,8,["modelValue"])]),_:1}),l(D,{label:"ÂêØÁî®"},{default:t(()=>[l(_e,{modelValue:p.value.enabled,"onUpdate:modelValue":e[21]||(e[21]=n=>p.value.enabled=n)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})}}}),Ul=ul(kl,[["__scopeId","data-v-e9d7c195"]]);export{Ul as default};
