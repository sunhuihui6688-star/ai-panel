import{d as ye,i as ge,I as _e,c as g,b as n,j as m,w as s,k as f,a,t as o,F as V,m as q,e as v,z as ne,r as _,o as i,h as d,l as K,B as we,V as be,s as ke,n as x,X as he,E as U}from"./index--B3_6xNz.js";import{q as E,b as Ve}from"./index-A6Vnzxup.js";import{_ as xe}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Ie={class:"tasks-page"},Ce={class:"page-header"},Te={class:"header-left"},ze={class:"header-actions"},Be={class:"filter-bar"},$e={class:"filter-count"},Ae={key:1,class:"task-list"},Ue={class:"task-header"},Se={class:"task-meta-row"},De={class:"task-label"},Me={class:"task-id"},Ne={class:"task-actions"},Le={class:"agent-flow"},qe={class:"flow-arrow"},Ee={class:"task-time"},Fe={class:"task-desc"},je={key:1,class:"output-preview"},Oe={class:"agent-option"},Pe={class:"agent-option-id"},Xe={class:"agent-option"},Ge={key:0,class:"permission-hint"},He={key:0},Je={style:{display:"flex",gap:"10px","margin-bottom":"12px","flex-wrap":"wrap","align-items":"center"}},Ke={style:{"font-size":"13px",color:"#64748b"}},Qe={style:{color:"#94a3b8"}},Re={style:{"font-size":"13px",color:"#64748b"}},We={style:{"font-size":"13px",color:"#94a3b8"}},Ye={class:"output-task-desc"},Ze={class:"output-full"},el=ye({__name:"SubagentsView",setup(ll){const S=v([]),Q=v([]),D=v([]),M=v(!1),F=v(null),N=v(""),L=v(""),I=v(""),C=v(!1),T=v(!1),u=v(null),j=v(!1),c=v("task"),h=v([]);let O;const r=v({spawnedBy:"",agentId:"",label:"",task:"",model:""}),P=ne(()=>S.value.filter(t=>!(N.value&&t.status!==N.value||L.value&&(t.taskType||"task")!==L.value||I.value&&t.agentId!==I.value&&t.spawnedBy!==I.value)).sort((t,l)=>(l.createdAt||0)-(t.createdAt||0))),X=ne(()=>S.value.filter(t=>t.status==="running"||t.status==="pending").length);function b(t){return D.value.find(l=>l.id===t)?.name||t}function k(t){return D.value.find(l=>l.id===t)?.avatarColor||"#6366f1"}function G(t){return b(t).charAt(0)}function R(t){return{running:"success",done:"primary",error:"danger",killed:"warning",pending:"info"}[t]||"info"}function W(t){return{running:"è¿è¡Œä¸­",done:"å·²å®Œæˆ",error:"å‡ºé”™",killed:"å·²ç»ˆæ­¢",pending:"ç­‰å¾…ä¸­"}[t]||t}function Y(t){switch(t){case"report":return"æ±‡æŠ¥";case"system":return"ç³»ç»Ÿ";default:return"æ´¾é£"}}function Z(t){switch(t){case"report":return"warning";case"system":return"info";default:return"primary"}}function se(t){return t?new Date(t).toLocaleString("zh-CN",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"â€”"}function ee(t){if(!t.startedAt)return"â€”";const p=(t.endedAt||Date.now())-t.startedAt;if(p<1e3)return"< 1s";if(p<6e4)return`${Math.round(p/1e3)}s`;const y=Math.floor(p/6e4),B=Math.round(p%6e4/1e3);return`${y}m${B}s`}function oe(t){return t.trim().split(`
`).slice(-3).join(`
`)}async function z(){M.value=!0;try{const t=await E.list();if(S.value=t.data,u.value){const l=S.value.find(p=>p.id===u.value.id);l&&(u.value=l)}}catch{}finally{M.value=!1}}async function ue(){try{const t=await Ve.list();D.value=t.data,Q.value=t.data.filter(l=>!l.system)}catch{}}async function le(t){F.value=t;try{await E.kill(t),U.success("ä»»åŠ¡å·²ç»ˆæ­¢"),await z()}catch(l){U.error(l?.response?.data?.error||"ç»ˆæ­¢å¤±è´¥")}finally{F.value=null}}function re(t){u.value=t,T.value=!0}function te(t){c.value=t,r.value={spawnedBy:"",agentId:"",label:"",task:"",model:""},h.value=[],C.value=!0}async function ie(t){if(r.value.agentId="",h.value=[],!!t)try{const l=await E.eligibleTargets(t,c.value);h.value=l.data}catch{}}async function de(){if(!(!r.value.agentId||!r.value.task.trim())){j.value=!0;try{await E.spawn({agentId:r.value.agentId,label:r.value.label,task:r.value.task,model:r.value.model,spawnedBy:r.value.spawnedBy||void 0,taskType:c.value}),U.success(c.value==="report"?"æ±‡æŠ¥å·²å‘é€":"ä»»åŠ¡å·²æ´¾é£ï¼Œåå°æ‰§è¡Œä¸­"),C.value=!1,await z()}catch(t){U.error(t?.response?.data?.error||"æ“ä½œå¤±è´¥")}finally{j.value=!1}}}function pe(t){navigator.clipboard?.writeText(t),U.success("å·²å¤åˆ¶")}return ge(async()=>{await ue(),await z(),O=window.setInterval(()=>{X.value>0&&z()},3e3)}),_e(()=>{O&&clearInterval(O)}),(t,l)=>{const p=_("el-tag"),y=_("el-button"),B=_("el-icon"),w=_("el-option"),$=_("el-select"),ve=_("el-empty"),H=_("el-alert"),fe=_("el-progress"),A=_("el-form-item"),J=_("el-input"),ce=_("el-form"),ae=_("el-dialog");return i(),g("div",Ie,[n("div",Ce,[n("div",Te,[l[16]||(l[16]=n("h2",{style:{margin:"0"}},"åå°ä»»åŠ¡",-1)),X.value>0?(i(),m(p,{key:0,type:"success",size:"small",effect:"dark"},{default:s(()=>[d(o(X.value)+" è¿è¡Œä¸­ ",1)]),_:1})):f("",!0)]),n("div",ze,[a(y,{size:"small",onClick:z,loading:M.value},{default:s(()=>[...l[17]||(l[17]=[d("åˆ·æ–°",-1)])]),_:1},8,["loading"]),a(y,{size:"small",type:"primary",onClick:l[0]||(l[0]=e=>te("task"))},{default:s(()=>[a(B,null,{default:s(()=>[a(K(we))]),_:1}),l[18]||(l[18]=d(" æ´¾é£ä»»åŠ¡ ",-1))]),_:1}),a(y,{size:"small",type:"warning",plain:"",onClick:l[1]||(l[1]=e=>te("report"))},{default:s(()=>[a(B,null,{default:s(()=>[a(K(be))]),_:1}),l[19]||(l[19]=d(" æ±‡æŠ¥ ",-1))]),_:1})])]),n("div",Be,[a($,{modelValue:N.value,"onUpdate:modelValue":l[2]||(l[2]=e=>N.value=e),placeholder:"æ‰€æœ‰çŠ¶æ€",clearable:"",size:"small",style:{width:"120px"}},{default:s(()=>[a(w,{label:"è¿è¡Œä¸­",value:"running"}),a(w,{label:"å·²å®Œæˆ",value:"done"}),a(w,{label:"å‡ºé”™",value:"error"}),a(w,{label:"å·²ç»ˆæ­¢",value:"killed"}),a(w,{label:"ç­‰å¾…ä¸­",value:"pending"})]),_:1},8,["modelValue"]),a($,{modelValue:L.value,"onUpdate:modelValue":l[3]||(l[3]=e=>L.value=e),placeholder:"æ‰€æœ‰ç±»å‹",clearable:"",size:"small",style:{width:"120px"}},{default:s(()=>[a(w,{label:"æ´¾é£ä»»åŠ¡",value:"task"}),a(w,{label:"æ±‡æŠ¥",value:"report"}),a(w,{label:"ç³»ç»Ÿ",value:"system"})]),_:1},8,["modelValue"]),a($,{modelValue:I.value,"onUpdate:modelValue":l[4]||(l[4]=e=>I.value=e),placeholder:"æ‰€æœ‰æˆå‘˜",clearable:"",size:"small",style:{width:"140px"}},{default:s(()=>[(i(!0),g(V,null,q(Q.value,e=>(i(),m(w,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),n("span",$e,"å…± "+o(P.value.length)+" ä¸ª",1)]),P.value.length===0&&!M.value?(i(),m(ve,{key:0,description:"æš‚æ— åå°ä»»åŠ¡",style:{"margin-top":"60px"}},{description:s(()=>[...l[20]||(l[20]=[n("p",{style:{color:"#94a3b8","font-size":"13px","text-align":"center",margin:"0"}},[d(" ä¸Šçº§å¯å‘ä¸‹çº§ã€Œæ´¾é£ä»»åŠ¡ã€"),n("br"),d(" ä¸‹çº§å¯å‘ä¸Šçº§ã€Œæ±‡æŠ¥ã€"),n("br"),d(" å¹³çº§åä½œæˆå‘˜å¯äº’ç›¸æ´¾é£ä¸æ±‡æŠ¥ ")],-1)])]),_:1})):(i(),g("div",Ae,[(i(!0),g(V,null,q(P.value,e=>(i(),g("div",{key:e.id,class:ke(["task-card",`task-${e.status}`])},[n("div",Ue,[n("div",Se,[a(p,{type:R(e.status),size:"small",effect:"dark",style:{"flex-shrink":"0"}},{default:s(()=>[d(o(W(e.status)),1)]),_:2},1032,["type"]),a(p,{type:Z(e.taskType),size:"small",effect:"plain",style:{"flex-shrink":"0"}},{default:s(()=>[d(o(Y(e.taskType)),1)]),_:2},1032,["type"]),e.relation?(i(),m(p,{key:0,size:"small",type:"info",effect:"plain",style:{"flex-shrink":"0"}},{default:s(()=>[d(o(e.relation),1)]),_:2},1024)):f("",!0),n("span",De,o(e.label||"ï¼ˆæ— æ ‡ç­¾ï¼‰"),1),n("code",Me,o(e.id),1)]),n("div",Ne,[e.status==="running"||e.status==="pending"?(i(),m(y,{key:0,size:"small",type:"danger",link:"",onClick:me=>le(e.id),loading:F.value===e.id},{default:s(()=>[...l[21]||(l[21]=[d("ç»ˆæ­¢",-1)])]),_:1},8,["onClick","loading"])):f("",!0),a(y,{size:"small",link:"",onClick:me=>re(e)},{default:s(()=>[...l[22]||(l[22]=[d("æŸ¥çœ‹è¾“å‡º",-1)])]),_:1},8,["onClick"])])]),n("div",Le,[e.spawnedBy?(i(),g(V,{key:0},[n("div",{class:"agent-chip",style:x({background:k(e.spawnedBy)+"22",borderColor:k(e.spawnedBy)})},[n("div",{class:"agent-dot",style:x({background:k(e.spawnedBy)})},o(G(e.spawnedBy)),5),n("span",null,o(b(e.spawnedBy)),1)],4),n("span",qe,o(e.taskType==="report"?"â¬† æ±‡æŠ¥":"â¬‡ æ´¾é£"),1)],64)):f("",!0),n("div",{class:"agent-chip",style:x({background:k(e.agentId)+"22",borderColor:k(e.agentId)})},[n("div",{class:"agent-dot",style:x({background:k(e.agentId)})},o(G(e.agentId)),5),n("span",null,o(b(e.agentId)),1)],4),n("span",Ee,"â± "+o(ee(e))+" Â· "+o(se(e.createdAt)),1)]),n("div",Fe,o(e.task),1),e.error?(i(),m(H,{key:0,type:"error",description:e.error,closable:!1,"show-icon":"",style:{"margin-top":"6px"}},null,8,["description"])):f("",!0),e.output&&e.status!=="pending"?(i(),g("div",je,[n("pre",null,o(oe(e.output)),1)])):f("",!0),e.status==="running"?(i(),m(fe,{key:2,percentage:100,status:"striped",striped:"","striped-flow":"",duration:3,style:{"margin-top":"8px"}})):f("",!0)],2))),128))])),a(ae,{modelValue:C.value,"onUpdate:modelValue":l[11]||(l[11]=e=>C.value=e),title:c.value==="report"?"å‘ä¸Šçº§æ±‡æŠ¥":"æ´¾é£ä»»åŠ¡",width:"560px","close-on-click-modal":!1},{footer:s(()=>[a(y,{onClick:l[10]||(l[10]=e=>C.value=!1)},{default:s(()=>[...l[23]||(l[23]=[d("å–æ¶ˆ",-1)])]),_:1}),a(y,{type:c.value==="report"?"warning":"primary",onClick:de,loading:j.value,disabled:!r.value.agentId||!r.value.task.trim()},{default:s(()=>[d(o(c.value==="report"?"å‘é€æ±‡æŠ¥":"æ´¾é£ä»»åŠ¡"),1)]),_:1},8,["type","loading","disabled"])]),default:s(()=>[a(H,{type:c.value==="report"?"warning":"info",title:c.value==="report"?"æ±‡æŠ¥ï¼šä¸‹çº§å‘ä¸Šçº§å‘é€ä»»åŠ¡å®Œæˆæƒ…å†µæˆ–å®šæœŸæ±‡æŠ¥":"æ´¾é£ï¼šä¸Šçº§å‘ä¸‹çº§åˆ†é…ä»»åŠ¡ï¼Œæˆ–å¹³çº§åä½œäº’ç›¸å§”æ‰˜",closable:!1,"show-icon":"",style:{"margin-bottom":"16px"}},null,8,["type","title"]),a(ce,{model:r.value,"label-width":"80px",size:"small"},{default:s(()=>[a(A,{label:"å‘èµ·æˆå‘˜",required:""},{default:s(()=>[a($,{modelValue:r.value.spawnedBy,"onUpdate:modelValue":l[5]||(l[5]=e=>r.value.spawnedBy=e),placeholder:"é€‰æ‹©å‘èµ·æˆå‘˜",style:{width:"100%"},onChange:ie,clearable:""},{default:s(()=>[(i(!0),g(V,null,q(D.value,e=>(i(),m(w,{key:e.id,label:e.name,value:e.id},{default:s(()=>[n("div",Oe,[n("div",{class:"agent-dot-sm",style:x({background:e.avatarColor||"#6366f1"})},o(e.name.charAt(0)),5),n("span",null,o(e.name),1),n("span",Pe,o(e.id),1)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(A,{label:"ç›®æ ‡æˆå‘˜",required:""},{default:s(()=>[a($,{modelValue:r.value.agentId,"onUpdate:modelValue":l[6]||(l[6]=e=>r.value.agentId=e),placeholder:r.value.spawnedBy?h.value.length?"é€‰æ‹©ç›®æ ‡æˆå‘˜":"æ— å¯ç”¨ç›®æ ‡ï¼ˆæ£€æŸ¥å…³ç³»é…ç½®ï¼‰":"è¯·å…ˆé€‰æ‹©å‘èµ·æˆå‘˜",style:{width:"100%"},disabled:!r.value.spawnedBy},{default:s(()=>[(i(!0),g(V,null,q(h.value,e=>(i(),m(w,{key:e.agentId,label:b(e.agentId),value:e.agentId},{default:s(()=>[n("div",Xe,[n("div",{class:"agent-dot-sm",style:x({background:k(e.agentId)})},o(G(e.agentId)),5),n("span",null,o(b(e.agentId)),1),a(p,{size:"small",type:"info",effect:"plain",style:{"font-size":"11px"}},{default:s(()=>[d(o(e.relation),1)]),_:2},1024)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","placeholder","disabled"]),r.value.spawnedBy&&h.value.length===0?(i(),g("div",Ge,[a(B,null,{default:s(()=>[a(K(he))]),_:1}),d(" "+o(c.value==="report"?"è¯¥æˆå‘˜æ²¡æœ‰ä¸Šçº§æˆ–å¹³çº§åä½œå…³ç³»":"è¯¥æˆå‘˜æ²¡æœ‰ä¸‹çº§æˆ–å¹³çº§åä½œå…³ç³»")+" â€” è¯·å…ˆåœ¨ã€Œå›¢é˜Ÿã€é¡µé¢é…ç½®å…³ç³» ",1)])):f("",!0)]),_:1}),a(A,{label:"æ ‡ç­¾"},{default:s(()=>[a(J,{modelValue:r.value.label,"onUpdate:modelValue":l[7]||(l[7]=e=>r.value.label=e),placeholder:c.value==="report"?"å¦‚ï¼šæœˆåº¦æ±‡æŠ¥ã€ä»»åŠ¡å®Œæˆé€šçŸ¥":"ç®€çŸ­æ ‡ç­¾ï¼ˆå¯é€‰ï¼‰"},null,8,["modelValue","placeholder"])]),_:1}),a(A,{label:"æ¨¡å‹"},{default:s(()=>[a(J,{modelValue:r.value.model,"onUpdate:modelValue":l[8]||(l[8]=e=>r.value.model=e),placeholder:"ç•™ç©ºä½¿ç”¨ç›®æ ‡æˆå‘˜é»˜è®¤æ¨¡å‹"},null,8,["modelValue"])]),_:1}),a(A,{label:c.value==="report"?"æ±‡æŠ¥å†…å®¹":"ä»»åŠ¡æè¿°",required:""},{default:s(()=>[a(J,{modelValue:r.value.task,"onUpdate:modelValue":l[9]||(l[9]=e=>r.value.task=e),type:"textarea",rows:6,placeholder:c.value==="report"?"æ±‡æŠ¥å†…å®¹ï¼šä»»åŠ¡è¿›å±•ã€å®Œæˆæƒ…å†µã€éœ€è¦ä¸Šçº§äº†è§£çš„äº‹é¡¹...":"è¯¦ç»†æè¿°ä»»åŠ¡ç›®æ ‡ã€è¦æ±‚ã€é¢„æœŸç»“æœ..."},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),a(ae,{modelValue:T.value,"onUpdate:modelValue":l[15]||(l[15]=e=>T.value=e),title:`è¾“å‡º â€” ${u.value?.label||u.value?.id}`,width:"720px",top:"5vh"},{footer:s(()=>[a(y,{onClick:l[12]||(l[12]=e=>T.value=!1)},{default:s(()=>[...l[25]||(l[25]=[d("å…³é—­",-1)])]),_:1}),u.value&&(u.value.status==="running"||u.value.status==="pending")?(i(),m(y,{key:0,type:"danger",onClick:l[13]||(l[13]=e=>{le(u.value.id),T.value=!1})},{default:s(()=>[...l[26]||(l[26]=[d("ç»ˆæ­¢",-1)])]),_:1})):f("",!0),u.value?.output?(i(),m(y,{key:1,onClick:l[14]||(l[14]=e=>pe(u.value.output))},{default:s(()=>[...l[27]||(l[27]=[d("å¤åˆ¶",-1)])]),_:1})):f("",!0)]),default:s(()=>[u.value?(i(),g("div",He,[n("div",Je,[a(p,{type:R(u.value.status),effect:"dark"},{default:s(()=>[d(o(W(u.value.status)),1)]),_:1},8,["type"]),a(p,{type:Z(u.value.taskType),effect:"plain"},{default:s(()=>[d(o(Y(u.value.taskType)),1)]),_:1},8,["type"]),u.value.relation?(i(),m(p,{key:0,type:"info",effect:"plain"},{default:s(()=>[d(o(u.value.relation),1)]),_:1})):f("",!0),u.value.spawnedBy?(i(),g(V,{key:1},[n("span",Ke,o(b(u.value.spawnedBy)),1),n("span",Qe,o(u.value.taskType==="report"?"â¬†":"â¬‡"),1)],64)):f("",!0),n("span",Re,"ğŸ¤– "+o(b(u.value.agentId)),1),n("span",We,"â± "+o(ee(u.value)),1)]),n("div",Ye,o(u.value.task),1),u.value.error?(i(),m(H,{key:0,type:"error",description:u.value.error,closable:!1,"show-icon":"",style:{"margin-bottom":"12px"}},null,8,["description"])):f("",!0),l[24]||(l[24]=n("div",{style:{"font-size":"13px","font-weight":"600",color:"#475569","margin-bottom":"6px"}},"è¾“å‡ºï¼š",-1)),n("pre",Ze,o(u.value.output||"ï¼ˆæš‚æ— è¾“å‡ºï¼‰"),1)])):f("",!0)]),_:1},8,["modelValue","title"])])}}}),sl=xe(el,[["__scopeId","data-v-e2f6bbc8"]]);export{sl as default};
