import{d as ie,h as de,c as f,f as o,t as n,a,w as s,i as x,D as re,g as u,E as _,r as i,o as c,e as p,F as M,j as q,k as N,M as ue,p as ce,b as S,N as fe,s as pe,O as me,n as ve,l as _e,C as ge,I as ye,m as xe,P as he}from"./index-C5QqZS7j.js";import{h as E,b as we}from"./index-DGv0meEh.js";import{_ as ke}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Ce={class:"chats-page"},be={class:"page-header"},ze={style:{"font-size":"13px",color:"#909399","margin-top":"4px"}},Ve={class:"filter-bar"},Ie={style:{display:"flex","flex-direction":"column",gap:"2px"}},Ee={style:{"font-weight":"500","font-size":"14px"}},Te={style:{"font-size":"12px",color:"#909399"}},Le={style:{"font-size":"13px",color:"#606266"}},$e={style:{"font-size":"13px"}},Ae={style:{flex:"1","min-width":"0"}},Me={key:0,style:{display:"flex","align-items":"center",gap:"8px"}},Ne={style:{"font-weight":"600","font-size":"16px",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap"}},Se={key:1,style:{display:"flex","align-items":"center",gap:"8px"}},De={style:{"font-size":"12px",color:"#909399","margin-top":"4px"}},Be={key:0,style:{"text-align":"center",padding:"40px"}},Ue={key:1,class:"message-list"},Fe={key:0,class:"compact-marker"},Ke={style:{"font-size":"12px",color:"#606266","line-height":"1.6"}},He={class:"msg-avatar"},Pe={class:"msg-body"},Re={class:"msg-meta"},je={class:"msg-role"},Oe={class:"msg-time"},qe=["innerHTML"],Ge=ie({__name:"ChatsView",setup(Je){const h=u([]),D=u(0),w=u(!1),T=u(""),k=u(""),C=u("lastAt"),B=u([]),b=u(!1),d=u(null),z=u([]),V=u(!1),g=u(!1),v=u(""),G=xe(()=>{let t=h.value;if(k.value){const e=k.value.toLowerCase();t=t.filter(r=>(r.title||"").toLowerCase().includes(e)||r.id.toLowerCase().includes(e)||(r.agentName||"").toLowerCase().includes(e))}return C.value==="messageCount"?t=[...t].sort((e,r)=>r.messageCount-e.messageCount):C.value==="tokenEstimate"&&(t=[...t].sort((e,r)=>r.tokenEstimate-e.tokenEstimate)),t});async function y(){w.value=!0;try{const t=await E.list({agentId:T.value||void 0,limit:200});h.value=t.data.sessions,D.value=t.data.total}catch(t){_.error("åŠ è½½å¤±è´¥ï¼š"+(t.message||""))}finally{w.value=!1}}async function J(){try{const t=await we.list();B.value=t.data}catch{}}async function U(t){d.value=t,b.value=!0,g.value=!1,z.value=[],V.value=!0;try{const e=await E.get(t.agentId,t.id);z.value=e.data.messages}catch(e){_.error("åŠ è½½å¯¹è¯å¤±è´¥ï¼š"+(e.message||""))}finally{V.value=!1}}async function Q(t){try{await E.delete(t.agentId,t.id),_.success("å·²åˆ é™¤"),d.value?.id===t.id&&(b.value=!1),y()}catch(e){_.error("åˆ é™¤å¤±è´¥ï¼š"+(e.message||""))}}function W(){v.value=d.value?.title||"",g.value=!0}async function F(){if(d.value)try{await E.rename(d.value.agentId,d.value.id,v.value),d.value.title=v.value;const t=h.value.findIndex(e=>e.id===d.value.id);t>=0&&(h.value[t].title=v.value),g.value=!1,_.success("å·²é‡å‘½å")}catch(t){_.error("ä¿å­˜å¤±è´¥ï¼š"+(t.message||""))}}function X({row:t}){return d.value?.id===t.id?"active-row":""}function L(t){return t?new Date(t).toLocaleString("zh-CN",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"â€”"}function Y(t){if(!t)return"â€”";const e=Date.now()-t;return e<6e4?"åˆšåˆš":e<36e5?`${Math.floor(e/6e4)} åˆ†é’Ÿå‰`:e<864e5?`${Math.floor(e/36e5)} å°æ—¶å‰`:e<7*864e5?`${Math.floor(e/864e5)} å¤©å‰`:L(t)}function K(t){return t?t>=1e3?`${(t/1e3).toFixed(1)}k`:String(t):"0"}function Z(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/```[\s\S]*?```/g,e=>`<pre class="code-block">${e.slice(3,-3)}</pre>`).replace(/`([^`]+)`/g,"<code>$1</code>").replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\n/g,"<br>")}return de(async()=>{await Promise.all([y(),J()])}),(t,e)=>{const r=i("el-button"),I=i("el-option"),H=i("el-select"),P=i("el-input"),$=i("el-card"),m=i("el-table-column"),R=i("el-tag"),ee=i("el-badge"),te=i("el-popconfirm"),j=i("el-empty"),le=i("el-table"),O=i("el-icon"),ae=i("el-divider"),se=i("el-avatar"),oe=i("el-drawer"),ne=he("loading");return c(),f("div",Ce,[o("div",be,[o("div",null,[e[8]||(e[8]=o("h2",{style:{margin:"0"}},"ğŸ’¬ å¯¹è¯ç®¡ç†",-1)),o("div",ze," å…± "+n(D.value)+" æ¡å¯¹è¯ Â· è·¨æ‰€æœ‰ AI å‘˜å·¥ ",1)]),a(r,{onClick:y,loading:w.value,icon:x(re)},{default:s(()=>[...e[9]||(e[9]=[p("åˆ·æ–°",-1)])]),_:1},8,["loading","icon"])]),a($,{shadow:"never",style:{"margin-bottom":"16px",padding:"0"}},{default:s(()=>[o("div",Ve,[a(H,{modelValue:T.value,"onUpdate:modelValue":e[0]||(e[0]=l=>T.value=l),placeholder:"å…¨éƒ¨å‘˜å·¥",clearable:"",style:{width:"180px"},onChange:y},{default:s(()=>[(c(!0),f(M,null,q(B.value,l=>(c(),N(I,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),a(P,{modelValue:k.value,"onUpdate:modelValue":e[1]||(e[1]=l=>k.value=l),placeholder:"æœç´¢å¯¹è¯æ ‡é¢˜â€¦",clearable:"",style:{width:"240px"},"prefix-icon":x(ue)},null,8,["modelValue","prefix-icon"]),a(H,{modelValue:C.value,"onUpdate:modelValue":e[2]||(e[2]=l=>C.value=l),style:{width:"140px"},onChange:y},{default:s(()=>[a(I,{label:"æœ€è¿‘æ´»è·ƒ",value:"lastAt"}),a(I,{label:"æ¶ˆæ¯æœ€å¤š",value:"messageCount"}),a(I,{label:"Token æœ€å¤š",value:"tokenEstimate"})]),_:1},8,["modelValue"])])]),_:1}),a($,{shadow:"never"},{default:s(()=>[ce((c(),N(le,{data:G.value,stripe:"","row-class-name":X,onRowClick:U,style:{cursor:"pointer"}},{empty:s(()=>[a(j,{description:"æš‚æ— å¯¹è¯è®°å½•"})]),default:s(()=>[a(m,{label:"å¯¹è¯æ ‡é¢˜","min-width":"220"},{default:s(({row:l})=>[o("div",Ie,[o("span",Ee,n(l.title||"ï¼ˆæ— æ ‡é¢˜ï¼‰"),1),o("span",Te,"ID: "+n(l.id),1)])]),_:1}),a(m,{label:"AI å‘˜å·¥",width:"130"},{default:s(({row:l})=>[a(R,{size:"small",type:"primary",effect:"plain"},{default:s(()=>[p(n(l.agentName||l.agentId),1)]),_:2},1024)]),_:1}),a(m,{label:"æ¶ˆæ¯æ•°",width:"90",align:"center"},{default:s(({row:l})=>[a(ee,{value:l.messageCount,type:"info"},null,8,["value"])]),_:1}),a(m,{label:"Token ç”¨é‡",width:"130",align:"center"},{default:s(({row:l})=>[a(R,{type:l.tokenEstimate>6e4?"danger":l.tokenEstimate>3e4?"warning":"success",size:"small",effect:"plain"},{default:s(()=>[p(n(K(l.tokenEstimate)),1)]),_:2},1032,["type"])]),_:1}),a(m,{label:"åˆ›å»ºæ—¶é—´",width:"150"},{default:s(({row:l})=>[o("span",Le,n(L(l.createdAt)),1)]),_:1}),a(m,{label:"æœ€åæ´»è·ƒ",width:"150"},{default:s(({row:l})=>[o("span",$e,n(Y(l.lastAt)),1)]),_:1}),a(m,{label:"æ“ä½œ",width:"130",onClick:e[4]||(e[4]=S(()=>{},["stop"]))},{default:s(({row:l})=>[a(r,{size:"small",onClick:S(A=>U(l),["stop"])},{default:s(()=>[...e[10]||(e[10]=[p("æŸ¥çœ‹",-1)])]),_:1},8,["onClick"]),a(te,{title:"ç¡®è®¤åˆ é™¤æ­¤å¯¹è¯ï¼Ÿ",onConfirm:A=>Q(l),width:"200"},{reference:s(()=>[a(r,{size:"small",type:"danger",onClick:e[3]||(e[3]=S(()=>{},["stop"]))},{default:s(()=>[...e[11]||(e[11]=[p("åˆ é™¤",-1)])]),_:1})]),_:1},8,["onConfirm"])]),_:1})]),_:1},8,["data"])),[[ne,w.value]])]),_:1}),a(oe,{modelValue:b.value,"onUpdate:modelValue":e[7]||(e[7]=l=>b.value=l),title:d.value?.title||"å¯¹è¯è¯¦æƒ…",size:"50%",direction:"rtl"},{header:s(()=>[o("div",Ae,[g.value?(c(),f("div",Se,[a(P,{modelValue:v.value,"onUpdate:modelValue":e[5]||(e[5]=l=>v.value=l),size:"small",style:{flex:"1"},onKeyup:ye(F,["enter"])},null,8,["modelValue"]),a(r,{type:"primary",size:"small",onClick:F},{default:s(()=>[...e[12]||(e[12]=[p("ä¿å­˜",-1)])]),_:1}),a(r,{size:"small",onClick:e[6]||(e[6]=l=>g.value=!1)},{default:s(()=>[...e[13]||(e[13]=[p("å–æ¶ˆ",-1)])]),_:1})])):(c(),f("div",Me,[o("span",Ne,n(d.value?.title||"ï¼ˆæ— æ ‡é¢˜ï¼‰"),1),a(r,{icon:x(ge),circle:"",size:"small",onClick:W},null,8,["icon"])])),o("div",De,n(d.value?.agentName)+" Â· "+n(d.value?.messageCount??0)+" æ¡æ¶ˆæ¯ Â· "+n(K(d.value?.tokenEstimate??0))+" tokens ",1)])]),default:s(()=>[V.value?(c(),f("div",Be,[a(O,{class:"is-loading",style:{"font-size":"32px",color:"#409eff"}},{default:s(()=>[a(x(fe))]),_:1}),e[14]||(e[14]=o("div",{style:{"margin-top":"12px",color:"#909399"}},"åŠ è½½å¯¹è¯å†å²â€¦",-1))])):(c(),f("div",Ue,[(c(!0),f(M,null,q(z.value,(l,A)=>(c(),f("div",{key:A,class:pe(["message-item",`msg-${l.role}`])},[l.isCompact?(c(),f("div",Fe,[a(ae,null,{default:s(()=>[a(O,null,{default:s(()=>[a(x(me))]),_:1}),e[15]||(e[15]=o("span",{style:{"margin-left":"6px","font-size":"12px",color:"#909399"}},"ä»¥ä¸Šå†…å®¹å·²å‹ç¼©",-1))]),_:1}),a($,{class:"compact-summary",shadow:"never"},{default:s(()=>[o("div",Ke,[e[16]||(e[16]=o("strong",null,"æ‘˜è¦ï¼š",-1)),p(n(l.text),1)])]),_:2},1024)])):(c(),f(M,{key:1},[o("div",He,[a(se,{size:32,style:ve({background:l.role==="user"?"#409eff":"#67c23a"})},{default:s(()=>[p(n(l.role==="user"?"ç”¨":"AI"),1)]),_:2},1032,["style"])]),o("div",Pe,[o("div",Re,[o("span",je,n(l.role==="user"?"ç”¨æˆ·":"AI åŠ©æ‰‹"),1),o("span",Oe,n(L(l.timestamp)),1)]),o("div",{class:"msg-text",innerHTML:Z(l.text)},null,8,qe)])],64))],2))),128)),!z.value.length&&!V.value?(c(),N(j,{key:0,description:"æš‚æ— æ¶ˆæ¯è®°å½•"})):_e("",!0)]))]),_:1},8,["modelValue","title"])])}}}),Ye=ke(Ge,[["__scopeId","data-v-4a13da8a"]]);export{Ye as default};
