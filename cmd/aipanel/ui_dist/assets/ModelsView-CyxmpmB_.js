import{d as ve,h as ye,c as f,b as u,a as t,w as a,i as V,j as q,g as c,r as s,o as d,f as i,F as R,l as T,t as p,k as _e,I as ge,x as be,p as xe,E as g,M as Ve}from"./index-BT96GM_8.js";import{m as k}from"./index-B6ZRKErS.js";import{_ as ke}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Ce={class:"models-page"},he={style:{display:"flex","justify-content":"space-between","align-items":"center","margin-bottom":"16px"}},Ke={style:{"font-weight":"600"}},Ue={style:{display:"flex","flex-wrap":"wrap",gap:"8px","margin-top":"6px","align-items":"center"}},we={style:{"font-size":"12px",color:"#606266"}},ze={key:1,style:{"font-size":"12px",color:"#909399"}},De={style:{"font-size":"13px"}},Ie={class:"field-hint"},Me={key:0,style:{color:"var(--el-color-success)"}},$e={key:1},Ae={style:{display:"flex",gap:"8px",width:"100%","align-items":"center"}},Ee={key:0,style:{"font-size":"12px",color:"var(--el-color-danger)"}},Pe={key:1,style:{"font-size":"12px",color:"var(--el-color-success)"}},Be={key:2,style:{"font-size":"12px",color:"#909399"}},Se=ve({__name:"ModelsView",setup(je){const I=c([]),b=c(!1),C=c(""),A=c(!1),E=c(""),P=c(!1),m=c(""),r=c([]),B=c(""),M=c([]),h={anthropic:"https://api.anthropic.com",openai:"https://api.openai.com",deepseek:"https://api.deepseek.com",openrouter:"https://openrouter.ai/api",custom:""};function N(o){return h[o]||"—"}const x=be(()=>M.value.find(o=>o.provider===n.provider)||null),n=xe({id:"",name:"",provider:"anthropic",model:"",apiKey:"",baseUrl:"https://api.anthropic.com",isDefault:!1});ye(async()=>{await Promise.all([$(),G()])});async function $(){try{const o=await k.list();I.value=o.data}catch{}}async function G(){try{const o=await k.envKeys();M.value=o.data.envKeys||[]}catch{}}function H(){n.baseUrl=h[n.provider]||"",n.model="",r.value=[],m.value="",n.provider==="openrouter"&&S()}function J(o){const e=r.value.find(K=>K.id===o);e&&(n.name=e.name&&e.name!==e.id?e.name:o),n.id||(n.id=o.replace(/[^a-z0-9]/gi,"-").toLowerCase().replace(/-+/g,"-").replace(/^-|-$/g,""))}function Q(){n.name||(n.name=n.model),n.id||(n.id=n.model.replace(/[^a-z0-9]/gi,"-").toLowerCase().replace(/-+/g,"-").replace(/^-|-$/g,""))}async function S(){if(!n.baseUrl){m.value="请先填写调用地址";return}P.value=!0,m.value="",r.value=[];let o=n.apiKey;(!o||o.includes("***"))&&(o="");try{const e=await k.probe(n.baseUrl,o||void 0,n.provider);r.value=e.data.models||[],r.value.length||(m.value="未获取到模型列表（接口返回为空）")}catch(e){m.value=e.response?.data?.error||e.message||"获取失败"}finally{P.value=!1}}async function W(o){B.value=o.envVar;try{if(I.value.find(K=>K.provider===o.provider)){g.warning(`${o.provider} 已有配置，请直接编辑`);return}C.value="",r.value=[],m.value="",Object.assign(n,{id:o.provider+"-default",name:X(o.provider)+" (env)",provider:o.provider,model:"",apiKey:"",baseUrl:o.baseUrl,isDefault:I.value.length===0}),b.value=!0,o.provider==="openrouter"&&S()}finally{B.value=""}}function X(o){return o.charAt(0).toUpperCase()+o.slice(1)}function Y(){C.value="",r.value=[],m.value="",Object.assign(n,{id:"",name:"",provider:"anthropic",model:"",apiKey:"",baseUrl:h.anthropic,isDefault:!1}),b.value=!0}function Z(o){C.value=o.id,r.value=[],m.value="",Object.assign(n,{id:o.id,name:o.name,provider:o.provider,model:o.model,apiKey:o.apiKey,baseUrl:o.baseUrl||h[o.provider]||"",isDefault:o.isDefault}),b.value=!0}async function ee(){if(!n.id||!n.provider||!n.model){g.warning("请填写必要字段（唯一ID / 提供商 / 模型 ID）");return}A.value=!0;try{const o={...n};C.value?await k.update(C.value,o):await k.create({...o,status:"untested"}),g.success("保存成功"),b.value=!1,$()}catch(o){g.error(o.response?.data?.error||"保存失败")}finally{A.value=!1}}async function le(o){E.value=o.id;try{const e=await k.test(o.id);e.data.valid?g.success("连接成功！"):g.error("连接失败: "+(e.data.error||"")),$()}catch{g.error("测试请求失败")}finally{E.value=""}}async function te(o){try{await Ve.confirm(`确定删除模型 "${o.name}"？`,"确认删除",{type:"warning"}),await k.delete(o.id),g.success("已删除"),$()}catch{}}return(o,e)=>{const K=s("Plus"),U=s("el-icon"),v=s("el-button"),ae=s("Key"),w=s("el-tag"),O=s("el-alert"),y=s("el-table-column"),F=s("el-text"),L=s("el-tooltip"),oe=s("Connection"),ne=s("el-table"),se=s("el-card"),z=s("el-radio-button"),ie=s("el-radio-group"),_=s("el-form-item"),D=s("el-input"),de=s("CircleCheck"),re=s("Search"),ue=s("el-option"),pe=s("el-select"),me=s("el-switch"),fe=s("el-form"),ce=s("el-dialog");return d(),f("div",Ce,[u("div",he,[e[12]||(e[12]=u("h2",{style:{margin:"0"}},"模型配置",-1)),t(v,{type:"primary",onClick:Y},{default:a(()=>[t(U,null,{default:a(()=>[t(K)]),_:1}),e[11]||(e[11]=i(" 添加模型 ",-1))]),_:1})]),M.value.length?(d(),V(O,{key:0,type:"success",closable:!1,style:{"margin-bottom":"16px"}},{title:a(()=>[u("span",Ke,[t(U,{style:{"vertical-align":"-2px","margin-right":"4px"}},{default:a(()=>[t(ae)]),_:1}),e[13]||(e[13]=i("检测到系统环境变量中的 API Key",-1))])]),default:a(()=>[u("div",Ue,[(d(!0),f(R,null,T(M.value,l=>(d(),f("span",{key:l.envVar,style:{display:"flex","align-items":"center",gap:"6px"}},[t(w,{type:"success",size:"small"},{default:a(()=>[i(p(l.envVar),1)]),_:2},1024),u("span",we,p(l.masked),1),t(v,{size:"small",type:"success",plain:"",onClick:j=>W(l),loading:B.value===l.envVar},{default:a(()=>[...e[14]||(e[14]=[i("一键添加",-1)])]),_:1},8,["onClick","loading"])]))),128))]),e[15]||(e[15]=u("div",{style:{"font-size":"12px",color:"#909399","margin-top":"6px"}}," 已配置的 Key 无需重复添加，系统会自动识别。你也可以在下方单独配置覆盖。 ",-1))]),_:1})):q("",!0),t(se,{shadow:"hover"},{default:a(()=>[t(ne,{data:I.value,stripe:""},{default:a(()=>[t(y,{label:"提供商",width:"110"},{default:a(({row:l})=>[t(w,{size:"small"},{default:a(()=>[i(p(l.provider),1)]),_:2},1024)]),_:1}),t(y,{prop:"name",label:"名称","min-width":"130"}),t(y,{label:"模型 ID","min-width":"190"},{default:a(({row:l})=>[t(F,{type:"info",size:"small"},{default:a(()=>[i(p(l.model),1)]),_:2},1024)]),_:1}),t(y,{label:"调用地址","min-width":"190"},{default:a(({row:l})=>[t(L,{content:l.baseUrl||N(l.provider),placement:"top"},{default:a(()=>[t(F,{type:"info",size:"small",truncated:"",style:{"max-width":"180px",display:"block"}},{default:a(()=>[i(p(l.baseUrl||N(l.provider)),1)]),_:2},1024)]),_:2},1032,["content"])]),_:1}),t(y,{label:"API Key",width:"160"},{default:a(({row:l})=>[l.apiKey?(d(),f("code",ze,p(l.apiKey),1)):(d(),V(w,{key:0,type:"info",size:"small",style:{"font-size":"11px"}},{default:a(()=>[t(U,{style:{"vertical-align":"-2px","margin-right":"4px"}},{default:a(()=>[t(oe)]),_:1}),e[16]||(e[16]=i("使用环境变量 ",-1))]),_:1}))]),_:1}),t(y,{label:"状态",width:"90"},{default:a(({row:l})=>[t(w,{type:l.status==="ok"?"success":l.status==="error"?"danger":"info",size:"small"},{default:a(()=>[i(p(l.status==="ok"?"✓ 有效":l.status==="error"?"✗ 无效":"? 未测"),1)]),_:2},1032,["type"])]),_:1}),t(y,{label:"默认",width:"60"},{default:a(({row:l})=>[l.isDefault?(d(),V(w,{key:0,type:"warning",size:"small"},{default:a(()=>[...e[17]||(e[17]=[i("默认",-1)])]),_:1})):q("",!0)]),_:1}),t(y,{label:"操作",width:"180"},{default:a(({row:l})=>[t(v,{size:"small",onClick:j=>le(l),loading:E.value===l.id},{default:a(()=>[...e[18]||(e[18]=[i("测试",-1)])]),_:1},8,["onClick","loading"]),t(v,{size:"small",onClick:j=>Z(l)},{default:a(()=>[...e[19]||(e[19]=[i("编辑",-1)])]),_:1},8,["onClick"]),t(v,{size:"small",type:"danger",onClick:j=>te(l)},{default:a(()=>[...e[20]||(e[20]=[i("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),t(ce,{modelValue:b.value,"onUpdate:modelValue":e[10]||(e[10]=l=>b.value=l),title:C.value?"编辑模型":"添加模型",width:"580px","align-center":""},{footer:a(()=>[t(v,{onClick:e[9]||(e[9]=l=>b.value=!1)},{default:a(()=>[...e[30]||(e[30]=[i("取消",-1)])]),_:1}),t(v,{type:"primary",onClick:ee,loading:A.value},{default:a(()=>[...e[31]||(e[31]=[i("保存",-1)])]),_:1},8,["loading"])]),default:a(()=>[t(fe,{model:n,"label-width":"90px",style:{"padding-right":"8px"}},{default:a(()=>[t(_,{label:"提供商",required:""},{default:a(()=>[t(ie,{modelValue:n.provider,"onUpdate:modelValue":e[0]||(e[0]=l=>n.provider=l),onChange:H,size:"small"},{default:a(()=>[t(z,{value:"anthropic"},{default:a(()=>[...e[21]||(e[21]=[i("Anthropic",-1)])]),_:1}),t(z,{value:"openai"},{default:a(()=>[...e[22]||(e[22]=[i("OpenAI",-1)])]),_:1}),t(z,{value:"deepseek"},{default:a(()=>[...e[23]||(e[23]=[i("DeepSeek",-1)])]),_:1}),t(z,{value:"openrouter"},{default:a(()=>[...e[24]||(e[24]=[i("OpenRouter",-1)])]),_:1}),t(z,{value:"custom"},{default:a(()=>[...e[25]||(e[25]=[i("自定义",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(_,{label:"调用地址",required:""},{default:a(()=>[t(D,{modelValue:n.baseUrl,"onUpdate:modelValue":e[2]||(e[2]=l=>n.baseUrl=l),placeholder:"https://api.anthropic.com",clearable:""},{append:a(()=>[t(L,{content:"恢复提供商默认地址",placement:"top"},{default:a(()=>[t(v,{onClick:e[1]||(e[1]=l=>n.baseUrl=h[n.provider]||""),icon:_e(ge)},null,8,["icon"])]),_:1})]),_:1},8,["modelValue"]),e[26]||(e[26]=u("div",{class:"field-hint"},"中转服务填这里，比如 https://your-relay.com",-1))]),_:1}),t(_,{label:"API Key"},{default:a(()=>[x.value?(d(),V(O,{key:0,type:"success",closable:!1,style:{"margin-bottom":"8px",padding:"6px 12px"}},{default:a(()=>[u("span",De,[t(U,{style:{"vertical-align":"-2px","margin-right":"4px"}},{default:a(()=>[t(de)]),_:1}),e[27]||(e[27]=i("检测到 ",-1)),u("code",null,p(x.value.envVar),1),i("（"+p(x.value.masked)+"） — ",1),e[28]||(e[28]=u("strong",null,"不填 API Key 即可自动使用",-1))])]),_:1})):q("",!0),t(D,{modelValue:n.apiKey,"onUpdate:modelValue":e[3]||(e[3]=l=>n.apiKey=l),type:"password","show-password":"",placeholder:x.value?"留空 = 自动读取 "+x.value.envVar:"sk-..."},null,8,["modelValue","placeholder"]),u("div",Ie,[!n.apiKey&&x.value?(d(),f("span",Me," ✓ 留空后将自动使用 "+p(x.value.envVar)+" 环境变量 ",1)):(d(),f("span",$e,"手动填写优先级高于环境变量"))])]),_:1}),t(_,{label:" ","label-width":"90px"},{default:a(()=>[u("div",Ae,[t(v,{onClick:S,loading:P.value,type:"primary",plain:"",style:{"flex-shrink":"0"}},{default:a(()=>[t(U,{style:{"vertical-align":"-2px","margin-right":"4px"}},{default:a(()=>[t(re)]),_:1}),e[29]||(e[29]=i("获取可用模型 ",-1))]),_:1},8,["loading"]),m.value?(d(),f("span",Ee,p(m.value),1)):r.value.length?(d(),f("span",Pe," 获取到 "+p(r.value.length)+" 个模型 ",1)):(d(),f("span",Be,"填写 Key 后点击获取，或直接手动填写模型 ID"))])]),_:1}),t(_,{label:"模型 ID",required:""},{default:a(()=>[r.value.length?(d(),V(pe,{key:0,modelValue:n.model,"onUpdate:modelValue":e[4]||(e[4]=l=>n.model=l),filterable:"",placeholder:"搜索或选择模型",style:{width:"100%"},onChange:J},{default:a(()=>[(d(!0),f(R,null,T(r.value,l=>(d(),V(ue,{key:l.id,label:l.name!==l.id?`${l.name}  (${l.id})`:l.id,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])):(d(),V(D,{key:1,modelValue:n.model,"onUpdate:modelValue":e[5]||(e[5]=l=>n.model=l),placeholder:"如 claude-sonnet-4-6（点上方「获取可用模型」自动列出）",onInput:Q},null,8,["modelValue"]))]),_:1}),t(_,{label:"显示名称"},{default:a(()=>[t(D,{modelValue:n.name,"onUpdate:modelValue":e[6]||(e[6]=l=>n.name=l),placeholder:"如 Claude Sonnet 4.6"},null,8,["modelValue"])]),_:1}),t(_,{label:"唯一 ID"},{default:a(()=>[t(D,{modelValue:n.id,"onUpdate:modelValue":e[7]||(e[7]=l=>n.id=l),placeholder:"如 claude-sonnet（Agent 引用时使用）"},null,8,["modelValue"])]),_:1}),t(_,{label:"设为默认"},{default:a(()=>[t(me,{modelValue:n.isDefault,"onUpdate:modelValue":e[8]||(e[8]=l=>n.isDefault=l)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}}),Fe=ke(Se,[["__scopeId","data-v-f5898a54"]]);export{Fe as default};
