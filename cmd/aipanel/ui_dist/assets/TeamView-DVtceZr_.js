import{d as et,h as nt,c as r,f as n,a as f,w as h,m as ot,i as L,j as T,g as b,E as st,r as m,I as lt,o as l,e as y,F as k,l as C,t as d,n as rt,x as it,u as at}from"./index-VoOb_fE2.js";import{r as ct}from"./index-C0ndNZQc.js";import{_ as dt}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ut={class:"team-view"},ft={class:"page-header"},pt={key:0,class:"empty-state"},ht={key:1,class:"empty-state"},gt=["id"],mt=["fill"],yt=["x1","y1","x2","y2","stroke","stroke-width","marker-end","onMouseenter"],_t=["transform","onClick"],vt=["fill"],xt={"text-anchor":"middle","dominant-baseline":"central",fill:"#fff","font-weight":"700","font-size":"15","font-family":"system-ui, sans-serif"},kt=["fill"],Ct={"text-anchor":"middle",y:"46","font-size":"12",fill:"#303133","font-family":"system-ui, sans-serif","paint-order":"stroke",stroke:"#f5f7fa","stroke-width":"3"},wt={"text-anchor":"middle",y:"58","font-size":"10",fill:"#909399","font-family":"system-ui, monospace"},bt={class:"tooltip-members"},Mt={class:"tooltip-from"},Et={class:"tooltip-to"},At={class:"tooltip-tags"},Tt={key:0,class:"tooltip-label"},zt={class:"legend"},Rt={width:"28",height:"6"},Ft=["stroke"],It={width:"28",height:"8"},Bt=["stroke-width"],D=820,W=580,$t=28,Nt=et({__name:"TeamView",setup(St){const H=at(),z=b(),v=b(!1),u=b({nodes:[],edges:[]}),M=D/2,E=W/2-10;function O(t){return t<=1?0:t<=4?160:t<=7?200:Math.min(240,60*t/(2*Math.PI)+40)}const U=it(()=>{const t=u.value.nodes,e={};if(t.length===1&&t[0])return e[t[0].id]={x:M,y:E},e;const s=O(t.length);return t.forEach((a,_)=>{const p=2*Math.PI*_/t.length-Math.PI/2;e[a.id]={x:Math.round(M+s*Math.cos(p)),y:Math.round(E+s*Math.sin(p))}}),e});function w(t){return U.value[t]??{x:M,y:E}}function R(t){return I(t.from,t.to,$t+2)}function F(t){return I(t.to,t.from,-40)}function I(t,e,s){const a=w(t),_=w(e),p=_.x-a.x,x=_.y-a.y,g=Math.sqrt(p*p+x*x)||1;return{x:a.x+p/g*(s>0?s:g+s),y:a.y+x/g*(s>0?s:g+s)}}const B=["#409EFF","#67C23A","#E6A23C","#F56C6C","#7C3AED","#0891B2","#B45309","#64748B"];function X(t){let e=0;for(let s=0;s<t.length;s++)e=t.charCodeAt(s)+((e<<5)-e);return B[Math.abs(e)%B.length]??"#409EFF"}function Y(t){return(t||"?").charAt(0).toUpperCase()}function $(t){return u.value.nodes.find(e=>e.id===t)?.name??t}const A={上级:"#F56C6C",下级:"#409EFF",平级协作:"#67C23A",支持:"#909399"},N={核心:3,常用:2,偶尔:1};function j(t){return A[t]??"#909399"}function q(t){return N[t]??1.5}function S(t){return encodeURIComponent(t).replace(/%/g,"_")}function G(t){H.push(`/agents/${t}`)}const i=b({visible:!1,x:0,y:0,type:"",strength:"",label:"",from:"",to:""});function J(t,e){const s=z.value;if(!s)return;const a=s.getBoundingClientRect();i.value={visible:!0,x:t.clientX-a.left+14,y:t.clientY-a.top-10,type:e.type,strength:e.strength,label:e.label,from:e.from,to:e.to}}function K(){i.value.visible=!1}function Q(t){return t==="上级"?"danger":t==="下级"?"":t==="平级协作"?"success":"info"}function Z(t){return t==="核心"?"danger":t==="常用"?"warning":"info"}async function P(){v.value=!0;try{const t=await ct.graph();u.value=t.data}catch{st.error("加载图谱失败")}finally{v.value=!1}}return nt(P),(t,e)=>{const s=m("Refresh"),a=m("el-icon"),_=m("el-button"),p=m("Share"),x=m("Connection"),g=m("el-tag"),V=m("el-card"),tt=lt("loading");return l(),r("div",ut,[n("div",ft,[e[1]||(e[1]=n("h2",null,"团队关系图谱",-1)),f(_,{size:"small",onClick:P},{default:h(()=>[f(a,null,{default:h(()=>[f(s)]),_:1}),e[0]||(e[0]=y(" 刷新 ",-1))]),_:1})]),ot((l(),L(V,{class:"graph-card"},{default:h(()=>[!v.value&&!u.value.nodes.length?(l(),r("div",pt,[f(a,{style:{"font-size":"64px",color:"#c0c4cc",display:"block",margin:"0 auto 16px"}},{default:h(()=>[f(p)]),_:1}),e[2]||(e[2]=n("p",{style:{color:"#909399","text-align":"center",margin:"0"}}," 暂无成员数据 ",-1))])):!v.value&&u.value.nodes.length&&!u.value.edges.length?(l(),r("div",ht,[f(a,{style:{"font-size":"64px",color:"#c0c4cc",display:"block",margin:"0 auto 16px"}},{default:h(()=>[f(x)]),_:1}),e[3]||(e[3]=n("p",{style:{color:"#909399","text-align":"center",margin:"0"}}," 为成员配置 RELATIONS.md 即可自动生成关系图谱 ",-1)),e[4]||(e[4]=n("p",{style:{color:"#c0c4cc","text-align":"center","font-size":"13px",margin:"6px 0 0"}}," 前往成员详情页 → 「关系」Tab 编辑 RELATIONS.md ",-1))])):(l(),r("div",{key:2,class:"graph-container",ref_key:"containerRef",ref:z},[(l(),r("svg",{width:D,height:W,class:"graph-svg"},[n("defs",null,[(l(),r(k,null,C(A,(o,c)=>n("marker",{key:c,id:`arrow-${S(c)}`,markerWidth:"8",markerHeight:"8",refX:"6",refY:"3",orient:"auto"},[n("path",{d:"M0,0 L0,6 L8,3 z",fill:o},null,8,mt)],8,gt)),64))]),(l(!0),r(k,null,C(u.value.edges,o=>(l(),r("g",{key:`${o.from}-${o.to}`},[n("line",{x1:R(o).x,y1:R(o).y,x2:F(o).x,y2:F(o).y,stroke:j(o.type),"stroke-width":q(o.strength),"stroke-opacity":"0.7","marker-end":`url(#arrow-${S(o.type)})`,class:"graph-edge",onMouseenter:c=>J(c,o),onMouseleave:K},null,40,yt)]))),128)),(l(!0),r(k,null,C(u.value.nodes,o=>(l(),r("g",{key:o.id,transform:`translate(${w(o.id).x}, ${w(o.id).y})`,class:"graph-node",onClick:c=>G(o.id)},[e[5]||(e[5]=n("circle",{r:"30",fill:"rgba(0,0,0,0.08)",transform:"translate(2,3)"},null,-1)),n("circle",{r:"28",fill:X(o.id),stroke:"#fff","stroke-width":"2.5"},null,8,vt),n("text",xt,d(Y(o.id)),1),n("circle",{cx:"20",cy:"-20",r:"6",fill:o.status==="running"?"#67C23A":"#c0c4cc",stroke:"#fff","stroke-width":"1.5"},null,8,kt),n("text",Ct,d(o.name),1),n("text",wt,d(o.id),1)],8,_t))),128))])),i.value.visible?(l(),r("div",{key:0,class:"edge-tooltip",style:rt({left:i.value.x+"px",top:i.value.y+"px"})},[n("div",bt,[n("span",Mt,d($(i.value.from)),1),e[6]||(e[6]=n("span",{class:"tooltip-arrow"},"→",-1)),n("span",Et,d($(i.value.to)),1)]),n("div",At,[f(g,{type:Q(i.value.type),size:"small"},{default:h(()=>[y(d(i.value.type),1)]),_:1},8,["type"]),f(g,{type:Z(i.value.strength),size:"small",effect:"plain"},{default:h(()=>[y(d(i.value.strength),1)]),_:1},8,["type"])]),i.value.label?(l(),r("div",Tt,d(i.value.label),1)):T("",!0)],4)):T("",!0)],512))]),_:1})),[[tt,v.value]]),u.value.nodes.length?(l(),L(V,{key:0,class:"legend-card"},{default:h(()=>[n("div",zt,[e[7]||(e[7]=n("span",{class:"legend-title"},"关系类型：",-1)),(l(),r(k,null,C(A,(o,c)=>n("span",{key:c,class:"legend-item"},[(l(),r("svg",Rt,[n("line",{x1:"0",y1:"3",x2:"28",y2:"3",stroke:o,"stroke-width":"3"},null,8,Ft)])),y(" "+d(c),1)])),64)),e[8]||(e[8]=n("span",{class:"legend-divider"}," | ",-1)),e[9]||(e[9]=n("span",{class:"legend-title"},"关系程度（线粗）：",-1)),(l(),r(k,null,C(N,(o,c)=>n("span",{key:c,class:"legend-item"},[(l(),r("svg",It,[n("line",{x1:"0",y1:"4",x2:"28",y2:"4",stroke:"#606266","stroke-width":o},null,8,Bt)])),y(" "+d(c),1)])),64)),e[10]||(e[10]=n("span",{class:"legend-divider"}," | ",-1)),e[11]||(e[11]=n("span",{class:"legend-item"},[n("svg",{width:"12",height:"12"},[n("circle",{cx:"6",cy:"6",r:"5",fill:"#67C23A"})]),y(" 运行中 ")],-1)),e[12]||(e[12]=n("span",{class:"legend-item"},[n("svg",{width:"12",height:"12"},[n("circle",{cx:"6",cy:"6",r:"5",fill:"#c0c4cc"})]),y(" 空闲/停止 ")],-1))])]),_:1})):T("",!0)])}}}),Dt=dt(Nt,[["__scopeId","data-v-da7aba44"]]);export{Dt as default};
