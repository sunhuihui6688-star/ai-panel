import{d as E,i as H,j as y,w as l,g,x as O,r as n,a as t,f as b,l as W,p as j,e as k,t as G,E as i,o as h,_ as q}from"./index-B-U8TcRI.js";import{e as v}from"./index-BEdvr7UB.js";const F={style:{display:"flex","align-items":"center",gap:"12px"}},J={style:{"margin-top":"24px","text-align":"right"}},L=E({__name:"ConfigView",setup(Q){const c=g("anthropic/claude-sonnet-4-6"),r=g(!1),s=O({enabled:!1,botToken:""}),_=g([{id:"anthropic",name:"Anthropic",key:"",showKey:!1,testing:!1,testResult:null},{id:"openai",name:"OpenAI",key:"",showKey:!1,testing:!1,testResult:null},{id:"deepseek",name:"DeepSeek",key:"",showKey:!1,testing:!1,testResult:null}]);H(async()=>{try{const e=(await v.get()).data;if(c.value=e.models?.primary||"anthropic/claude-sonnet-4-6",e.models?.apiKeys)for(const d of _.value)e.models.apiKeys[d.id]&&(d.key=e.models.apiKeys[d.id]);e.channels?.telegram&&(s.enabled=e.channels.telegram.enabled,s.botToken=e.channels.telegram.botToken||"")}catch{}});async function w(o){if(!o.key||o.key.endsWith("***")){i.warning("请输入完整的 API Key");return}o.testing=!0,o.testResult=null;try{const e=await v.testKey(o.id,o.key);o.testResult=e.data.valid,i[e.data.valid?"success":"error"](e.data.valid?"Key 有效":`Key 无效: ${e.data.error}`)}catch{o.testResult=!1,i.error("测试请求失败")}finally{o.testing=!1}}async function T(){r.value=!0;try{const o={};for(const e of _.value)e.key&&!e.key.endsWith("***")&&(o[e.id]=e.key);await v.patch({models:{primary:c.value,apiKeys:o},channels:{telegram:{enabled:s.enabled,botToken:s.botToken}}}),i.success("配置已保存")}catch(o){i.error(o.response?.data?.error||"保存失败")}finally{r.value=!1}}return(o,e)=>{const d=n("el-button"),R=n("el-header"),u=n("el-table-column"),A=n("View"),B=n("Hide"),V=n("el-icon"),K=n("el-input"),I=n("el-tag"),U=n("el-table"),p=n("el-option"),$=n("el-select"),m=n("el-form-item"),x=n("el-form"),C=n("el-tab-pane"),z=n("el-switch"),P=n("el-card"),S=n("el-tabs"),D=n("Check"),M=n("el-main"),N=n("el-container");return h(),y(N,{class:"config-page"},{default:l(()=>[t(R,{class:"config-header"},{default:l(()=>[b("div",F,[t(d,{icon:W(j),onClick:e[0]||(e[0]=a=>o.$router.push("/")),circle:""},null,8,["icon"]),e[4]||(e[4]=b("h2",null,"配置中心",-1))])]),_:1}),t(M,null,{default:l(()=>[t(S,{type:"border-card"},{default:l(()=>[t(C,{label:"模型 & API Keys"},{default:l(()=>[t(U,{data:_.value,stripe:""},{default:l(()=>[t(u,{prop:"name",label:"提供商",width:"140"}),t(u,{label:"API Key"},{default:l(({row:a})=>[t(K,{modelValue:a.key,"onUpdate:modelValue":f=>a.key=f,type:a.showKey?"text":"password",size:"small",style:{"max-width":"400px"}},{append:l(()=>[t(d,{onClick:f=>a.showKey=!a.showKey},{default:l(()=>[t(V,null,{default:l(()=>[a.showKey?(h(),y(B,{key:1})):(h(),y(A,{key:0}))]),_:2},1024)]),_:2},1032,["onClick"])]),_:2},1032,["modelValue","onUpdate:modelValue","type"])]),_:1}),t(u,{label:"状态",width:"120"},{default:l(({row:a})=>[t(I,{type:a.testResult===!0?"success":a.testResult===!1?"danger":"info",size:"small"},{default:l(()=>[k(G(a.testResult===!0?"有效":a.testResult===!1?"无效":"未测试"),1)]),_:2},1032,["type"])]),_:1}),t(u,{label:"操作",width:"100"},{default:l(({row:a})=>[t(d,{size:"small",onClick:f=>w(a),loading:a.testing},{default:l(()=>[...e[5]||(e[5]=[k("测试",-1)])]),_:1},8,["onClick","loading"])]),_:1})]),_:1},8,["data"]),t(x,{style:{"margin-top":"24px"},"label-width":"100px"},{default:l(()=>[t(m,{label:"默认模型"},{default:l(()=>[t($,{modelValue:c.value,"onUpdate:modelValue":e[1]||(e[1]=a=>c.value=a)},{default:l(()=>[t(p,{label:"Claude Sonnet 4",value:"anthropic/claude-sonnet-4-6"}),t(p,{label:"Claude Opus 4",value:"anthropic/claude-opus-4-0"}),t(p,{label:"GPT-4o",value:"openai/gpt-4o"}),t(p,{label:"DeepSeek V3",value:"deepseek/deepseek-chat"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(C,{label:"消息通道"},{default:l(()=>[t(P,{header:"Telegram Bot"},{default:l(()=>[t(x,{"label-width":"120px"},{default:l(()=>[t(m,{label:"启用"},{default:l(()=>[t(z,{modelValue:s.enabled,"onUpdate:modelValue":e[2]||(e[2]=a=>s.enabled=a)},null,8,["modelValue"])]),_:1}),t(m,{label:"Bot Token"},{default:l(()=>[t(K,{modelValue:s.botToken,"onUpdate:modelValue":e[3]||(e[3]=a=>s.botToken=a),type:"password","show-password":"",style:{"max-width":"400px"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),b("div",J,[t(d,{type:"primary",size:"large",onClick:T,loading:r.value},{default:l(()=>[t(V,null,{default:l(()=>[t(D)]),_:1}),e[6]||(e[6]=k(" 保存配置 ",-1))]),_:1},8,["loading"])])]),_:1})]),_:1})}}}),Z=q(L,[["__scopeId","data-v-ca67133f"]]);export{Z as default};
