import{c}from"./index-B6SLQW8T.js";import{d as G,i as H,c as y,b as A,a as e,w as a,h as d,e as V,r as s,o as v,t as w,F as B,m as J,k as K,q as Q,E as m,x as R}from"./index-BKdoBjUU.js";const X={class:"channels-page"},Y={style:{display:"flex","justify-content":"space-between","align-items":"center","margin-bottom":"20px"}},Z={style:{margin:"0"}},ae=G({__name:"ChannelsView",setup(ee){const x=V([]),r=V(!1),g=V(""),C=V(!1),n=Q({id:"",name:"",type:"telegram",enabled:!0,config:{botToken:"",defaultAgent:"main",allowedFrom:""}});H(b);async function b(){try{const o=await c.list();x.value=o.data}catch{}}function E(){g.value="",Object.assign(n,{id:"",name:"",type:"telegram",enabled:!0,config:{botToken:"",defaultAgent:"main",allowedFrom:""}}),r.value=!0}function F(o){g.value=o.id,Object.assign(n,{...o,config:{...o.config}}),r.value=!0}async function $(){if(!n.name||!n.type){m.warning("请填写必要字段");return}n.id||(n.id=n.type+"-"+Date.now().toString(36)),C.value=!0;try{g.value?await c.update(g.value,{...n}):await c.create({...n,status:"untested"}),m.success("保存成功"),r.value=!1,b()}catch(o){m.error(o.response?.data?.error||"保存失败")}finally{C.value=!1}}async function q(o){try{await c.update(o.id,{enabled:o.enabled})}catch{m.error("更新失败")}}async function D(o){try{await c.test(o.id),m.success("测试成功"),b()}catch{m.error("测试失败")}}async function M(o){try{await R.confirm(`确定删除通道 "${o.name}"？`,"确认删除",{type:"warning"}),await c.delete(o.id),m.success("已删除"),b()}catch{}}return(o,t)=>{const N=s("Connection"),h=s("el-icon"),j=s("Plus"),p=s("el-button"),U=s("el-tag"),f=s("el-table-column"),I=s("el-text"),T=s("el-switch"),L=s("el-table"),O=s("el-card"),k=s("el-option"),P=s("el-select"),i=s("el-form-item"),_=s("el-input"),S=s("el-form"),W=s("el-dialog");return v(),y("div",X,[A("div",Y,[A("h2",Z,[e(h,{style:{"vertical-align":"-2px","margin-right":"6px"}},{default:a(()=>[e(N)]),_:1}),t[9]||(t[9]=d("消息通道",-1))]),e(p,{type:"primary",onClick:E},{default:a(()=>[e(h,null,{default:a(()=>[e(j)]),_:1}),t[10]||(t[10]=d(" 添加通道 ",-1))]),_:1})]),e(O,{shadow:"hover"},{default:a(()=>[e(L,{data:x.value,stripe:""},{default:a(()=>[e(f,{label:"类型",width:"120"},{default:a(({row:l})=>[e(U,{size:"small"},{default:a(()=>[d(w(l.type),1)]),_:2},1024)]),_:1}),e(f,{prop:"name",label:"名称","min-width":"160"}),e(f,{label:"配置","min-width":"200"},{default:a(({row:l})=>[e(I,{type:"info",size:"small"},{default:a(()=>[(v(!0),y(B,null,J(l.config,(u,z)=>(v(),y("span",{key:z,style:{"margin-right":"8px"}},w(z)+": "+w(u),1))),128))]),_:2},1024)]),_:1}),e(f,{label:"启用",width:"80"},{default:a(({row:l})=>[e(T,{modelValue:l.enabled,"onUpdate:modelValue":u=>l.enabled=u,onChange:u=>q(l),size:"small"},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),e(f,{label:"状态",width:"100"},{default:a(({row:l})=>[e(U,{type:l.status==="ok"?"success":l.status==="error"?"danger":"info",size:"small"},{default:a(()=>[d(w(l.status==="ok"?"✓":l.status==="error"?"✗":"?"),1)]),_:2},1032,["type"])]),_:1}),e(f,{label:"操作",width:"180"},{default:a(({row:l})=>[e(p,{size:"small",onClick:u=>D(l)},{default:a(()=>[...t[11]||(t[11]=[d("测试",-1)])]),_:1},8,["onClick"]),e(p,{size:"small",onClick:u=>F(l)},{default:a(()=>[...t[12]||(t[12]=[d("编辑",-1)])]),_:1},8,["onClick"]),e(p,{size:"small",type:"danger",onClick:u=>M(l)},{default:a(()=>[...t[13]||(t[13]=[d("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),e(W,{modelValue:r.value,"onUpdate:modelValue":t[8]||(t[8]=l=>r.value=l),title:g.value?"编辑通道":"添加通道",width:"520px"},{footer:a(()=>[e(p,{onClick:t[7]||(t[7]=l=>r.value=!1)},{default:a(()=>[...t[14]||(t[14]=[d("取消",-1)])]),_:1}),e(p,{type:"primary",onClick:$,loading:C.value},{default:a(()=>[...t[15]||(t[15]=[d("保存",-1)])]),_:1},8,["loading"])]),default:a(()=>[e(S,{model:n,"label-width":"120px"},{default:a(()=>[e(i,{label:"类型",required:""},{default:a(()=>[e(P,{modelValue:n.type,"onUpdate:modelValue":t[0]||(t[0]=l=>n.type=l),style:{width:"100%"}},{default:a(()=>[e(k,{label:"Telegram",value:"telegram"}),e(k,{label:"iMessage",value:"imessage"}),e(k,{label:"WhatsApp",value:"whatsapp"})]),_:1},8,["modelValue"])]),_:1}),e(i,{label:"名称",required:""},{default:a(()=>[e(_,{modelValue:n.name,"onUpdate:modelValue":t[1]||(t[1]=l=>n.name=l),placeholder:"如 Telegram Bot"},null,8,["modelValue"])]),_:1}),e(i,{label:"ID"},{default:a(()=>[e(_,{modelValue:n.id,"onUpdate:modelValue":t[2]||(t[2]=l=>n.id=l),placeholder:"唯一标识"},null,8,["modelValue"])]),_:1}),n.type==="telegram"?(v(),y(B,{key:0},[e(i,{label:"Bot Token",required:""},{default:a(()=>[e(_,{modelValue:n.config.botToken,"onUpdate:modelValue":t[3]||(t[3]=l=>n.config.botToken=l),type:"password","show-password":""},null,8,["modelValue"])]),_:1}),e(i,{label:"默认 Agent"},{default:a(()=>[e(_,{modelValue:n.config.defaultAgent,"onUpdate:modelValue":t[4]||(t[4]=l=>n.config.defaultAgent=l),placeholder:"main"},null,8,["modelValue"])]),_:1}),e(i,{label:"允许的发送者"},{default:a(()=>[e(_,{modelValue:n.config.allowedFrom,"onUpdate:modelValue":t[5]||(t[5]=l=>n.config.allowedFrom=l),placeholder:"逗号分隔的 Telegram 用户 ID"},null,8,["modelValue"])]),_:1})],64)):K("",!0),e(i,{label:"启用"},{default:a(()=>[e(T,{modelValue:n.enabled,"onUpdate:modelValue":t[6]||(t[6]=l=>n.enabled=l)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}});export{ae as default};
