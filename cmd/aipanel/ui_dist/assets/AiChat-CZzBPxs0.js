import{d as We,e as b,D as Ge,I as _e,i as Xe,c as l,f as L,n as Ye,s as F,a as T,w as R,S as Qe,b as i,t as g,F as I,m as M,k as f,h as U,p as Ze,G as et,g as ge,z as me,H as V,r as z,o as a,j as ke,q as tt}from"./index-BXkcOagz.js";import{n as st,i as ee,o as nt,p as at,q as ne}from"./index-BclxA8EE.js";import{_ as lt}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ot={key:0,class:"drag-overlay"},it={key:0,class:"running-tasks-banner"},rt={key:0,class:"resumed-list"},ut={key:0,class:"history-loading"},ct={key:1,class:"chat-empty"},dt={key:0,class:"welcome-msg"},pt={key:1,class:"examples"},ft=["onClick"],ht={key:0,class:"msg-row user"},vt={class:"msg-bubble user"},_t={key:0,class:"msg-images"},gt=["src","onClick"],mt={class:"msg-text"},kt={key:1,class:"msg-row assistant"},yt={class:"msg-col"},xt=["open"],bt={class:"thinking-summary"},wt={class:"thinking-len"},Ct={class:"thinking-content"},St={key:1,class:"tool-timeline"},Tt=["onClick"],It={class:"tool-step-header"},$t={key:0,class:"tool-spin"},Dt={key:1},Mt={key:2},Nt={key:3},jt={class:"tool-step-icon"},Ft={class:"tool-step-name"},Ot={key:0,class:"tool-step-summary"},At={key:1,class:"tool-step-dur"},Bt={key:0},Lt={key:1},Rt={key:2},Et={key:3},Jt={key:4},Pt={class:"tool-step-chevron"},Ut={key:0,class:"tool-section"},zt={class:"tool-pre"},qt={key:1,class:"tool-section"},Ht={class:"tool-pre result"},Kt={class:"msg-bubble assistant"},Vt=["innerHTML"],Wt={key:1,class:"apply-card"},Gt={class:"apply-preview"},Xt={class:"apply-key"},Yt={class:"apply-val"},Qt=["onClick"],Zt={class:"msg-actions"},es=["onClick","title"],ts=["onClick"],ss=["onClick"],ns={key:2,class:"option-chips"},as=["onClick"],ls={key:2,class:"msg-row system"},os={class:"msg-system"},is={key:2,class:"msg-row assistant"},rs={class:"msg-col"},us={key:0,class:"thinking-block",open:""},cs={class:"thinking-summary"},ds={class:"thinking-content"},ps={key:1,class:"tool-timeline"},fs=["onClick"],hs={class:"tool-step-header"},vs={key:0,class:"tool-spin"},_s={key:1},gs={key:2},ms={class:"tool-step-icon"},ks={class:"tool-step-name"},ys={key:0,class:"tool-step-summary"},xs={key:1,class:"tool-step-dur"},bs={key:0},ws={key:1},Cs={key:2},Ss={key:3},Ts={key:4},Is={class:"tool-step-chevron"},$s={key:0,class:"tool-section"},Ds={class:"tool-pre"},Ms={key:1,class:"tool-section"},Ns={class:"tool-pre result"},js={key:2,class:"msg-bubble assistant"},Fs={key:0,class:"typing-dots"},Os=["innerHTML"],As={key:2,class:"blink"},Bs=["src"],Ls={class:"chat-input-area"},Rs={key:0,class:"attachments-bar"},Es=["src"],Js=["onClick"],Ps={class:"attach-file-icon"},Us={class:"attach-file-name"},zs={class:"attach-file-size"},qs=["onClick"],Hs={class:"input-row"},Ks={class:"textarea-wrap"},Vs=["placeholder","disabled","onKeydown"],Ws={class:"input-actions"},Gs={class:"icon-btn",title:"é™„åŠ æ–‡ä»¶ï¼ˆå›¾ç‰‡/ä»£ç /æ–‡æœ¬ï¼‰"},Xs=["disabled"],Ys={key:0,class:"spinner"},Qs={key:1},Zs=We({__name:"AiChat",props:{agentId:{},sessionId:{},context:{},scenario:{},skillId:{},placeholder:{},welcomeMessage:{},examples:{default:()=>[]},showThinking:{type:Boolean,default:!1},compact:{type:Boolean,default:!1},bgColor:{},height:{},initialMessages:{},applyable:{type:Boolean,default:!1}},emits:["message","response","apply","session-change","streaming-change"],setup($,{expose:ye,emit:xe}){const x=$,E=xe,v=b(x.initialMessages?[...x.initialMessages]:[]),J=b(""),O=b([]),A=b([]),m=b(!1);Ge(m,e=>E("streaming-change",e));const w=b(""),D=b(""),C=b([]),q=tt(new Map),B=b([]);let S=null;const ae=me(()=>{let e=0;for(const t of v.value)for(const n of t.toolCalls??[])n.taskId&&n.taskStatus&&!["done","error","killed"].includes(n.taskStatus)&&e++;return e+=B.value.filter(t=>!["done","error","killed"].includes(t.status)).length,e}),H=b(!1);let K=0;const W=b(null),G=b(""),k=b(x.sessionId),P=b(!1),X=b(),N=b(),be=me(()=>({height:x.height??"100%","--bg":x.bgColor??"transparent"}));function le(){S||(S=setInterval(we,3e3))}async function we(){if(q.size===0&&B.value.every(u=>["done","error","killed"].includes(u.status))){S&&(clearInterval(S),S=null);return}const t=[];let n=!1;for(const[u,c]of q)try{const s=(await ne.get(c)).data;for(const r of v.value){const o=r.toolCalls?.find(_=>_.id===u);if(o){const _=!["done","error","killed"].includes(o.taskStatus??"");o.taskStatus=s.status,["done","error","killed"].includes(s.status)&&(t.push(u),_&&(n=!0))}}}catch{t.push(u),n=!0}for(const u of t)q.delete(u);let d=!1;for(const u of B.value)if(!["done","error","killed"].includes(u.status))try{const c=await ne.get(u.id),p=u.status;u.status=c.data.status,["done","error","killed"].includes(u.status)&&p!==u.status&&(d=!0)}catch{u.status="error",d=!0}if(!(q.size>0||B.value.some(u=>!["done","error","killed"].includes(u.status)))&&S&&(clearInterval(S),S=null),(d||n)&&k.value&&!m.value){const u=k.value;setTimeout(async()=>{if(!m.value&&k.value===u)try{const c=await ee.get(x.agentId,u);if(m.value||k.value!==u)return;const p=c.data.messages??[],s=[];p.some(r=>r.isCompact||r.role==="compaction")&&s.push({role:"system",text:"æ›´æ—©çš„å†…å®¹å·²å‹ç¼©"});for(const r of p)r.role!=="compaction"&&s.push({role:r.role,text:r.text,toolCalls:r.toolCalls?.map(o=>({id:o.id,name:o.name,input:o.input,result:o.result,status:"done",_expanded:!1}))});v.value=s,y()}catch{}},1500)}}_e(()=>{S&&(clearInterval(S),S=null)});async function Ce(e){try{const n=(await ne.list({sessionId:e})).data,d=n.filter(u=>!["done","error","killed"].includes(u.status));if(n.filter(u=>["done","error","killed"].includes(u.status)).length>0&&setTimeout(async()=>{if(!m.value&&k.value===e)try{const u=await ee.get(x.agentId,e);if(m.value||k.value!==e)return;const c=u.data.messages??[],p=[];c.some(s=>s.isCompact||s.role==="compaction")&&p.push({role:"system",text:"æ›´æ—©çš„å†…å®¹å·²å‹ç¼©"});for(const s of c)s.role!=="compaction"&&p.push({role:s.role,text:s.text,toolCalls:s.toolCalls?.map(r=>({id:r.id,name:r.name,input:r.input,result:r.result,status:"done",_expanded:!1}))});v.value=p,y()}catch{}},500),d.length===0)return;B.value=d.map(u=>({id:u.id,label:u.label||u.id.slice(0,8),status:u.status})),le()}catch{}}function y(){V(()=>{X.value&&(X.value.scrollTop=X.value.scrollHeight)})}function Se(){N.value&&(N.value.style.height="auto",N.value.style.height=Math.min(N.value.scrollHeight,160)+"px")}function Y(e){J.value=e,V(()=>N.value?.focus())}function oe(e){try{return JSON.stringify(JSON.parse(e),null,2)}catch{return e}}function Te(e){navigator.clipboard?.writeText(e);const t=v.value.findIndex(n=>n.text===e);W.value=t,setTimeout(()=>{W.value=null},1500)}function Ie(e){for(let t=e-1;t>=0;t--){const n=v.value[t];if(n&&n.role==="user"){const d=n.text,h=n.images??[];v.value.splice(t,v.value.length-t),se(d,h);return}}}function $e(e){G.value=e}function ie(e){return e?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/```(\w*)\n([\s\S]*?)```/g,(n,d,h)=>`<pre class="code-block${d?" lang-"+d:""}"><code>${h}</code></pre>`).replace(/`([^`]+)`/g,'<code class="inline-code">$1</code>').replace(/\*\*(.+?)\*\*/g,"<strong>$1</strong>").replace(/\*(.+?)\*/g,"<em>$1</em>").replace(/\[(.+?)\]\((https?:\/\/[^\)]+)\)/g,'<a href="$2" target="_blank" rel="noopener">$1</a>').replace(/^### (.+)$/gm,"<h3>$1</h3>").replace(/^## (.+)$/gm,"<h2>$1</h2>").replace(/^# (.+)$/gm,"<h1>$1</h1>").replace(/^[-*] (.+)$/gm,"<li>$1</li>").replace(/^\d+\. (.+)$/gm,"<li>$1</li>").replace(/(<li>[\s\S]+?<\/li>)(\n(?!<li>)|$)/g,"<ul>$1</ul>$2").replace(/([^>])\n([^<])/g,"$1<br>$2"):""}function De(e){const t=e.split(`
`),n=[],d=/^([ğŸ™ğŸ˜„ğŸŒğŸ›ğŸ“šğŸ¨ğŸ’¼ğŸ¤–âš½ğŸ¯âœ…âŒğŸ”¥ğŸ’¡ğŸğŸš€ğŸŒŸğŸ’ğŸªğŸ­ğŸ¬ğŸ¤]|[\u{1F300}-\u{1FFFF}]|[\u{2600}-\u{27BF}])\s+(.{4,40})/u;for(const h of t){const u=h.replace(/^[-*â€¢]\s*/,"").trim();if(u.match(d)){const p=u.replace(/[ï¼š:ã€‚ï¼Œ,]$/,"").trim();p.length>=5&&n.push(p)}}return n.slice(0,5)}function Me(e){return e?/\{[\s\S]{30,}\}/.test(e)&&(e.includes('"name"')||e.includes('"identity"')||e.includes('"soul"')||e.includes('"IDENTITY"')||e.includes('"SOUL"')):!1}function Ne(e){const t=ue(e.text);t?(v.value.forEach(n=>{n!==e&&n.applyData&&delete n.applyData}),e.applyData=t,V(()=>E("apply",t))):alert("æœªèƒ½ä»æ¶ˆæ¯ä¸­æå–åˆ°é…ç½® JSONï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶")}function re(e,t=0){const n=e.indexOf("{",t);if(n===-1)return null;let d=0,h=!1,u=!1;for(let c=n;c<e.length;c++){const p=e[c];if(u){u=!1;continue}if(p==="\\"&&h){u=!0;continue}if(p==='"'){h=!h;continue}if(!h){if(p==="{")d++;else if(p==="}"&&(d--,d===0))return{raw:e.slice(n,c+1),end:c+1}}}return null}function ue(e){const t=/```(?:json)?\s*\n?([\s\S]*?)```/g,n=[];let d;for(;(d=t.exec(e))!==null;){const c=(d[1]??"").trim();c.startsWith("{")&&n.push(c)}for(let c=n.length-1;c>=0;c--){const p=n[c],s=re(p);if(!s)continue;const r=Q(s.raw)??Q(ce(s.raw));if(r)return r}const h=[];let u=0;for(;u<e.length;){const c=re(e,u);if(!c)break;h.push(c.raw),u=c.end}for(let c=h.length-1;c>=0;c--){const p=h[c],s=Q(p)??Q(ce(p));if(s)return s}return null}function Q(e){try{const t=JSON.parse(e);if(t&&typeof t=="object"&&!Array.isArray(t)){const n=["name","id","description","identity","soul","IDENTITY","SOUL","NAME","DESCRIPTION"];if(Object.keys(t).some(d=>n.includes(d)))return t}}catch{}return null}function ce(e){let t="",n=!1,d=!1;for(let h=0;h<e.length;h++){const u=e[h];if(d){t+=u,d=!1;continue}if(u==="\\"&&n){t+=u,d=!0;continue}if(u==='"'){n=!n,t+=u;continue}if(n&&u===`
`){t+="\\n";continue}if(n&&u==="\r"){t+="\\r";continue}t+=u}return t}const je={exec:"âš¡",bash:"âš¡",read:"ğŸ“–",write:"âœï¸",edit:"âœï¸",web_search:"ğŸŒ",web_fetch:"ğŸŒ",browser:"ğŸŒ",agent_spawn:"ğŸš€",agent_tasks:"ğŸ“‹",agent_kill:"ğŸ›‘",agent_result:"ğŸ“Š",project_read:"ğŸ“",project_write:"ğŸ“",project_list:"ğŸ“",project_create:"ğŸ“",project_glob:"ğŸ“",memory_search:"ğŸ§ ",memory_get:"ğŸ§ ",image:"ğŸ–¼ï¸",tts:"ğŸ”Š",cron:"â±ï¸"};function de(e){return je[e]??"âš™ï¸"}function pe(e,t){try{const n=JSON.parse(t);if(e==="exec"||e==="bash")return(n.command??"").slice(0,60);if(e==="read")return n.file_path??n.path??"";if(e==="write")return(n.file_path??n.path??"")+(n.content?` (${n.content.length}B)`:"");if(e==="edit")return n.file_path??n.path??"";if(e==="web_search")return n.query??"";if(e==="web_fetch")return n.url??"";if(e==="agent_spawn")return`â†’ ${n.agentId}: ${(n.task??"").slice(0,40)}`;if(e==="project_read"||e==="project_write")return n.path??"";if(e==="memory_search")return n.query??""}catch{}return""}const Fe=new Set(["txt","md","markdown","js","ts","jsx","tsx","vue","go","py","rs","java","kt","swift","html","css","scss","less","json","yaml","yml","toml","ini","cfg","env","sh","bash","zsh","fish","ps1","bat","cmd","dockerfile","makefile","sql","graphql","proto","xml","svg","gitignore","gitattributes"]);function fe(e){const t=e.split(".").pop()?.toLowerCase()??"";return Fe.has(t)}function Oe(e){const t=e.split(".").pop()?.toLowerCase()??"";return{js:"ğŸŸ¨",ts:"ğŸ”µ",vue:"ğŸ’š",go:"ğŸ¹",py:"ğŸ",rs:"ğŸ¦€",html:"ğŸŒ",css:"ğŸ¨",json:"ğŸ“‹",md:"ğŸ“",sh:"âš¡",sql:"ğŸ—„ï¸",yaml:"âš™ï¸",yml:"âš™ï¸",dockerfile:"ğŸ³"}[t]??"ğŸ“„"}function Ae(e){return e<1024?`${e}B`:e<1024*1024?`${(e/1024).toFixed(1)}KB`:`${(e/1024/1024).toFixed(1)}MB`}function Be(e){const t=e.clipboardData?.items;if(t){for(const n of Array.from(t))if(n.type.startsWith("image/")){e.preventDefault();const d=n.getAsFile();d&&te(d)}}}function Le(e){e.preventDefault(),K++,H.value=!0}function Re(e){e.preventDefault(),K--,K<=0&&(K=0,H.value=!1)}function Ee(e){K=0,H.value=!1;const t=e.dataTransfer?.files;if(t)for(const n of Array.from(t))n.type.startsWith("image/")?te(n):fe(n.name)&&he(n)}function Je(e){const t=e.target.files;if(t){for(const n of Array.from(t))n.type.startsWith("image/")?te(n):fe(n.name)&&he(n);e.target.value=""}}function he(e){const t=new FileReader;t.onload=()=>{typeof t.result=="string"&&A.value.push({name:e.name,content:t.result})},t.readAsText(e)}function te(e){const t=new FileReader;t.onload=()=>{typeof t.result=="string"&&O.value.push(t.result)},t.readAsDataURL(e)}function Pe(e){O.value.splice(e,1)}function Z(){const e=J.value.trim(),t=[...O.value],n=[...A.value];if(!e&&!t.length&&!n.length||m.value)return;let d=e;if(n.length>0){const h=n.map(u=>{const c=u.name.split(".").pop()??"text";return`

ğŸ“ **${u.name}**
\`\`\`${c}
${u.content}
\`\`\``}).join("");d=e?e+h:h.trimStart()}J.value="",O.value=[],A.value=[],V(()=>{N.value&&(N.value.style.height="auto")}),E("message",d,t),se(d,t)}function se(e,t,n=!1){n||(v.value.push({role:"user",text:e,images:t.length?t:void 0}),y()),m.value=!0,w.value="",D.value="",C.value=[];const d={role:"assistant",text:"",toolCalls:[]};v.value.push(d),n&&y();const h=v.value.length-1;let u="",c;if(k.value)c=void 0;else{const s=v.value.slice(0,-1).filter(r=>(r.role==="user"||r.role==="assistant")&&r.text).slice(-20).map(r=>({role:r.role,content:r.text}));c=s.length>0?s:void 0}const p={sessionId:k.value,context:x.context,scenario:x.scenario,skillId:x.skillId,images:t.length?t:void 0,history:c};st(x.agentId,e,s=>{switch(s.type){case"thinking_delta":D.value+=s.text,y();break;case"text":case"text_delta":w.value+=s.text,y();break;case"tool_call":{const r={id:s.tool_call?.id??String(Date.now()),name:s.tool_call?.name??"tool",input:s.tool_call?.input?JSON.stringify(s.tool_call.input):void 0,status:"running",_startedAt:Date.now(),_expanded:!1};v.value[h].toolCalls.push(r),C.value.push(r),u=r.id,y();break}case"tool_result":{const r=v.value[h].toolCalls?.find(o=>o.id===u);if(r){if(r.result=s.text,r.status="done",r._startedAt){const _=Date.now()-r._startedAt;r.duration=_<1e3?`${_}ms`:`${(_/1e3).toFixed(1)}s`}if(r.name==="agent_spawn"&&s.text){const _=s.text.match(/ä»»åŠ¡\s*ID[ï¼š:]\s*([a-f0-9-]{8,})/i);_&&(r.taskId=_[1],r.taskStatus="pending",q.set(u,_[1]),le())}const o=C.value.find(_=>_.id===u);o&&(o.result=r.result,o.status="done",o.duration=r.duration)}y();break}case"done":case"error":{if(s.type==="done"&&s.sessionId){const _=!k.value;k.value=s.sessionId,_&&E("session-change",s.sessionId)}const r=v.value[h];if(r.text=w.value,r.thinking=D.value||void 0,x.applyable){const _=ue(w.value);_&&(v.value.forEach(j=>{j!==r&&j.applyData&&delete j.applyData}),r.applyData=_)}const o=De(w.value);if(o.length>=2&&(r.options=o),s.type==="error"){r.text=`[é”™è¯¯] ${s.error}`;const _=r.toolCalls?.find(j=>j.status==="running");_&&(_.status="error")}m.value=!1,w.value="",D.value="",C.value=[],E("response",r.text),y();break}}},p)}function Ue(){v.value=[]}function ze(e){v.value.push(e),y()}async function qe(e){k.value=e,v.value=[],P.value=!0;const t=e;try{const n=await ee.get(x.agentId,e);if(k.value!==t)return;const d=n.data.messages??[],h=[];d.some(c=>c.isCompact||c.role==="compaction")&&h.push({role:"system",text:"æ›´æ—©çš„å†…å®¹å·²å‹ç¼©"});for(const c of d)c.role!=="compaction"&&h.push({role:c.role,text:c.text,toolCalls:c.toolCalls?.map(p=>({id:p.id,name:p.name,input:p.input,result:p.result,status:"done",_expanded:!1}))});v.value=h,y(),Ce(e),ve(e)}catch(n){n?.response?.status===404?v.value=[]:(console.error("[AiChat] resumeSession failed",n),v.value=[{role:"system",text:"å†å²åŠ è½½å¤±è´¥ï¼Œç»§ç»­å¯¹è¯ä»å¯æ¥ç»­"}])}finally{P.value=!1}}async function ve(e){if(m.value)return;const t=await nt(x.agentId,e);if(k.value!==e||!t.hasWorker)return;if(t.status!=="generating"){const c=async()=>{if(!m.value)try{const p=await ee.get(x.agentId,e);if(m.value||k.value!==e)return;const s=p.data.messages??[],r=[];s.some(o=>o.isCompact||o.role==="compaction")&&r.push({role:"system",text:"æ›´æ—©çš„å†…å®¹å·²å‹ç¼©"});for(const o of s)o.role!=="compaction"&&r.push({role:o.role,text:o.text,toolCalls:o.toolCalls?.map(_=>({id:_.id,name:_.name,input:_.input,result:_.result,status:"done",_expanded:!1}))});v.value=r,y()}catch{}};await c(),setTimeout(async()=>{m.value||k.value===e&&await c()},1e3);return}if(k.value!==e)return;m.value=!0,w.value="",D.value="",C.value=[];const n={role:"assistant",text:"",toolCalls:[]};v.value.push(n);const d=v.value.length-1;y();let h="";const u=at(x.agentId,e,c=>{switch(c.type){case"idle":v.value.splice(d,1),m.value=!1;break;case"thinking_delta":D.value+=c.text,y();break;case"text":case"text_delta":w.value+=c.text,y();break;case"tool_call":{const p={id:c.tool_call?.id??String(Date.now()),name:c.tool_call?.name??"tool",input:c.tool_call?.input?JSON.stringify(c.tool_call.input):void 0,status:"running",_startedAt:Date.now(),_expanded:!1};v.value[d].toolCalls.push(p),C.value.push(p),h=p.id,y();break}case"tool_result":{const p=v.value[d].toolCalls?.find(s=>s.id===h);if(p){p.result=c.text,p.status="done";const s=C.value.find(r=>r.id===h);s&&(s.result=p.result,s.status="done")}y();break}case"done":case"error":{if(c.type==="done"&&c.sessionId){const s=!k.value;k.value=c.sessionId,s&&E("session-change",c.sessionId)}const p=v.value[d];p.text=w.value,p.thinking=D.value||void 0,c.type==="error"&&(p.text=`[é”™è¯¯] ${c.error}`),m.value=!1,w.value="",D.value="",C.value=[],y();break}}});_e(()=>u.abort())}function He(){k.value=void 0,v.value=[]}function Ke(e){Y(e),V(Z)}function Ve(e){se(e,[],!0)}return ye({clearMessages:Ue,appendMessage:ze,sendText:Ke,sendSilent:Ve,fillInput:Y,messages:v,streaming:m,currentSessionId:k,resumeSession:qe,startNewSession:He}),Xe(()=>{y(),k.value&&ve(k.value)}),(e,t)=>{const n=z("ChatRound"),d=z("el-icon"),h=z("Check"),u=z("CopyDocument"),c=z("Setting"),p=z("Paperclip");return a(),l("div",{class:F(["ai-chat",{compact:$.compact,"has-bg":$.bgColor,"drag-active":H.value}]),style:Ye(be.value),onDragenter:L(Le,["prevent"]),onDragover:t[4]||(t[4]=L(()=>{},["prevent"])),onDragleave:Re,onDrop:L(Ee,["prevent","stop"])},[T(Qe,{name:"drag-fade"},{default:R(()=>[H.value?(a(),l("div",ot,[...t[5]||(t[5]=[i("div",{class:"drag-overlay-content"},[i("div",{class:"drag-overlay-icon"},"ğŸ“"),i("div",{class:"drag-overlay-title"},"æ¾å¼€ä»¥é™„åŠ æ–‡ä»¶"),i("div",{class:"drag-overlay-hint"},"æ”¯æŒå›¾ç‰‡ Â· ä»£ç  Â· æ–‡æœ¬æ–‡ä»¶")],-1)])])):f("",!0)]),_:1}),ae.value>0?(a(),l("div",it,[t[6]||(t[6]=i("span",{class:"running-dot"},null,-1)),i("span",null,"åå°æœ‰ "+g(ae.value)+" ä¸ªä»»åŠ¡æ­£åœ¨æ‰§è¡Œä¸­ï¼Œå…³é—­çª—å£åä»ä¼šç»§ç»­è¿è¡Œ",1),B.value.length?(a(),l("span",rt,[(a(!0),l(I,null,M(B.value.filter(s=>!["done","error","killed"].includes(s.status)),s=>(a(),l("span",{key:s.id,class:F(["resumed-chip",s.status])},g(s.status==="running"?"âŸ³":"ğŸŸ¡")+" "+g(s.label),3))),128))])):f("",!0)])):f("",!0),i("div",{class:"chat-messages",ref_key:"msgListRef",ref:X},[P.value?(a(),l("div",ut,[...t[7]||(t[7]=[i("div",{class:"history-loading-dots"},[i("span"),i("span"),i("span")],-1),i("div",{class:"history-loading-text"},"åŠ è½½å†å²å¯¹è¯â€¦",-1)])])):f("",!0),!v.value.length&&!P.value?(a(),l("div",ct,[$.welcomeMessage?(a(),l("div",dt,g($.welcomeMessage),1)):f("",!0),$.examples.length?(a(),l("div",pt,[(a(!0),l(I,null,M($.examples,(s,r)=>(a(),l("div",{key:r,class:"example-chip",onClick:o=>Y(s)},g(s),9,ft))),128))])):f("",!0)])):f("",!0),(a(!0),l(I,null,M(m.value?v.value.slice(0,-1):v.value,(s,r)=>(a(),l(I,{key:r},[s.role==="user"?(a(),l("div",ht,[i("div",vt,[s.images?.length?(a(),l("div",_t,[(a(!0),l(I,null,M(s.images,(o,_)=>(a(),l("img",{key:_,src:o,class:"msg-img",onClick:j=>$e(o)},null,8,gt))),128))])):f("",!0),i("div",mt,g(s.text),1)])])):s.role==="assistant"?(a(),l("div",kt,[i("div",yt,[s.thinking?(a(),l("details",{key:0,class:"thinking-block",open:$.showThinking},[i("summary",bt,[T(d,{class:"thinking-icon"},{default:R(()=>[T(n)]),_:1}),t[8]||(t[8]=U(" æ€è€ƒè¿‡ç¨‹ ",-1)),i("span",wt,g(s.thinking.length)+" å­—ç¬¦",1)]),i("pre",Ct,g(s.thinking),1)],8,xt)):f("",!0),s.toolCalls?.length?(a(),l("div",St,[(a(!0),l(I,null,M(s.toolCalls,(o,_)=>(a(),l("div",{key:_,class:F(["tool-step",o.status]),onClick:j=>o._expanded=!o._expanded},[i("div",It,[i("span",{class:F(["tool-step-dot",o.status])},[o.status==="running"?(a(),l("span",$t,"âŸ³")):o.status==="done"?(a(),l("span",Dt,"âœ“")):o.status==="error"?(a(),l("span",Mt,"âœ—")):(a(),l("span",Nt,"â—‹"))],2),i("span",jt,g(de(o.name)),1),i("code",Ft,g(o.name),1),o.input?(a(),l("span",Ot,g(pe(o.name,o.input)),1)):f("",!0),t[10]||(t[10]=i("span",{class:"tool-step-flex"},null,-1)),o.duration?(a(),l("span",At,g(o.duration),1)):f("",!0),o.taskId?(a(),l("span",{key:2,class:F(["task-badge",o.taskStatus])},[o.taskStatus==="pending"?(a(),l("span",Bt,"ğŸŸ¡ æ’é˜Ÿä¸­")):o.taskStatus==="running"?(a(),l("span",Lt,[...t[9]||(t[9]=[i("span",{class:"tool-spin"},"âŸ³",-1),U(" æ‰§è¡Œä¸­ ",-1)])])):o.taskStatus==="done"?(a(),l("span",Rt,"âœ… å®Œæˆ")):o.taskStatus==="error"?(a(),l("span",Et,"âŒ å¤±è´¥")):o.taskStatus==="killed"?(a(),l("span",Jt,"ğŸ›‘ å·²ç»ˆæ­¢")):f("",!0)],2)):f("",!0),i("span",Pt,g(o._expanded?"â–²":"â–¼"),1)]),o._expanded?(a(),l("div",{key:0,class:"tool-step-body",onClick:t[0]||(t[0]=L(()=>{},["stop"]))},[o.input?(a(),l("div",Ut,[t[11]||(t[11]=i("div",{class:"tool-label"},"INPUT",-1)),i("pre",zt,g(oe(o.input)),1)])):f("",!0),o.result?(a(),l("div",qt,[t[12]||(t[12]=i("div",{class:"tool-label"},"OUTPUT",-1)),i("pre",Ht,g(o.result.slice(0,3e3))+g(o.result.length>3e3?`
â€¦ (æˆªæ–­)`:""),1)])):f("",!0)])):f("",!0)],10,Tt))),128))])):f("",!0),i("div",Kt,[s.text?(a(),l("div",{key:0,class:"msg-text",innerHTML:ie(s.text)},null,8,Vt)):f("",!0),s.applyData&&x.applyable?(a(),l("div",Wt,[i("div",Gt,[(a(!0),l(I,null,M(s.applyData,(o,_)=>(a(),l("div",{key:_,class:"apply-row"},[i("span",Xt,g(_),1),i("span",Yt,g(String(o).slice(0,60))+g(String(o).length>60?"â€¦":""),1)]))),128))]),i("button",{class:"apply-btn",onClick:o=>e.$emit("apply",s.applyData)}," åº”ç”¨åˆ°è¡¨å• â†™ ",8,Qt)])):f("",!0),i("div",Zt,[i("button",{class:"act-btn",onClick:o=>Te(s.text),title:W.value===r?"å·²å¤åˆ¶":"å¤åˆ¶"},[W.value===r?(a(),ke(d,{key:0},{default:R(()=>[T(h)]),_:1})):(a(),ke(d,{key:1},{default:R(()=>[T(u)]),_:1}))],8,es),i("button",{class:"act-btn",onClick:o=>Ie(r),title:"é‡è¯•"},"â†º",8,ts),x.applyable&&!s.applyData&&Me(s.text)?(a(),l("button",{key:0,class:"act-btn apply-manual-btn",onClick:o=>Ne(s),title:"æ£€æµ‹åˆ°é…ç½® JSONï¼Œç‚¹å‡»åº”ç”¨"},[T(d,null,{default:R(()=>[T(c)]),_:1}),t[13]||(t[13]=U(" åº”ç”¨é…ç½® ",-1))],8,ss)):f("",!0)])]),s.options&&s.options.length?(a(),l("div",ns,[(a(!0),l(I,null,M(s.options,(o,_)=>(a(),l("button",{key:_,class:"option-chip",onClick:j=>Y(o)},g(o),9,as))),128))])):f("",!0)])])):s.role==="system"?(a(),l("div",ls,[i("div",os,g(s.text),1)])):f("",!0)],64))),128)),m.value?(a(),l("div",is,[i("div",rs,[D.value&&$.showThinking?(a(),l("details",us,[i("summary",cs,[T(d,{class:"thinking-icon"},{default:R(()=>[T(n)]),_:1}),t[14]||(t[14]=U(" æ€è€ƒä¸­â€¦ ",-1))]),i("pre",ds,[U(g(D.value),1),t[15]||(t[15]=i("span",{class:"blink"},"â–Š",-1))])])):f("",!0),C.value.length?(a(),l("div",ps,[(a(!0),l(I,null,M(C.value,(s,r)=>(a(),l("div",{key:r,class:F(["tool-step",s.status]),onClick:o=>s._expanded=!s._expanded},[i("div",hs,[i("span",{class:F(["tool-step-dot",s.status])},[s.status==="running"?(a(),l("span",vs,"âŸ³")):s.status==="done"?(a(),l("span",_s,"âœ“")):s.status==="error"?(a(),l("span",gs,"âœ—")):f("",!0)],2),i("span",ms,g(de(s.name)),1),i("code",ks,g(s.name),1),s.input?(a(),l("span",ys,g(pe(s.name,s.input)),1)):f("",!0),t[17]||(t[17]=i("span",{class:"tool-step-flex"},null,-1)),s.duration?(a(),l("span",xs,g(s.duration),1)):f("",!0),s.taskId?(a(),l("span",{key:2,class:F(["task-badge",s.taskStatus])},[s.taskStatus==="pending"?(a(),l("span",bs,"ğŸŸ¡ æ’é˜Ÿä¸­")):s.taskStatus==="running"?(a(),l("span",ws,[...t[16]||(t[16]=[i("span",{class:"tool-spin"},"âŸ³",-1),U(" æ‰§è¡Œä¸­",-1)])])):s.taskStatus==="done"?(a(),l("span",Cs,"âœ… å®Œæˆ")):s.taskStatus==="error"?(a(),l("span",Ss,"âŒ å¤±è´¥")):s.taskStatus==="killed"?(a(),l("span",Ts,"ğŸ›‘ å·²ç»ˆæ­¢")):f("",!0)],2)):f("",!0),i("span",Is,g(s._expanded?"â–²":"â–¼"),1)]),s._expanded?(a(),l("div",{key:0,class:"tool-step-body",onClick:t[1]||(t[1]=L(()=>{},["stop"]))},[s.input?(a(),l("div",$s,[t[18]||(t[18]=i("div",{class:"tool-label"},"INPUT",-1)),i("pre",Ds,g(oe(s.input)),1)])):f("",!0),s.result?(a(),l("div",Ms,[t[19]||(t[19]=i("div",{class:"tool-label"},"OUTPUT",-1)),i("pre",Ns,g(s.result.slice(0,3e3)),1)])):f("",!0)])):f("",!0)],10,fs))),128))])):f("",!0),w.value||!C.value.length?(a(),l("div",js,[!w.value&&!C.value.length?(a(),l("div",Fs,[...t[20]||(t[20]=[i("span",null,null,-1),i("span",null,null,-1),i("span",null,null,-1)])])):f("",!0),w.value?(a(),l("div",{key:1,class:"msg-text",innerHTML:ie(w.value)},null,8,Os)):f("",!0),w.value?(a(),l("span",As,"â–Š")):f("",!0)])):f("",!0)])])):f("",!0)],512),G.value?(a(),l("div",{key:1,class:"img-preview-mask",onClick:t[2]||(t[2]=s=>G.value="")},[i("img",{src:G.value,class:"img-preview-full"},null,8,Bs)])):f("",!0),i("div",Ls,[O.value.length||A.value.length?(a(),l("div",Rs,[(a(!0),l(I,null,M(O.value,(s,r)=>(a(),l("div",{key:"img-"+r,class:"attach-thumb"},[i("img",{src:s},null,8,Es),i("button",{class:"remove-attach",onClick:o=>Pe(r)},"Ã—",8,Js)]))),128)),(a(!0),l(I,null,M(A.value,(s,r)=>(a(),l("div",{key:"file-"+r,class:"attach-file-chip"},[i("span",Ps,g(Oe(s.name)),1),i("span",Us,g(s.name),1),i("span",zs,g(Ae(s.content.length)),1),i("button",{class:"attach-file-remove",onClick:o=>A.value.splice(r,1)},"Ã—",8,qs)]))),128))])):f("",!0),i("div",Hs,[i("div",Ks,[Ze(i("textarea",{ref_key:"inputRef",ref:N,"onUpdate:modelValue":t[3]||(t[3]=s=>J.value=s),placeholder:$.placeholder||"è¾“å…¥æ¶ˆæ¯â€¦ æ”¯æŒæ‹–æ‹½å›¾ç‰‡æˆ–æ–‡ä»¶ (Ctrl+Enter å‘é€)",disabled:m.value||P.value,rows:"1",class:"chat-textarea",onKeydown:[ge(L(Z,["ctrl","prevent"]),["enter"]),ge(L(Z,["meta","prevent"]),["enter"])],onPaste:Be,onInput:Se},null,40,Vs),[[et,J.value]])]),i("div",Ws,[i("label",Gs,[T(d,null,{default:R(()=>[T(p)]),_:1}),i("input",{type:"file",multiple:"",hidden:"",onChange:Je},null,32)]),i("button",{class:"send-btn",disabled:m.value||P.value||!J.value.trim()&&!O.value.length&&!A.value.length,onClick:Z},[m.value?(a(),l("span",Ys)):(a(),l("span",Qs,"â†‘"))],8,Xs)])]),t[21]||(t[21]=i("div",{class:"input-hint"},"Ctrl+Enter å‘é€ Â· æ”¯æŒæ‹–æ‹½å›¾ç‰‡/æ–‡ä»¶",-1))])],38)}}}),nn=lt(Zs,[["__scopeId","data-v-11724e02"]]);export{nn as A};
