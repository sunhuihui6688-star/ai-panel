import{t as c}from"./index-BclxA8EE.js";import{d as L,i as M,c as O,b as w,a as e,w as a,h as d,e as v,r as s,o as B,t as k,j as R,k as F,q as G,E as i,x as H}from"./index-CIO-nNtg.js";const J={class:"tools-page"},Q={style:{display:"flex","justify-content":"space-between","align-items":"center","margin-bottom":"20px"}},W={style:{margin:"0"}},X={style:{"font-size":"12px",color:"#909399"}},le=L({__name:"ToolsView",setup(Y){const U=v([]),u=v(!1),_=v(""),V=v(!1),o=G({id:"",name:"",type:"brave_search",apiKey:"",baseUrl:"",enabled:!0});M(b);async function b(){try{const n=await c.list();U.value=n.data}catch{}}function z(){_.value="",Object.assign(o,{id:"",name:"",type:"brave_search",apiKey:"",baseUrl:"",enabled:!0}),u.value=!0}function E(n){_.value=n.id,Object.assign(o,{...n}),u.value=!0}async function K(){if(!o.name||!o.type){i.warning("请填写必要字段");return}o.id||(o.id=o.type+"-"+Date.now().toString(36)),V.value=!0;try{_.value?await c.update(_.value,{...o}):await c.create({...o,status:"untested"}),i.success("保存成功"),u.value=!1,b()}catch(n){i.error(n.response?.data?.error||"保存失败")}finally{V.value=!1}}async function S(n){try{await c.update(n.id,{enabled:n.enabled})}catch{i.error("更新失败")}}async function $(n){try{await c.test(n.id),i.success("测试成功"),b()}catch{i.error("测试失败")}}async function T(n){try{await H.confirm(`确定删除 "${n.name}"？`,"确认删除",{type:"warning"}),await c.delete(n.id),i.success("已删除"),b()}catch{}}return(n,l)=>{const j=s("SetUp"),C=s("el-icon"),q=s("Plus"),r=s("el-button"),m=s("el-table-column"),x=s("el-tag"),h=s("el-switch"),I=s("el-table"),N=s("el-card"),g=s("el-option"),P=s("el-select"),p=s("el-form-item"),y=s("el-input"),A=s("el-form"),D=s("el-dialog");return B(),O("div",J,[w("div",Q,[w("h2",W,[e(C,{style:{"vertical-align":"-2px","margin-right":"6px"}},{default:a(()=>[e(j)]),_:1}),l[8]||(l[8]=d("能力配置",-1))]),e(r,{type:"primary",onClick:z},{default:a(()=>[e(C,null,{default:a(()=>[e(q)]),_:1}),l[9]||(l[9]=d(" 添加能力 ",-1))]),_:1})]),e(N,{shadow:"hover"},{default:a(()=>[e(I,{data:U.value,stripe:""},{default:a(()=>[e(m,{prop:"name",label:"名称","min-width":"160"}),e(m,{label:"类型",width:"140"},{default:a(({row:t})=>[e(x,{size:"small"},{default:a(()=>[d(k(t.type),1)]),_:2},1024)]),_:1}),e(m,{label:"API Key","min-width":"180"},{default:a(({row:t})=>[w("code",X,k(t.apiKey),1)]),_:1}),e(m,{label:"启用",width:"80"},{default:a(({row:t})=>[e(h,{modelValue:t.enabled,"onUpdate:modelValue":f=>t.enabled=f,onChange:f=>S(t),size:"small"},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),e(m,{label:"状态",width:"80"},{default:a(({row:t})=>[e(x,{type:t.status==="ok"?"success":"info",size:"small"},{default:a(()=>[d(k(t.status==="ok"?"✓":"?"),1)]),_:2},1032,["type"])]),_:1}),e(m,{label:"操作",width:"180"},{default:a(({row:t})=>[e(r,{size:"small",onClick:f=>$(t)},{default:a(()=>[...l[10]||(l[10]=[d("测试",-1)])]),_:1},8,["onClick"]),e(r,{size:"small",onClick:f=>E(t)},{default:a(()=>[...l[11]||(l[11]=[d("编辑",-1)])]),_:1},8,["onClick"]),e(r,{size:"small",type:"danger",onClick:f=>T(t)},{default:a(()=>[...l[12]||(l[12]=[d("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),e(D,{modelValue:u.value,"onUpdate:modelValue":l[7]||(l[7]=t=>u.value=t),title:_.value?"编辑能力":"添加能力",width:"520px"},{footer:a(()=>[e(r,{onClick:l[6]||(l[6]=t=>u.value=!1)},{default:a(()=>[...l[13]||(l[13]=[d("取消",-1)])]),_:1}),e(r,{type:"primary",onClick:K,loading:V.value},{default:a(()=>[...l[14]||(l[14]=[d("保存",-1)])]),_:1},8,["loading"])]),default:a(()=>[e(A,{model:o,"label-width":"100px"},{default:a(()=>[e(p,{label:"类型",required:""},{default:a(()=>[e(P,{modelValue:o.type,"onUpdate:modelValue":l[0]||(l[0]=t=>o.type=t),style:{width:"100%"}},{default:a(()=>[e(g,{label:"Brave Search",value:"brave_search"}),e(g,{label:"ElevenLabs",value:"elevenlabs"}),e(g,{label:"自定义",value:"custom"})]),_:1},8,["modelValue"])]),_:1}),e(p,{label:"名称",required:""},{default:a(()=>[e(y,{modelValue:o.name,"onUpdate:modelValue":l[1]||(l[1]=t=>o.name=t),placeholder:"如 Brave Search"},null,8,["modelValue"])]),_:1}),e(p,{label:"ID"},{default:a(()=>[e(y,{modelValue:o.id,"onUpdate:modelValue":l[2]||(l[2]=t=>o.id=t),placeholder:"唯一标识"},null,8,["modelValue"])]),_:1}),e(p,{label:"API Key",required:""},{default:a(()=>[e(y,{modelValue:o.apiKey,"onUpdate:modelValue":l[3]||(l[3]=t=>o.apiKey=t),type:"password","show-password":""},null,8,["modelValue"])]),_:1}),o.type==="custom"?(B(),R(p,{key:0,label:"Base URL"},{default:a(()=>[e(y,{modelValue:o.baseUrl,"onUpdate:modelValue":l[4]||(l[4]=t=>o.baseUrl=t),placeholder:"https://..."},null,8,["modelValue"])]),_:1})):F("",!0),e(p,{label:"启用"},{default:a(()=>[e(h,{modelValue:o.enabled,"onUpdate:modelValue":l[5]||(l[5]=t=>o.enabled=t)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}});export{le as default};
