import{o as E,b as se}from"./index-B6SLQW8T.js";import{d as ie,i as re,I as ue,j as m,w as a,z as J,r as f,e as g,o as i,a as o,b as n,h as d,t as r,k as v,c as y,m as F,F as L,s as de,n as pe,E as h}from"./index-CdZnHZ0f.js";import{_ as fe}from"./_plugin-vue_export-helper-DlAUqK2U.js";const me={style:{display:"flex","align-items":"center",gap:"12px"}},ve={style:{display:"flex",gap:"8px"}},ce={style:{display:"flex",gap:"8px","margin-bottom":"16px","align-items":"center","flex-wrap":"wrap"}},ge={style:{color:"#94a3b8","font-size":"13px"}},ye={key:1,style:{display:"flex","flex-direction":"column",gap:"12px"}},xe={style:{display:"flex","align-items":"flex-start","justify-content":"space-between","margin-bottom":"10px"}},_e={style:{display:"flex","align-items":"center",gap:"10px",flex:"1","min-width":"0"}},be={style:{"font-weight":"600","font-size":"14px",color:"#1e293b","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis"}},we={style:{"font-size":"11px",color:"#94a3b8","flex-shrink":"0"}},ke={style:{display:"flex",gap:"6px","flex-shrink":"0","margin-left":"12px"}},he={style:{display:"flex",gap:"16px","margin-bottom":"10px","flex-wrap":"wrap"}},ze={style:{"font-size":"12px",color:"#64748b"}},Ve={key:0,style:{"font-size":"12px",color:"#64748b"}},Ce={style:{"font-size":"12px",color:"#64748b"}},Ie={style:{"font-size":"12px",color:"#64748b"}},$e={style:{background:"#f8fafc","border-radius":"6px",padding:"8px 12px","margin-bottom":"8px"}},Te={style:{margin:"0","font-size":"13px",color:"#475569","white-space":"pre-wrap","word-break":"break-all","max-height":"60px",overflow:"hidden"}},Ae={key:1,style:{"margin-top":"6px"}},Ue={style:{margin:"0","font-size":"12px",color:"#334155",background:"#f1f5f9",padding:"8px","border-radius":"6px","max-height":"80px",overflow:"hidden","white-space":"pre-wrap","word-break":"break-all"}},Se={style:{display:"flex","align-items":"center",gap:"8px"}},Be={style:{color:"#94a3b8","font-size":"12px"}},Ne={key:0},De={style:{display:"flex",gap:"12px","margin-bottom":"12px","flex-wrap":"wrap"}},Me={style:{"font-size":"13px",color:"#64748b"}},je={style:{"font-size":"13px",color:"#64748b"}},Ee={style:{background:"#f8fafc","border-radius":"6px",padding:"10px 14px","margin-bottom":"12px","font-size":"13px",color:"#475569"}},Fe={style:{background:"#0f172a",color:"#e2e8f0",padding:"16px","border-radius":"8px","font-size":"12px","white-space":"pre-wrap","word-break":"break-all","max-height":"400px","overflow-y":"auto",margin:"0"}},Le=ie({__name:"SubagentsView",setup(qe){const _=g([]),z=g([]),V=g(!1),T=g(null),C=g(""),I=g(""),b=g(!1),w=g(!1),s=g(null),A=g(!1);let U;const u=g({agentId:"",label:"",task:"",model:""}),S=J(()=>_.value.filter(l=>!(C.value&&l.status!==C.value||I.value&&l.agentId!==I.value))),B=J(()=>_.value.filter(l=>l.status==="running"||l.status==="pending").length);function q(l){switch(l){case"running":return"success";case"done":return"primary";case"error":return"danger";case"killed":return"warning";default:return"info"}}function O(l){switch(l){case"running":return"è¿è¡Œä¸­";case"done":return"å·²å®Œæˆ";case"error":return"å‡ºé”™";case"killed":return"å·²ç»ˆæ­¢";case"pending":return"ç­‰å¾…ä¸­";default:return l}}function N(l){return z.value.find(e=>e.id===l)?.name||l}function K(l){return l?new Date(l).toLocaleString("zh-CN",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}):"â€”"}function P(l){if(!l.startedAt)return"â€”";const p=(l.endedAt||Date.now())-l.startedAt;if(p<1e3)return"< 1s";if(p<6e4)return`${Math.round(p/1e3)}s`;const c=Math.floor(p/6e4),D=Math.round(p%6e4/1e3);return`${c}m${D}s`}function Q(l){return l.trim().split(`
`).slice(-4).join(`
`)}async function k(){V.value=!0;try{const l=await E.list();if(_.value=l.data,s.value){const e=_.value.find(p=>p.id===s.value.id);e&&(s.value=e)}}catch{}finally{V.value=!1}}async function W(){try{const l=await se.list();z.value=l.data.filter(e=>!e.system)}catch{}}async function R(l){T.value=l;try{await E.kill(l),h.success("ä»»åŠ¡å·²ç»ˆæ­¢"),await k()}catch(e){h.error(e?.response?.data?.error||"ç»ˆæ­¢å¤±è´¥")}finally{T.value=null}}function X(l){s.value=l,w.value=!0}async function Y(){if(!(!u.value.agentId||!u.value.task.trim())){A.value=!0;try{await E.spawn({agentId:u.value.agentId,label:u.value.label,task:u.value.task,model:u.value.model}),h.success("ä»»åŠ¡å·²æ´¾ç”Ÿï¼Œåœ¨åå°æ‰§è¡Œä¸­"),b.value=!1,u.value={agentId:"",label:"",task:"",model:""},await k()}catch(l){h.error(l?.response?.data?.error||"æ´¾ç”Ÿå¤±è´¥")}finally{A.value=!1}}}function Z(l){navigator.clipboard?.writeText(l),h.success("å·²å¤åˆ¶")}return re(async()=>{await W(),await k(),U=window.setInterval(()=>{B.value>0&&k()},3e3)}),ue(()=>{U&&clearInterval(U)}),(l,e)=>{const p=f("el-tag"),c=f("el-button"),D=f("el-header"),x=f("el-option"),M=f("el-select"),ee=f("el-empty"),G=f("el-alert"),te=f("el-progress"),le=f("el-main"),$=f("el-form-item"),j=f("el-input"),ae=f("el-form"),H=f("el-dialog"),ne=f("el-container");return i(),m(ne,{style:{height:"100vh","flex-direction":"column"}},{default:a(()=>[o(D,{style:{display:"flex","align-items":"center","justify-content":"space-between",padding:"0 20px","border-bottom":"1px solid #e2e8f0",background:"#fff"}},{default:a(()=>[n("div",me,[e[14]||(e[14]=n("span",{style:{"font-size":"18px","font-weight":"600",color:"#1e293b"}},"âš¡ åå°ä»»åŠ¡",-1)),B.value>0?(i(),m(p,{key:0,type:"success",size:"small",effect:"dark"},{default:a(()=>[d(r(B.value)+" è¿è¡Œä¸­ ",1)]),_:1})):v("",!0),_.value.length===0?(i(),m(p,{key:1,type:"info",size:"small"},{default:a(()=>[...e[13]||(e[13]=[d("æš‚æ— ä»»åŠ¡",-1)])]),_:1})):v("",!0)]),n("div",ve,[o(c,{size:"small",onClick:k,loading:V.value,icon:"Refresh"},{default:a(()=>[...e[15]||(e[15]=[d("åˆ·æ–°",-1)])]),_:1},8,["loading"]),o(c,{size:"small",type:"primary",onClick:e[0]||(e[0]=t=>b.value=!0),icon:"Plus"},{default:a(()=>[...e[16]||(e[16]=[d(" æ´¾ç”Ÿä»»åŠ¡ ",-1)])]),_:1})])]),_:1}),o(le,{style:{padding:"20px","overflow-y":"auto"}},{default:a(()=>[n("div",ce,[o(M,{modelValue:C.value,"onUpdate:modelValue":e[1]||(e[1]=t=>C.value=t),placeholder:"æ‰€æœ‰çŠ¶æ€",clearable:"",size:"small",style:{width:"140px"}},{default:a(()=>[o(x,{label:"è¿è¡Œä¸­",value:"running"}),o(x,{label:"å·²å®Œæˆ",value:"done"}),o(x,{label:"å‡ºé”™",value:"error"}),o(x,{label:"å·²ç»ˆæ­¢",value:"killed"}),o(x,{label:"ç­‰å¾…ä¸­",value:"pending"})]),_:1},8,["modelValue"]),o(M,{modelValue:I.value,"onUpdate:modelValue":e[2]||(e[2]=t=>I.value=t),placeholder:"æ‰€æœ‰æˆå‘˜",clearable:"",size:"small",style:{width:"160px"}},{default:a(()=>[(i(!0),y(L,null,F(z.value,t=>(i(),m(x,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),n("span",ge,"å…± "+r(S.value.length)+" ä¸ªä»»åŠ¡",1)]),S.value.length===0&&!V.value?(i(),m(ee,{key:0,description:"æš‚æ— åå°ä»»åŠ¡ã€‚ç‚¹å‡»ã€Œæ´¾ç”Ÿä»»åŠ¡ã€è®© AI æˆå‘˜åœ¨åå°æ‰§è¡Œä»»åŠ¡ã€‚",style:{"margin-top":"60px"}})):(i(),y("div",ye,[(i(!0),y(L,null,F(S.value,t=>(i(),y("div",{key:t.id,class:de(["task-card","task-"+t.status])},[n("div",xe,[n("div",_e,[o(p,{type:q(t.status),size:"small",effect:"dark",style:{"flex-shrink":"0"}},{default:a(()=>[d(r(O(t.status)),1)]),_:2},1032,["type"]),n("span",be,r(t.label||"æ— æ ‡ç­¾"),1),n("code",we,r(t.id),1)]),n("div",ke,[t.status==="running"||t.status==="pending"?(i(),m(c,{key:0,size:"small",type:"danger",link:"",onClick:oe=>R(t.id),loading:T.value===t.id},{default:a(()=>[...e[17]||(e[17]=[d("ç»ˆæ­¢",-1)])]),_:1},8,["onClick","loading"])):v("",!0),o(c,{size:"small",link:"",onClick:oe=>X(t)},{default:a(()=>[...e[18]||(e[18]=[d("æŸ¥çœ‹è¾“å‡º",-1)])]),_:1},8,["onClick"])])]),n("div",he,[n("span",ze,[e[19]||(e[19]=d(" ğŸ¤– ",-1)),n("strong",null,r(N(t.agentId)),1)]),t.spawnedBy?(i(),y("span",Ve," â†‘ æ´¾å‘è‡ª "+r(N(t.spawnedBy)),1)):v("",!0),n("span",Ce,"â± "+r(t.duration||P(t)),1),n("span",Ie," ğŸ“… "+r(K(t.createdAt)),1),t.model?(i(),m(p,{key:1,size:"small",type:"info",effect:"plain"},{default:a(()=>[d(r(t.model),1)]),_:2},1024)):v("",!0)]),n("div",$e,[n("p",Te,r(t.task),1)]),t.error?(i(),m(G,{key:0,type:"error",description:t.error,closable:!1,"show-icon":"",style:{"margin-top":"4px"}},null,8,["description"])):v("",!0),t.output&&t.status!=="pending"?(i(),y("div",Ae,[e[20]||(e[20]=n("div",{style:{"font-size":"11px",color:"#94a3b8","margin-bottom":"4px"}},"è¾“å‡ºé¢„è§ˆï¼š",-1)),n("pre",Ue,r(Q(t.output)),1)])):v("",!0),t.status==="running"?(i(),m(te,{key:2,percentage:100,status:"striped",striped:"","striped-flow":"",duration:3,style:{"margin-top":"8px"}})):v("",!0)],2))),128))]))]),_:1}),o(H,{modelValue:b.value,"onUpdate:modelValue":e[8]||(e[8]=t=>b.value=t),title:"æ´¾ç”Ÿåå°ä»»åŠ¡",width:"560px","close-on-click-modal":!1},{footer:a(()=>[o(c,{onClick:e[7]||(e[7]=t=>b.value=!1)},{default:a(()=>[...e[21]||(e[21]=[d("å–æ¶ˆ",-1)])]),_:1}),o(c,{type:"primary",onClick:Y,loading:A.value,disabled:!u.value.agentId||!u.value.task.trim()},{default:a(()=>[...e[22]||(e[22]=[d(" æ´¾ç”Ÿä»»åŠ¡ ",-1)])]),_:1},8,["loading","disabled"])]),default:a(()=>[o(ae,{model:u.value,"label-width":"80px",size:"small"},{default:a(()=>[o($,{label:"æ‰§è¡Œæˆå‘˜",required:""},{default:a(()=>[o(M,{modelValue:u.value.agentId,"onUpdate:modelValue":e[3]||(e[3]=t=>u.value.agentId=t),placeholder:"é€‰æ‹© AI æˆå‘˜",style:{width:"100%"}},{default:a(()=>[(i(!0),y(L,null,F(z.value,t=>(i(),m(x,{key:t.id,label:t.name,value:t.id},{default:a(()=>[n("div",Se,[n("div",{style:pe([{width:"8px",height:"8px","border-radius":"50%"},{background:t.avatarColor||"#6366f1"}])},null,4),n("span",null,r(t.name),1),n("span",Be,r(t.id),1)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o($,{label:"ä»»åŠ¡æ ‡ç­¾"},{default:a(()=>[o(j,{modelValue:u.value.label,"onUpdate:modelValue":e[4]||(e[4]=t=>u.value.label=t),placeholder:"ç®€çŸ­æ ‡ç­¾ï¼Œä¾¿äºè¯†åˆ«ï¼ˆå¯é€‰ï¼‰"},null,8,["modelValue"])]),_:1}),o($,{label:"æ¨¡å‹"},{default:a(()=>[o(j,{modelValue:u.value.model,"onUpdate:modelValue":e[5]||(e[5]=t=>u.value.model=t),placeholder:"ç•™ç©ºä½¿ç”¨é»˜è®¤æ¨¡å‹ï¼ˆå¦‚ anthropic/claude-sonnet-4-6ï¼‰"},null,8,["modelValue"])]),_:1}),o($,{label:"ä»»åŠ¡æè¿°",required:""},{default:a(()=>[o(j,{modelValue:u.value.task,"onUpdate:modelValue":e[6]||(e[6]=t=>u.value.task=t),type:"textarea",rows:6,placeholder:"è¯¦ç»†æè¿°è¿™ä¸ª AI æˆå‘˜éœ€è¦å®Œæˆçš„ä»»åŠ¡..."},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),o(H,{modelValue:w.value,"onUpdate:modelValue":e[12]||(e[12]=t=>w.value=t),title:`ä»»åŠ¡è¾“å‡º â€” ${s.value?.label||s.value?.id}`,width:"720px",top:"5vh"},{footer:a(()=>[o(c,{onClick:e[9]||(e[9]=t=>w.value=!1)},{default:a(()=>[...e[25]||(e[25]=[d("å…³é—­",-1)])]),_:1}),s.value&&(s.value.status==="running"||s.value.status==="pending")?(i(),m(c,{key:0,type:"danger",onClick:e[10]||(e[10]=t=>{R(s.value.id),w.value=!1})},{default:a(()=>[...e[26]||(e[26]=[d(" ç»ˆæ­¢ä»»åŠ¡ ",-1)])]),_:1})):v("",!0),s.value?.output?(i(),m(c,{key:1,onClick:e[11]||(e[11]=t=>Z(s.value.output))},{default:a(()=>[...e[27]||(e[27]=[d("å¤åˆ¶è¾“å‡º",-1)])]),_:1})):v("",!0)]),default:a(()=>[s.value?(i(),y("div",Ne,[n("div",De,[o(p,{type:q(s.value.status),effect:"dark"},{default:a(()=>[d(r(O(s.value.status)),1)]),_:1},8,["type"]),n("span",Me,"ğŸ¤– "+r(N(s.value.agentId)),1),n("span",je,"â± "+r(P(s.value)),1)]),n("div",Ee,[e[23]||(e[23]=n("strong",null,"ä»»åŠ¡ï¼š",-1)),d(r(s.value.task),1)]),s.value.error?(i(),m(G,{key:0,type:"error",description:s.value.error,closable:!1,"show-icon":"",style:{"margin-bottom":"12px"}},null,8,["description"])):v("",!0),e[24]||(e[24]=n("div",{style:{"font-size":"13px","font-weight":"600",color:"#475569","margin-bottom":"6px"}},"è¾“å‡ºï¼š",-1)),n("pre",Fe,r(s.value.output||"ï¼ˆæš‚æ— è¾“å‡ºï¼‰"),1)])):v("",!0)]),_:1},8,["modelValue","title"])]),_:1})}}}),Ge=fe(Le,[["__scopeId","data-v-709a693a"]]);export{Ge as default};
