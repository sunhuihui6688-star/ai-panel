import{d as Ee,h as Se,E as r,k as c,w as t,B as Be,g as s,r as o,o as m,a as l,f as _,i as y,y as Ie,t as f,e as u,z as ie,C as Me,D as Le,G as Ye,H as je,l as S,c as X,j as Oe,F as Z}from"./index-D6n06Nfd.js";import{b as Pe,f as B,d as I,e as M}from"./index-BF1X9mkB.js";import{A as Re}from"./AiChat-BXlQFA8K.js";import{_ as Ge}from"./_plugin-vue_export-helper-DlAUqK2U.js";const He={class:"header-left"},Je={class:"memory-toolbar",style:{"margin-bottom":"12px",display:"flex",gap:"8px"}},Ke={style:{display:"flex","align-items":"center",gap:"4px","font-size":"13px"}},We={style:{display:"flex","align-items":"center","justify-content":"space-between"}},qe={style:{"margin-top":"8px",display:"flex",gap:"8px","align-items":"center"}},Qe=Ee({__name:"AgentDetailView",setup(Xe){const p=Be().params.id,g=s(null),ee=s("chat"),L=s(""),Y=s(""),j=s([]),w=s(""),V=s(""),H=s(!1),J=s([]),T=s(!1),O=s(""),D=s(!1),P=s(""),le=s([]),b=s(""),$=s(""),R=s(null),te=s([]),A=s(!1),d=s({name:"",expr:"0 9 * * *",tz:"Asia/Shanghai",message:"",enabled:!0});function me(a){return a==="running"?"success":a==="stopped"?"danger":"info"}function pe(a){return a==="running"?"运行中":a==="stopped"?"已停止":"空闲"}function ae(a){return a?a<1024?a+" B":a<1048576?(a/1024).toFixed(1)+" KB":(a/1048576).toFixed(1)+" MB":"0 B"}function fe(a){return new Date(a).toLocaleString()}function ce(a){return a?new Date(a).toLocaleString():""}Se(async()=>{try{const a=await Pe.get(p);g.value=a.data}catch{r.error("加载 Agent 失败")}ve(),Ve(),G()});async function ve(){try{const[a,e]=await Promise.all([B.read(p,"IDENTITY.md"),B.read(p,"SOUL.md")]);L.value=a.data?.content||"",Y.value=e.data?.content||""}catch{}N()}async function K(a,e){try{await B.write(p,a,e),r.success(`${a} 已保存`)}catch{r.error(`保存 ${a} 失败`)}}async function N(){try{const a=await I.tree(p);j.value=a.data||[]}catch{j.value=[]}}async function ye(a){if(!a.isDir){w.value=a.path,J.value=a.path.split("/");try{const e=await I.readFile(p,a.path);V.value=e.data?.content||""}catch{V.value="(无法读取)"}}}async function _e(){if(w.value){H.value=!0;try{await I.writeFile(p,w.value,V.value),r.success("记忆文件已保存"),N()}catch{r.error("保存失败")}finally{H.value=!1}}}async function ge(){const a=O.value.trim();if(!a){r.warning("请输入路径");return}try{await I.writeFile(p,a,`# ${a.split("/").pop()?.replace(".md","")||"New File"}

`),r.success("文件已创建"),T.value=!1,O.value="",N(),w.value=a,J.value=a.split("/"),V.value=`# ${a.split("/").pop()?.replace(".md","")||"New File"}

`}catch{r.error("创建失败")}}async function we(){const a=P.value.trim();if(!a){r.warning("请输入内容");return}try{await I.dailyLog(p,a),r.success("日志已添加"),D.value=!1,P.value="",N()}catch{r.error("添加失败")}}async function Ve(){try{const a=await B.read(p,"/");Array.isArray(a.data)&&(le.value=a.data.map(e=>({name:e.name,isDir:e.isDir,size:e.size,modTime:e.modTime,path:e.name})))}catch{}}async function be(a){if(!a.isDir){b.value=a.path||a.name,R.value=a;try{const e=await B.read(p,b.value);$.value=e.data?.content||""}catch{$.value="(无法读取)"}}}async function ke(){b.value&&await K(b.value,$.value)}async function G(){try{const a=await M.list();te.value=a.data||[]}catch{}}async function Ce(){try{await M.create({name:d.value.name,enabled:d.value.enabled,schedule:{kind:"cron",expr:d.value.expr,tz:d.value.tz},payload:{kind:"agentTurn",message:d.value.message},delivery:{mode:"announce"}}),r.success("任务创建成功"),A.value=!1,G()}catch(a){r.error(a.response?.data?.error||"创建失败")}}async function xe(a){try{await M.update(a.id,a)}catch{r.error("更新失败")}}async function ze(a){try{await M.run(a.id),r.success("已触发运行"),setTimeout(G,2e3)}catch{r.error("运行失败")}}async function Fe(a){try{await M.delete(a.id),r.success("已删除"),G()}catch{r.error("删除失败")}}return(a,e)=>{const i=o("el-button"),ne=o("el-tag"),k=o("el-text"),Ue=o("el-header"),h=o("el-tab-pane"),v=o("el-input"),C=o("el-card"),x=o("el-col"),W=o("el-row"),z=o("el-icon"),oe=o("el-tree"),ue=o("el-empty"),se=o("el-breadcrumb-item"),Te=o("el-breadcrumb"),F=o("el-form-item"),re=o("el-form"),q=o("el-dialog"),E=o("el-table-column"),de=o("el-switch"),De=o("el-table"),Q=o("el-option"),$e=o("el-select"),Ae=o("el-tabs"),Ne=o("el-main"),he=o("el-container");return m(),c(he,{class:"agent-detail"},{default:t(()=>[l(Ue,{class:"detail-header"},{default:t(()=>[_("div",He,[l(i,{icon:y(Ie),onClick:e[0]||(e[0]=n=>a.$router.push("/agents")),circle:""},null,8,["icon"]),_("h2",null,f(g.value?.name||"..."),1),l(ne,{type:me(g.value?.status)},{default:t(()=>[u(f(pe(g.value?.status)),1)]),_:1},8,["type"])]),l(k,{type:"info"},{default:t(()=>[u(f(g.value?.model),1)]),_:1})]),_:1}),l(Ne,null,{default:t(()=>[l(Ae,{modelValue:ee.value,"onUpdate:modelValue":e[23]||(e[23]=n=>ee.value=n),type:"border-card"},{default:t(()=>[l(h,{label:"对话",name:"chat"},{default:t(()=>[l(Re,{"agent-id":y(p),scenario:"agent-detail","welcome-message":`你好！我是 **${g.value?.name||"AI"}**，有什么可以帮你的？`,height:"calc(100vh - 140px)","show-thinking":!0},null,8,["agent-id","welcome-message"])]),_:1}),l(h,{label:"身份 & 灵魂",name:"identity"},{default:t(()=>[l(W,{gutter:20},{default:t(()=>[l(x,{span:12},{default:t(()=>[l(C,{header:"IDENTITY.md"},{default:t(()=>[l(v,{modelValue:L.value,"onUpdate:modelValue":e[1]||(e[1]=n=>L.value=n),type:"textarea",rows:15,onBlur:e[2]||(e[2]=n=>K("IDENTITY.md",L.value))},null,8,["modelValue"])]),_:1})]),_:1}),l(x,{span:12},{default:t(()=>[l(C,{header:"SOUL.md"},{default:t(()=>[l(v,{modelValue:Y.value,"onUpdate:modelValue":e[3]||(e[3]=n=>Y.value=n),type:"textarea",rows:15,onBlur:e[4]||(e[4]=n=>K("SOUL.md",Y.value))},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),l(h,{label:"记忆",name:"memory"},{default:t(()=>[_("div",Je,[l(i,{type:"primary",size:"small",onClick:e[5]||(e[5]=n=>T.value=!0)},{default:t(()=>[l(z,null,{default:t(()=>[l(y(ie))]),_:1}),e[24]||(e[24]=u(" 新建文件 ",-1))]),_:1}),l(i,{size:"small",onClick:e[6]||(e[6]=n=>D.value=!0)},{default:t(()=>[l(z,null,{default:t(()=>[l(y(Me))]),_:1}),e[25]||(e[25]=u(" 添加日志 ",-1))]),_:1}),l(i,{size:"small",onClick:N},{default:t(()=>[l(z,null,{default:t(()=>[l(y(Le))]),_:1}),e[26]||(e[26]=u(" 刷新 ",-1))]),_:1})]),l(W,{gutter:16},{default:t(()=>[l(x,{span:7},{default:t(()=>[l(C,{header:"记忆目录",shadow:"hover"},{default:t(()=>[l(oe,{data:j.value,props:{label:"name",children:"children",isLeaf:n=>!n.isDir},onNodeClick:ye,"highlight-current":"","default-expand-all":"","expand-on-click-node":!1},{default:t(({data:n})=>[_("span",Ke,[n.isDir?(m(),c(z,{key:0,style:{color:"#E6A23C"}},{default:t(()=>[l(y(Ye))]),_:1})):(m(),c(z,{key:1,style:{color:"#409EFF"}},{default:t(()=>[l(y(je))]),_:1})),_("span",null,f(n.name),1),!n.isDir&&n.size?(m(),c(k,{key:2,type:"info",size:"small",style:{"margin-left":"auto"}},{default:t(()=>[u(f(ae(n.size)),1)]),_:2},1024)):S("",!0)])]),_:1},8,["data","props"]),j.value.length===0?(m(),c(ue,{key:0,description:"记忆树为空","image-size":40})):S("",!0)]),_:1})]),_:1}),l(x,{span:17},{default:t(()=>[l(C,{shadow:"hover"},{header:t(()=>[_("div",We,[l(Te,{separator:"/"},{default:t(()=>[l(se,null,{default:t(()=>[...e[27]||(e[27]=[u("memory",-1)])]),_:1}),(m(!0),X(Z,null,Oe(J.value,(n,U)=>(m(),c(se,{key:U},{default:t(()=>[u(f(n),1)]),_:2},1024))),128))]),_:1}),w.value?(m(),c(i,{key:0,type:"primary",size:"small",onClick:_e,loading:H.value},{default:t(()=>[...e[28]||(e[28]=[u("保存",-1)])]),_:1},8,["loading"])):S("",!0)])]),default:t(()=>[w.value?(m(),c(v,{key:0,modelValue:V.value,"onUpdate:modelValue":e[7]||(e[7]=n=>V.value=n),type:"textarea",rows:22,style:{"font-family":"monospace"}},null,8,["modelValue"])):(m(),c(ue,{key:1,description:"点击左侧文件查看和编辑","image-size":60}))]),_:1})]),_:1})]),_:1}),l(q,{modelValue:T.value,"onUpdate:modelValue":e[10]||(e[10]=n=>T.value=n),title:"新建记忆文件",width:"480px"},{footer:t(()=>[l(i,{onClick:e[9]||(e[9]=n=>T.value=!1)},{default:t(()=>[...e[30]||(e[30]=[u("取消",-1)])]),_:1}),l(i,{type:"primary",onClick:ge},{default:t(()=>[...e[31]||(e[31]=[u("创建",-1)])]),_:1})]),default:t(()=>[l(re,{"label-width":"80px"},{default:t(()=>[l(F,{label:"路径"},{default:t(()=>[l(v,{modelValue:O.value,"onUpdate:modelValue":e[8]||(e[8]=n=>O.value=n),placeholder:"例如: projects/my-project.md 或 topics/cooking.md"},null,8,["modelValue"]),l(k,{type:"info",size:"small",style:{"margin-top":"4px"}},{default:t(()=>[...e[29]||(e[29]=[u("相对于 memory/ 目录",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(q,{modelValue:D.value,"onUpdate:modelValue":e[13]||(e[13]=n=>D.value=n),title:"添加今日日志",width:"600px"},{footer:t(()=>[l(i,{onClick:e[12]||(e[12]=n=>D.value=!1)},{default:t(()=>[...e[32]||(e[32]=[u("取消",-1)])]),_:1}),l(i,{type:"primary",onClick:we},{default:t(()=>[...e[33]||(e[33]=[u("提交",-1)])]),_:1})]),default:t(()=>[l(v,{modelValue:P.value,"onUpdate:modelValue":e[11]||(e[11]=n=>P.value=n),type:"textarea",rows:10,placeholder:"记录今天的重要事项、学习心得、待办..."},null,8,["modelValue"])]),_:1},8,["modelValue"])]),_:1}),l(h,{label:"工作区",name:"workspace"},{default:t(()=>[l(W,{gutter:20},{default:t(()=>[l(x,{span:8},{default:t(()=>[l(C,{header:"文件列表"},{default:t(()=>[l(oe,{data:le.value,props:{label:"name",children:"children"},onNodeClick:be,"highlight-current":"","default-expand-all":""},null,8,["data"])]),_:1})]),_:1}),l(x,{span:16},{default:t(()=>[l(C,{header:b.value||"选择文件查看"},{default:t(()=>[b.value?(m(),X(Z,{key:0},[l(v,{modelValue:$.value,"onUpdate:modelValue":e[14]||(e[14]=n=>$.value=n),type:"textarea",rows:20},null,8,["modelValue"]),_("div",qe,[l(i,{type:"primary",onClick:ke},{default:t(()=>[...e[34]||(e[34]=[u("保存",-1)])]),_:1}),R.value?(m(),c(k,{key:0,type:"info",size:"small"},{default:t(()=>[u(f(ae(R.value.size))+" · "+f(fe(R.value.modTime)),1)]),_:1})):S("",!0)])],64)):S("",!0)]),_:1},8,["header"])]),_:1})]),_:1})]),_:1}),l(h,{label:"定时任务",name:"cron"},{default:t(()=>[l(i,{type:"primary",onClick:e[15]||(e[15]=n=>A.value=!0),style:{"margin-bottom":"16px"}},{default:t(()=>[l(z,null,{default:t(()=>[l(y(ie))]),_:1}),e[35]||(e[35]=u(" 新建任务 ",-1))]),_:1}),l(De,{data:te.value,stripe:""},{default:t(()=>[l(E,{prop:"name",label:"名称"}),l(E,{label:"调度"},{default:t(({row:n})=>[u(f(n.schedule?.expr)+" ("+f(n.schedule?.tz)+")",1)]),_:1}),l(E,{label:"最近运行",width:"180"},{default:t(({row:n})=>[n.state?.lastRunAtMs?(m(),X(Z,{key:0},[l(ne,{type:n.state?.lastStatus==="ok"?"success":"danger",size:"small"},{default:t(()=>[u(f(n.state?.lastStatus),1)]),_:2},1032,["type"]),l(k,{type:"info",size:"small",style:{"margin-left":"4px"}},{default:t(()=>[u(f(ce(n.state?.lastRunAtMs)),1)]),_:2},1024)],64)):(m(),c(k,{key:1,type:"info",size:"small"},{default:t(()=>[...e[36]||(e[36]=[u("未运行",-1)])]),_:1}))]),_:1}),l(E,{label:"启用",width:"80"},{default:t(({row:n})=>[l(de,{modelValue:n.enabled,"onUpdate:modelValue":U=>n.enabled=U,onChange:U=>xe(n)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),l(E,{label:"操作",width:"200"},{default:t(({row:n})=>[l(i,{size:"small",onClick:U=>ze(n)},{default:t(()=>[...e[37]||(e[37]=[u("立即运行",-1)])]),_:1},8,["onClick"]),l(i,{size:"small",type:"danger",onClick:U=>Fe(n)},{default:t(()=>[...e[38]||(e[38]=[u("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]),l(q,{modelValue:A.value,"onUpdate:modelValue":e[22]||(e[22]=n=>A.value=n),title:"新建定时任务",width:"520px"},{footer:t(()=>[l(i,{onClick:e[21]||(e[21]=n=>A.value=!1)},{default:t(()=>[...e[39]||(e[39]=[u("取消",-1)])]),_:1}),l(i,{type:"primary",onClick:Ce},{default:t(()=>[...e[40]||(e[40]=[u("创建",-1)])]),_:1})]),default:t(()=>[l(re,{model:d.value,"label-width":"100px"},{default:t(()=>[l(F,{label:"名称"},{default:t(()=>[l(v,{modelValue:d.value.name,"onUpdate:modelValue":e[16]||(e[16]=n=>d.value.name=n)},null,8,["modelValue"])]),_:1}),l(F,{label:"Cron 表达式"},{default:t(()=>[l(v,{modelValue:d.value.expr,"onUpdate:modelValue":e[17]||(e[17]=n=>d.value.expr=n),placeholder:"30 3 * * *"},null,8,["modelValue"])]),_:1}),l(F,{label:"时区"},{default:t(()=>[l($e,{modelValue:d.value.tz,"onUpdate:modelValue":e[18]||(e[18]=n=>d.value.tz=n)},{default:t(()=>[l(Q,{label:"Asia/Shanghai",value:"Asia/Shanghai"}),l(Q,{label:"UTC",value:"UTC"}),l(Q,{label:"America/New_York",value:"America/New_York"})]),_:1},8,["modelValue"])]),_:1}),l(F,{label:"消息"},{default:t(()=>[l(v,{modelValue:d.value.message,"onUpdate:modelValue":e[19]||(e[19]=n=>d.value.message=n),type:"textarea",rows:3},null,8,["modelValue"])]),_:1}),l(F,{label:"启用"},{default:t(()=>[l(de,{modelValue:d.value.enabled,"onUpdate:modelValue":e[20]||(e[20]=n=>d.value.enabled=n)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})}}}),nl=Ge(Qe,[["__scopeId","data-v-252708d3"]]);export{nl as default};
