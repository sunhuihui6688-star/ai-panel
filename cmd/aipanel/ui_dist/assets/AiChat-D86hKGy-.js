import{d as G,g as d,h as Q,c as l,n as X,s as V,f as e,l as r,F as f,j as b,e as I,t as p,b as B,p as Z,I as ee,J as te,K as A,o}from"./index-dEy0INM8.js";import{g as se}from"./index-BF1X9mkB.js";import{_ as ne}from"./_plugin-vue_export-helper-DlAUqK2U.js";const le={key:0,class:"welcome-msg"},oe=["innerHTML"],ae={key:1,class:"examples-wrap"},ie=["onClick"],re={key:0,class:"msg-row user"},ce={class:"msg-bubble user-bubble"},ue={key:0,class:"msg-images"},de=["src","onClick"],pe=["innerHTML"],ge={key:1,class:"msg-row assistant"},he={class:"msg-bubble assistant-bubble"},ve={key:0,class:"thinking-block",open:!1},me={class:"thinking-summary"},fe={class:"thinking-len"},ye=["innerHTML"],ke={class:"tool-details"},_e={class:"tool-summary"},be={class:"tool-name"},xe={key:0,class:"tool-status running"},we={key:1,class:"tool-status ok"},Ce={key:2,class:"tool-status error"},Te={class:"tool-body"},Me={key:0,class:"tool-section"},$e={class:"tool-pre"},Se={key:1,class:"tool-section"},De={class:"tool-pre"},He=["innerHTML"],Le={class:"msg-actions"},Ie=["onClick"],Be={key:2,class:"apply-card"},Ae={class:"apply-fields"},Ne={class:"apply-key"},Re={class:"apply-val"},Fe=["onClick"],Je={key:2,class:"msg-row assistant"},Oe={class:"msg-bubble assistant-bubble"},Ve={class:"thinking-block",open:""},je={class:"thinking-content streaming-thinking"},Ee={key:3,class:"msg-row assistant"},Ke={class:"msg-bubble assistant-bubble"},Ue=["innerHTML"],ze={key:1,class:"typing-dots"},Pe={key:2,class:"cursor"},We=["src"],Ye={key:0,class:"pending-images"},qe=["src"],Ge=["onClick"],Qe={class:"input-row"},Xe=["placeholder","disabled","onKeydown"],Ze=["disabled"],et={key:0,width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2.5"},tt={key:1,class:"spin"},st=G({__name:"AiChat",props:{agentId:{},context:{},scenario:{},placeholder:{},welcomeMessage:{},examples:{default:()=>[]},showThinking:{type:Boolean,default:!0},height:{default:"100%"},compact:{type:Boolean,default:!1},initialMessages:{}},emits:["message","response","apply","error"],setup(g,{expose:j,emit:E}){const x=g,T=E,y=d(x.initialMessages?[...x.initialMessages]:[]),k=d(""),h=d([]),v=d(!1),c=d(""),m=d(""),M=d(),D=d(),N=d(),$=d(!1),S=d("");let _=[];function R(n){k.value=n,A(()=>D.value?.focus())}function F(){const n=D.value;n&&(n.style.height="auto",n.style.height=Math.min(n.scrollHeight,160)+"px")}async function K(n){const t=n.clipboardData?.items;if(t){for(const s of Array.from(t))if(s.type.startsWith("image/")){n.preventDefault();const a=s.getAsFile();a&&await H(a)}}}function U(n){$.value=!1;const t=n.dataTransfer?.files;if(t)for(const s of Array.from(t))s.type.startsWith("image/")&&H(s)}function z(n){const t=n.target.files;if(t){for(const s of Array.from(t))H(s);n.target.value=""}}function H(n){return new Promise(t=>{const s=new FileReader;s.onload=a=>{a.target?.result&&h.value.push(a.target.result),t()},s.readAsDataURL(n)})}async function L(){const n=k.value.trim();if(!n&&!h.value.length||v.value)return;const t=[...h.value];k.value="",h.value=[],A(F),y.value.push({role:"user",text:n,images:t.length?t:void 0}),T("message",n),w(),v.value=!0,c.value="",m.value="",_=[];const s={context:x.context,scenario:x.scenario,images:t.length?t:void 0};se(x.agentId,n,a=>{if(a.type==="thinking_delta")m.value+=a.text,w();else if(a.type==="text_delta")c.value+=a.text,w();else if(a.type==="tool_call"){const i={name:a.tool_call?.name||"tool",input:a.tool_call?.input?JSON.stringify(a.tool_call.input,null,2):void 0,status:"running"};_.push(i)}else if(a.type==="tool_result"){const i=_[_.length-1];i&&(i.result=a.text,i.status="ok")}else if(a.type==="done"||a.type==="error"){a.type==="error"&&T("error",a.error||"Unknown error");let i;const u=c.value.match(/```json\s*([\s\S]+?)\s*```/);if(u)try{i=JSON.parse(u[1]),c.value=c.value.replace(/```json[\s\S]+?```/,"").trim()}catch{}const O={role:"assistant",text:c.value,thinking:m.value||void 0,toolCalls:_.length?[..._]:void 0,applyData:i};y.value.push(O),T("response",c.value),c.value="",m.value="",v.value=!1,w()}},s)}function w(){A(()=>{M.value&&(M.value.scrollTop=M.value.scrollHeight)})}function P(n){navigator.clipboard.writeText(n).catch(()=>{})}function W(n){return n.trim().split(/\s+/).length}function Y(n){try{return JSON.stringify(JSON.parse(n),null,2)}catch{return n}}function q(n){return{name:"åç§°",id:"ID",description:"æè¿°",identity:"IDENTITY",soul:"SOUL"}[n]||n}function C(n){return n?n.replace(/```(\w*)\n?([\s\S]*?)```/g,(s,a,i)=>{const u=J(i.trim());return`<pre class="code-block"><code class="lang-${a||"text"}">${u}</code></pre>`}).replace(/`([^`]+)`/g,(s,a)=>`<code class="inline-code">${J(a)}</code>`).replace(/\*\*([^*]+)\*\*/g,"<strong>$1</strong>").replace(/\*([^*]+)\*/g,"<em>$1</em>").replace(/^### (.+)$/gm,"<h4>$1</h4>").replace(/^## (.+)$/gm,"<h3>$1</h3>").replace(/^# (.+)$/gm,"<h2>$1</h2>").replace(/^[-*] (.+)$/gm,"<li>$1</li>").replace(/\n/g,"<br>").replace(/(<li>.*?<\/li><br>)+/g,s=>`<ul>${s.replace(/<br>/g,"")}</ul>`):""}function J(n){return n.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}return Q(()=>{w()}),j({send:L,fillInput:R,messages:y}),(n,t)=>(o(),l("div",{class:V(["ai-chat",{compact:g.compact,"has-thinking":g.showThinking}]),style:X({height:g.height})},[e("div",{class:"chat-messages",ref_key:"messagesRef",ref:M},[!y.value.length&&g.welcomeMessage?(o(),l("div",le,[t[5]||(t[5]=e("div",{class:"welcome-icon"},"ğŸ¤–",-1)),e("div",{class:"welcome-text",innerHTML:C(g.welcomeMessage)},null,8,oe)])):r("",!0),!y.value.length&&g.examples.length?(o(),l("div",ae,[(o(!0),l(f,null,b(g.examples,s=>(o(),l("div",{key:s,class:"example-chip",onClick:a=>R(s)},p(s),9,ie))),128))])):r("",!0),(o(!0),l(f,null,b(y.value,(s,a)=>(o(),l(f,{key:a},[s.role==="user"?(o(),l("div",re,[e("div",ce,[s.images?.length?(o(),l("div",ue,[(o(!0),l(f,null,b(s.images,(i,u)=>(o(),l("img",{key:u,src:i,class:"msg-img-thumb",onClick:O=>S.value=i},null,8,de))),128))])):r("",!0),e("div",{class:"msg-text",innerHTML:C(s.text)},null,8,pe)])])):s.role==="assistant"?(o(),l("div",ge,[e("div",he,[s.thinking?(o(),l("details",ve,[e("summary",me,[t[6]||(t[6]=e("span",{class:"thinking-icon"},"ğŸ’­",-1)),t[7]||(t[7]=I(" æ€è€ƒè¿‡ç¨‹ ",-1)),e("span",fe,p(W(s.thinking))+" è¯",1)]),e("div",{class:"thinking-content",innerHTML:C(s.thinking)},null,8,ye)])):r("",!0),(o(!0),l(f,null,b(s.toolCalls,(i,u)=>(o(),l("div",{key:u,class:"tool-call-block"},[e("details",ke,[e("summary",_e,[t[8]||(t[8]=e("span",{class:"tool-icon"},"ğŸ”§",-1)),e("span",be,p(i.name),1),i.status==="running"?(o(),l("span",xe,"è¿è¡Œä¸­â€¦")):i.status==="ok"?(o(),l("span",we,"âœ“")):i.status==="error"?(o(),l("span",Ce,"âœ—")):r("",!0)]),e("div",Te,[i.input?(o(),l("div",Me,[t[9]||(t[9]=e("div",{class:"tool-section-label"},"è¾“å…¥",-1)),e("pre",$e,p(Y(i.input)),1)])):r("",!0),i.result?(o(),l("div",Se,[t[10]||(t[10]=e("div",{class:"tool-section-label"},"è¾“å‡º",-1)),e("pre",De,p(i.result.slice(0,800))+p(i.result.length>800?`
â€¦ï¼ˆæˆªæ–­ï¼‰`:""),1)])):r("",!0)])])]))),128)),s.text?(o(),l("div",{key:1,class:"msg-text",innerHTML:C(s.text)},null,8,He)):r("",!0),e("div",Le,[e("button",{class:"action-btn",onClick:i=>P(s.text),title:"å¤åˆ¶"},[...t[11]||(t[11]=[e("svg",{width:"13",height:"13",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("rect",{x:"9",y:"9",width:"13",height:"13",rx:"2"}),e("path",{d:"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"})],-1)])],8,Ie)]),s.applyData?(o(),l("div",Be,[e("div",Ae,[(o(!0),l(f,null,b(s.applyData,(i,u)=>(o(),l("div",{key:u,class:"apply-row"},[e("span",Ne,p(q(String(u))),1),e("span",Re,p(String(i).slice(0,50))+p(String(i).length>50?"â€¦":""),1)]))),128))]),e("button",{class:"apply-btn",onClick:i=>T("apply",s.applyData)}," åº”ç”¨åˆ°è¡¨å• â†™ ",8,Fe)])):r("",!0)])])):r("",!0)],64))),128)),v.value&&m.value?(o(),l("div",Je,[e("div",Oe,[e("details",Ve,[t[13]||(t[13]=e("summary",{class:"thinking-summary"},[e("span",{class:"thinking-icon"},"ğŸ’­"),I(" æ€è€ƒä¸­â€¦ ")],-1)),e("div",je,[I(p(m.value),1),t[12]||(t[12]=e("span",{class:"cursor"},"â–Š",-1))])])])])):r("",!0),v.value&&(c.value||!m.value&&!c.value)?(o(),l("div",Ee,[e("div",Ke,[c.value?(o(),l("div",{key:0,class:"msg-text",innerHTML:C(c.value)},null,8,Ue)):(o(),l("div",ze,[...t[14]||(t[14]=[e("span",null,null,-1),e("span",null,null,-1),e("span",null,null,-1)])])),c.value?(o(),l("span",Pe,"â–Š")):r("",!0)])])):r("",!0)],512),S.value?(o(),l("div",{key:0,class:"lightbox",onClick:t[0]||(t[0]=s=>S.value="")},[e("img",{src:S.value,class:"lightbox-img"},null,8,We)])):r("",!0),e("div",{class:V(["chat-input-area",{"drag-over":$.value}]),onDragover:t[3]||(t[3]=B(s=>$.value=!0,["prevent"])),onDragleave:t[4]||(t[4]=s=>$.value=!1),onDrop:B(U,["prevent"])},[h.value.length?(o(),l("div",Ye,[(o(!0),l(f,null,b(h.value,(s,a)=>(o(),l("div",{key:a,class:"pending-img-wrap"},[e("img",{src:s,class:"pending-img"},null,8,qe),e("button",{class:"remove-img",onClick:i=>h.value.splice(a,1)},"Ã—",8,Ge)]))),128))])):r("",!0),e("div",Qe,[e("button",{class:"input-icon-btn",title:"é™„åŠ å›¾ç‰‡",onClick:t[1]||(t[1]=s=>N.value?.click())},[...t[15]||(t[15]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2"}),e("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),e("polyline",{points:"21 15 16 10 5 21"})],-1)])]),e("input",{ref_key:"imgInput",ref:N,type:"file",accept:"image/*",multiple:"",style:{display:"none"},onChange:z},null,544),Z(e("textarea",{ref_key:"inputRef",ref:D,"onUpdate:modelValue":t[2]||(t[2]=s=>k.value=s),class:"chat-textarea",placeholder:g.placeholder||"è¾“å…¥æ¶ˆæ¯... (Ctrl+Enter å‘é€)",disabled:v.value,rows:"1",onKeydown:ee(B(L,["ctrl","prevent"]),["enter"]),onPaste:K,onInput:F},null,40,Xe),[[te,k.value]]),e("button",{class:"send-btn",disabled:v.value||!k.value.trim()&&!h.value.length,onClick:L},[v.value?(o(),l("span",tt,"âŸ³")):(o(),l("svg",et,[...t[16]||(t[16]=[e("line",{x1:"22",y1:"2",x2:"11",y2:"13"},null,-1),e("polygon",{points:"22 2 15 22 11 13 2 9 22 2"},null,-1)])]))],8,Ze)])],34)],6))}}),at=ne(st,[["__scopeId","data-v-9a48b79f"]]);export{at as A};
