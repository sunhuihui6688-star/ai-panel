import{d as Ve,e as y,D as We,I as ve,i as Ge,c as l,f as B,n as Xe,s as A,a as I,w as L,S as Ye,b as o,t as h,F as T,m as M,k as p,h as P,p as Qe,G as Ze,g as _e,z as ge,H as K,r as U,o as a,j as ke,q as et}from"./index-7FwmUnlb.js";import{n as tt,i as st,o as nt,p as at,q as se}from"./index-BclxA8EE.js";import{_ as lt}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ot={key:0,class:"drag-overlay"},it={key:0,class:"running-tasks-banner"},rt={key:0,class:"resumed-list"},ut={key:0,class:"history-loading"},ct={key:1,class:"chat-empty"},dt={key:0,class:"welcome-msg"},pt={key:1,class:"examples"},ft=["onClick"],ht={key:0,class:"msg-row user"},vt={class:"msg-bubble user"},_t={key:0,class:"msg-images"},gt=["src","onClick"],kt={class:"msg-text"},mt={key:1,class:"msg-row assistant"},yt={class:"msg-col"},xt=["open"],bt={class:"thinking-summary"},wt={class:"thinking-len"},Ct={class:"thinking-content"},St={key:1,class:"tool-timeline"},It=["onClick"],Tt={class:"tool-step-header"},$t={key:0,class:"tool-spin"},Dt={key:1},Mt={key:2},Nt={key:3},At={class:"tool-step-icon"},jt={class:"tool-step-name"},Ft={key:0,class:"tool-step-summary"},Ot={key:1,class:"tool-step-dur"},Bt={key:0},Lt={key:1},Rt={key:2},Et={key:3},Jt={key:4},Pt={class:"tool-step-chevron"},Ut={key:0,class:"tool-section"},zt={class:"tool-pre"},qt={key:1,class:"tool-section"},Ht={class:"tool-pre result"},Kt={class:"msg-bubble assistant"},Vt=["innerHTML"],Wt={key:1,class:"apply-card"},Gt={class:"apply-preview"},Xt={class:"apply-key"},Yt={class:"apply-val"},Qt=["onClick"],Zt={class:"msg-actions"},es=["onClick","title"],ts=["onClick"],ss=["onClick"],ns={key:2,class:"option-chips"},as=["onClick"],ls={key:2,class:"msg-row system"},os={class:"msg-system"},is={key:2,class:"msg-row assistant"},rs={class:"msg-col"},us={key:0,class:"thinking-block",open:""},cs={class:"thinking-summary"},ds={class:"thinking-content"},ps={key:1,class:"tool-timeline"},fs=["onClick"],hs={class:"tool-step-header"},vs={key:0,class:"tool-spin"},_s={key:1},gs={key:2},ks={class:"tool-step-icon"},ms={class:"tool-step-name"},ys={key:0,class:"tool-step-summary"},xs={key:1,class:"tool-step-dur"},bs={key:0},ws={key:1},Cs={key:2},Ss={key:3},Is={key:4},Ts={class:"tool-step-chevron"},$s={key:0,class:"tool-section"},Ds={class:"tool-pre"},Ms={key:1,class:"tool-section"},Ns={class:"tool-pre result"},As={key:2,class:"msg-bubble assistant"},js={key:0,class:"typing-dots"},Fs=["innerHTML"],Os={key:2,class:"blink"},Bs=["src"],Ls={class:"chat-input-area"},Rs={key:0,class:"attachments-bar"},Es=["src"],Js=["onClick"],Ps={class:"attach-file-icon"},Us={class:"attach-file-name"},zs={class:"attach-file-size"},qs=["onClick"],Hs={class:"input-row"},Ks={class:"textarea-wrap"},Vs=["placeholder","disabled","onKeydown"],Ws={class:"input-actions"},Gs={class:"icon-btn",title:"é™„åŠ æ–‡ä»¶ï¼ˆå›¾ç‰‡/ä»£ç /æ–‡æœ¬ï¼‰"},Xs=["disabled"],Ys={key:0,class:"spinner"},Qs={key:1},Zs=Ve({__name:"AiChat",props:{agentId:{},sessionId:{},context:{},scenario:{},skillId:{},placeholder:{},welcomeMessage:{},examples:{default:()=>[]},showThinking:{type:Boolean,default:!1},compact:{type:Boolean,default:!1},bgColor:{},height:{},initialMessages:{},applyable:{type:Boolean,default:!1}},emits:["message","response","apply","session-change","streaming-change"],setup($,{expose:me,emit:ye}){const x=$,R=ye,_=y(x.initialMessages?[...x.initialMessages]:[]),E=y(""),j=y([]),F=y([]),b=y(!1);We(b,t=>R("streaming-change",t));const k=y(""),D=y(""),w=y([]),z=et(new Map),O=y([]);let C=null;const ne=ge(()=>{let t=0;for(const e of _.value)for(const n of e.toolCalls??[])n.taskId&&n.taskStatus&&!["done","error","killed"].includes(n.taskStatus)&&t++;return t+=O.value.filter(e=>!["done","error","killed"].includes(e.status)).length,t}),q=y(!1);let H=0;const V=y(null),W=y(""),S=y(x.sessionId),J=y(!1),G=y(),N=y(),xe=ge(()=>({height:x.height??"100%","--bg":x.bgColor??"transparent"}));function ae(){C||(C=setInterval(be,3e3))}async function be(){if(z.size===0&&O.value.every(i=>["done","error","killed"].includes(i.status))){C&&(clearInterval(C),C=null);return}const e=[];for(const[i,f]of z)try{const c=(await se.get(f)).data;for(const v of _.value){const s=v.toolCalls?.find(u=>u.id===i);s&&(s.taskStatus=c.status,["done","error","killed"].includes(c.status)&&e.push(i))}}catch{e.push(i)}for(const i of e)z.delete(i);for(const i of O.value)if(!["done","error","killed"].includes(i.status))try{const f=await se.get(i.id);i.status=f.data.status}catch{i.status="error"}!(z.size>0||O.value.some(i=>!["done","error","killed"].includes(i.status)))&&C&&(clearInterval(C),C=null)}ve(()=>{C&&(clearInterval(C),C=null)});async function we(t){try{const n=(await se.list({sessionId:t})).data.filter(i=>!["done","error","killed"].includes(i.status));if(n.length===0)return;O.value=n.map(i=>({id:i.id,label:i.label||i.id.slice(0,8),status:i.status})),ae()}catch{}}function m(){K(()=>{G.value&&(G.value.scrollTop=G.value.scrollHeight)})}function Ce(){N.value&&(N.value.style.height="auto",N.value.style.height=Math.min(N.value.scrollHeight,160)+"px")}function X(t){E.value=t,K(()=>N.value?.focus())}function le(t){try{return JSON.stringify(JSON.parse(t),null,2)}catch{return t}}function Se(t){navigator.clipboard?.writeText(t);const e=_.value.findIndex(n=>n.text===t);V.value=e,setTimeout(()=>{V.value=null},1500)}function Ie(t){for(let e=t-1;e>=0;e--){const n=_.value[e];if(n&&n.role==="user"){const i=n.text,f=n.images??[];_.value.splice(e,_.value.length-e),te(i,f);return}}}function Te(t){W.value=t}function oe(t){return t?t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/```(\w*)\n([\s\S]*?)```/g,(n,i,f)=>`<pre class="code-block${i?" lang-"+i:""}"><code>${f}</code></pre>`).replace(/`([^`]+)`/g,'<code class="inline-code">$1</code>').replace(/\*\*(.+?)\*\*/g,"<strong>$1</strong>").replace(/\*(.+?)\*/g,"<em>$1</em>").replace(/\[(.+?)\]\((https?:\/\/[^\)]+)\)/g,'<a href="$2" target="_blank" rel="noopener">$1</a>').replace(/^### (.+)$/gm,"<h3>$1</h3>").replace(/^## (.+)$/gm,"<h2>$1</h2>").replace(/^# (.+)$/gm,"<h1>$1</h1>").replace(/^[-*] (.+)$/gm,"<li>$1</li>").replace(/^\d+\. (.+)$/gm,"<li>$1</li>").replace(/(<li>[\s\S]+?<\/li>)(\n(?!<li>)|$)/g,"<ul>$1</ul>$2").replace(/([^>])\n([^<])/g,"$1<br>$2"):""}function $e(t){const e=t.split(`
`),n=[],i=/^([ğŸ™ğŸ˜„ğŸŒğŸ›ğŸ“šğŸ¨ğŸ’¼ğŸ¤–âš½ğŸ¯âœ…âŒğŸ”¥ğŸ’¡ğŸğŸš€ğŸŒŸğŸ’ğŸªğŸ­ğŸ¬ğŸ¤]|[\u{1F300}-\u{1FFFF}]|[\u{2600}-\u{27BF}])\s+(.{4,40})/u;for(const f of e){const d=f.replace(/^[-*â€¢]\s*/,"").trim();if(d.match(i)){const v=d.replace(/[ï¼š:ã€‚ï¼Œ,]$/,"").trim();v.length>=5&&n.push(v)}}return n.slice(0,5)}function De(t){return t?/\{[\s\S]{30,}\}/.test(t)&&(t.includes('"name"')||t.includes('"identity"')||t.includes('"soul"')||t.includes('"IDENTITY"')||t.includes('"SOUL"')):!1}function Me(t){const e=re(t.text);console.log("[AiChat] manualApply result:",e),e?(t.applyData=e,K(()=>R("apply",e))):alert("æœªèƒ½ä»æ¶ˆæ¯ä¸­æå–åˆ°é…ç½® JSONï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶")}function ie(t,e=0){const n=t.indexOf("{",e);if(n===-1)return null;let i=0,f=!1,d=!1;for(let c=n;c<t.length;c++){const v=t[c];if(d){d=!1;continue}if(v==="\\"&&f){d=!0;continue}if(v==='"'){f=!f;continue}if(!f){if(v==="{")i++;else if(v==="}"&&(i--,i===0))return{raw:t.slice(n,c+1),end:c+1}}}return null}function re(t){const e=/```(?:json)?\s*\n?([\s\S]*?)```/g,n=[];let i;for(;(i=e.exec(t))!==null;){const c=(i[1]??"").trim();c.startsWith("{")&&n.push(c)}for(let c=n.length-1;c>=0;c--){const v=n[c],s=ie(v);if(!s)continue;const u=Y(s.raw)??Y(ue(s.raw));if(u)return u}const f=[];let d=0;for(;d<t.length;){const c=ie(t,d);if(!c)break;f.push(c.raw),d=c.end}for(let c=f.length-1;c>=0;c--){const v=f[c],s=Y(v)??Y(ue(v));if(s)return s}return null}function Y(t){try{const e=JSON.parse(t);if(e&&typeof e=="object"&&!Array.isArray(e)){const n=["name","id","description","identity","soul","IDENTITY","SOUL","NAME","DESCRIPTION"];if(Object.keys(e).some(i=>n.includes(i)))return e}}catch{}return null}function ue(t){let e="",n=!1,i=!1;for(let f=0;f<t.length;f++){const d=t[f];if(i){e+=d,i=!1;continue}if(d==="\\"&&n){e+=d,i=!0;continue}if(d==='"'){n=!n,e+=d;continue}if(n&&d===`
`){e+="\\n";continue}if(n&&d==="\r"){e+="\\r";continue}e+=d}return e}const Ne={exec:"âš¡",bash:"âš¡",read:"ğŸ“–",write:"âœï¸",edit:"âœï¸",web_search:"ğŸŒ",web_fetch:"ğŸŒ",browser:"ğŸŒ",agent_spawn:"ğŸš€",agent_tasks:"ğŸ“‹",agent_kill:"ğŸ›‘",agent_result:"ğŸ“Š",project_read:"ğŸ“",project_write:"ğŸ“",project_list:"ğŸ“",project_create:"ğŸ“",project_glob:"ğŸ“",memory_search:"ğŸ§ ",memory_get:"ğŸ§ ",image:"ğŸ–¼ï¸",tts:"ğŸ”Š",cron:"â±ï¸"};function ce(t){return Ne[t]??"âš™ï¸"}function de(t,e){try{const n=JSON.parse(e);if(t==="exec"||t==="bash")return(n.command??"").slice(0,60);if(t==="read")return n.file_path??n.path??"";if(t==="write")return(n.file_path??n.path??"")+(n.content?` (${n.content.length}B)`:"");if(t==="edit")return n.file_path??n.path??"";if(t==="web_search")return n.query??"";if(t==="web_fetch")return n.url??"";if(t==="agent_spawn")return`â†’ ${n.agentId}: ${(n.task??"").slice(0,40)}`;if(t==="project_read"||t==="project_write")return n.path??"";if(t==="memory_search")return n.query??""}catch{}return""}const Ae=new Set(["txt","md","markdown","js","ts","jsx","tsx","vue","go","py","rs","java","kt","swift","html","css","scss","less","json","yaml","yml","toml","ini","cfg","env","sh","bash","zsh","fish","ps1","bat","cmd","dockerfile","makefile","sql","graphql","proto","xml","svg","gitignore","gitattributes"]);function pe(t){const e=t.split(".").pop()?.toLowerCase()??"";return Ae.has(e)}function je(t){const e=t.split(".").pop()?.toLowerCase()??"";return{js:"ğŸŸ¨",ts:"ğŸ”µ",vue:"ğŸ’š",go:"ğŸ¹",py:"ğŸ",rs:"ğŸ¦€",html:"ğŸŒ",css:"ğŸ¨",json:"ğŸ“‹",md:"ğŸ“",sh:"âš¡",sql:"ğŸ—„ï¸",yaml:"âš™ï¸",yml:"âš™ï¸",dockerfile:"ğŸ³"}[e]??"ğŸ“„"}function Fe(t){return t<1024?`${t}B`:t<1024*1024?`${(t/1024).toFixed(1)}KB`:`${(t/1024/1024).toFixed(1)}MB`}function Oe(t){const e=t.clipboardData?.items;if(e){for(const n of Array.from(e))if(n.type.startsWith("image/")){t.preventDefault();const i=n.getAsFile();i&&ee(i)}}}function Be(t){t.preventDefault(),H++,q.value=!0}function Le(t){t.preventDefault(),H--,H<=0&&(H=0,q.value=!1)}function Re(t){H=0,q.value=!1;const e=t.dataTransfer?.files;if(e)for(const n of Array.from(e))n.type.startsWith("image/")?ee(n):pe(n.name)&&fe(n)}function Ee(t){const e=t.target.files;if(e){for(const n of Array.from(e))n.type.startsWith("image/")?ee(n):pe(n.name)&&fe(n);t.target.value=""}}function fe(t){const e=new FileReader;e.onload=()=>{typeof e.result=="string"&&F.value.push({name:t.name,content:e.result})},e.readAsText(t)}function ee(t){const e=new FileReader;e.onload=()=>{typeof e.result=="string"&&j.value.push(e.result)},e.readAsDataURL(t)}function Je(t){j.value.splice(t,1)}function Q(){const t=E.value.trim(),e=[...j.value],n=[...F.value];if(!t&&!e.length&&!n.length||b.value)return;let i=t;if(n.length>0){const f=n.map(d=>{const c=d.name.split(".").pop()??"text";return`

ğŸ“ **${d.name}**
\`\`\`${c}
${d.content}
\`\`\``}).join("");i=t?t+f:f.trimStart()}E.value="",j.value=[],F.value=[],K(()=>{N.value&&(N.value.style.height="auto")}),R("message",i,e),te(i,e)}function te(t,e,n=!1){n||(_.value.push({role:"user",text:t,images:e.length?e:void 0}),m()),b.value=!0,k.value="",D.value="",w.value=[];const i={role:"assistant",text:"",toolCalls:[]};_.value.push(i),n&&m();const f=_.value.length-1;let d="",c;if(S.value)c=void 0;else{const s=_.value.slice(0,-1).filter(u=>(u.role==="user"||u.role==="assistant")&&u.text).slice(-20).map(u=>({role:u.role,content:u.text}));c=s.length>0?s:void 0}const v={sessionId:S.value,context:x.context,scenario:x.scenario,skillId:x.skillId,images:e.length?e:void 0,history:c};tt(x.agentId,t,s=>{switch(s.type){case"thinking_delta":D.value+=s.text,m();break;case"text":case"text_delta":k.value+=s.text,m();break;case"tool_call":{const u={id:s.tool_call?.id??String(Date.now()),name:s.tool_call?.name??"tool",input:s.tool_call?.input?JSON.stringify(s.tool_call.input):void 0,status:"running",_startedAt:Date.now(),_expanded:!1};_.value[f].toolCalls.push(u),w.value.push(u),d=u.id,m();break}case"tool_result":{const u=_.value[f].toolCalls?.find(r=>r.id===d);if(u){if(u.result=s.text,u.status="done",u._startedAt){const g=Date.now()-u._startedAt;u.duration=g<1e3?`${g}ms`:`${(g/1e3).toFixed(1)}s`}if(u.name==="agent_spawn"&&s.text){const g=s.text.match(/ä»»åŠ¡\s*ID[ï¼š:]\s*([a-f0-9-]{8,})/i);g&&(u.taskId=g[1],u.taskStatus="pending",z.set(d,g[1]),ae())}const r=w.value.find(g=>g.id===d);r&&(r.result=u.result,r.status="done",r.duration=u.duration)}m();break}case"done":case"error":{if(s.type==="done"&&s.sessionId){const g=!S.value;S.value=s.sessionId,g&&R("session-change",s.sessionId)}const u=_.value[f];if(u.text=k.value,u.thinking=D.value||void 0,x.applyable){const g=re(k.value);g?(u.applyData=g,console.log("[AiChat] applyData extracted:",g)):console.log("[AiChat] no applyData found in text length:",k.value.length)}const r=$e(k.value);if(r.length>=2&&(u.options=r),s.type==="error"){u.text=`[é”™è¯¯] ${s.error}`;const g=u.toolCalls?.find(Z=>Z.status==="running");g&&(g.status="error")}b.value=!1,k.value="",D.value="",w.value=[],R("response",u.text),m();break}}},v)}function Pe(){_.value=[]}function Ue(t){_.value.push(t),m()}async function ze(t){S.value=t,_.value=[],J.value=!0;try{const n=(await st.get(x.agentId,t)).data.messages??[],i=[];n.some(d=>d.isCompact||d.role==="compaction")&&i.push({role:"system",text:"æ›´æ—©çš„å†…å®¹å·²å‹ç¼©"});for(const d of n)d.role!=="compaction"&&i.push({role:d.role,text:d.text});_.value=i,m(),we(t),he(t)}catch(e){e?.response?.status===404?_.value=[]:(console.error("[AiChat] resumeSession failed",e),_.value=[{role:"system",text:"å†å²åŠ è½½å¤±è´¥ï¼Œç»§ç»­å¯¹è¯ä»å¯æ¥ç»­"}])}finally{J.value=!1}}async function he(t){if(b.value||!(await nt(x.agentId,t)).hasWorker)return;b.value=!0,k.value="",D.value="",w.value=[];const n={role:"assistant",text:"",toolCalls:[]};_.value.push(n);const i=_.value.length-1;m();let f="";const d=at(x.agentId,t,c=>{switch(c.type){case"idle":_.value.splice(i,1),b.value=!1;break;case"thinking_delta":D.value+=c.text,m();break;case"text":case"text_delta":k.value+=c.text,m();break;case"tool_call":{const v={id:c.tool_call?.id??String(Date.now()),name:c.tool_call?.name??"tool",input:c.tool_call?.input?JSON.stringify(c.tool_call.input):void 0,status:"running",_startedAt:Date.now(),_expanded:!1};_.value[i].toolCalls.push(v),w.value.push(v),f=v.id,m();break}case"tool_result":{const v=_.value[i].toolCalls?.find(s=>s.id===f);if(v){v.result=c.text,v.status="done";const s=w.value.find(u=>u.id===f);s&&(s.result=v.result,s.status="done")}m();break}case"done":case"error":{if(c.type==="done"&&c.sessionId){const s=!S.value;S.value=c.sessionId,s&&R("session-change",c.sessionId)}const v=_.value[i];v.text=k.value,v.thinking=D.value||void 0,c.type==="error"&&(v.text=`[é”™è¯¯] ${c.error}`),b.value=!1,k.value="",D.value="",w.value=[],m();break}}});ve(()=>d.abort())}function qe(){S.value=void 0,_.value=[]}function He(t){X(t),K(Q)}function Ke(t){te(t,[],!0)}return me({clearMessages:Pe,appendMessage:Ue,sendText:He,sendSilent:Ke,fillInput:X,messages:_,streaming:b,currentSessionId:S,resumeSession:ze,startNewSession:qe}),Ge(()=>{m(),S.value&&he(S.value)}),(t,e)=>{const n=U("ChatRound"),i=U("el-icon"),f=U("Check"),d=U("CopyDocument"),c=U("Setting"),v=U("Paperclip");return a(),l("div",{class:A(["ai-chat",{compact:$.compact,"has-bg":$.bgColor,"drag-active":q.value}]),style:Xe(xe.value),onDragenter:B(Be,["prevent"]),onDragover:e[4]||(e[4]=B(()=>{},["prevent"])),onDragleave:Le,onDrop:B(Re,["prevent","stop"])},[I(Ye,{name:"drag-fade"},{default:L(()=>[q.value?(a(),l("div",ot,[...e[5]||(e[5]=[o("div",{class:"drag-overlay-content"},[o("div",{class:"drag-overlay-icon"},"ğŸ“"),o("div",{class:"drag-overlay-title"},"æ¾å¼€ä»¥é™„åŠ æ–‡ä»¶"),o("div",{class:"drag-overlay-hint"},"æ”¯æŒå›¾ç‰‡ Â· ä»£ç  Â· æ–‡æœ¬æ–‡ä»¶")],-1)])])):p("",!0)]),_:1}),ne.value>0?(a(),l("div",it,[e[6]||(e[6]=o("span",{class:"running-dot"},null,-1)),o("span",null,"åå°æœ‰ "+h(ne.value)+" ä¸ªä»»åŠ¡æ­£åœ¨æ‰§è¡Œä¸­ï¼Œå…³é—­çª—å£åä»ä¼šç»§ç»­è¿è¡Œ",1),O.value.length?(a(),l("span",rt,[(a(!0),l(T,null,M(O.value.filter(s=>!["done","error","killed"].includes(s.status)),s=>(a(),l("span",{key:s.id,class:A(["resumed-chip",s.status])},h(s.status==="running"?"âŸ³":"ğŸŸ¡")+" "+h(s.label),3))),128))])):p("",!0)])):p("",!0),o("div",{class:"chat-messages",ref_key:"msgListRef",ref:G},[J.value?(a(),l("div",ut,[...e[7]||(e[7]=[o("div",{class:"history-loading-dots"},[o("span"),o("span"),o("span")],-1),o("div",{class:"history-loading-text"},"åŠ è½½å†å²å¯¹è¯â€¦",-1)])])):p("",!0),!_.value.length&&!J.value?(a(),l("div",ct,[$.welcomeMessage?(a(),l("div",dt,h($.welcomeMessage),1)):p("",!0),$.examples.length?(a(),l("div",pt,[(a(!0),l(T,null,M($.examples,(s,u)=>(a(),l("div",{key:u,class:"example-chip",onClick:r=>X(s)},h(s),9,ft))),128))])):p("",!0)])):p("",!0),(a(!0),l(T,null,M(b.value?_.value.slice(0,-1):_.value,(s,u)=>(a(),l(T,{key:u},[s.role==="user"?(a(),l("div",ht,[o("div",vt,[s.images?.length?(a(),l("div",_t,[(a(!0),l(T,null,M(s.images,(r,g)=>(a(),l("img",{key:g,src:r,class:"msg-img",onClick:Z=>Te(r)},null,8,gt))),128))])):p("",!0),o("div",kt,h(s.text),1)])])):s.role==="assistant"?(a(),l("div",mt,[o("div",yt,[s.thinking?(a(),l("details",{key:0,class:"thinking-block",open:$.showThinking},[o("summary",bt,[I(i,{class:"thinking-icon"},{default:L(()=>[I(n)]),_:1}),e[8]||(e[8]=P(" æ€è€ƒè¿‡ç¨‹ ",-1)),o("span",wt,h(s.thinking.length)+" å­—ç¬¦",1)]),o("pre",Ct,h(s.thinking),1)],8,xt)):p("",!0),s.toolCalls?.length?(a(),l("div",St,[(a(!0),l(T,null,M(s.toolCalls,(r,g)=>(a(),l("div",{key:g,class:A(["tool-step",r.status]),onClick:Z=>r._expanded=!r._expanded},[o("div",Tt,[o("span",{class:A(["tool-step-dot",r.status])},[r.status==="running"?(a(),l("span",$t,"âŸ³")):r.status==="done"?(a(),l("span",Dt,"âœ“")):r.status==="error"?(a(),l("span",Mt,"âœ—")):(a(),l("span",Nt,"â—‹"))],2),o("span",At,h(ce(r.name)),1),o("code",jt,h(r.name),1),r.input?(a(),l("span",Ft,h(de(r.name,r.input)),1)):p("",!0),e[10]||(e[10]=o("span",{class:"tool-step-flex"},null,-1)),r.duration?(a(),l("span",Ot,h(r.duration),1)):p("",!0),r.taskId?(a(),l("span",{key:2,class:A(["task-badge",r.taskStatus])},[r.taskStatus==="pending"?(a(),l("span",Bt,"ğŸŸ¡ æ’é˜Ÿä¸­")):r.taskStatus==="running"?(a(),l("span",Lt,[...e[9]||(e[9]=[o("span",{class:"tool-spin"},"âŸ³",-1),P(" æ‰§è¡Œä¸­ ",-1)])])):r.taskStatus==="done"?(a(),l("span",Rt,"âœ… å®Œæˆ")):r.taskStatus==="error"?(a(),l("span",Et,"âŒ å¤±è´¥")):r.taskStatus==="killed"?(a(),l("span",Jt,"ğŸ›‘ å·²ç»ˆæ­¢")):p("",!0)],2)):p("",!0),o("span",Pt,h(r._expanded?"â–²":"â–¼"),1)]),r._expanded?(a(),l("div",{key:0,class:"tool-step-body",onClick:e[0]||(e[0]=B(()=>{},["stop"]))},[r.input?(a(),l("div",Ut,[e[11]||(e[11]=o("div",{class:"tool-label"},"INPUT",-1)),o("pre",zt,h(le(r.input)),1)])):p("",!0),r.result?(a(),l("div",qt,[e[12]||(e[12]=o("div",{class:"tool-label"},"OUTPUT",-1)),o("pre",Ht,h(r.result.slice(0,3e3))+h(r.result.length>3e3?`
â€¦ (æˆªæ–­)`:""),1)])):p("",!0)])):p("",!0)],10,It))),128))])):p("",!0),o("div",Kt,[s.text?(a(),l("div",{key:0,class:"msg-text",innerHTML:oe(s.text)},null,8,Vt)):p("",!0),s.applyData&&x.applyable?(a(),l("div",Wt,[o("div",Gt,[(a(!0),l(T,null,M(s.applyData,(r,g)=>(a(),l("div",{key:g,class:"apply-row"},[o("span",Xt,h(g),1),o("span",Yt,h(String(r).slice(0,60))+h(String(r).length>60?"â€¦":""),1)]))),128))]),o("button",{class:"apply-btn",onClick:r=>t.$emit("apply",s.applyData)}," åº”ç”¨åˆ°è¡¨å• â†™ ",8,Qt)])):p("",!0),o("div",Zt,[o("button",{class:"act-btn",onClick:r=>Se(s.text),title:V.value===u?"å·²å¤åˆ¶":"å¤åˆ¶"},[V.value===u?(a(),ke(i,{key:0},{default:L(()=>[I(f)]),_:1})):(a(),ke(i,{key:1},{default:L(()=>[I(d)]),_:1}))],8,es),o("button",{class:"act-btn",onClick:r=>Ie(u),title:"é‡è¯•"},"â†º",8,ts),x.applyable&&!s.applyData&&De(s.text)?(a(),l("button",{key:0,class:"act-btn apply-manual-btn",onClick:r=>Me(s),title:"æ£€æµ‹åˆ°é…ç½® JSONï¼Œç‚¹å‡»åº”ç”¨"},[I(i,null,{default:L(()=>[I(c)]),_:1}),e[13]||(e[13]=P(" åº”ç”¨é…ç½® ",-1))],8,ss)):p("",!0)])]),s.options&&s.options.length?(a(),l("div",ns,[(a(!0),l(T,null,M(s.options,(r,g)=>(a(),l("button",{key:g,class:"option-chip",onClick:Z=>X(r)},h(r),9,as))),128))])):p("",!0)])])):s.role==="system"?(a(),l("div",ls,[o("div",os,h(s.text),1)])):p("",!0)],64))),128)),b.value?(a(),l("div",is,[o("div",rs,[D.value&&$.showThinking?(a(),l("details",us,[o("summary",cs,[I(i,{class:"thinking-icon"},{default:L(()=>[I(n)]),_:1}),e[14]||(e[14]=P(" æ€è€ƒä¸­â€¦ ",-1))]),o("pre",ds,[P(h(D.value),1),e[15]||(e[15]=o("span",{class:"blink"},"â–Š",-1))])])):p("",!0),w.value.length?(a(),l("div",ps,[(a(!0),l(T,null,M(w.value,(s,u)=>(a(),l("div",{key:u,class:A(["tool-step",s.status]),onClick:r=>s._expanded=!s._expanded},[o("div",hs,[o("span",{class:A(["tool-step-dot",s.status])},[s.status==="running"?(a(),l("span",vs,"âŸ³")):s.status==="done"?(a(),l("span",_s,"âœ“")):s.status==="error"?(a(),l("span",gs,"âœ—")):p("",!0)],2),o("span",ks,h(ce(s.name)),1),o("code",ms,h(s.name),1),s.input?(a(),l("span",ys,h(de(s.name,s.input)),1)):p("",!0),e[17]||(e[17]=o("span",{class:"tool-step-flex"},null,-1)),s.duration?(a(),l("span",xs,h(s.duration),1)):p("",!0),s.taskId?(a(),l("span",{key:2,class:A(["task-badge",s.taskStatus])},[s.taskStatus==="pending"?(a(),l("span",bs,"ğŸŸ¡ æ’é˜Ÿä¸­")):s.taskStatus==="running"?(a(),l("span",ws,[...e[16]||(e[16]=[o("span",{class:"tool-spin"},"âŸ³",-1),P(" æ‰§è¡Œä¸­",-1)])])):s.taskStatus==="done"?(a(),l("span",Cs,"âœ… å®Œæˆ")):s.taskStatus==="error"?(a(),l("span",Ss,"âŒ å¤±è´¥")):s.taskStatus==="killed"?(a(),l("span",Is,"ğŸ›‘ å·²ç»ˆæ­¢")):p("",!0)],2)):p("",!0),o("span",Ts,h(s._expanded?"â–²":"â–¼"),1)]),s._expanded?(a(),l("div",{key:0,class:"tool-step-body",onClick:e[1]||(e[1]=B(()=>{},["stop"]))},[s.input?(a(),l("div",$s,[e[18]||(e[18]=o("div",{class:"tool-label"},"INPUT",-1)),o("pre",Ds,h(le(s.input)),1)])):p("",!0),s.result?(a(),l("div",Ms,[e[19]||(e[19]=o("div",{class:"tool-label"},"OUTPUT",-1)),o("pre",Ns,h(s.result.slice(0,3e3)),1)])):p("",!0)])):p("",!0)],10,fs))),128))])):p("",!0),k.value||!w.value.length?(a(),l("div",As,[!k.value&&!w.value.length?(a(),l("div",js,[...e[20]||(e[20]=[o("span",null,null,-1),o("span",null,null,-1),o("span",null,null,-1)])])):p("",!0),k.value?(a(),l("div",{key:1,class:"msg-text",innerHTML:oe(k.value)},null,8,Fs)):p("",!0),k.value?(a(),l("span",Os,"â–Š")):p("",!0)])):p("",!0)])])):p("",!0)],512),W.value?(a(),l("div",{key:1,class:"img-preview-mask",onClick:e[2]||(e[2]=s=>W.value="")},[o("img",{src:W.value,class:"img-preview-full"},null,8,Bs)])):p("",!0),o("div",Ls,[j.value.length||F.value.length?(a(),l("div",Rs,[(a(!0),l(T,null,M(j.value,(s,u)=>(a(),l("div",{key:"img-"+u,class:"attach-thumb"},[o("img",{src:s},null,8,Es),o("button",{class:"remove-attach",onClick:r=>Je(u)},"Ã—",8,Js)]))),128)),(a(!0),l(T,null,M(F.value,(s,u)=>(a(),l("div",{key:"file-"+u,class:"attach-file-chip"},[o("span",Ps,h(je(s.name)),1),o("span",Us,h(s.name),1),o("span",zs,h(Fe(s.content.length)),1),o("button",{class:"attach-file-remove",onClick:r=>F.value.splice(u,1)},"Ã—",8,qs)]))),128))])):p("",!0),o("div",Hs,[o("div",Ks,[Qe(o("textarea",{ref_key:"inputRef",ref:N,"onUpdate:modelValue":e[3]||(e[3]=s=>E.value=s),placeholder:$.placeholder||"è¾“å…¥æ¶ˆæ¯â€¦ æ”¯æŒæ‹–æ‹½å›¾ç‰‡æˆ–æ–‡ä»¶ (Ctrl+Enter å‘é€)",disabled:b.value||J.value,rows:"1",class:"chat-textarea",onKeydown:[_e(B(Q,["ctrl","prevent"]),["enter"]),_e(B(Q,["meta","prevent"]),["enter"])],onPaste:Oe,onInput:Ce},null,40,Vs),[[Ze,E.value]])]),o("div",Ws,[o("label",Gs,[I(i,null,{default:L(()=>[I(v)]),_:1}),o("input",{type:"file",multiple:"",hidden:"",onChange:Ee},null,32)]),o("button",{class:"send-btn",disabled:b.value||J.value||!E.value.trim()&&!j.value.length&&!F.value.length,onClick:Q},[b.value?(a(),l("span",Ys)):(a(),l("span",Qs,"â†‘"))],8,Xs)])]),e[21]||(e[21]=o("div",{class:"input-hint"},"Ctrl+Enter å‘é€ Â· æ”¯æŒæ‹–æ‹½å›¾ç‰‡/æ–‡ä»¶",-1))])],38)}}}),nn=lt(Zs,[["__scopeId","data-v-1d4e6ff1"]]);export{nn as A};
