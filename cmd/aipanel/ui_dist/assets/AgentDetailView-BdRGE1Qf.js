import{d as Zl,h as et,o as u,c as v,b as o,a as e,w as t,j as z,F,l as H,q as Je,t as m,i as V,f as s,e as lt,m as ml,B as Pt,k as S,g as r,x as pl,E as f,r as p,C as Al,D as Rt,y as jt,z as ul,n as dl,G as Wt,H as Fl,I as Kt,J as Ot,K as qt,L as Yt,M as Ht}from"./index-EyqXyX8h.js";import{g as qe,f as _e,b as Dl,h as Ye,i as He,j as Jt,e as rl,r as Ql,k as Y,l as Xl}from"./index-sb85_xT4.js";import{A as tt}from"./AiChat-ChfTwog3.js";import{_ as at}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Gt={class:"skill-studio"},Qt={class:"studio-sidebar"},Xt={class:"sidebar-top"},Zt={class:"sidebar-acts"},ea={class:"skill-list"},la={key:0,class:"list-empty"},ta=["onClick"],aa={class:"sk-icon"},na={key:0},oa={class:"sk-info"},sa={class:"sk-name"},ia={class:"sk-id"},ua={class:"sk-right"},da={class:"studio-editor"},ra={key:0,class:"editor-empty"},ma={class:"editor-toolbar"},pa={class:"editor-breadcrumb"},fa={class:"crumb-name"},va={class:"toolbar-acts"},ca={class:"editor-body"},ya={class:"file-tree"},ga={class:"tree-item tree-dir"},_a={key:0,class:"file-editor"},ba={class:"file-editor-head"},wa={style:{display:"flex","align-items":"center",gap:"10px"}},ka={style:{"font-size":"12px",color:"#909399"}},xa={class:"json-preview"},Ca={key:1,class:"file-editor"},Va={class:"file-editor-head"},ha={style:{"margin-left":"auto",display:"flex","align-items":"center",gap:"8px"}},za={style:{"font-size":"11px",color:"#c0c4cc"}},$a={class:"studio-chat"},Ta={class:"chat-panel-head"},Ua={key:0,style:{"margin-left":"auto","font-size":"11px",color:"#c0c4cc"}},Ia={class:"chat-wrap"},Sa=Zl({__name:"SkillStudio",props:{agentId:{}},setup(Nl){const Q=Nl,y=Q.agentId,O=r([]),X=r(!1),b=r(null),K=r("meta"),h=r({name:"",icon:"",category:"",description:"",version:"1.0.0",enabled:!0}),L=r(""),be=r(!1),re=r(!1),Le=r(!1),me=r(!1),we=r(!1),x=r({id:"",name:"",icon:"",category:"",description:"",promptContent:""}),ne=r(null),pe=pl(()=>b.value?`你是一个技能配置助手，正在帮助用户配置技能「${b.value.name}」（ID: ${b.value.id}）。

当前 SKILL.md 内容：
\`\`\`markdown
${L.value||"（空）"}
\`\`\`

你可以帮助：
- 优化或重写 SKILL.md 系统提示词
- 测试技能效果（用户发消息即可测试）
- 给出技能设计建议`:"你是一个技能配置助手，帮助用户设计和优化 AI 技能的系统提示词。"),Ae=pl(()=>b.value?`当前编辑「${b.value.name}」。你可以让我优化 SKILL.md、测试效果，或者直接对话体验当前技能。`:"选择一个技能后，我可以帮你优化配置、写 SKILL.md、测试效果。"),J=pl(()=>b.value?[`帮我优化「${b.value.name}」的 SKILL.md`,"这个技能怎么写效果更好？","用中文回答一道历史题，测试当前技能效果"]:["帮我设计一个代码审查技能","帮我写一个翻译助手的 SKILL.md"]);async function Z(){X.value=!0;try{const w=await qe.list(y);if(O.value=w.data||[],b.value){const i=O.value.find(oe=>oe.id===b.value.id);i&&(b.value=i,Fe(i))}}catch{}finally{X.value=!1}}function Fe(w){h.value={name:w.name,icon:w.icon||"",category:w.category||"",description:w.description||"",version:w.version||"1.0.0",enabled:w.enabled}}async function Ge(w){b.value=w,Fe(w),K.value="meta",re.value=!1,L.value=""}async function Qe(){b.value&&K.value!=="prompt"&&(K.value="prompt",L.value||await Ve())}async function ke(){if(b.value){Le.value=!0;try{await qe.update(Q.agentId,b.value.id,{name:h.value.name,icon:h.value.icon,category:h.value.category,description:h.value.description,enabled:h.value.enabled}),(K.value==="prompt"||L.value)&&(await _e.write(y,`skills/${b.value.id}/SKILL.md`,L.value),re.value=!1),f.success("保存成功"),await Z()}catch(w){f.error(w.response?.data?.error||"保存失败")}finally{Le.value=!1}}}async function xe(w,i){try{await qe.update(Q.agentId,w.id,{enabled:i}),await Z()}catch{f.error("操作失败")}}async function D(){if(b.value)try{await qe.remove(Q.agentId,b.value.id),f.success("已删除"),b.value=null,await Z()}catch{f.error("删除失败")}}function Ce(){x.value={id:"",name:"",icon:"",category:"",description:"",promptContent:""},me.value=!0}async function De(){if(!x.value.id||!x.value.name){f.warning("ID 和名称必填");return}we.value=!0;try{await qe.create(Q.agentId,{meta:{id:x.value.id,name:x.value.name,icon:x.value.icon,category:x.value.category,description:x.value.description,version:"1.0.0",enabled:!0,source:"local",installedAt:""},promptContent:x.value.promptContent}),f.success("创建成功"),me.value=!1,await Z();const w=O.value.find(i=>i.id===x.value.id);w&&await Ge(w)}catch(w){f.error(w.response?.data?.error||"创建失败")}finally{we.value=!1}}async function fl(w){b.value&&(await Z(),K.value==="prompt"&&await Ve())}async function Ve(){if(b.value){be.value=!0;try{const w=await _e.read(y,`skills/${b.value.id}/SKILL.md`);L.value=w.data?.content||"",re.value=!1}catch{L.value=""}finally{be.value=!1}}}async function vl(){if(!b.value)return;L.value||await Qe();const w=`请用「${b.value.name}」技能效果回复：你好，请介绍一下你的功能。`;ne.value?.fillInput?.(w),f.info("测试消息已填入右侧聊天框，点击发送即可测试")}return et(Z),(w,i)=>{const oe=p("Refresh"),I=p("el-icon"),B=p("el-button"),ee=p("Plus"),Ne=p("Tools"),fe=p("el-tag"),se=p("el-switch"),he=p("Setting"),ve=p("FolderOpened"),ze=p("VideoPlay"),Xe=p("DocumentChecked"),ie=p("Delete"),ce=p("el-popconfirm"),$e=p("Folder"),N=p("Document"),E=p("el-input"),k=p("el-form-item"),ue=p("el-col"),Me=p("el-row"),cl=p("el-collapse-item"),yl=p("el-collapse"),Ze=p("el-form"),el=p("ChatLineRound"),Be=p("el-dialog");return u(),v("div",Gt,[o("div",Qt,[o("div",Xt,[i[18]||(i[18]=o("span",{class:"sidebar-title"},"技能库",-1)),o("div",Zt,[e(B,{size:"small",loading:X.value,circle:"",onClick:Z},{default:t(()=>[e(I,null,{default:t(()=>[e(oe)]),_:1})]),_:1},8,["loading"]),e(B,{size:"small",type:"primary",circle:"",onClick:Ce},{default:t(()=>[e(I,null,{default:t(()=>[e(ee)]),_:1})]),_:1})])]),o("div",ea,[!X.value&&O.value.length===0?(u(),v("div",la,"暂无技能")):z("",!0),(u(!0),v(F,null,H(O.value,g=>(u(),v("div",{key:g.id,class:Je(["skill-item",{active:b.value?.id===g.id}]),onClick:Ee=>Ge(g)},[o("span",aa,[g.icon?(u(),v("span",na,m(g.icon),1)):(u(),V(I,{key:1},{default:t(()=>[e(Ne)]),_:1}))]),o("div",oa,[o("div",sa,m(g.name),1),o("div",ia,m(g.id),1)]),o("div",ua,[g.category?(u(),V(fe,{key:0,size:"small",effect:"plain",style:{"margin-right":"6px","font-size":"11px"}},{default:t(()=>[s(m(g.category),1)]),_:2},1024)):z("",!0),e(se,{"model-value":g.enabled,size:"small",onChange:Ee=>xe(g,Ee),onClick:i[0]||(i[0]=lt(()=>{},["stop"]))},null,8,["model-value","onChange"])])],10,ta))),128))])]),o("div",da,[b.value?(u(),v(F,{key:1},[o("div",ma,[o("div",pa,[e(I,{style:{color:"#909399"}},{default:t(()=>[e(ve)]),_:1}),i[21]||(i[21]=o("span",{class:"crumb-sep"},"skills /",-1)),o("span",fa,m(b.value.id),1)]),o("div",va,[e(B,{size:"small",onClick:vl},{default:t(()=>[e(I,null,{default:t(()=>[e(ze)]),_:1}),i[22]||(i[22]=s(" 测试 ",-1))]),_:1}),e(B,{size:"small",type:"primary",loading:Le.value,onClick:ke},{default:t(()=>[e(I,null,{default:t(()=>[e(Xe)]),_:1}),i[23]||(i[23]=s(" 保存 ",-1))]),_:1},8,["loading"]),e(ce,{title:"确认删除该技能？",onConfirm:D},{reference:t(()=>[e(B,{size:"small",type:"danger",plain:""},{default:t(()=>[e(I,null,{default:t(()=>[e(ie)]),_:1})]),_:1})]),_:1})])]),o("div",ca,[o("div",ya,[i[27]||(i[27]=o("div",{class:"tree-title"},"目录",-1)),o("div",ga,[e(I,null,{default:t(()=>[e($e)]),_:1}),o("span",null,m(b.value.id)+"/",1)]),o("div",{class:Je(["tree-item",{"tree-active":K.value==="meta"}]),onClick:i[1]||(i[1]=g=>K.value="meta")},[e(I,null,{default:t(()=>[e(N)]),_:1}),i[24]||(i[24]=o("span",null,"skill.json",-1))],2),o("div",{class:Je(["tree-item",{"tree-active":K.value==="prompt"}]),onClick:Qe},[e(I,null,{default:t(()=>[e(N)]),_:1}),i[26]||(i[26]=o("span",null,"SKILL.md",-1)),b.value.enabled?(u(),V(fe,{key:0,size:"small",type:"success",effect:"plain",style:{"margin-left":"4px","font-size":"10px"}},{default:t(()=>[...i[25]||(i[25]=[s("注入中",-1)])]),_:1})):z("",!0)],2)]),K.value==="meta"?(u(),v("div",_a,[o("div",ba,[e(I,null,{default:t(()=>[e(N)]),_:1}),i[28]||(i[28]=s(" skill.json ",-1)),i[29]||(i[29]=o("span",{class:"file-hint"},"技能元信息，影响列表展示和 runner 行为",-1))]),e(Ze,{model:h.value,"label-width":"72px",size:"small",style:{padding:"16px 20px"}},{default:t(()=>[e(k,{label:"技能 ID"},{default:t(()=>[e(E,{value:b.value.id,disabled:""},null,8,["value"])]),_:1}),e(Me,{gutter:12},{default:t(()=>[e(ue,{span:14},{default:t(()=>[e(k,{label:"名称"},{default:t(()=>[e(E,{modelValue:h.value.name,"onUpdate:modelValue":i[2]||(i[2]=g=>h.value.name=g),placeholder:"如 翻译助手"},null,8,["modelValue"])]),_:1})]),_:1}),e(ue,{span:10},{default:t(()=>[e(k,{label:"图标"},{default:t(()=>[e(E,{modelValue:h.value.icon,"onUpdate:modelValue":i[3]||(i[3]=g=>h.value.icon=g),placeholder:"emoji"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(Me,{gutter:12},{default:t(()=>[e(ue,{span:14},{default:t(()=>[e(k,{label:"分类"},{default:t(()=>[e(E,{modelValue:h.value.category,"onUpdate:modelValue":i[4]||(i[4]=g=>h.value.category=g),placeholder:"如 语言"},null,8,["modelValue"])]),_:1})]),_:1}),e(ue,{span:10},{default:t(()=>[e(k,{label:"版本"},{default:t(()=>[e(E,{modelValue:h.value.version,"onUpdate:modelValue":i[5]||(i[5]=g=>h.value.version=g),placeholder:"1.0.0"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(k,{label:"描述"},{default:t(()=>[e(E,{modelValue:h.value.description,"onUpdate:modelValue":i[6]||(i[6]=g=>h.value.description=g),type:"textarea",rows:2,placeholder:"简要描述技能功能"},null,8,["modelValue"])]),_:1}),e(k,{label:"状态"},{default:t(()=>[o("div",wa,[e(se,{modelValue:h.value.enabled,"onUpdate:modelValue":i[7]||(i[7]=g=>h.value.enabled=g)},null,8,["modelValue"]),o("span",ka,m(h.value.enabled?"已启用，SKILL.md 将注入系统提示":"已禁用"),1)])]),_:1}),e(yl,{style:{"margin-top":"8px"}},{default:t(()=>[e(cl,{title:"查看 skill.json 原文"},{default:t(()=>[o("pre",xa,m(JSON.stringify({id:b.value.id,...h.value},null,2)),1)]),_:1})]),_:1})]),_:1},8,["model"])])):(u(),v("div",Ca,[o("div",Va,[e(I,null,{default:t(()=>[e(N)]),_:1}),i[31]||(i[31]=s(" SKILL.md ",-1)),i[32]||(i[32]=o("span",{class:"file-hint"},"注入到 AI System Prompt 的指令内容",-1)),o("div",ha,[re.value?(u(),V(fe,{key:0,type:"warning",size:"small"},{default:t(()=>[...i[30]||(i[30]=[s("未保存",-1)])]),_:1})):z("",!0),o("span",za,m(L.value.length)+" 字符",1),e(B,{size:"small",circle:"",loading:be.value,onClick:Ve,title:"重新加载"},{default:t(()=>[e(I,null,{default:t(()=>[e(oe)]),_:1})]),_:1},8,["loading"])])]),ml(o("textarea",{"onUpdate:modelValue":i[8]||(i[8]=g=>L.value=g),class:"code-textarea",spellcheck:"false",placeholder:`# 技能名称

## 功能说明
描述该技能的用途…

## 行为规范
- 规范 1
- 规范 2`,onInput:i[9]||(i[9]=g=>re.value=!0)},null,544),[[Pt,L.value]])]))])],64)):(u(),v("div",ra,[e(I,{size:"48",color:"#c0c4cc"},{default:t(()=>[e(he)]),_:1}),i[20]||(i[20]=o("p",null,"从左侧选择一个技能开始编辑",-1)),e(B,{type:"primary",onClick:Ce},{default:t(()=>[e(I,null,{default:t(()=>[e(ee)]),_:1}),i[19]||(i[19]=s(" 新建技能",-1))]),_:1})]))]),o("div",$a,[o("div",Ta,[e(I,null,{default:t(()=>[e(el)]),_:1}),i[33]||(i[33]=s(" AI 协作配置 ",-1)),b.value?(u(),v("span",Ua,"当前: "+m(b.value.name),1)):z("",!0)]),o("div",Ia,[e(tt,{ref_key:"aiChatRef",ref:ne,"agent-id":S(y),context:pe.value,scenario:"skill-studio","welcome-message":Ae.value,examples:J.value,compact:"",onResponse:fl},null,8,["agent-id","context","welcome-message","examples"])])]),e(Be,{modelValue:me.value,"onUpdate:modelValue":i[17]||(i[17]=g=>me.value=g),title:"新建技能",width:"480px"},{footer:t(()=>[e(B,{onClick:i[16]||(i[16]=g=>me.value=!1)},{default:t(()=>[...i[34]||(i[34]=[s("取消",-1)])]),_:1}),e(B,{type:"primary",loading:we.value,onClick:De},{default:t(()=>[...i[35]||(i[35]=[s("创建",-1)])]),_:1},8,["loading"])]),default:t(()=>[e(Ze,{model:x.value,"label-width":"80px",size:"small"},{default:t(()=>[e(k,{label:"技能 ID",required:""},{default:t(()=>[e(E,{modelValue:x.value.id,"onUpdate:modelValue":i[10]||(i[10]=g=>x.value.id=g),placeholder:"如 translate（小写字母+下划线）"},null,8,["modelValue"])]),_:1}),e(Me,{gutter:12},{default:t(()=>[e(ue,{span:14},{default:t(()=>[e(k,{label:"名称",required:""},{default:t(()=>[e(E,{modelValue:x.value.name,"onUpdate:modelValue":i[11]||(i[11]=g=>x.value.name=g),placeholder:"如 翻译助手"},null,8,["modelValue"])]),_:1})]),_:1}),e(ue,{span:10},{default:t(()=>[e(k,{label:"图标"},{default:t(()=>[e(E,{modelValue:x.value.icon,"onUpdate:modelValue":i[12]||(i[12]=g=>x.value.icon=g),placeholder:"emoji"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(k,{label:"分类"},{default:t(()=>[e(E,{modelValue:x.value.category,"onUpdate:modelValue":i[13]||(i[13]=g=>x.value.category=g),placeholder:"如 语言 / 开发 / 写作"},null,8,["modelValue"])]),_:1}),e(k,{label:"描述"},{default:t(()=>[e(E,{modelValue:x.value.description,"onUpdate:modelValue":i[14]||(i[14]=g=>x.value.description=g),type:"textarea",rows:2},null,8,["modelValue"])]),_:1}),e(k,{label:"SKILL.md"},{default:t(()=>[e(E,{modelValue:x.value.promptContent,"onUpdate:modelValue":i[15]||(i[15]=g=>x.value.promptContent=g),type:"textarea",rows:6,placeholder:`# 技能名称

## 功能说明
…`,style:{"font-family":"monospace","font-size":"12px"}},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),La=at(Sa,[["__scopeId","data-v-5518d80d"]]),Aa={class:"header-left"},Fa={class:"chat-layout"},Da={class:"session-sidebar"},Na={class:"session-sidebar-header"},Ma={class:"session-list"},Ba=["onClick"],Ea={class:"session-item-title"},Pa={class:"session-item-meta"},Ra={key:0,class:"session-empty"},ja={class:"at-panel"},Wa={key:0,class:"at-form"},Ka={class:"chat-area"},Oa={style:{display:"flex","align-items":"center",gap:"8px"}},qa={style:{"font-weight":"600"}},Ya={key:0,style:{"text-align":"center",color:"#c0c4cc",padding:"32px 0","font-size":"14px"}},Ha={style:{display:"flex","align-items":"center",gap:"8px"}},Ja={style:{"font-size":"13px"}},Ga={style:{"font-size":"13px",color:"#606266"}},Qa={key:0,style:{"text-align":"center",color:"#c0c4cc",padding:"40px 0"}},Xa={key:1,class:"relations-list"},Za={class:"relation-info"},en={class:"relation-name"},ln={class:"relation-tags"},tn={class:"relation-desc"},an={style:{display:"flex","align-items":"center","justify-content":"space-between"}},nn={style:{display:"flex",gap:"8px","margin-top":"4px"}},on={style:{display:"flex","align-items":"center","justify-content":"space-between"}},sn={key:0,style:{"text-align":"center",color:"#c0c4cc",padding:"16px 0","font-size":"13px"}},un={style:{"font-size":"12px"}},dn={style:{"font-size":"12px",color:"#606266"}},rn={class:"memory-toolbar",style:{"margin-bottom":"12px",display:"flex",gap:"8px"}},mn={style:{display:"flex","align-items":"center",gap:"4px","font-size":"13px"}},pn={style:{display:"flex","align-items":"center","justify-content":"space-between"}},fn={style:{"margin-bottom":"16px",display:"flex","align-items":"center",gap:"8px"}},vn={class:"conv-drawer-body"},cn={key:0,style:{"text-align":"center","margin-bottom":"12px"}},yn={class:"conv-msg-list"},gn={class:"conv-msg-meta"},_n={class:"conv-msg-role"},bn={key:0,class:"conv-msg-sender"},wn={class:"conv-msg-time"},kn={class:"conv-msg-content"},xn={key:0,class:"conv-msg-empty"},Cn={style:{"margin-top":"8px",display:"flex",gap:"8px","align-items":"center"}},Vn={style:{display:"flex","justify-content":"space-between","align-items":"center","margin-bottom":"16px"}},hn={class:"channel-card-header"},zn={class:"channel-card-left"},$n={class:"channel-card-name"},Tn={key:0,class:"channel-bot-username"},Un={class:"channel-card-actions"},In={key:0,class:"channel-card-body"},Sn={class:"channel-info-row"},Ln={class:"channel-info-value"},An={class:"channel-info-row"},Fn={class:"channel-info-value"},Dn={key:1,class:"channel-card-body"},Nn={class:"channel-info-row"},Mn={class:"channel-info-value"},Bn={style:{opacity:"0.6","font-size":"11px","margin-left":"3px"}},En={class:"pending-section"},Pn=["onClick"],Rn={key:0,class:"pending-list"},jn={key:0,style:{"text-align":"center",padding:"12px"}},Wn={class:"pending-user-info"},Kn={class:"pending-user-name"},On={key:0,class:"pending-user-username"},qn={class:"pending-user-id"},Yn={class:"pending-user-actions"},Hn={key:2,class:"pending-empty"},Jn={style:{width:"100%"}},Gn={style:{display:"flex",gap:"6px","align-items":"center"}},Qn={key:0,style:{"margin-top":"6px",display:"flex","align-items":"center",gap:"6px",color:"#909399","font-size":"13px"}},Xn={key:1,style:{"margin-top":"6px",color:"#67c23a","font-size":"13px"}},Zn={key:2,style:{"margin-top":"6px",color:"#e6a23c","font-size":"13px"}},eo={key:3,style:{"margin-top":"6px",color:"#f56c6c","font-size":"13px"}},lo={key:4,style:{"margin-top":"4px"}},to={class:"channel-url-preview"},ao={class:"channel-url-text"},no={class:"channel-url-preview"},oo={class:"channel-url-text"},so=50,io=Zl({__name:"AgentDetailView",setup(Nl){const Q=Rt(),y=Q.params.id,O=r(null),X=r("chat"),b=r(),K=r([]),h=r(!1),L=r();async function be(){h.value=!0;try{const n=await Jt.list({agentId:y,limit:50});K.value=n.data.sessions}catch{}finally{h.value=!1}}function re(n){L.value=n.id,b.value?.resumeSession(n.id)}function Le(){L.value=void 0,b.value?.startNewSession()}function me(n){L.value=n,setTimeout(be,500)}function we(n){if(!n)return"";const l=Date.now()-n;return l<6e4?"刚刚":l<36e5?`${Math.floor(l/6e4)}分前`:l<864e5?`${Math.floor(l/36e5)}小时前`:`${Math.floor(l/864e5)}天前`}const x=r(!1),ne=r(""),pe=r(""),Ae=r(!1),J=r([]);function Z(){x.value=!x.value,x.value&&!J.value.length&&Fe()}async function Fe(){try{const n=await Dl.list();J.value=n.data.filter(l=>l.id!==y)}catch{J.value=[]}}function Ge(n){const l=J.value.find(d=>d.id===n);l&&b.value?.fillInput(`@${l.name}: `)}async function Qe(){const n=ne.value,l=pe.value.trim();if(!n||!l)return;const C=J.value.find(ye=>ye.id===n)?.name??n;Ae.value=!0;const R={role:"user",text:`→ 转发给 ${C}：
${l}`};b.value?.appendMessage(R);try{const $=(await Dl.message(n,l,y)).data.response,te={role:"assistant",text:`← **${C}** 回复：

${$}`};b.value?.appendMessage(te),pe.value="",ne.value="",x.value=!1,f.success(`${C} 已回复`)}catch(ye){const $={role:"system",text:`[失败] 转发失败：${ye.response?.data?.error??ye.message??"网络错误"}`};b.value?.appendMessage($),f.error("转发失败")}finally{Ae.value=!1}}const ke=r(""),xe=r(""),D=r({enabled:!1,schedule:"daily",keepTurns:3,focusHint:"",cronJobId:""}),Ce=r(!1),De=r(!1);async function fl(){try{const n=await rl.getConfig(y);D.value=n.data,oe()}catch{}}async function Ve(){Ce.value=!0;try{const n=await rl.setConfig(y,D.value);D.value=n.data,f.success(D.value.enabled?"自动记忆已开启":"自动记忆已关闭")}catch{f.error("保存失败")}finally{Ce.value=!1}}async function vl(){De.value=!0;try{await rl.consolidate(y),f.success("记忆整理已在后台启动（约需10~30秒），稍后自动刷新日志"),setTimeout(oe,1e4)}catch{f.error("整理失败")}finally{De.value=!1}}const w=r([]),i=r(!1);async function oe(){i.value=!0;try{const n=await rl.runLog(y);w.value=n.data||[]}catch{w.value=[]}finally{i.value=!1}}const I=r([]),B=r(""),ee=r(""),Ne=r(!1),fe=r([]),se=r(!1),he=r(""),ve=r(!1),ze=r(""),Xe=r([]),ie=r(""),ce=r(""),$e=r(null),N=r([]),E=r(!1),k=r({agentId:"",agentName:"",relationType:"平级协作",strength:"常用",desc:""});async function ue(){try{const n=await Ql.get(y);N.value=n.data.parsed||[]}catch{N.value=[]}}function Me(n){const l=J.value.find(d=>d.id===n);k.value.agentName=l?l.name:n}async function cl(){if(!k.value.agentId)return;if(N.value.find(l=>l.agentId===k.value.agentId)){f.warning("该成员关系已存在，请先删除再重新添加");return}N.value.push({...k.value}),k.value={agentId:"",agentName:"",relationType:"平级协作",strength:"常用",desc:""},await el()}async function yl(n){N.value.splice(n,1),await el()}function Ze(){if(N.value.length===0)return"";const n=`| 成员ID | 成员名称 | 关系类型 | 关系程度 | 说明 |
|--------|--------|--------|--------|------|`,l=N.value.map(d=>`| ${d.agentId} | ${d.agentName} | ${d.relationType} | ${d.strength} | ${d.desc||""} |`).join(`
`);return n+`
`+l}async function el(){E.value=!0;try{await Ql.put(y,Ze()),f.success("关系已保存")}catch{f.error("保存失败")}finally{E.value=!1}}function Be(n){const l=["#409EFF","#67C23A","#E6A23C","#F56C6C","#909399","#B45309","#7C3AED","#0891B2"];let d=0;for(let C=0;C<n.length;C++)d=n.charCodeAt(C)+((d<<5)-d);return l[Math.abs(d)%l.length]??"#409EFF"}function g(n){return n==="上级"?"danger":n==="下级"?"":n==="平级协作"?"success":"info"}function Ee(n){return n==="核心"?"danger":n==="常用"?"warning":"info"}const Ml=r([]),Pe=r(!1),P=r({name:"",expr:"0 9 * * *",tz:"Asia/Shanghai",message:"",enabled:!0});function nt(n){return n==="running"?"success":n==="stopped"?"danger":"info"}function ot(n){return n==="running"?"运行中":n==="stopped"?"已停止":"空闲"}function Bl(n){return n?n<1024?n+" B":n<1048576?(n/1024).toFixed(1)+" KB":(n/1048576).toFixed(1)+" MB":"0 B"}function st(n){return new Date(n).toLocaleString()}function El(n){return n?new Date(n).toLocaleString():""}const le=r([]),gl=r(!1),Te=r(!1),G=r(""),ll=r(""),_l=r(!1),bl=r(""),c=r({type:"telegram",name:"",enabled:!0,botToken:"",allowedFrom:"",webPassword:"",webWelcome:"",webTitle:""}),U=r({loading:!1,status:""});let wl=null;function kl(n){return/^\*+$/.test(n)}async function Pl(){const n=c.value.botToken;if(!(!n||kl(n))){U.value={loading:!0,status:""};try{const d=(await Y.checkToken(y,n)).data;d.duplicate?U.value={loading:!1,status:"duplicate",usedBy:d.usedBy,usedByCh:d.usedByCh}:d.valid?(U.value={loading:!1,status:"ok",botName:d.botName},!c.value.name&&d.botName&&(c.value.name=d.botName)):U.value={loading:!1,status:"error",error:d.error||"Token 无效"}}catch{U.value={loading:!1,status:"error",error:"网络错误，请重试"}}}}Al(()=>c.value.type,n=>{G.value||(ll.value=xl(n))}),Al(()=>c.value.botToken,n=>{U.value={loading:!1,status:""},wl&&clearTimeout(wl),!(!n||kl(n)||n.length<20||!n.includes(":"))&&(wl=setTimeout(Pl,800))});function Ue(n,l){return l?`${window.location.origin}/chat/${n}/${l}`:`${window.location.origin}/chat/${n}`}function Rl(n){navigator.clipboard.writeText(n).then(()=>f.success("链接已复制"))}async function Ie(){gl.value=!0;try{const n=await Y.list(y);le.value=n.data||[]}catch{le.value=[]}finally{gl.value=!1}}function xl(n){return n+"-"+Date.now().toString(36)}function it(){G.value="";const n=O.value?.name||"";ll.value=xl("telegram"),c.value={type:"telegram",name:n,enabled:!0,botToken:"",allowedFrom:"",webPassword:"",webWelcome:"",webTitle:""},U.value={loading:!1,status:""},Te.value=!0}function ut(n){G.value=n.id,c.value={type:n.type,name:n.name,enabled:n.enabled,botToken:n.config?.botToken||"",allowedFrom:n.config?.allowedFrom||"",webPassword:"",webWelcome:n.config?.welcomeMsg||"",webTitle:n.config?.title||""},U.value={loading:!1,status:""},Te.value=!0}async function dt(){if(!c.value.name||!c.value.type){f.warning("请填写名称和类型");return}if(U.value.status==="duplicate"){f.error(`Bot Token 已被成员「${U.value.usedBy}」使用，请更换`);return}_l.value=!0;try{const n={};if(c.value.type==="telegram"?(c.value.botToken&&(n.botToken=c.value.botToken),c.value.allowedFrom&&(n.allowedFrom=c.value.allowedFrom)):c.value.type==="web"&&(c.value.webPassword&&(n.password=c.value.webPassword),c.value.webWelcome&&(n.welcomeMsg=c.value.webWelcome),c.value.webTitle&&(n.title=c.value.webTitle)),G.value){const l=le.value.map(d=>d.id!==G.value?d:{...d,name:c.value.name,type:c.value.type,enabled:c.value.enabled,config:{...d.config,...n}});await Y.set(y,l)}else{const l={id:ll.value||xl(c.value.type),name:c.value.name,type:c.value.type,enabled:c.value.enabled,config:n,status:"untested"};await Y.set(y,[...le.value,l])}f.success(c.value.type==="web"?"保存成功，Web 聊天页立即生效":"保存成功，重启后新渠道生效"),Te.value=!1,await Ie()}catch(n){f.error(n.response?.data?.error||"保存失败")}finally{_l.value=!1}}async function rt(){try{await Y.set(y,le.value)}catch(n){f.error(n.response?.data?.error||"保存失败"),await Ie()}}async function mt(n){const l=le.value.filter(d=>d.id!==n.id);try{await Y.set(y,l),le.value=l,f.success("已删除")}catch{f.error("删除失败")}}async function pt(n){bl.value=n.id;try{const l=await Y.test(y,n.id);l.data.valid?f.success(l.data.botName?`测试成功 (@${l.data.botName})`:"测试成功"):f.error(l.data.error||"测试失败"),await Ie()}catch{f.error("测试请求失败")}finally{bl.value=""}}const Se=r({}),Cl=r({}),Re=r(""),Vl=r("");async function tl(n){Cl.value[n]=!0;try{const l=await Y.listPending(y,n);Se.value[n]=l.data||[]}catch{Se.value[n]=[]}finally{Cl.value[n]=!1}}function ft(n){Re.value===n?Re.value="":(Re.value=n,tl(n))}async function vt(n,l){Vl.value=`${n}-${l}`;try{await Y.allowUser(y,n,l),f.success(`用户 ${l} 已加入白名单`),await tl(n),await Ie()}catch{f.error("操作失败")}finally{Vl.value=""}}async function ct(n,l){try{await Y.dismissUser(y,n,l),f.success("已忽略"),await tl(n)}catch{f.error("操作失败")}}async function jl(n,l){try{await Yt.confirm(`确定将用户 ${l} 从白名单中移除？移除后该用户将无法使用此 Bot。`,"移除白名单",{confirmButtonText:"确认移除",cancelButtonText:"取消",type:"warning"})}catch{return}try{await Y.removeAllowed(y,n,l),f.success(`用户 ${l} 已从白名单移除`),await Ie()}catch{f.error("操作失败")}}et(async()=>{try{const d=await Dl.get(y);O.value=d.data}catch{f.error("加载 Agent 失败")}yt(),ue(),Fe(),fl(),kt(),al(),Ie(),await be();const n=Q.query.tab;n&&(X.value=n);const l=Q.query.resumeSession;l&&(L.value=l,await new Promise(C=>setTimeout(C,100)),b.value?.resumeSession(l),K.value.find(C=>C.id===l)||(L.value=l))});async function yt(){try{const[n,l]=await Promise.all([_e.read(y,"IDENTITY.md"),_e.read(y,"SOUL.md")]);ke.value=n.data?.content||"",xe.value=l.data?.content||""}catch{}je()}async function hl(n,l){try{await _e.write(y,n,l),f.success(`${n} 已保存`)}catch{f.error(`保存 ${n} 失败`)}}async function je(){try{const n=await Ye.tree(y);I.value=n.data||[]}catch{I.value=[]}}async function gt(n){if(!n.isDir){B.value=n.path,fe.value=n.path.split("/");try{const l=await Ye.readFile(y,n.path);ee.value=l.data?.content||""}catch{ee.value="(无法读取)"}}}async function _t(){if(B.value){Ne.value=!0;try{await Ye.writeFile(y,B.value,ee.value),f.success("记忆文件已保存"),je()}catch{f.error("保存失败")}finally{Ne.value=!1}}}async function bt(){const n=he.value.trim();if(!n){f.warning("请输入路径");return}try{await Ye.writeFile(y,n,`# ${n.split("/").pop()?.replace(".md","")||"New File"}

`),f.success("文件已创建"),se.value=!1,he.value="",je(),B.value=n,fe.value=n.split("/"),ee.value=`# ${n.split("/").pop()?.replace(".md","")||"New File"}

`}catch{f.error("创建失败")}}async function wt(){const n=ze.value.trim();if(!n){f.warning("请输入内容");return}try{await Ye.dailyLog(y,n),f.success("日志已添加"),ve.value=!1,ze.value="",je()}catch{f.error("添加失败")}}async function kt(){try{const n=await _e.read(y,"/");Array.isArray(n.data)&&(Xe.value=n.data.map(l=>({name:l.name,isDir:l.isDir,size:l.size,modTime:l.modTime,path:l.name})))}catch{}}async function xt(n){if(!n.isDir){ie.value=n.path||n.name,$e.value=n;try{const l=await _e.read(y,ie.value);ce.value=l.data?.content||""}catch{ce.value="(无法读取)"}}}async function Ct(){ie.value&&await hl(ie.value,ce.value)}async function al(){try{const n=await He.list(y);Ml.value=n.data||[]}catch{}}async function Vt(){try{await He.create({name:P.value.name,enabled:P.value.enabled,agentId:y,schedule:{kind:"cron",expr:P.value.expr,tz:P.value.tz},payload:{kind:"agentTurn",message:P.value.message},delivery:{mode:"announce"}}),f.success("任务创建成功"),Pe.value=!1,al()}catch(n){f.error(n.response?.data?.error||"创建失败")}}async function ht(n){try{await He.update(n.id,n)}catch{f.error("更新失败")}}async function Wl(n){try{await He.run(n.id),f.success("已触发运行"),setTimeout(al,2e3)}catch{f.error("运行失败")}}async function zt(n){try{await He.delete(n.id),f.success("已删除"),al()}catch{f.error("删除失败")}}const nl=r(!1),zl=r([]),$l=r(!1),Tl=r(""),de=r([]),Ul=r(0),ol=r(0),$t=pl(()=>de.value.length<Ul.value),We=r(!1);async function Kl(){nl.value=!0;try{const n=await Xl.list(y);zl.value=n.data}catch{f.error("加载对话渠道失败")}finally{nl.value=!1}}async function Tt(n){Tl.value=n.channelId,de.value=[],Ul.value=0,ol.value=0,$l.value=!0,await Ol()}async function Ol(){We.value=!0;try{const l=(await Xl.messages(y,Tl.value,{limit:so,offset:ol.value})).data;Ul.value=l.total,ol.value===0?de.value=l.messages:de.value=[...l.messages,...de.value],ol.value+=l.messages.length}catch{f.error("加载消息失败")}finally{We.value=!1}}async function Ut(){await Ol()}return Al(X,n=>{n==="convlogs"&&zl.value.length===0&&Kl()}),(n,l)=>{const d=p("el-button"),C=p("el-tag"),R=p("el-text"),ye=p("el-header"),$=p("el-option"),te=p("el-select"),A=p("el-input"),ae=p("el-tab-pane"),q=p("el-card"),j=p("el-col"),ge=p("el-row"),T=p("el-form-item"),Ke=p("el-form"),ql=p("el-badge"),M=p("el-table-column"),sl=p("el-table"),Oe=p("el-switch"),It=p("el-input-number"),W=p("el-icon"),Yl=p("el-tree"),Il=p("el-empty"),Hl=p("el-breadcrumb-item"),St=p("el-breadcrumb"),il=p("el-dialog"),Lt=p("el-drawer"),At=p("el-link"),Ft=p("CircleCheck"),Dt=p("Warning"),Nt=p("CircleClose"),Jl=p("InfoFilled"),Gl=p("Link"),Mt=p("el-tabs"),Bt=p("el-main"),Et=p("el-container"),Sl=Ht("loading");return u(),V(Et,{class:"agent-detail"},{default:t(()=>[e(ye,{class:"detail-header"},{default:t(()=>[o("div",Aa,[e(d,{icon:S(jt),onClick:l[0]||(l[0]=a=>n.$router.push("/agents")),circle:""},null,8,["icon"]),o("h2",null,m(O.value?.name||"..."),1),e(C,{type:nt(O.value?.status)},{default:t(()=>[s(m(ot(O.value?.status)),1)]),_:1},8,["type"])]),e(R,{type:"info"},{default:t(()=>[s(m(O.value?.model),1)]),_:1})]),_:1}),e(Bt,null,{default:t(()=>[e(Mt,{modelValue:X.value,"onUpdate:modelValue":l[45]||(l[45]=a=>X.value=a),type:"border-card"},{default:t(()=>[e(ae,{label:"对话",name:"chat"},{default:t(()=>[o("div",Fa,[o("div",Da,[o("div",Na,[l[47]||(l[47]=o("span",{class:"sidebar-title"},"历史对话",-1)),e(d,{size:"small",type:"primary",plain:"",onClick:Le,icon:S(ul)},{default:t(()=>[...l[46]||(l[46]=[s("新建",-1)])]),_:1},8,["icon"])]),ml((u(),v("div",Ma,[(u(!0),v(F,null,H(K.value,a=>(u(),v("div",{key:a.id,class:Je(["session-item",{active:L.value===a.id}]),onClick:_=>re(a)},[o("div",Ea,m(a.title||"新对话"),1),o("div",Pa,[o("span",null,m(we(a.lastAt)),1),e(C,{size:"small",type:"info",effect:"plain",style:{"font-size":"10px",padding:"0 4px"}},{default:t(()=>[s(m(a.messageCount)+" 条 ",1)]),_:2},1024),a.tokenEstimate>6e4?(u(),V(C,{key:0,size:"small",type:"warning",effect:"plain",style:{"font-size":"10px",padding:"0 4px"}},{default:t(()=>[s("~"+m(Math.round(a.tokenEstimate/1e3))+"k",1)]),_:2},1024)):z("",!0)])],10,Ba))),128)),!h.value&&!K.value.length?(u(),v("div",Ra," 还没有对话记录 ")):z("",!0)])),[[Sl,h.value]]),o("div",ja,[e(d,{size:"small",plain:"",class:"at-toggle-btn",onClick:Z},{default:t(()=>[...l[48]||(l[48]=[o("span",{class:"at-icon"},"@",-1),s(" 其他成员 ",-1)])]),_:1}),x.value?(u(),v("div",Wa,[e(te,{modelValue:ne.value,"onUpdate:modelValue":l[1]||(l[1]=a=>ne.value=a),placeholder:"选择成员",size:"small",style:{width:"100%","margin-bottom":"6px"},onChange:Ge},{default:t(()=>[(u(!0),v(F,null,H(J.value,a=>(u(),V($,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),e(A,{modelValue:pe.value,"onUpdate:modelValue":l[2]||(l[2]=a=>pe.value=a),type:"textarea",rows:3,placeholder:"输入要转发的消息…",size:"small",style:{"margin-bottom":"6px"}},null,8,["modelValue"]),e(d,{type:"primary",size:"small",style:{width:"100%"},loading:Ae.value,disabled:!ne.value||!pe.value.trim(),onClick:Qe},{default:t(()=>[...l[49]||(l[49]=[s(" 转发 ",-1)])]),_:1},8,["loading","disabled"])])):z("",!0)])]),o("div",Ka,[e(tt,{ref_key:"aiChatRef",ref:b,"agent-id":S(y),scenario:"agent-detail","welcome-message":`你好！我是 **${O.value?.name||"AI"}**，有什么可以帮你的？`,height:"calc(100vh - 145px)","show-thinking":!0,onSessionChange:me},null,8,["agent-id","welcome-message"])])])]),_:1}),e(ae,{label:"身份 & 灵魂",name:"identity"},{default:t(()=>[e(ge,{gutter:20},{default:t(()=>[e(j,{span:12},{default:t(()=>[e(q,{header:"IDENTITY.md"},{default:t(()=>[e(A,{modelValue:ke.value,"onUpdate:modelValue":l[3]||(l[3]=a=>ke.value=a),type:"textarea",rows:15,onBlur:l[4]||(l[4]=a=>hl("IDENTITY.md",ke.value))},null,8,["modelValue"])]),_:1})]),_:1}),e(j,{span:12},{default:t(()=>[e(q,{header:"SOUL.md"},{default:t(()=>[e(A,{modelValue:xe.value,"onUpdate:modelValue":l[5]||(l[5]=a=>xe.value=a),type:"textarea",rows:15,onBlur:l[6]||(l[6]=a=>hl("SOUL.md",xe.value))},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),e(ae,{label:"关系",name:"relations"},{default:t(()=>[e(ge,{gutter:20},{default:t(()=>[e(j,{span:14},{default:t(()=>[e(q,{style:{"margin-bottom":"16px"}},{header:t(()=>[...l[50]||(l[50]=[o("span",{style:{"font-weight":"600"}},"添加关系",-1)])]),default:t(()=>[e(Ke,{model:k.value,"label-position":"top",size:"default"},{default:t(()=>[e(ge,{gutter:12},{default:t(()=>[e(j,{span:10},{default:t(()=>[e(T,{label:"关联成员"},{default:t(()=>[e(te,{modelValue:k.value.agentId,"onUpdate:modelValue":l[7]||(l[7]=a=>k.value.agentId=a),placeholder:"选择系统成员",filterable:"",style:{width:"100%"},onChange:Me},{default:t(()=>[(u(!0),v(F,null,H(J.value,a=>(u(),V($,{key:a.id,label:a.name,value:a.id},{default:t(()=>[o("div",Oa,[o("div",{style:dl([{width:"24px",height:"24px","border-radius":"50%",display:"flex","align-items":"center","justify-content":"center","font-size":"11px",color:"#fff","flex-shrink":"0"},{background:Be(a.id)}])},m(a.name.charAt(0)),5),o("span",null,m(a.name),1)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(j,{span:7},{default:t(()=>[e(T,{label:"关系类型"},{default:t(()=>[e(te,{modelValue:k.value.relationType,"onUpdate:modelValue":l[8]||(l[8]=a=>k.value.relationType=a),style:{width:"100%"}},{default:t(()=>[e($,{label:"上级",value:"上级"}),e($,{label:"下级",value:"下级"}),e($,{label:"平级协作",value:"平级协作"}),e($,{label:"支持",value:"支持"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(j,{span:7},{default:t(()=>[e(T,{label:"协作程度"},{default:t(()=>[e(te,{modelValue:k.value.strength,"onUpdate:modelValue":l[9]||(l[9]=a=>k.value.strength=a),style:{width:"100%"}},{default:t(()=>[e($,{label:"核心",value:"核心"}),e($,{label:"常用",value:"常用"}),e($,{label:"偶尔",value:"偶尔"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(ge,{gutter:12},{default:t(()=>[e(j,{span:18},{default:t(()=>[e(T,{label:"说明（选填）"},{default:t(()=>[e(A,{modelValue:k.value.desc,"onUpdate:modelValue":l[10]||(l[10]=a=>k.value.desc=a),placeholder:"简要描述这段关系..."},null,8,["modelValue"])]),_:1})]),_:1}),e(j,{span:6},{default:t(()=>[e(T,{label:" "},{default:t(()=>[e(d,{type:"primary",style:{width:"100%"},disabled:!k.value.agentId||!k.value.relationType||!k.value.strength,loading:E.value,onClick:cl},{default:t(()=>[...l[51]||(l[51]=[s(" 添加 ",-1)])]),_:1},8,["disabled","loading"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),e(q,null,{header:t(()=>[o("span",qa,[l[52]||(l[52]=s("已有关系 ",-1)),e(ql,{value:N.value.length,type:"info",style:{"margin-left":"4px"}},null,8,["value"])])]),default:t(()=>[N.value.length===0?(u(),v("div",Ya," 暂无关系，请在上方添加 ")):(u(),V(sl,{key:1,data:N.value,size:"small",style:{width:"100%"}},{default:t(()=>[e(M,{label:"成员","min-width":"120"},{default:t(({row:a})=>[o("div",Ha,[o("div",{style:dl([{width:"28px",height:"28px","border-radius":"50%",display:"flex","align-items":"center","justify-content":"center","font-size":"12px",color:"#fff","flex-shrink":"0"},{background:Be(a.agentId)}])},m(a.agentName.charAt(0)),5),o("span",Ja,m(a.agentName),1)])]),_:1}),e(M,{label:"类型",width:"100"},{default:t(({row:a})=>[e(C,{type:g(a.relationType),size:"small"},{default:t(()=>[s(m(a.relationType),1)]),_:2},1032,["type"])]),_:1}),e(M,{label:"程度",width:"80"},{default:t(({row:a})=>[e(C,{type:Ee(a.strength),size:"small",effect:"plain"},{default:t(()=>[s(m(a.strength),1)]),_:2},1032,["type"])]),_:1}),e(M,{label:"说明","min-width":"120","show-overflow-tooltip":""},{default:t(({row:a})=>[o("span",Ga,m(a.desc||"—"),1)]),_:1}),e(M,{label:"操作",width:"70",fixed:"right"},{default:t(({$index:a})=>[e(d,{type:"danger",link:"",size:"small",onClick:_=>yl(a)},{default:t(()=>[...l[53]||(l[53]=[s("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]))]),_:1})]),_:1}),e(j,{span:10},{default:t(()=>[e(q,{header:"关系预览"},{default:t(()=>[N.value.length===0?(u(),v("div",Qa," 暂无关系数据 ")):(u(),v("div",Xa,[(u(!0),v(F,null,H(N.value,a=>(u(),v("div",{key:a.agentId,class:"relation-card"},[o("div",{class:"relation-avatar",style:dl({background:Be(a.agentId)})},m(a.agentName.charAt(0).toUpperCase()),5),o("div",Za,[o("div",en,m(a.agentName),1),o("div",ln,[e(C,{type:g(a.relationType),size:"small"},{default:t(()=>[s(m(a.relationType),1)]),_:2},1032,["type"]),e(C,{type:Ee(a.strength),size:"small",effect:"plain"},{default:t(()=>[s(m(a.strength),1)]),_:2},1032,["type"])]),o("div",tn,m(a.desc),1)])]))),128))]))]),_:1})]),_:1})]),_:1})]),_:1}),e(ae,{label:"记忆",name:"memory"},{default:t(()=>[e(q,{style:{"margin-bottom":"16px"},shadow:"never"},{header:t(()=>[o("div",an,[l[54]||(l[54]=o("span",{style:{"font-weight":"600"}},"自动记忆",-1)),e(Oe,{modelValue:D.value.enabled,"onUpdate:modelValue":l[11]||(l[11]=a=>D.value.enabled=a),"active-text":"已开启","inactive-text":"已关闭",onChange:Ve},null,8,["modelValue"])])]),default:t(()=>[e(Ke,{model:D.value,"label-position":"top",size:"small",disabled:!D.value.enabled},{default:t(()=>[e(ge,{gutter:16},{default:t(()=>[e(j,{span:6},{default:t(()=>[e(T,{label:"整理频率"},{default:t(()=>[e(te,{modelValue:D.value.schedule,"onUpdate:modelValue":l[12]||(l[12]=a=>D.value.schedule=a),style:{width:"100%"}},{default:t(()=>[e($,{label:"每小时",value:"hourly"}),e($,{label:"每6小时",value:"every6h"}),e($,{label:"每天",value:"daily"}),e($,{label:"每周",value:"weekly"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(j,{span:5},{default:t(()=>[e(T,{label:"每个会话保留轮数"},{default:t(()=>[e(It,{modelValue:D.value.keepTurns,"onUpdate:modelValue":l[13]||(l[13]=a=>D.value.keepTurns=a),min:1,max:20,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),e(j,{span:13},{default:t(()=>[e(T,{label:"记录重点（留空则自动）"},{default:t(()=>[e(A,{modelValue:D.value.focusHint,"onUpdate:modelValue":l[14]||(l[14]=a=>D.value.focusHint=a),placeholder:"例如：记录数学解题步骤和用户常见错误"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),o("div",nn,[e(d,{type:"primary",size:"small",loading:Ce.value,onClick:Ve},{default:t(()=>[...l[55]||(l[55]=[s(" 保存设置 ",-1)])]),_:1},8,["loading"]),e(d,{size:"small",loading:De.value,onClick:vl},{default:t(()=>[...l[56]||(l[56]=[s(" 立即整理 ",-1)])]),_:1},8,["loading"]),e(R,{type:"info",size:"small",style:{"align-self":"center","margin-left":"4px"}},{default:t(()=>[s(" 整理后：LLM提炼摘要写入 MEMORY.md，每个会话只保留最近 "+m(D.value.keepTurns)+" 轮对话 ",1)]),_:1})])]),_:1},8,["model","disabled"])]),_:1}),e(q,{style:{"margin-bottom":"16px"},shadow:"never"},{header:t(()=>[o("div",on,[l[58]||(l[58]=o("span",{style:{"font-weight":"600"}},"整理日志",-1)),e(d,{size:"small",text:"",onClick:oe,loading:i.value},{default:t(()=>[...l[57]||(l[57]=[s("刷新",-1)])]),_:1},8,["loading"])])]),default:t(()=>[w.value.length===0&&!i.value?(u(),v("div",sn," 暂无运行记录，点击「立即整理」触发第一次 ")):(u(),V(sl,{key:1,data:w.value.slice(0,20),size:"small"},{default:t(()=>[e(M,{label:"时间",width:"160"},{default:t(({row:a})=>[o("span",un,m(El(a.timestamp)),1)]),_:1}),e(M,{label:"状态",width:"72"},{default:t(({row:a})=>[e(C,{type:a.status==="ok"?"success":"danger",size:"small"},{default:t(()=>[s(m(a.status),1)]),_:2},1032,["type"])]),_:1}),e(M,{label:"结果","min-width":"200","show-overflow-tooltip":""},{default:t(({row:a})=>[o("span",dn,m(a.message||"—"),1)]),_:1})]),_:1},8,["data"]))]),_:1}),o("div",rn,[e(d,{type:"primary",size:"small",onClick:l[15]||(l[15]=a=>se.value=!0)},{default:t(()=>[e(W,null,{default:t(()=>[e(S(ul))]),_:1}),l[59]||(l[59]=s(" 新建文件 ",-1))]),_:1}),e(d,{size:"small",onClick:l[16]||(l[16]=a=>ve.value=!0)},{default:t(()=>[e(W,null,{default:t(()=>[e(S(Wt))]),_:1}),l[60]||(l[60]=s(" 添加日志 ",-1))]),_:1}),e(d,{size:"small",onClick:je},{default:t(()=>[e(W,null,{default:t(()=>[e(S(Fl))]),_:1}),l[61]||(l[61]=s(" 刷新 ",-1))]),_:1})]),e(ge,{gutter:16},{default:t(()=>[e(j,{span:7},{default:t(()=>[e(q,{header:"记忆目录",shadow:"hover"},{default:t(()=>[e(Yl,{data:I.value,props:{label:"name",children:"children",isLeaf:a=>!a.isDir},onNodeClick:gt,"highlight-current":"","default-expand-all":"","expand-on-click-node":!1},{default:t(({data:a})=>[o("span",mn,[a.isDir?(u(),V(W,{key:0,style:{color:"#E6A23C"}},{default:t(()=>[e(S(Kt))]),_:1})):(u(),V(W,{key:1,style:{color:"#409EFF"}},{default:t(()=>[e(S(Ot))]),_:1})),o("span",null,m(a.name),1),!a.isDir&&a.size?(u(),V(R,{key:2,type:"info",size:"small",style:{"margin-left":"auto"}},{default:t(()=>[s(m(Bl(a.size)),1)]),_:2},1024)):z("",!0)])]),_:1},8,["data","props"]),I.value.length===0?(u(),V(Il,{key:0,description:"记忆树为空","image-size":40})):z("",!0)]),_:1})]),_:1}),e(j,{span:17},{default:t(()=>[e(q,{shadow:"hover"},{header:t(()=>[o("div",pn,[e(St,{separator:"/"},{default:t(()=>[e(Hl,null,{default:t(()=>[...l[62]||(l[62]=[s("memory",-1)])]),_:1}),(u(!0),v(F,null,H(fe.value,(a,_)=>(u(),V(Hl,{key:_},{default:t(()=>[s(m(a),1)]),_:2},1024))),128))]),_:1}),B.value?(u(),V(d,{key:0,type:"primary",size:"small",onClick:_t,loading:Ne.value},{default:t(()=>[...l[63]||(l[63]=[s("保存",-1)])]),_:1},8,["loading"])):z("",!0)])]),default:t(()=>[B.value?(u(),V(A,{key:0,modelValue:ee.value,"onUpdate:modelValue":l[17]||(l[17]=a=>ee.value=a),type:"textarea",rows:22,style:{"font-family":"monospace"}},null,8,["modelValue"])):(u(),V(Il,{key:1,description:"点击左侧文件查看和编辑","image-size":60}))]),_:1})]),_:1})]),_:1}),e(il,{modelValue:se.value,"onUpdate:modelValue":l[20]||(l[20]=a=>se.value=a),title:"新建记忆文件",width:"480px"},{footer:t(()=>[e(d,{onClick:l[19]||(l[19]=a=>se.value=!1)},{default:t(()=>[...l[65]||(l[65]=[s("取消",-1)])]),_:1}),e(d,{type:"primary",onClick:bt},{default:t(()=>[...l[66]||(l[66]=[s("创建",-1)])]),_:1})]),default:t(()=>[e(Ke,{"label-width":"80px"},{default:t(()=>[e(T,{label:"路径"},{default:t(()=>[e(A,{modelValue:he.value,"onUpdate:modelValue":l[18]||(l[18]=a=>he.value=a),placeholder:"例如: projects/my-project.md 或 topics/cooking.md"},null,8,["modelValue"]),e(R,{type:"info",size:"small",style:{"margin-top":"4px"}},{default:t(()=>[...l[64]||(l[64]=[s("相对于 memory/ 目录",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(il,{modelValue:ve.value,"onUpdate:modelValue":l[23]||(l[23]=a=>ve.value=a),title:"添加今日日志",width:"600px"},{footer:t(()=>[e(d,{onClick:l[22]||(l[22]=a=>ve.value=!1)},{default:t(()=>[...l[67]||(l[67]=[s("取消",-1)])]),_:1}),e(d,{type:"primary",onClick:wt},{default:t(()=>[...l[68]||(l[68]=[s("提交",-1)])]),_:1})]),default:t(()=>[e(A,{modelValue:ze.value,"onUpdate:modelValue":l[21]||(l[21]=a=>ze.value=a),type:"textarea",rows:10,placeholder:"记录今天的重要事项、学习心得、待办..."},null,8,["modelValue"])]),_:1},8,["modelValue"])]),_:1}),e(ae,{label:"技能",name:"skills"},{default:t(()=>[e(La,{"agent-id":S(y)},null,8,["agent-id"])]),_:1}),e(ae,{label:"历史对话",name:"convlogs"},{default:t(()=>[o("div",fn,[l[69]||(l[69]=o("span",{style:{"font-weight":"600","font-size":"15px"}},"渠道对话记录",-1)),e(d,{size:"small",icon:S(Fl),circle:"",onClick:Kl,loading:nl.value},null,8,["icon","loading"])]),ml((u(),V(sl,{data:zl.value,stripe:"","empty-text":"暂无对话记录"},{default:t(()=>[e(M,{label:"渠道","min-width":"200"},{default:t(({row:a})=>[o("span",null,m(a.channelType==="telegram"?"Telegram":"Web")+" "+m(a.channelId),1)]),_:1}),e(M,{label:"消息数",width:"100"},{default:t(({row:a})=>[s(m(a.messageCount)+" 条",1)]),_:1}),e(M,{label:"最后活跃",width:"180"},{default:t(({row:a})=>[s(m(a.lastAt?new Date(a.lastAt).toLocaleString("zh-CN"):"-"),1)]),_:1}),e(M,{label:"操作",width:"100"},{default:t(({row:a})=>[e(d,{size:"small",type:"primary",plain:"",onClick:_=>Tt(a)},{default:t(()=>[...l[70]||(l[70]=[s("查看",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[Sl,nl.value]]),e(Lt,{modelValue:$l.value,"onUpdate:modelValue":l[24]||(l[24]=a=>$l.value=a),title:Tl.value+" 对话记录",direction:"rtl",size:"520px","destroy-on-close":!1},{default:t(()=>[o("div",vn,[$t.value?(u(),v("div",cn,[e(d,{size:"small",plain:"",loading:We.value,onClick:Ut},{default:t(()=>[...l[71]||(l[71]=[s("加载更多",-1)])]),_:1},8,["loading"])])):z("",!0),ml((u(),v("div",yn,[(u(!0),v(F,null,H(de.value,(a,_)=>(u(),v("div",{key:_,class:Je(["conv-msg-item",a.role==="user"?"conv-msg-user":"conv-msg-assistant"])},[o("div",gn,[o("span",_n,m(a.role==="user"?"用户":"助手"),1),a.sender?(u(),v("span",bn,m(a.sender),1)):z("",!0),o("span",wn,m(a.ts?new Date(a.ts).toLocaleString("zh-CN"):""),1)]),o("div",kn,m(a.content),1)],2))),128)),!We.value&&de.value.length===0?(u(),v("div",xn," 暂无消息记录 ")):z("",!0)])),[[Sl,We.value&&de.value.length===0]])])]),_:1},8,["modelValue","title"])]),_:1}),e(ae,{label:"工作区",name:"workspace"},{default:t(()=>[e(ge,{gutter:20},{default:t(()=>[e(j,{span:8},{default:t(()=>[e(q,{header:"文件列表"},{default:t(()=>[e(Yl,{data:Xe.value,props:{label:"name",children:"children"},onNodeClick:xt,"highlight-current":"","default-expand-all":""},null,8,["data"])]),_:1})]),_:1}),e(j,{span:16},{default:t(()=>[e(q,{header:ie.value||"选择文件查看"},{default:t(()=>[ie.value?(u(),v(F,{key:0},[e(A,{modelValue:ce.value,"onUpdate:modelValue":l[25]||(l[25]=a=>ce.value=a),type:"textarea",rows:20},null,8,["modelValue"]),o("div",Cn,[e(d,{type:"primary",onClick:Ct},{default:t(()=>[...l[72]||(l[72]=[s("保存",-1)])]),_:1}),$e.value?(u(),V(R,{key:0,type:"info",size:"small"},{default:t(()=>[s(m(Bl($e.value.size))+" · "+m(st($e.value.modTime)),1)]),_:1})):z("",!0)])],64)):z("",!0)]),_:1},8,["header"])]),_:1})]),_:1})]),_:1}),e(ae,{label:"定时任务",name:"cron"},{default:t(()=>[e(d,{type:"primary",onClick:l[26]||(l[26]=a=>Pe.value=!0),style:{"margin-bottom":"16px"}},{default:t(()=>[e(W,null,{default:t(()=>[e(S(ul))]),_:1}),l[73]||(l[73]=s(" 新建任务 ",-1))]),_:1}),e(sl,{data:Ml.value,stripe:""},{default:t(()=>[e(M,{prop:"name",label:"名称"}),e(M,{label:"调度"},{default:t(({row:a})=>[s(m(a.schedule?.expr)+" ("+m(a.schedule?.tz)+")",1)]),_:1}),e(M,{label:"最近运行",width:"180"},{default:t(({row:a})=>[a.state?.lastRunAtMs?(u(),v(F,{key:0},[e(C,{type:a.state?.lastStatus==="ok"?"success":"danger",size:"small"},{default:t(()=>[s(m(a.state?.lastStatus),1)]),_:2},1032,["type"]),e(R,{type:"info",size:"small",style:{"margin-left":"4px"}},{default:t(()=>[s(m(El(a.state?.lastRunAtMs)),1)]),_:2},1024)],64)):(u(),V(R,{key:1,type:"info",size:"small"},{default:t(()=>[...l[74]||(l[74]=[s("未运行",-1)])]),_:1}))]),_:1}),e(M,{label:"启用",width:"80"},{default:t(({row:a})=>[e(Oe,{modelValue:a.enabled,"onUpdate:modelValue":_=>a.enabled=_,onChange:_=>ht(a)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),e(M,{label:"操作",width:"220"},{default:t(({row:a})=>[a.payload?.message==="__MEMORY_CONSOLIDATE__"?(u(),v(F,{key:0},[e(C,{type:"info",size:"small",style:{"margin-right":"8px"}},{default:t(()=>[...l[75]||(l[75]=[s("记忆管理",-1)])]),_:1}),e(d,{size:"small",onClick:_=>Wl(a)},{default:t(()=>[...l[76]||(l[76]=[s("立即运行",-1)])]),_:1},8,["onClick"])],64)):(u(),v(F,{key:1},[e(d,{size:"small",onClick:_=>Wl(a)},{default:t(()=>[...l[77]||(l[77]=[s("立即运行",-1)])]),_:1},8,["onClick"]),e(d,{size:"small",type:"danger",onClick:_=>zt(a)},{default:t(()=>[...l[78]||(l[78]=[s("删除",-1)])]),_:1},8,["onClick"])],64))]),_:1})]),_:1},8,["data"]),e(il,{modelValue:Pe.value,"onUpdate:modelValue":l[33]||(l[33]=a=>Pe.value=a),title:"新建定时任务",width:"520px"},{footer:t(()=>[e(d,{onClick:l[32]||(l[32]=a=>Pe.value=!1)},{default:t(()=>[...l[79]||(l[79]=[s("取消",-1)])]),_:1}),e(d,{type:"primary",onClick:Vt},{default:t(()=>[...l[80]||(l[80]=[s("创建",-1)])]),_:1})]),default:t(()=>[e(Ke,{model:P.value,"label-width":"100px"},{default:t(()=>[e(T,{label:"名称"},{default:t(()=>[e(A,{modelValue:P.value.name,"onUpdate:modelValue":l[27]||(l[27]=a=>P.value.name=a)},null,8,["modelValue"])]),_:1}),e(T,{label:"Cron 表达式"},{default:t(()=>[e(A,{modelValue:P.value.expr,"onUpdate:modelValue":l[28]||(l[28]=a=>P.value.expr=a),placeholder:"30 3 * * *"},null,8,["modelValue"])]),_:1}),e(T,{label:"时区"},{default:t(()=>[e(te,{modelValue:P.value.tz,"onUpdate:modelValue":l[29]||(l[29]=a=>P.value.tz=a)},{default:t(()=>[e($,{label:"Asia/Shanghai",value:"Asia/Shanghai"}),e($,{label:"UTC",value:"UTC"}),e($,{label:"America/New_York",value:"America/New_York"})]),_:1},8,["modelValue"])]),_:1}),e(T,{label:"消息"},{default:t(()=>[e(A,{modelValue:P.value.message,"onUpdate:modelValue":l[30]||(l[30]=a=>P.value.message=a),type:"textarea",rows:3},null,8,["modelValue"])]),_:1}),e(T,{label:"启用"},{default:t(()=>[e(Oe,{modelValue:P.value.enabled,"onUpdate:modelValue":l[31]||(l[31]=a=>P.value.enabled=a)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])]),_:1}),e(ae,{label:"渠道",name:"channels"},{default:t(()=>[o("div",Vn,[e(R,{type:"info",size:"small"},{default:t(()=>[...l[81]||(l[81]=[s("每个 AI 成员独立配置自己的消息通道（如 Telegram Bot Token）",-1)])]),_:1}),e(d,{type:"primary",size:"small",onClick:it},{default:t(()=>[e(W,null,{default:t(()=>[e(S(ul))]),_:1}),l[82]||(l[82]=s(" 添加消息渠道 ",-1))]),_:1})]),(u(!0),v(F,null,H(le.value,a=>(u(),v("div",{key:a.id,class:"channel-card"},[o("div",hn,[o("div",zn,[e(C,{size:"small",style:{"margin-right":"8px"}},{default:t(()=>[s(m(a.type),1)]),_:2},1024),o("span",$n,m(a.name),1),a.config?.botName?(u(),v("span",Tn,"@"+m(a.config.botName),1)):z("",!0),e(C,{type:a.status==="ok"?"success":a.status==="error"?"danger":"info",size:"small",effect:"plain",style:{"margin-left":"8px"}},{default:t(()=>[s(m(a.status==="ok"?"✓ 正常":a.status==="error"?"✗ 错误":"未测试"),1)]),_:2},1032,["type"])]),o("div",Un,[e(Oe,{modelValue:a.enabled,"onUpdate:modelValue":_=>a.enabled=_,size:"small",onChange:rt,style:{"margin-right":"8px"}},null,8,["modelValue","onUpdate:modelValue"]),e(d,{size:"small",onClick:_=>pt(a),loading:bl.value===a.id},{default:t(()=>[...l[83]||(l[83]=[s("测试连接",-1)])]),_:1},8,["onClick","loading"]),e(d,{size:"small",onClick:_=>ut(a)},{default:t(()=>[...l[84]||(l[84]=[s("编辑",-1)])]),_:1},8,["onClick"]),e(d,{size:"small",type:"danger",plain:"",onClick:_=>mt(a)},{default:t(()=>[...l[85]||(l[85]=[s("删除",-1)])]),_:1},8,["onClick"])])]),a.type==="web"?(u(),v("div",In,[o("div",Sn,[l[87]||(l[87]=o("span",{class:"channel-info-label"},"公开地址",-1)),o("span",Ln,[e(At,{href:Ue(S(y),a.id),target:"_blank",type:"primary",style:{"font-size":"13px"}},{default:t(()=>[s(m(Ue(S(y),a.id)),1)]),_:2},1032,["href"]),e(d,{size:"small",link:"",style:{"margin-left":"8px"},onClick:_=>Rl(Ue(S(y),a.id))},{default:t(()=>[...l[86]||(l[86]=[s("复制",-1)])]),_:1},8,["onClick"])])]),o("div",An,[l[88]||(l[88]=o("span",{class:"channel-info-label"},"访问密码",-1)),o("span",Fn,[e(C,{size:"small",type:a.config?.password?"warning":"info",effect:"plain"},{default:t(()=>[s(m(a.config?.password?"已设置":"无密码"),1)]),_:2},1032,["type"])])])])):z("",!0),a.type==="telegram"?(u(),v("div",Dn,[o("div",Nn,[l[90]||(l[90]=o("span",{class:"channel-info-label"},"白名单用户",-1)),o("span",Mn,[a.allowedFromUsers?.length?(u(!0),v(F,{key:0},H(a.allowedFromUsers,_=>(u(),V(C,{key:_.id,size:"small",closable:"","disable-transitions":!0,style:{"margin-right":"4px","margin-bottom":"4px"},onClose:Ll=>jl(a.id,_.id)},{default:t(()=>[s(m(_.username?"@"+_.username:_.firstName||String(_.id))+" ",1),o("span",Bn,"("+m(_.id)+")",1)]),_:2},1032,["onClose"]))),128)):a.config?.allowedFrom?(u(!0),v(F,{key:1},H(a.config.allowedFrom.split(","),_=>(u(),V(C,{key:_,size:"small",closable:"","disable-transitions":!0,style:{"margin-right":"4px","margin-bottom":"4px"},onClose:Ll=>jl(a.id,Number(_.trim()))},{default:t(()=>[s(m(_.trim()),1)]),_:2},1032,["onClose"]))),128)):(u(),V(R,{key:2,type:"warning",size:"small"},{default:t(()=>[...l[89]||(l[89]=[s("未设置（配对模式，向用户返回其 ID）",-1)])]),_:1}))])]),o("div",En,[o("div",{class:"pending-section-header",onClick:_=>ft(a.id)},[l[92]||(l[92]=o("span",null,"待审核用户",-1)),e(ql,{value:(Se.value[a.id]||[]).length,hidden:!(Se.value[a.id]||[]).length,type:"warning",style:{"margin-left":"6px"}},null,8,["value","hidden"]),e(d,{size:"small",link:"",onClick:lt(_=>tl(a.id),["stop"]),style:{"margin-left":"8px"}},{default:t(()=>[...l[91]||(l[91]=[s("刷新",-1)])]),_:1},8,["onClick"]),e(W,{style:dl([{"margin-left":"4px",transition:"transform 0.2s"},{transform:Re.value===a.id?"rotate(180deg)":""}])},{default:t(()=>[e(S(qt))]),_:1},8,["style"])],8,Pn),Re.value===a.id?(u(),v("div",Rn,[Cl.value[a.id]?(u(),v("div",jn,[e(R,{type:"info",size:"small"},{default:t(()=>[...l[93]||(l[93]=[s("加载中...",-1)])]),_:1})])):(Se.value[a.id]||[]).length?(u(!0),v(F,{key:1},H(Se.value[a.id],_=>(u(),v("div",{key:_.id,class:"pending-user-row"},[o("div",Wn,[o("span",Kn,m(_.firstName||"未知"),1),_.username?(u(),v("span",On,"@"+m(_.username),1)):z("",!0),o("span",qn,"ID: "+m(_.id),1),e(R,{type:"info",size:"small",style:{"margin-left":"8px"}},{default:t(()=>[s(m(we(_.lastSeen)),1)]),_:2},1024)]),o("div",Yn,[e(d,{size:"small",type:"success",plain:"",onClick:Ll=>vt(a.id,_.id),loading:Vl.value===`${a.id}-${_.id}`},{default:t(()=>[...l[94]||(l[94]=[s("加入白名单",-1)])]),_:1},8,["onClick","loading"]),e(d,{size:"small",type:"danger",plain:"",onClick:Ll=>ct(a.id,_.id)},{default:t(()=>[...l[95]||(l[95]=[s("忽略",-1)])]),_:1},8,["onClick"])])]))),128)):(u(),v("div",Hn," 暂无待审核用户。让用户向 Bot 发送 /start 即可出现在此处。 "))])):z("",!0)])])):z("",!0)]))),128)),!gl.value&&!le.value.length?(u(),V(Il,{key:0,description:"暂无消息渠道，点击「添加消息渠道」开始配置","image-size":80,style:{"margin-top":"40px"}})):z("",!0),e(il,{modelValue:Te.value,"onUpdate:modelValue":l[44]||(l[44]=a=>Te.value=a),title:G.value?"编辑消息渠道":"添加消息渠道",width:"540px"},{footer:t(()=>[e(d,{onClick:l[43]||(l[43]=a=>Te.value=!1)},{default:t(()=>[...l[105]||(l[105]=[s("取消",-1)])]),_:1}),e(d,{type:"primary",onClick:dt,loading:_l.value},{default:t(()=>[...l[106]||(l[106]=[s("保存",-1)])]),_:1},8,["loading"])]),default:t(()=>[e(Ke,{model:c.value,"label-width":"120px"},{default:t(()=>[e(T,{label:"类型",required:""},{default:t(()=>[e(te,{modelValue:c.value.type,"onUpdate:modelValue":l[34]||(l[34]=a=>c.value.type=a),style:{width:"100%"}},{default:t(()=>[e($,{label:"Telegram",value:"telegram"}),e($,{label:"Web 聊天页",value:"web"}),e($,{label:"iMessage",value:"imessage"}),e($,{label:"WhatsApp",value:"whatsapp"})]),_:1},8,["modelValue"])]),_:1}),e(T,{label:"名称",required:""},{default:t(()=>[e(A,{modelValue:c.value.name,"onUpdate:modelValue":l[35]||(l[35]=a=>c.value.name=a),placeholder:"如：客服 Bot"},null,8,["modelValue"])]),_:1}),c.value.type==="telegram"?(u(),v(F,{key:0},[e(T,{label:"Bot Token",required:""},{default:t(()=>[o("div",Jn,[o("div",Gn,[e(A,{modelValue:c.value.botToken,"onUpdate:modelValue":l[36]||(l[36]=a=>c.value.botToken=a),type:"password","show-password":"",placeholder:"从 @BotFather 获取",style:{flex:"1"},status:U.value.status==="error"?"error":U.value.status==="ok"?"success":""},null,8,["modelValue","status"]),e(d,{size:"default",loading:U.value.loading,type:U.value.status==="ok"?"success":U.value.status==="error"?"danger":"default",onClick:Pl,disabled:!c.value.botToken||kl(c.value.botToken)},{default:t(()=>[...l[96]||(l[96]=[s("验证",-1)])]),_:1},8,["loading","type","disabled"])]),U.value.loading?(u(),v("div",Qn,[e(W,{class:"is-loading"},{default:t(()=>[e(S(Fl))]),_:1}),l[97]||(l[97]=s(" 正在验证 Token… ",-1))])):U.value.status==="ok"?(u(),v("div",Xn,[e(W,{style:{"vertical-align":"-2px","margin-right":"4px"}},{default:t(()=>[e(Ft)]),_:1}),l[98]||(l[98]=s("Token 有效，Bot 名称：",-1)),o("b",null,"@"+m(U.value.botName),1)])):U.value.status==="duplicate"?(u(),v("div",Zn,[e(W,{style:{"vertical-align":"-2px","margin-right":"4px"}},{default:t(()=>[e(Dt)]),_:1}),l[99]||(l[99]=s("此 Token 已被成员「",-1)),o("b",null,m(U.value.usedBy),1),s("」的渠道「"+m(U.value.usedByCh)+"」使用 ",1)])):U.value.status==="error"?(u(),v("div",eo,[e(W,{style:{"vertical-align":"-2px","margin-right":"4px"}},{default:t(()=>[e(Nt)]),_:1}),s(m(U.value.error),1)])):(u(),v("div",lo,[e(R,{type:"info",size:"small"},{default:t(()=>[e(W,{style:{"vertical-align":"-2px","margin-right":"4px"}},{default:t(()=>[e(Jl)]),_:1}),l[100]||(l[100]=s("输入完成后自动验证，也可点右侧「验证」按钮手动触发",-1))]),_:1})]))])]),_:1}),e(T,{label:"白名单用户"},{default:t(()=>[e(A,{modelValue:c.value.allowedFrom,"onUpdate:modelValue":l[37]||(l[37]=a=>c.value.allowedFrom=a),placeholder:"填入 Telegram 用户 ID，多个用逗号分隔"},null,8,["modelValue"]),e(R,{type:"info",size:"small",style:{display:"block","margin-top":"4px"}},{default:t(()=>[e(W,{style:{"vertical-align":"-2px","margin-right":"4px"}},{default:t(()=>[e(Jl)]),_:1}),l[101]||(l[101]=s("留空时 Bot 进入配对模式——向用户返回其 ID，引导联系管理员添加白名单 ",-1))]),_:1})]),_:1})],64)):z("",!0),c.value.type==="web"?(u(),v(F,{key:1},[G.value?(u(),V(T,{key:0,label:"访问链接"},{default:t(()=>[o("div",to,[e(W,{style:{"flex-shrink":"0",color:"#909399"}},{default:t(()=>[e(Gl)]),_:1}),o("span",ao,m(Ue(S(y),G.value)),1),e(d,{size:"small",link:"",onClick:l[38]||(l[38]=a=>Rl(Ue(S(y),G.value)))},{default:t(()=>[...l[102]||(l[102]=[s("复制",-1)])]),_:1})])]),_:1})):z("",!0),G.value?z("",!0):(u(),V(T,{key:1,label:"访问链接"},{default:t(()=>[o("div",no,[e(W,{style:{"flex-shrink":"0",color:"#909399"}},{default:t(()=>[e(Gl)]),_:1}),o("span",oo,m(Ue(S(y),ll.value)),1),e(C,{size:"small",type:"info",effect:"plain"},{default:t(()=>[...l[103]||(l[103]=[s("保存后生效",-1)])]),_:1})]),e(R,{type:"info",size:"small",style:{display:"block","margin-top":"4px"}},{default:t(()=>[...l[104]||(l[104]=[s(" 每个 Web 渠道有独立链接，可同时开放多个入口 ",-1)])]),_:1})]),_:1})),e(T,{label:"访问密码"},{default:t(()=>[e(A,{modelValue:c.value.webPassword,"onUpdate:modelValue":l[39]||(l[39]=a=>c.value.webPassword=a),type:"password","show-password":"",placeholder:"留空则无需密码"},null,8,["modelValue"])]),_:1}),e(T,{label:"欢迎语"},{default:t(()=>[e(A,{modelValue:c.value.webWelcome,"onUpdate:modelValue":l[40]||(l[40]=a=>c.value.webWelcome=a),placeholder:"你好！有什么可以帮你的？"},null,8,["modelValue"])]),_:1}),e(T,{label:"页面标题"},{default:t(()=>[e(A,{modelValue:c.value.webTitle,"onUpdate:modelValue":l[41]||(l[41]=a=>c.value.webTitle=a),placeholder:"AI 助手"},null,8,["modelValue"])]),_:1})],64)):z("",!0),e(T,{label:"启用"},{default:t(()=>[e(Oe,{modelValue:c.value.enabled,"onUpdate:modelValue":l[42]||(l[42]=a=>c.value.enabled=a)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})}}}),fo=at(io,[["__scopeId","data-v-385962f3"]]);export{fo as default};
