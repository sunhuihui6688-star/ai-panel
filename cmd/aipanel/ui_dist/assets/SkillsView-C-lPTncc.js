import{d as te,i as se,c as f,b as o,a as s,w as a,h as c,t as r,l as ae,U as ne,j as C,F as $,m as R,e as b,z as B,E as k,r as i,o as u,k as D,u as oe}from"./index--B3_6xNz.js";import{b as ie,h as z,f as de}from"./index-A6Vnzxup.js";import{_ as ue}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ce={class:"skills-page"},re={class:"page-header"},me={class:"header-left"},pe={class:"page-title"},fe={class:"header-stats"},_e={class:"stat-item"},ve={class:"stat-item"},ke={class:"stat-item"},ge={class:"header-acts"},ye={key:0,style:{padding:"40px"}},be={key:2,class:"skills-grid"},Ie={class:"card-agent"},Ce={class:"agent-name"},he={class:"card-body"},Ve={class:"skill-icon"},xe={key:0},we={class:"skill-info"},ze={class:"skill-name"},Ne={class:"skill-id"},Ae={key:0,class:"card-desc"},Se={class:"card-acts"},$e={key:0,class:"copy-source"},Re=te({__name:"SkillsView",setup(De){const T=oe(),I=b([]),h=b(!1),V=b(""),x=b(""),v=b([]),F=B(()=>new Set(v.value.map(t=>t.agentId))),L=B(()=>{let t=v.value;if(V.value&&(t=t.filter(e=>e.agentId===V.value)),x.value.trim()){const e=x.value.trim().toLowerCase();t=t.filter(p=>p.skill.name.toLowerCase().includes(e)||p.skill.id.toLowerCase().includes(e)||(p.skill.category||"").toLowerCase().includes(e))}return t});async function N(){h.value=!0;try{const t=await ie.list();I.value=t.data||[];const e=await Promise.allSettled(I.value.map(d=>z.list(d.id).then(m=>(m.data||[]).map(g=>({agentId:d.id,agentName:d.name,skill:g}))))),p=[];for(const d of e)d.status==="fulfilled"&&p.push(...d.value);p.sort((d,m)=>d.agentName.localeCompare(m.agentName)||d.skill.name.localeCompare(m.skill.name)),v.value=p}catch(t){k.error("加载失败: "+(t.message||""))}finally{h.value=!1}}async function K(t,e){try{await z.update(t.agentId,t.skill.id,{enabled:e}),t.skill.enabled=e}catch{k.error("操作失败")}}async function M(t){try{await z.remove(t.agentId,t.skill.id),v.value=v.value.filter(e=>!(e.agentId===t.agentId&&e.skill.id===t.skill.id)),k.success("已删除")}catch{k.error("删除失败")}}function j(t){T.push(`/agents/${t.agentId}?tab=skills&skill=${t.skill.id}`)}const n=b({visible:!1,source:null,targetAgentId:"",newSkillId:"",newName:"",copying:!1});function q(t){n.value={visible:!0,source:t,targetAgentId:"",newSkillId:"",newName:"",copying:!1}}async function P(){const{source:t,targetAgentId:e,newSkillId:p,newName:d}=n.value;if(!t||!e){k.warning("请选择目标成员");return}n.value.copying=!0;try{let m="";try{m=(await de.read(t.agentId,`skills/${t.skill.id}/SKILL.md`)).data?.content||""}catch{}const g=p.trim()||t.skill.id,y=d.trim()||t.skill.name;await z.create(e,{meta:{id:g,name:y,icon:t.skill.icon||"",category:t.skill.category||"",description:t.skill.description||"",version:t.skill.version||"1.0.0",enabled:t.skill.enabled,source:"local",installedAt:""},promptContent:m});const A=I.value.find(_=>_.id===e);k.success(`已复制「${y}」到「${A?.name}」`),n.value.visible=!1,await N()}catch(m){k.error(m.response?.data?.error||"复制失败")}finally{n.value.copying=!1}}return se(N),(t,e)=>{const p=i("Aim"),d=i("el-icon"),m=i("el-option"),g=i("el-select"),y=i("el-input"),A=i("Refresh"),_=i("el-button"),G=i("el-skeleton"),H=i("el-empty"),J=i("el-avatar"),O=i("el-switch"),Q=i("Tools"),U=i("el-tag"),W=i("Edit"),E=i("CopyDocument"),X=i("Delete"),Y=i("el-popconfirm"),Z=i("ArrowRight"),S=i("el-form-item"),ee=i("el-form"),le=i("el-dialog");return u(),f("div",ce,[o("div",re,[o("div",me,[o("h2",pe,[s(d,null,{default:a(()=>[s(p)]),_:1}),e[7]||(e[7]=c(" 技能库 ",-1))]),o("div",fe,[o("span",_e,[e[8]||(e[8]=c("共 ",-1)),o("b",null,r(v.value.length),1),e[9]||(e[9]=c(" 个技能",-1))]),e[13]||(e[13]=o("span",{class:"stat-sep"},"·",-1)),o("span",ve,[e[10]||(e[10]=c("已启用 ",-1)),o("b",null,r(v.value.filter(l=>l.skill.enabled).length),1)]),e[14]||(e[14]=o("span",{class:"stat-sep"},"·",-1)),o("span",ke,[e[11]||(e[11]=c("涉及 ",-1)),o("b",null,r(F.value.size),1),e[12]||(e[12]=c(" 个成员",-1))])])]),o("div",ge,[s(g,{modelValue:V.value,"onUpdate:modelValue":e[0]||(e[0]=l=>V.value=l),placeholder:"全部成员",clearable:"",size:"small",style:{width:"150px"}},{default:a(()=>[(u(!0),f($,null,R(I.value,l=>(u(),C(m,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),s(y,{modelValue:x.value,"onUpdate:modelValue":e[1]||(e[1]=l=>x.value=l),placeholder:"搜索技能…",clearable:"",size:"small",style:{width:"180px"},"prefix-icon":ae(ne)},null,8,["modelValue","prefix-icon"]),s(_,{loading:h.value,size:"small",circle:"",onClick:N},{default:a(()=>[s(d,null,{default:a(()=>[s(A)]),_:1})]),_:1},8,["loading"])])]),h.value?(u(),f("div",ye,[s(G,{rows:3,animated:""})])):L.value.length===0?(u(),C(H,{key:1,description:"暂无技能",style:{padding:"60px 0"}})):(u(),f("div",be,[(u(!0),f($,null,R(L.value,l=>(u(),f("div",{key:`${l.agentId}-${l.skill.id}`,class:"skill-card"},[o("div",Ie,[s(J,{size:18,style:{"font-size":"10px","flex-shrink":"0",background:"#409eff"}},{default:a(()=>[c(r(l.agentName.charAt(0)),1)]),_:2},1024),o("span",Ce,r(l.agentName),1),s(O,{"model-value":l.skill.enabled,size:"small",style:{"margin-left":"auto"},onChange:w=>K(l,w)},null,8,["model-value","onChange"])]),o("div",he,[o("div",Ve,[l.skill.icon?(u(),f("span",xe,r(l.skill.icon),1)):(u(),C(d,{key:1,size:"20",color:"#c0c4cc"},{default:a(()=>[s(Q)]),_:1}))]),o("div",we,[o("div",ze,r(l.skill.name),1),o("div",Ne,r(l.skill.id),1),l.skill.category?(u(),C(U,{key:0,size:"small",type:"primary",effect:"plain",style:{"margin-top":"4px","font-size":"11px"}},{default:a(()=>[c(r(l.skill.category),1)]),_:2},1024)):D("",!0)])]),l.skill.description?(u(),f("div",Ae,r(l.skill.description),1)):D("",!0),o("div",Se,[s(_,{size:"small",link:"",type:"primary",onClick:w=>j(l)},{default:a(()=>[s(d,null,{default:a(()=>[s(W)]),_:1}),e[15]||(e[15]=c(" 编辑 ",-1))]),_:1},8,["onClick"]),s(_,{size:"small",link:"",type:"primary",onClick:w=>q(l)},{default:a(()=>[s(d,null,{default:a(()=>[s(E)]),_:1}),e[16]||(e[16]=c(" 复制到… ",-1))]),_:1},8,["onClick"]),s(Y,{title:`从「${l.agentName}」删除「${l.skill.name}」？`,onConfirm:w=>M(l)},{reference:a(()=>[s(_,{size:"small",link:"",type:"danger"},{default:a(()=>[s(d,null,{default:a(()=>[s(X)]),_:1})]),_:1})]),_:1},8,["title","onConfirm"])])]))),128))])),s(le,{modelValue:n.value.visible,"onUpdate:modelValue":e[6]||(e[6]=l=>n.value.visible=l),title:"复制技能到其他成员",width:"420px"},{footer:a(()=>[s(_,{onClick:e[5]||(e[5]=l=>n.value.visible=!1)},{default:a(()=>[...e[18]||(e[18]=[c("取消",-1)])]),_:1}),s(_,{type:"primary",loading:n.value.copying,onClick:P},{default:a(()=>[s(d,null,{default:a(()=>[s(E)]),_:1}),e[19]||(e[19]=c(" 复制 ",-1))]),_:1},8,["loading"])]),default:a(()=>[n.value.source?(u(),f("div",$e,[o("b",null,r(n.value.source.agentName),1),s(d,{style:{margin:"0 4px",color:"#c0c4cc"}},{default:a(()=>[s(Z)]),_:1}),c(" "+r(n.value.source.skill.icon)+" "+r(n.value.source.skill.name)+" ",1),s(U,{size:"small",type:"info",effect:"plain",style:{"margin-left":"6px","font-family":"monospace","font-size":"11px"}},{default:a(()=>[c(r(n.value.source.skill.id),1)]),_:1})])):D("",!0),s(ee,{"label-width":"80px",size:"small",style:{"margin-top":"16px"}},{default:a(()=>[s(S,{label:"目标成员",required:""},{default:a(()=>[s(g,{modelValue:n.value.targetAgentId,"onUpdate:modelValue":e[2]||(e[2]=l=>n.value.targetAgentId=l),placeholder:"选择目标成员",style:{width:"100%"}},{default:a(()=>[(u(!0),f($,null,R(I.value.filter(l=>l.id!==n.value.source?.agentId),l=>(u(),C(m,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),s(S,{label:"新技能 ID"},{default:a(()=>[s(y,{modelValue:n.value.newSkillId,"onUpdate:modelValue":e[3]||(e[3]=l=>n.value.newSkillId=l),placeholder:n.value.source?.skill.id||"留空使用原 ID"},null,8,["modelValue","placeholder"]),e[17]||(e[17]=o("div",{style:{"font-size":"11px",color:"#c0c4cc","margin-top":"3px"}},"目标成员已有同 ID 技能时需修改",-1))]),_:1}),s(S,{label:"新名称"},{default:a(()=>[s(y,{modelValue:n.value.newName,"onUpdate:modelValue":e[4]||(e[4]=l=>n.value.newName=l),placeholder:n.value.source?.skill.name||"留空使用原名称"},null,8,["modelValue","placeholder"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}}),Be=ue(Re,[["__scopeId","data-v-bcc7eea9"]]);export{Be as default};
