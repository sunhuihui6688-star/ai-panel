import{d as Ge,e as C,D as Xe,I as _e,i as Ye,c as o,f as T,n as Qe,s as F,a as $,w as B,S as Ze,b as a,t as m,F as I,m as j,k as f,h as P,p as et,G as tt,g as ke,z as ye,H as W,r as q,o as l,j as xe,q as st}from"./index-7KsAVTAL.js";import{n as nt,i as te,o as at,p as lt,q as le}from"./index-BclxA8EE.js";import{_ as ot}from"./_plugin-vue_export-helper-DlAUqK2U.js";const it={key:0,class:"drag-overlay"},rt={key:0,class:"running-tasks-banner"},ut={key:0,class:"resumed-list"},ct={key:0,class:"history-loading"},dt={key:1,class:"chat-empty"},pt={key:0,class:"welcome-msg"},ft={key:1,class:"examples"},ht=["onClick"],vt={key:0,class:"msg-row user"},mt={class:"msg-bubble user"},gt={key:0,class:"msg-images"},_t=["src","onClick"],kt={class:"msg-text"},yt={key:1,class:"msg-row assistant"},xt={class:"msg-col"},Ct=["open"],bt={class:"thinking-summary"},wt={class:"thinking-len"},St={class:"thinking-content"},Tt={key:1,class:"tool-timeline"},$t=["onClick"],It={class:"tool-step-header"},Dt={key:0,class:"tool-spin"},Mt={key:1},jt={key:2},Nt={key:3},Ot={class:"tool-step-icon"},Ft={class:"tool-step-name"},Ut={key:0,class:"tool-step-summary"},Rt={key:1,class:"tool-step-dur"},At={key:0},Bt={key:1},Lt={key:2},Et={key:3},Jt={key:4},zt={class:"tool-step-chevron"},Pt={key:0,class:"tool-section"},qt={class:"tool-pre"},Ht={key:1,class:"tool-section"},Kt={class:"tool-pre result"},Vt=["src","onClick"],Wt=["href"],Gt={class:"tool-file-name"},Xt={class:"tool-file-size"},Yt={class:"msg-bubble assistant"},Qt=["innerHTML"],Zt={key:1,class:"apply-card"},es={class:"apply-preview"},ts={class:"apply-key"},ss={class:"apply-val"},ns=["onClick"],as={class:"msg-actions"},ls=["onClick","title"],os=["onClick"],is=["onClick"],rs={key:2,class:"option-chips"},us=["onClick"],cs={key:2,class:"msg-row system"},ds={class:"msg-system"},ps={key:2,class:"msg-row assistant"},fs={class:"msg-col"},hs={key:0,class:"thinking-block",open:""},vs={class:"thinking-summary"},ms={class:"thinking-content"},gs={key:1,class:"tool-timeline"},_s=["onClick"],ks={class:"tool-step-header"},ys={key:0,class:"tool-spin"},xs={key:1},Cs={key:2},bs={class:"tool-step-icon"},ws={class:"tool-step-name"},Ss={key:0,class:"tool-step-summary"},Ts={key:1,class:"tool-step-dur"},$s={key:0},Is={key:1},Ds={key:2},Ms={key:3},js={key:4},Ns={class:"tool-step-chevron"},Os={key:0,class:"tool-section"},Fs={class:"tool-pre"},Us={key:1,class:"tool-section"},Rs={class:"tool-pre result"},As=["src","onClick"],Bs=["href"],Ls={class:"tool-file-name"},Es={class:"tool-file-size"},Js={key:2,class:"msg-bubble assistant"},zs={key:0,class:"typing-dots"},Ps=["innerHTML"],qs={key:2,class:"blink"},Hs=["src"],Ks={class:"chat-input-area"},Vs={key:0,class:"attachments-bar"},Ws=["src"],Gs=["onClick"],Xs={class:"attach-file-icon"},Ys={class:"attach-file-name"},Qs={class:"attach-file-size"},Zs=["onClick"],en={class:"input-row"},tn={class:"textarea-wrap"},sn=["placeholder","disabled","onKeydown"],nn={class:"input-actions"},an={class:"icon-btn",title:"é™„åŠ æ–‡ä»¶ï¼ˆå›¾ç‰‡/ä»£ç /æ–‡æœ¬ï¼‰"},ln=["disabled"],on={key:0,class:"spinner"},rn={key:1},un=Ge({__name:"AiChat",props:{agentId:{},sessionId:{},context:{},scenario:{},skillId:{},placeholder:{},welcomeMessage:{},examples:{default:()=>[]},showThinking:{type:Boolean,default:!1},compact:{type:Boolean,default:!1},bgColor:{},height:{},initialMessages:{},applyable:{type:Boolean,default:!1}},emits:["message","response","apply","session-change","streaming-change"],setup(D,{expose:Ce,emit:be}){const x=D,L=be,g=C(x.initialMessages?[...x.initialMessages]:[]),E=C(""),U=C([]),R=C([]),_=C(!1);Xe(_,s=>L("streaming-change",s));const b=C(""),M=C(""),w=C([]),H=st(new Map),A=C([]);let S=null;const oe=ye(()=>{let s=0;for(const e of g.value)for(const n of e.toolCalls??[])n.taskId&&n.taskStatus&&!["done","error","killed"].includes(n.taskStatus)&&s++;return s+=A.value.filter(e=>!["done","error","killed"].includes(e.status)).length,s}),K=C(!1);let V=0;const G=C(null),X=C(""),k=C(x.sessionId),J=C(!1),Y=C(),O=C(),we=ye(()=>({height:x.height??"100%","--bg":x.bgColor??"transparent"}));function ie(){S||(S=setInterval(Se,3e3))}async function Se(){if(H.size===0&&A.value.every(c=>["done","error","killed"].includes(c.status))){S&&(clearInterval(S),S=null);return}const e=[];let n=!1;for(const[c,u]of H)try{const t=(await le.get(u)).data;for(const r of g.value){const i=r.toolCalls?.find(v=>v.id===c);if(i){const v=!["done","error","killed"].includes(i.taskStatus??"");i.taskStatus=t.status,["done","error","killed"].includes(t.status)&&(e.push(c),v&&(n=!0))}}}catch{e.push(c),n=!0}for(const c of e)H.delete(c);let d=!1;for(const c of A.value)if(!["done","error","killed"].includes(c.status))try{const u=await le.get(c.id),p=c.status;c.status=u.data.status,["done","error","killed"].includes(c.status)&&p!==c.status&&(d=!0)}catch{c.status="error",d=!0}if(!(H.size>0||A.value.some(c=>!["done","error","killed"].includes(c.status)))&&S&&(clearInterval(S),S=null),(d||n)&&k.value&&!_.value){const c=k.value;setTimeout(async()=>{if(!_.value&&k.value===c)try{const u=await te.get(x.agentId,c);if(_.value||k.value!==c)return;const p=u.data.messages??[],t=[];p.some(r=>r.isCompact||r.role==="compaction")&&t.push({role:"system",text:"æ›´æ—©çš„å†…å®¹å·²å‹ç¼©"});for(const r of p)r.role!=="compaction"&&t.push({role:r.role,text:r.text,toolCalls:r.toolCalls?.map(i=>({id:i.id,name:i.name,input:i.input,result:i.result,status:"done",_expanded:!1,...z(i.result??"")}))});g.value=t,y()}catch{}},1500)}}_e(()=>{S&&(clearInterval(S),S=null)});async function Te(s){try{const n=(await le.list({sessionId:s})).data,d=n.filter(c=>!["done","error","killed"].includes(c.status));if(n.filter(c=>["done","error","killed"].includes(c.status)).length>0&&setTimeout(async()=>{if(!_.value&&k.value===s)try{const c=await te.get(x.agentId,s);if(_.value||k.value!==s)return;const u=c.data.messages??[],p=[];u.some(t=>t.isCompact||t.role==="compaction")&&p.push({role:"system",text:"æ›´æ—©çš„å†…å®¹å·²å‹ç¼©"});for(const t of u)t.role!=="compaction"&&p.push({role:t.role,text:t.text,toolCalls:t.toolCalls?.map(r=>({id:r.id,name:r.name,input:r.input,result:r.result,status:"done",_expanded:!1,...z(r.result??"")}))});g.value=p,y()}catch{}},500),d.length===0)return;A.value=d.map(c=>({id:c.id,label:c.label||c.id.slice(0,8),status:c.status})),ie()}catch{}}function y(){W(()=>{Y.value&&(Y.value.scrollTop=Y.value.scrollHeight)})}function $e(){O.value&&(O.value.style.height="auto",O.value.style.height=Math.min(O.value.scrollHeight,160)+"px")}function Q(s){E.value=s,W(()=>O.value?.focus())}function re(s){try{return JSON.stringify(JSON.parse(s),null,2)}catch{return s}}function Ie(s){navigator.clipboard?.writeText(s);const e=g.value.findIndex(n=>n.text===s);G.value=e,setTimeout(()=>{G.value=null},1500)}function De(s){for(let e=s-1;e>=0;e--){const n=g.value[e];if(n&&n.role==="user"){const d=n.text,h=n.images??[];g.value.splice(e,g.value.length-e),ae(d,h);return}}}function se(s){X.value=s}function z(s){const e={};if(!s)return e;const n=s.match(/\[media:([^\]]+)\]/);if(n&&n[1]){const h=localStorage.getItem("aipanel_token")??"";e.mediaUrl=`/api/media?path=${encodeURIComponent(n[1])}&token=${encodeURIComponent(h)}`}const d=s.match(/\[file_card:([^|]+)\|([^|]+)\|([^\]]+)\]/);return d&&d[1]&&d[2]&&d[3]&&(e.fileCard={url:d[1],name:d[2],size:d[3]}),e}function ue(s){return s?s.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/```(\w*)\n([\s\S]*?)```/g,(n,d,h)=>`<pre class="code-block${d?" lang-"+d:""}"><code>${h}</code></pre>`).replace(/`([^`]+)`/g,'<code class="inline-code">$1</code>').replace(/\*\*(.+?)\*\*/g,"<strong>$1</strong>").replace(/\*(.+?)\*/g,"<em>$1</em>").replace(/\[(.+?)\]\((https?:\/\/[^\)]+)\)/g,'<a href="$2" target="_blank" rel="noopener">$1</a>').replace(/^### (.+)$/gm,"<h3>$1</h3>").replace(/^## (.+)$/gm,"<h2>$1</h2>").replace(/^# (.+)$/gm,"<h1>$1</h1>").replace(/^[-*] (.+)$/gm,"<li>$1</li>").replace(/^\d+\. (.+)$/gm,"<li>$1</li>").replace(/(<li>[\s\S]+?<\/li>)(\n(?!<li>)|$)/g,"<ul>$1</ul>$2").replace(/([^>])\n([^<])/g,"$1<br>$2"):""}function Me(s){const e=s.split(`
`),n=[],d=/^([ğŸ™ğŸ˜„ğŸŒğŸ›ğŸ“šğŸ¨ğŸ’¼ğŸ¤–âš½ğŸ¯âœ…âŒğŸ”¥ğŸ’¡ğŸğŸš€ğŸŒŸğŸ’ğŸªğŸ­ğŸ¬ğŸ¤]|[\u{1F300}-\u{1FFFF}]|[\u{2600}-\u{27BF}])\s+(.{4,40})/u;for(const h of e){const c=h.replace(/^[-*â€¢]\s*/,"").trim();if(c.match(d)){const p=c.replace(/[ï¼š:ã€‚ï¼Œ,]$/,"").trim();p.length>=5&&n.push(p)}}return n.slice(0,5)}function je(s){return s?/\{[\s\S]{30,}\}/.test(s)&&(s.includes('"name"')||s.includes('"identity"')||s.includes('"soul"')||s.includes('"IDENTITY"')||s.includes('"SOUL"')):!1}function Ne(s){const e=de(s.text);e?(g.value.forEach(n=>{n!==s&&n.applyData&&delete n.applyData}),s.applyData=e,W(()=>L("apply",e))):alert("æœªèƒ½ä»æ¶ˆæ¯ä¸­æå–åˆ°é…ç½® JSONï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶")}function ce(s,e=0){const n=s.indexOf("{",e);if(n===-1)return null;let d=0,h=!1,c=!1;for(let u=n;u<s.length;u++){const p=s[u];if(c){c=!1;continue}if(p==="\\"&&h){c=!0;continue}if(p==='"'){h=!h;continue}if(!h){if(p==="{")d++;else if(p==="}"&&(d--,d===0))return{raw:s.slice(n,u+1),end:u+1}}}return null}function de(s){const e=/```(?:json)?\s*\n?([\s\S]*?)```/g,n=[];let d;for(;(d=e.exec(s))!==null;){const u=(d[1]??"").trim();u.startsWith("{")&&n.push(u)}for(let u=n.length-1;u>=0;u--){const p=n[u],t=ce(p);if(!t)continue;const r=Z(t.raw)??Z(pe(t.raw));if(r)return r}const h=[];let c=0;for(;c<s.length;){const u=ce(s,c);if(!u)break;h.push(u.raw),c=u.end}for(let u=h.length-1;u>=0;u--){const p=h[u],t=Z(p)??Z(pe(p));if(t)return t}return null}function Z(s){try{const e=JSON.parse(s);if(e&&typeof e=="object"&&!Array.isArray(e)){const n=["name","id","description","identity","soul","IDENTITY","SOUL","NAME","DESCRIPTION"];if(Object.keys(e).some(d=>n.includes(d)))return e}}catch{}return null}function pe(s){let e="",n=!1,d=!1;for(let h=0;h<s.length;h++){const c=s[h];if(d){e+=c,d=!1;continue}if(c==="\\"&&n){e+=c,d=!0;continue}if(c==='"'){n=!n,e+=c;continue}if(n&&c===`
`){e+="\\n";continue}if(n&&c==="\r"){e+="\\r";continue}e+=c}return e}const Oe={exec:"âš¡",bash:"âš¡",read:"ğŸ“–",write:"âœï¸",edit:"âœï¸",web_search:"ğŸŒ",web_fetch:"ğŸŒ",browser:"ğŸŒ",agent_spawn:"ğŸš€",agent_tasks:"ğŸ“‹",agent_kill:"ğŸ›‘",agent_result:"ğŸ“Š",project_read:"ğŸ“",project_write:"ğŸ“",project_list:"ğŸ“",project_create:"ğŸ“",project_glob:"ğŸ“",memory_search:"ğŸ§ ",memory_get:"ğŸ§ ",image:"ğŸ–¼ï¸",tts:"ğŸ”Š",show_image:"ğŸ–¼ï¸",cron:"â±ï¸"};function fe(s){return Oe[s]??"âš™ï¸"}function he(s,e){try{const n=JSON.parse(e);if(s==="exec"||s==="bash")return(n.command??"").slice(0,60);if(s==="read")return n.file_path??n.path??"";if(s==="write")return(n.file_path??n.path??"")+(n.content?` (${n.content.length}B)`:"");if(s==="edit")return n.file_path??n.path??"";if(s==="web_search")return n.query??"";if(s==="web_fetch")return n.url??"";if(s==="agent_spawn")return`â†’ ${n.agentId}: ${(n.task??"").slice(0,40)}`;if(s==="project_read"||s==="project_write")return n.path??"";if(s==="memory_search")return n.query??"";if(s==="show_image")return(n.path??"").split("/").pop()??""}catch{}return""}const Fe=new Set(["txt","md","markdown","js","ts","jsx","tsx","vue","go","py","rs","java","kt","swift","html","css","scss","less","json","yaml","yml","toml","ini","cfg","env","sh","bash","zsh","fish","ps1","bat","cmd","dockerfile","makefile","sql","graphql","proto","xml","svg","gitignore","gitattributes"]);function ve(s){const e=s.split(".").pop()?.toLowerCase()??"";return Fe.has(e)}function Ue(s){const e=s.split(".").pop()?.toLowerCase()??"";return{js:"ğŸŸ¨",ts:"ğŸ”µ",vue:"ğŸ’š",go:"ğŸ¹",py:"ğŸ",rs:"ğŸ¦€",html:"ğŸŒ",css:"ğŸ¨",json:"ğŸ“‹",md:"ğŸ“",sh:"âš¡",sql:"ğŸ—„ï¸",yaml:"âš™ï¸",yml:"âš™ï¸",dockerfile:"ğŸ³"}[e]??"ğŸ“„"}function Re(s){return s<1024?`${s}B`:s<1024*1024?`${(s/1024).toFixed(1)}KB`:`${(s/1024/1024).toFixed(1)}MB`}function Ae(s){const e=s.clipboardData?.items;if(e){for(const n of Array.from(e))if(n.type.startsWith("image/")){s.preventDefault();const d=n.getAsFile();d&&ne(d)}}}function Be(s){s.preventDefault(),V++,K.value=!0}function Le(s){s.preventDefault(),V--,V<=0&&(V=0,K.value=!1)}function Ee(s){V=0,K.value=!1;const e=s.dataTransfer?.files;if(e)for(const n of Array.from(e))n.type.startsWith("image/")?ne(n):ve(n.name)&&me(n)}function Je(s){const e=s.target.files;if(e){for(const n of Array.from(e))n.type.startsWith("image/")?ne(n):ve(n.name)&&me(n);s.target.value=""}}function me(s){const e=new FileReader;e.onload=()=>{typeof e.result=="string"&&R.value.push({name:s.name,content:e.result})},e.readAsText(s)}function ne(s){const e=new FileReader;e.onload=()=>{typeof e.result=="string"&&U.value.push(e.result)},e.readAsDataURL(s)}function ze(s){U.value.splice(s,1)}function ee(){const s=E.value.trim(),e=[...U.value],n=[...R.value];if(!s&&!e.length&&!n.length||_.value)return;let d=s;if(n.length>0){const h=n.map(c=>{const u=c.name.split(".").pop()??"text";return`

ğŸ“ **${c.name}**
\`\`\`${u}
${c.content}
\`\`\``}).join("");d=s?s+h:h.trimStart()}E.value="",U.value=[],R.value=[],W(()=>{O.value&&(O.value.style.height="auto")}),L("message",d,e),ae(d,e)}function ae(s,e,n=!1){n||(g.value.push({role:"user",text:s,images:e.length?e:void 0}),y()),_.value=!0,b.value="",M.value="",w.value=[];const d={role:"assistant",text:"",toolCalls:[]};g.value.push(d),n&&y();const h=g.value.length-1;let c="",u;if(k.value)u=void 0;else{const t=g.value.slice(0,-1).filter(r=>(r.role==="user"||r.role==="assistant")&&r.text).slice(-20).map(r=>({role:r.role,content:r.text}));u=t.length>0?t:void 0}const p={sessionId:k.value,context:x.context,scenario:x.scenario,skillId:x.skillId,images:e.length?e:void 0,history:u};nt(x.agentId,s,t=>{switch(t.type){case"thinking_delta":M.value+=t.text,y();break;case"text":case"text_delta":b.value+=t.text,y();break;case"tool_call":{const r={id:t.tool_call?.id??String(Date.now()),name:t.tool_call?.name??"tool",input:t.tool_call?.input?JSON.stringify(t.tool_call.input):void 0,status:"running",_startedAt:Date.now(),_expanded:!1};g.value[h].toolCalls.push(r),w.value.push(r),c=r.id,y();break}case"tool_result":{const r=g.value[h].toolCalls?.find(i=>i.id===c);if(r){if(r.result=t.text,r.status="done",r._startedAt){const v=Date.now()-r._startedAt;r.duration=v<1e3?`${v}ms`:`${(v/1e3).toFixed(1)}s`}if(t.text&&Object.assign(r,z(t.text)),r.name==="agent_spawn"&&t.text){const v=t.text.match(/ä»»åŠ¡\s*ID[ï¼š:]\s*([a-f0-9-]{8,})/i);v&&(r.taskId=v[1],r.taskStatus="pending",H.set(c,v[1]),ie())}const i=w.value.find(v=>v.id===c);i&&(i.result=r.result,i.status="done",i.duration=r.duration)}y();break}case"done":case"error":{if(t.type==="done"&&t.sessionId){const v=!k.value;k.value=t.sessionId,v&&L("session-change",t.sessionId)}const r=g.value[h];if(r.text=b.value,r.thinking=M.value||void 0,x.applyable){const v=de(b.value);v&&(g.value.forEach(N=>{N!==r&&N.applyData&&delete N.applyData}),r.applyData=v)}const i=Me(b.value);if(i.length>=2&&(r.options=i),t.type==="error"){r.text=`[é”™è¯¯] ${t.error}`;const v=r.toolCalls?.find(N=>N.status==="running");v&&(v.status="error")}_.value=!1,b.value="",M.value="",w.value=[],L("response",r.text),y();break}}},p)}function Pe(){g.value=[]}function qe(s){g.value.push(s),y()}async function He(s){k.value=s,g.value=[],J.value=!0;const e=s;try{const n=await te.get(x.agentId,s);if(k.value!==e)return;const d=n.data.messages??[],h=[];d.some(u=>u.isCompact||u.role==="compaction")&&h.push({role:"system",text:"æ›´æ—©çš„å†…å®¹å·²å‹ç¼©"});for(const u of d)u.role!=="compaction"&&h.push({role:u.role,text:u.text,toolCalls:u.toolCalls?.map(p=>({id:p.id,name:p.name,input:p.input,result:p.result,status:"done",_expanded:!1}))});g.value=h,y(),Te(s),ge(s)}catch(n){n?.response?.status===404?g.value=[]:(console.error("[AiChat] resumeSession failed",n),g.value=[{role:"system",text:"å†å²åŠ è½½å¤±è´¥ï¼Œç»§ç»­å¯¹è¯ä»å¯æ¥ç»­"}])}finally{J.value=!1}}async function ge(s){if(_.value)return;const e=await at(x.agentId,s);if(k.value!==s||!e.hasWorker)return;if(e.status!=="generating"){const u=async()=>{if(!_.value)try{const p=await te.get(x.agentId,s);if(_.value||k.value!==s)return;const t=p.data.messages??[],r=[];t.some(i=>i.isCompact||i.role==="compaction")&&r.push({role:"system",text:"æ›´æ—©çš„å†…å®¹å·²å‹ç¼©"});for(const i of t)i.role!=="compaction"&&r.push({role:i.role,text:i.text,toolCalls:i.toolCalls?.map(v=>({id:v.id,name:v.name,input:v.input,result:v.result,status:"done",_expanded:!1,...z(v.result??"")}))});g.value=r,y()}catch{}};await u(),setTimeout(async()=>{_.value||k.value===s&&await u()},1e3);return}if(k.value!==s)return;_.value=!0,b.value="",M.value="",w.value=[];const n={role:"assistant",text:"",toolCalls:[]};g.value.push(n);const d=g.value.length-1;y();let h="";const c=lt(x.agentId,s,u=>{switch(u.type){case"idle":g.value.splice(d,1),_.value=!1;break;case"thinking_delta":M.value+=u.text,y();break;case"text":case"text_delta":b.value+=u.text,y();break;case"tool_call":{const p={id:u.tool_call?.id??String(Date.now()),name:u.tool_call?.name??"tool",input:u.tool_call?.input?JSON.stringify(u.tool_call.input):void 0,status:"running",_startedAt:Date.now(),_expanded:!1};g.value[d].toolCalls.push(p),w.value.push(p),h=p.id,y();break}case"tool_result":{const p=g.value[d].toolCalls?.find(t=>t.id===h);if(p){p.result=u.text,p.status="done",u.text&&Object.assign(p,z(u.text));const t=w.value.find(r=>r.id===h);t&&(t.result=p.result,t.status="done",Object.assign(t,z(u.text??"")))}y();break}case"done":case"error":{if(u.type==="done"&&u.sessionId){const t=!k.value;k.value=u.sessionId,t&&L("session-change",u.sessionId)}const p=g.value[d];p.text=b.value,p.thinking=M.value||void 0,u.type==="error"&&(p.text=`[é”™è¯¯] ${u.error}`),_.value=!1,b.value="",M.value="",w.value=[],y();break}}});_e(()=>c.abort())}function Ke(){k.value=void 0,g.value=[]}function Ve(s){Q(s),W(ee)}function We(s){ae(s,[],!0)}return Ce({clearMessages:Pe,appendMessage:qe,sendText:Ve,sendSilent:We,fillInput:Q,messages:g,streaming:_,currentSessionId:k,resumeSession:He,startNewSession:Ke}),Ye(()=>{y(),k.value&&ge(k.value)}),(s,e)=>{const n=q("ChatRound"),d=q("el-icon"),h=q("Check"),c=q("CopyDocument"),u=q("Setting"),p=q("Paperclip");return l(),o("div",{class:F(["ai-chat",{compact:D.compact,"has-bg":D.bgColor,"drag-active":K.value}]),style:Qe(we.value),onDragenter:T(Be,["prevent"]),onDragover:e[8]||(e[8]=T(()=>{},["prevent"])),onDragleave:Le,onDrop:T(Ee,["prevent","stop"])},[$(Ze,{name:"drag-fade"},{default:B(()=>[K.value?(l(),o("div",it,[...e[9]||(e[9]=[a("div",{class:"drag-overlay-content"},[a("div",{class:"drag-overlay-icon"},"ğŸ“"),a("div",{class:"drag-overlay-title"},"æ¾å¼€ä»¥é™„åŠ æ–‡ä»¶"),a("div",{class:"drag-overlay-hint"},"æ”¯æŒå›¾ç‰‡ Â· ä»£ç  Â· æ–‡æœ¬æ–‡ä»¶")],-1)])])):f("",!0)]),_:1}),oe.value>0?(l(),o("div",rt,[e[10]||(e[10]=a("span",{class:"running-dot"},null,-1)),a("span",null,"åå°æœ‰ "+m(oe.value)+" ä¸ªä»»åŠ¡æ­£åœ¨æ‰§è¡Œä¸­ï¼Œå…³é—­çª—å£åä»ä¼šç»§ç»­è¿è¡Œ",1),A.value.length?(l(),o("span",ut,[(l(!0),o(I,null,j(A.value.filter(t=>!["done","error","killed"].includes(t.status)),t=>(l(),o("span",{key:t.id,class:F(["resumed-chip",t.status])},m(t.status==="running"?"âŸ³":"ğŸŸ¡")+" "+m(t.label),3))),128))])):f("",!0)])):f("",!0),a("div",{class:"chat-messages",ref_key:"msgListRef",ref:Y},[J.value?(l(),o("div",ct,[...e[11]||(e[11]=[a("div",{class:"history-loading-dots"},[a("span"),a("span"),a("span")],-1),a("div",{class:"history-loading-text"},"åŠ è½½å†å²å¯¹è¯â€¦",-1)])])):f("",!0),!g.value.length&&!J.value?(l(),o("div",dt,[D.welcomeMessage?(l(),o("div",pt,m(D.welcomeMessage),1)):f("",!0),D.examples.length?(l(),o("div",ft,[(l(!0),o(I,null,j(D.examples,(t,r)=>(l(),o("div",{key:r,class:"example-chip",onClick:i=>Q(t)},m(t),9,ht))),128))])):f("",!0)])):f("",!0),(l(!0),o(I,null,j(_.value?g.value.slice(0,-1):g.value,(t,r)=>(l(),o(I,{key:r},[t.role==="user"?(l(),o("div",vt,[a("div",mt,[t.images?.length?(l(),o("div",gt,[(l(!0),o(I,null,j(t.images,(i,v)=>(l(),o("img",{key:v,src:i,class:"msg-img",onClick:N=>se(i)},null,8,_t))),128))])):f("",!0),a("div",kt,m(t.text),1)])])):t.role==="assistant"?(l(),o("div",yt,[a("div",xt,[t.thinking?(l(),o("details",{key:0,class:"thinking-block",open:D.showThinking},[a("summary",bt,[$(d,{class:"thinking-icon"},{default:B(()=>[$(n)]),_:1}),e[12]||(e[12]=P(" æ€è€ƒè¿‡ç¨‹ ",-1)),a("span",wt,m(t.thinking.length)+" å­—ç¬¦",1)]),a("pre",St,m(t.thinking),1)],8,Ct)):f("",!0),t.toolCalls?.length?(l(),o("div",Tt,[(l(!0),o(I,null,j(t.toolCalls,(i,v)=>(l(),o("div",{key:v,class:F(["tool-step",i.status]),onClick:N=>i._expanded=!i._expanded},[a("div",It,[a("span",{class:F(["tool-step-dot",i.status])},[i.status==="running"?(l(),o("span",Dt,"âŸ³")):i.status==="done"?(l(),o("span",Mt,"âœ“")):i.status==="error"?(l(),o("span",jt,"âœ—")):(l(),o("span",Nt,"â—‹"))],2),a("span",Ot,m(fe(i.name)),1),a("code",Ft,m(i.name),1),i.input?(l(),o("span",Ut,m(he(i.name,i.input)),1)):f("",!0),e[14]||(e[14]=a("span",{class:"tool-step-flex"},null,-1)),i.duration?(l(),o("span",Rt,m(i.duration),1)):f("",!0),i.taskId?(l(),o("span",{key:2,class:F(["task-badge",i.taskStatus])},[i.taskStatus==="pending"?(l(),o("span",At,"ğŸŸ¡ æ’é˜Ÿä¸­")):i.taskStatus==="running"?(l(),o("span",Bt,[...e[13]||(e[13]=[a("span",{class:"tool-spin"},"âŸ³",-1),P(" æ‰§è¡Œä¸­ ",-1)])])):i.taskStatus==="done"?(l(),o("span",Lt,"âœ… å®Œæˆ")):i.taskStatus==="error"?(l(),o("span",Et,"âŒ å¤±è´¥")):i.taskStatus==="killed"?(l(),o("span",Jt,"ğŸ›‘ å·²ç»ˆæ­¢")):f("",!0)],2)):f("",!0),a("span",zt,m(i._expanded?"â–²":"â–¼"),1)]),i._expanded?(l(),o("div",{key:0,class:"tool-step-body",onClick:e[0]||(e[0]=T(()=>{},["stop"]))},[i.input?(l(),o("div",Pt,[e[15]||(e[15]=a("div",{class:"tool-label"},"INPUT",-1)),a("pre",qt,m(re(i.input)),1)])):f("",!0),i.result?(l(),o("div",Ht,[e[16]||(e[16]=a("div",{class:"tool-label"},"OUTPUT",-1)),a("pre",Kt,m(i.result.slice(0,3e3))+m(i.result.length>3e3?`
â€¦ (æˆªæ–­)`:""),1)])):f("",!0)])):f("",!0),i.mediaUrl?(l(),o("div",{key:1,class:"tool-media-preview",onClick:e[1]||(e[1]=T(()=>{},["stop"]))},[a("img",{src:i.mediaUrl,class:"tool-media-img",onClick:N=>se(i.mediaUrl)},null,8,Vt)])):f("",!0),i.fileCard?(l(),o("div",{key:2,class:"tool-file-card",onClick:e[2]||(e[2]=T(()=>{},["stop"]))},[a("a",{href:i.fileCard.url,target:"_blank",download:"",class:"tool-file-link"},[e[17]||(e[17]=a("span",{class:"tool-file-icon"},"ğŸ“",-1)),a("span",Gt,m(i.fileCard.name),1),a("span",Xt,m(i.fileCard.size),1),e[18]||(e[18]=a("span",{class:"tool-file-dl"},"â†“ ä¸‹è½½",-1))],8,Wt)])):f("",!0)],10,$t))),128))])):f("",!0),a("div",Yt,[t.text?(l(),o("div",{key:0,class:"msg-text",innerHTML:ue(t.text)},null,8,Qt)):f("",!0),t.applyData&&x.applyable?(l(),o("div",Zt,[a("div",es,[(l(!0),o(I,null,j(t.applyData,(i,v)=>(l(),o("div",{key:v,class:"apply-row"},[a("span",ts,m(v),1),a("span",ss,m(String(i).slice(0,60))+m(String(i).length>60?"â€¦":""),1)]))),128))]),a("button",{class:"apply-btn",onClick:i=>s.$emit("apply",t.applyData)}," åº”ç”¨åˆ°è¡¨å• â†™ ",8,ns)])):f("",!0),a("div",as,[a("button",{class:"act-btn",onClick:i=>Ie(t.text),title:G.value===r?"å·²å¤åˆ¶":"å¤åˆ¶"},[G.value===r?(l(),xe(d,{key:0},{default:B(()=>[$(h)]),_:1})):(l(),xe(d,{key:1},{default:B(()=>[$(c)]),_:1}))],8,ls),a("button",{class:"act-btn",onClick:i=>De(r),title:"é‡è¯•"},"â†º",8,os),x.applyable&&!t.applyData&&je(t.text)?(l(),o("button",{key:0,class:"act-btn apply-manual-btn",onClick:i=>Ne(t),title:"æ£€æµ‹åˆ°é…ç½® JSONï¼Œç‚¹å‡»åº”ç”¨"},[$(d,null,{default:B(()=>[$(u)]),_:1}),e[19]||(e[19]=P(" åº”ç”¨é…ç½® ",-1))],8,is)):f("",!0)])]),t.options&&t.options.length?(l(),o("div",rs,[(l(!0),o(I,null,j(t.options,(i,v)=>(l(),o("button",{key:v,class:"option-chip",onClick:N=>Q(i)},m(i),9,us))),128))])):f("",!0)])])):t.role==="system"?(l(),o("div",cs,[a("div",ds,m(t.text),1)])):f("",!0)],64))),128)),_.value?(l(),o("div",ps,[a("div",fs,[M.value&&D.showThinking?(l(),o("details",hs,[a("summary",vs,[$(d,{class:"thinking-icon"},{default:B(()=>[$(n)]),_:1}),e[20]||(e[20]=P(" æ€è€ƒä¸­â€¦ ",-1))]),a("pre",ms,[P(m(M.value),1),e[21]||(e[21]=a("span",{class:"blink"},"â–Š",-1))])])):f("",!0),w.value.length?(l(),o("div",gs,[(l(!0),o(I,null,j(w.value,(t,r)=>(l(),o("div",{key:r,class:F(["tool-step",t.status]),onClick:i=>t._expanded=!t._expanded},[a("div",ks,[a("span",{class:F(["tool-step-dot",t.status])},[t.status==="running"?(l(),o("span",ys,"âŸ³")):t.status==="done"?(l(),o("span",xs,"âœ“")):t.status==="error"?(l(),o("span",Cs,"âœ—")):f("",!0)],2),a("span",bs,m(fe(t.name)),1),a("code",ws,m(t.name),1),t.input?(l(),o("span",Ss,m(he(t.name,t.input)),1)):f("",!0),e[23]||(e[23]=a("span",{class:"tool-step-flex"},null,-1)),t.duration?(l(),o("span",Ts,m(t.duration),1)):f("",!0),t.taskId?(l(),o("span",{key:2,class:F(["task-badge",t.taskStatus])},[t.taskStatus==="pending"?(l(),o("span",$s,"ğŸŸ¡ æ’é˜Ÿä¸­")):t.taskStatus==="running"?(l(),o("span",Is,[...e[22]||(e[22]=[a("span",{class:"tool-spin"},"âŸ³",-1),P(" æ‰§è¡Œä¸­",-1)])])):t.taskStatus==="done"?(l(),o("span",Ds,"âœ… å®Œæˆ")):t.taskStatus==="error"?(l(),o("span",Ms,"âŒ å¤±è´¥")):t.taskStatus==="killed"?(l(),o("span",js,"ğŸ›‘ å·²ç»ˆæ­¢")):f("",!0)],2)):f("",!0),a("span",Ns,m(t._expanded?"â–²":"â–¼"),1)]),t._expanded?(l(),o("div",{key:0,class:"tool-step-body",onClick:e[3]||(e[3]=T(()=>{},["stop"]))},[t.input?(l(),o("div",Os,[e[24]||(e[24]=a("div",{class:"tool-label"},"INPUT",-1)),a("pre",Fs,m(re(t.input)),1)])):f("",!0),t.result?(l(),o("div",Us,[e[25]||(e[25]=a("div",{class:"tool-label"},"OUTPUT",-1)),a("pre",Rs,m(t.result.slice(0,3e3)),1)])):f("",!0)])):f("",!0),t.mediaUrl?(l(),o("div",{key:1,class:"tool-media-preview",onClick:e[4]||(e[4]=T(()=>{},["stop"]))},[a("img",{src:t.mediaUrl,class:"tool-media-img",onClick:i=>se(t.mediaUrl)},null,8,As)])):f("",!0),t.fileCard?(l(),o("div",{key:2,class:"tool-file-card",onClick:e[5]||(e[5]=T(()=>{},["stop"]))},[a("a",{href:t.fileCard.url,target:"_blank",download:"",class:"tool-file-link"},[e[26]||(e[26]=a("span",{class:"tool-file-icon"},"ğŸ“",-1)),a("span",Ls,m(t.fileCard.name),1),a("span",Es,m(t.fileCard.size),1),e[27]||(e[27]=a("span",{class:"tool-file-dl"},"â†“ ä¸‹è½½",-1))],8,Bs)])):f("",!0)],10,_s))),128))])):f("",!0),b.value||!w.value.length?(l(),o("div",Js,[!b.value&&!w.value.length?(l(),o("div",zs,[...e[28]||(e[28]=[a("span",null,null,-1),a("span",null,null,-1),a("span",null,null,-1)])])):f("",!0),b.value?(l(),o("div",{key:1,class:"msg-text",innerHTML:ue(b.value)},null,8,Ps)):f("",!0),b.value?(l(),o("span",qs,"â–Š")):f("",!0)])):f("",!0)])])):f("",!0)],512),X.value?(l(),o("div",{key:1,class:"img-preview-mask",onClick:e[6]||(e[6]=t=>X.value="")},[a("img",{src:X.value,class:"img-preview-full"},null,8,Hs)])):f("",!0),a("div",Ks,[U.value.length||R.value.length?(l(),o("div",Vs,[(l(!0),o(I,null,j(U.value,(t,r)=>(l(),o("div",{key:"img-"+r,class:"attach-thumb"},[a("img",{src:t},null,8,Ws),a("button",{class:"remove-attach",onClick:i=>ze(r)},"Ã—",8,Gs)]))),128)),(l(!0),o(I,null,j(R.value,(t,r)=>(l(),o("div",{key:"file-"+r,class:"attach-file-chip"},[a("span",Xs,m(Ue(t.name)),1),a("span",Ys,m(t.name),1),a("span",Qs,m(Re(t.content.length)),1),a("button",{class:"attach-file-remove",onClick:i=>R.value.splice(r,1)},"Ã—",8,Zs)]))),128))])):f("",!0),a("div",en,[a("div",tn,[et(a("textarea",{ref_key:"inputRef",ref:O,"onUpdate:modelValue":e[7]||(e[7]=t=>E.value=t),placeholder:D.placeholder||"è¾“å…¥æ¶ˆæ¯â€¦ æ”¯æŒæ‹–æ‹½å›¾ç‰‡æˆ–æ–‡ä»¶ (Ctrl+Enter å‘é€)",disabled:_.value||J.value,rows:"1",class:"chat-textarea",onKeydown:[ke(T(ee,["ctrl","prevent"]),["enter"]),ke(T(ee,["meta","prevent"]),["enter"])],onPaste:Ae,onInput:$e},null,40,sn),[[tt,E.value]])]),a("div",nn,[a("label",an,[$(d,null,{default:B(()=>[$(p)]),_:1}),a("input",{type:"file",multiple:"",hidden:"",onChange:Je},null,32)]),a("button",{class:"send-btn",disabled:_.value||J.value||!E.value.trim()&&!U.value.length&&!R.value.length,onClick:ee},[_.value?(l(),o("span",on)):(l(),o("span",rn,"â†‘"))],8,ln)])]),e[29]||(e[29]=a("div",{class:"input-hint"},"Ctrl+Enter å‘é€ Â· æ”¯æŒæ‹–æ‹½å›¾ç‰‡/æ–‡ä»¶",-1))])],38)}}}),fn=ot(un,[["__scopeId","data-v-de8c2ce2"]]);export{fn as A};
