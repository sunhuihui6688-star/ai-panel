import{d as Fl,D as wl,i as Zl,o as u,c as m,b as s,a as e,w as t,k as C,F as M,m as J,s as Ye,t as v,j as $,h as d,f as al,n as We,p as Ee,G as Al,v as Gt,l as D,e as r,z as sl,E as y,H as Dl,r as _,I as Qt,g as nl,x as Ql,J as Oe,K as Zt,A as ea,B as Ll,L as la,M as Gl,N as ta,O as aa,P as na,Q as sa}from"./index-BH3wezV0.js";import{h as pl,f as te,b as yl,m as oa,i as gl,j as _l,k as ia,g as Ul,r as ft,e as fe,l as pt}from"./index-BpGprwnc.js";import{A as et}from"./AiChat-B1kMe4I-.js";import{_ as lt}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ua={class:"skill-studio"},da={class:"studio-sidebar"},ra={class:"sidebar-top"},ca={class:"sidebar-acts"},va={class:"skill-list"},ma={key:0,class:"list-empty"},fa=["onClick"],pa={class:"sk-icon"},ya={key:0},ga={class:"sk-info"},_a={class:"sk-name"},wa={class:"sk-id"},ba={class:"sk-right"},ka={key:0,class:"sk-streaming-dot",title:"AI ç”Ÿæˆä¸­â€¦"},ha={class:"studio-editor"},xa={key:0,class:"editor-empty"},Ca={class:"editor-toolbar"},$a={class:"editor-breadcrumb"},Va={class:"crumb-name"},za={class:"toolbar-acts"},Ta={class:"editor-body"},Sa={class:"file-tree"},Ia={class:"tree-title"},La={class:"tree-item tree-dir"},Ua=["onClick"],Fa={key:0,class:"tree-empty"},Aa={key:0,class:"file-editor"},Da={class:"file-editor-head"},Ma={style:{display:"flex","align-items":"center",gap:"10px"}},Na={style:{"font-size":"12px",color:"#909399"}},Ea={class:"json-preview"},Ba={key:1,class:"file-editor"},Ra={class:"file-editor-head"},Pa={style:{"margin-left":"auto",display:"flex","align-items":"center",gap:"8px"}},Ka={style:{"font-size":"11px",color:"#c0c4cc"}},ja={key:2,class:"file-editor"},Oa={class:"file-editor-head"},Wa={style:{"margin-left":"auto",display:"flex","align-items":"center",gap:"8px"}},Ya={style:{"font-size":"11px",color:"#c0c4cc"}},Ha=["placeholder"],qa={class:"studio-chat"},Ja={class:"chat-panel-head"},Xa={key:0,style:{"margin-left":"auto","font-size":"11px",color:"#c0c4cc"}},Ga={key:0,style:{"margin-left":"6px",color:"#e6a23c"}},Qa={class:"chat-wrap"},Za=Fl({__name:"SkillStudio",props:{agentId:{}},setup(He){const pe=He,g=pe.agentId,I=r([]),ae=r(!1),f=r(null),x=r("meta"),T=r({name:"",icon:"",category:"",description:"",version:"1.0.0",enabled:!0}),F=r(""),ye=r(!1),S=r(!1),X=r(!1),G=r(!1),ne=r(!1),Q=r([]),W=r(!1),R=r(""),se=r(!1),Y=r(!1),Ie={};function qe(o,i){i?Ie[o]=i:delete Ie[o]}function ge(o){return o?Ie[o]:null}const ue=r(new Set);function de(o,i){const V=new Set(ue.value);i?V.add(o):V.delete(o),ue.value=V}const ce=r(new Set);wl(f,async o=>{o&&(ce.value.has(o.id)||(ce.value.add(o.id),await Dl(),await ge(o.id)?.resumeSession?.(`skill-studio-${o.id}`)))},{flush:"post"});const Be=sl(()=>{if(!f.value)return"ä½ æ˜¯ä¸€ä¸ªæŠ€èƒ½é…ç½®åŠ©æ‰‹ï¼Œå¸®åŠ©ç”¨æˆ·è®¾è®¡å’Œä¼˜åŒ– AI æŠ€èƒ½çš„ç³»ç»Ÿæç¤ºè¯ã€‚";const o=JSON.stringify({id:f.value.id,name:f.value.name,icon:f.value.icon||"",category:f.value.category||"",description:f.value.description||"",version:f.value.version||"1.0.0",enabled:f.value.enabled,source:"local",installedAt:""},null,2);return`ä½ æ˜¯ä¸€ä¸ªæŠ€èƒ½é…ç½®åŠ©æ‰‹ï¼Œæ­£åœ¨å¸®åŠ©ç”¨æˆ·é…ç½®æŠ€èƒ½ï¼ˆID: ${f.value.id}ï¼‰ã€‚

## âš ï¸ æ–‡ä»¶è·¯å¾„è§„åˆ™ï¼ˆå¿…é¡»éµå®ˆï¼‰
æ‰€æœ‰æ–‡ä»¶å¿…é¡»åœ¨ skills/${f.value.id}/ ç›®å½•ä¸‹ï¼š
- âœ… skills/${f.value.id}/SKILL.md
- âœ… skills/${f.value.id}/skill.json
- âœ… skills/${f.value.id}/tools/helper.py
- âŒ ä»»ä½•å…¶ä»–è·¯å¾„

## âš ï¸ åˆ›å»ºæˆ–æ›´æ–°æŠ€èƒ½æ—¶ï¼Œå¿…é¡»åŒæ—¶å†™ä¸¤ä¸ªæ–‡ä»¶

### 1. skills/${f.value.id}/skill.jsonï¼ˆæŠ€èƒ½å…ƒæ•°æ®ï¼‰
æ ¼å¼å¦‚ä¸‹ï¼Œä¿®æ”¹ name/icon/category/description å­—æ®µï¼š
\`\`\`json
${o}
\`\`\`

### 2. skills/${f.value.id}/SKILL.mdï¼ˆç³»ç»Ÿæç¤ºè¯ï¼‰
å½“å‰å†…å®¹ï¼š
\`\`\`markdown
${F.value||"ï¼ˆç©ºï¼‰"}
\`\`\`

## ä½ å¯ä»¥å¸®åŠ©ï¼š
- åˆ›å»º/ä¼˜åŒ–æŠ€èƒ½ï¼šåŒæ—¶å†™ skill.jsonï¼ˆåç§°ã€åˆ†ç±»ã€æè¿°ï¼‰å’Œ SKILL.mdï¼ˆæç¤ºè¯ï¼‰
- åœ¨æŠ€èƒ½ç›®å½•ä¸‹åˆ›å»ºå·¥å…·æ–‡ä»¶ï¼ˆPython ç­‰ï¼‰
- æµ‹è¯•æŠ€èƒ½æ•ˆæœï¼ˆç›´æ¥å¯¹è¯å³å¯æµ‹è¯•ï¼‰`}),oe=sl(()=>f.value?ne.value?`æ–°æŠ€èƒ½å·²åˆ›å»ºï¼ˆID: ${f.value.id}ï¼‰ã€‚å‘Šè¯‰æˆ‘ä½ æƒ³è¦ä»€ä¹ˆåŠŸèƒ½ï¼Œæˆ‘æ¥å¸®ä½ ç”Ÿæˆå®Œæ•´çš„ SKILL.md å†…å®¹ï¼Œç”Ÿæˆåç›´æ¥ç‚¹ä¿å­˜å³å¯ã€‚`:`å½“å‰ç¼–è¾‘ã€Œ${f.value.name}ã€ã€‚ä½ å¯ä»¥è®©æˆ‘ä¼˜åŒ– SKILL.mdã€æµ‹è¯•æ•ˆæœï¼Œæˆ–è€…ç›´æ¥å¯¹è¯ä½“éªŒå½“å‰æŠ€èƒ½ã€‚`:"é€‰æ‹©ä¸€ä¸ªæŠ€èƒ½åï¼Œæˆ‘å¯ä»¥å¸®ä½ ä¼˜åŒ–é…ç½®ã€å†™ SKILL.mdã€æµ‹è¯•æ•ˆæœã€‚"),_e=sl(()=>f.value?ne.value?[]:[`å¸®æˆ‘ä¼˜åŒ–ã€Œ${f.value.name}ã€çš„ SKILL.md`,"è¿™ä¸ªæŠ€èƒ½æ€ä¹ˆå†™æ•ˆæœæ›´å¥½ï¼Ÿ","ç”¨ä¸­æ–‡å›ç­”ä¸€é“å†å²é¢˜ï¼Œæµ‹è¯•å½“å‰æŠ€èƒ½æ•ˆæœ"]:["å¸®æˆ‘è®¾è®¡ä¸€ä¸ªä»£ç å®¡æŸ¥æŠ€èƒ½","å¸®æˆ‘å†™ä¸€ä¸ªç¿»è¯‘åŠ©æ‰‹çš„ SKILL.md"]);async function N(){ae.value=!0;try{const o=await pl.list(g);if(I.value=o.data||[],f.value){const i=I.value.find(V=>V.id===f.value.id);i&&(f.value=i,re(i))}}catch{}finally{ae.value=!1}}function re(o){T.value={name:o.name,icon:o.icon||"",category:o.category||"",description:o.description||"",version:o.version||"1.0.0",enabled:o.enabled}}async function ve(o){f.value?.id!==o.id&&(f.value=o,re(o),x.value="meta",S.value=!1,F.value="",ne.value=!1,be(),me())}async function we(){f.value&&x.value!=="prompt"&&(x.value="prompt",F.value||await me())}async function Le(o,i,V){const h=await te.read(g,o),j=Array.isArray(h.data)?h.data:[],ke=[];for(const Z of j){if(V===0&&Z.name==="skill.json")continue;const ie=i?`${i}/${Z.name}`:Z.name;if(ke.push({name:Z.name,path:ie,isDir:Z.isDir,depth:V}),Z.isDir){const he=await Le(`skills/${f.value.id}/${ie}`,ie,V+1);ke.push(...he)}}return ke}async function be(){if(f.value){W.value=!0;try{Q.value=await Le(`skills/${f.value.id}/`,"",0)}catch{Q.value=[{name:"SKILL.md",path:"SKILL.md",isDir:!1,depth:0}]}finally{W.value=!1}}}async function Je(o,i){if(!i){if(o==="SKILL.md"){await we();return}x.value=o,se.value=!1,await Re()}}async function Re(){if(!(!f.value||!x.value||x.value==="meta"||x.value==="prompt")){Y.value=!0;try{const o=await te.read(g,`skills/${f.value.id}/${x.value}`);R.value=o.data?.content||"",se.value=!1}catch{R.value=""}finally{Y.value=!1}}}async function P(o){if(f.value)try{await te.delete(g,`skills/${f.value.id}/${o}`),x.value===o&&(x.value="prompt"),await be(),y.success("å·²åˆ é™¤")}catch{y.error("åˆ é™¤å¤±è´¥")}}async function Ue(){if(f.value){X.value=!0;try{x.value==="meta"||x.value==="prompt"?(await pl.update(pe.agentId,f.value.id,{name:T.value.name,icon:T.value.icon,category:T.value.category,description:T.value.description,enabled:T.value.enabled}),(x.value==="prompt"||F.value)&&(await te.write(g,`skills/${f.value.id}/SKILL.md`,F.value),S.value=!1),await N()):(await te.write(g,`skills/${f.value.id}/${x.value}`,R.value),se.value=!1),y.success("ä¿å­˜æˆåŠŸ")}catch(o){y.error(o.response?.data?.error||"ä¿å­˜å¤±è´¥")}finally{X.value=!1}}}async function Fe(o,i){try{await pl.update(pe.agentId,o.id,{enabled:i}),await N()}catch{y.error("æ“ä½œå¤±è´¥")}}async function ol(){if(f.value)try{await pl.remove(pe.agentId,f.value.id),y.success("å·²åˆ é™¤"),f.value=null,await N()}catch{y.error("åˆ é™¤å¤±è´¥")}}async function Ae(){if(G.value)return;G.value=!0;const o="skill_"+Date.now().toString(36);try{await pl.create(pe.agentId,{meta:{id:o,name:"æ–°æŠ€èƒ½",icon:"",category:"",description:"",version:"1.0.0",enabled:!1,source:"local",installedAt:""},promptContent:""}),await N();const i=I.value.find(V=>V.id===o);if(i){await ve(i),x.value="prompt",F.value="",ne.value=!0,await Dl(),ce.value.has(o)||(ce.value.add(o),await ge(o)?.resumeSession?.(`skill-studio-${o}`));const V=I.value.filter(h=>h.id!==o).map(h=>h.name).join("ã€")||"æš‚æ— ";ge(o)?.sendSilent?.(`ã€çº¯æ–‡å­—è¾“å‡ºï¼Œä¸ä½¿ç”¨ä»»ä½•å·¥å…·ï¼Œä¸åˆ›å»ºä»»ä½•æ–‡ä»¶ã€‘å½“å‰å·²æœ‰æŠ€èƒ½ï¼š${V}ã€‚è¯·æ¨è3ä¸ªå…¨æ–°çš„ã€ä¸å·²æœ‰æŠ€èƒ½ä¸é‡å¤çš„æŠ€èƒ½æ–¹å‘ï¼Œæ¯æ¡ä¸€å¥è¯ï¼Œç›´æ¥åˆ—å‡ºå³å¯ã€‚`)}}catch(i){y.error(i.response?.data?.error||"åˆ›å»ºå¤±è´¥")}finally{G.value=!1}}async function il(o,i){o===f.value?.id&&(ne.value=!1),await N(),o===f.value?.id&&(await Promise.all([be(),me()]),x.value!=="meta"&&x.value!=="prompt"&&await Re())}async function me(){if(f.value){ye.value=!0;try{const o=await te.read(g,`skills/${f.value.id}/SKILL.md`);F.value=o.data?.content||"",S.value=!1}catch{F.value=""}finally{ye.value=!1}}}async function p(){if(!f.value)return;F.value||await we();const o=`è¯·ç”¨ã€Œ${f.value.name}ã€æŠ€èƒ½æ•ˆæœå›å¤ï¼šä½ å¥½ï¼Œè¯·ä»‹ç»ä¸€ä¸‹ä½ çš„åŠŸèƒ½ã€‚`;ge(f.value?.id)?.fillInput?.(o),y.info("æµ‹è¯•æ¶ˆæ¯å·²å¡«å…¥å³ä¾§èŠå¤©æ¡†ï¼Œç‚¹å‡»å‘é€å³å¯æµ‹è¯•")}return Zl(N),(o,i)=>{const V=_("Refresh"),h=_("el-icon"),j=_("el-button"),ke=_("Plus"),Z=_("Tools"),ie=_("el-tag"),he=_("el-switch"),Xe=_("Setting"),ee=_("FolderOpened"),ul=_("VideoPlay"),K=_("DocumentChecked"),bl=_("Delete"),kl=_("el-popconfirm"),hl=_("Folder"),Pe=_("Document"),De=_("el-input"),xe=_("el-form-item"),Me=_("el-col"),dl=_("el-row"),xl=_("el-collapse-item"),Cl=_("el-collapse"),Ke=_("el-form"),O=_("ChatLineRound");return u(),m("div",ua,[s("div",da,[s("div",ra,[i[13]||(i[13]=s("span",{class:"sidebar-title"},"æŠ€èƒ½åº“",-1)),s("div",ca,[e(j,{size:"small",loading:ae.value,circle:"",onClick:N},{default:t(()=>[e(h,null,{default:t(()=>[e(V)]),_:1})]),_:1},8,["loading"]),e(j,{size:"small",type:"primary",circle:"",loading:G.value,onClick:Ae},{default:t(()=>[e(h,null,{default:t(()=>[e(ke)]),_:1})]),_:1},8,["loading"])])]),s("div",va,[!ae.value&&I.value.length===0?(u(),m("div",ma,"æš‚æ— æŠ€èƒ½")):C("",!0),(u(!0),m(M,null,J(I.value,w=>(u(),m("div",{key:w.id,class:Ye(["skill-item",{active:f.value?.id===w.id}]),onClick:Ce=>ve(w)},[s("span",pa,[w.icon?(u(),m("span",ya,v(w.icon),1)):(u(),$(h,{key:1},{default:t(()=>[e(Z)]),_:1}))]),s("div",ga,[s("div",_a,v(w.name),1),s("div",wa,v(w.id),1)]),s("div",ba,[ue.value.has(w.id)?(u(),m("span",ka)):w.category?(u(),$(ie,{key:1,size:"small",effect:"plain",style:{"margin-right":"6px","font-size":"11px"}},{default:t(()=>[d(v(w.category),1)]),_:2},1024)):C("",!0),e(he,{"model-value":w.enabled,size:"small",onChange:Ce=>Fe(w,Ce),onClick:i[0]||(i[0]=al(()=>{},["stop"]))},null,8,["model-value","onChange"])])],10,fa))),128))])]),s("div",ha,[f.value?(u(),m(M,{key:1},[s("div",Ca,[s("div",$a,[e(h,{style:{color:"#909399"}},{default:t(()=>[e(ee)]),_:1}),i[16]||(i[16]=s("span",{class:"crumb-sep"},"skills /",-1)),s("span",Va,v(f.value.id),1)]),s("div",za,[e(j,{size:"small",onClick:p},{default:t(()=>[e(h,null,{default:t(()=>[e(ul)]),_:1}),i[17]||(i[17]=d(" æµ‹è¯• ",-1))]),_:1}),e(j,{size:"small",type:"primary",loading:X.value,onClick:Ue},{default:t(()=>[e(h,null,{default:t(()=>[e(K)]),_:1}),i[18]||(i[18]=d(" ä¿å­˜ ",-1))]),_:1},8,["loading"]),e(kl,{title:"ç¡®è®¤åˆ é™¤è¯¥æŠ€èƒ½ï¼Ÿ",onConfirm:ol},{reference:t(()=>[e(j,{size:"small",type:"danger",plain:""},{default:t(()=>[e(h,null,{default:t(()=>[e(bl)]),_:1})]),_:1})]),_:1})])]),s("div",Ta,[s("div",Sa,[s("div",Ia,[i[19]||(i[19]=d(" ç›®å½• ",-1)),e(j,{link:"",size:"small",loading:W.value,onClick:be,style:{"margin-left":"auto",padding:"0"}},{default:t(()=>[e(h,null,{default:t(()=>[e(V)]),_:1})]),_:1},8,["loading"])]),s("div",La,[e(h,null,{default:t(()=>[e(hl)]),_:1}),s("span",null,v(f.value.id)+"/",1)]),s("div",{class:Ye(["tree-item",{"tree-active":x.value==="meta"}]),onClick:i[1]||(i[1]=w=>x.value="meta")},[e(h,null,{default:t(()=>[e(Pe)]),_:1}),i[20]||(i[20]=s("span",null,"skill.json",-1))],2),(u(!0),m(M,null,J(Q.value,w=>(u(),m("div",{key:w.path,class:Ye(["tree-item",{"tree-active":x.value===(w.path==="SKILL.md"?"prompt":w.path),"tree-dir-row":w.isDir}]),style:We({paddingLeft:`${12+w.depth*12}px`}),onClick:Ce=>Je(w.path,w.isDir)},[w.isDir?(u(),$(h,{key:0,style:{color:"#e6a23c"}},{default:t(()=>[e(hl)]),_:1})):(u(),$(h,{key:1},{default:t(()=>[e(Pe)]),_:1})),s("span",null,v(w.name),1),w.path==="SKILL.md"&&f.value.enabled?(u(),$(ie,{key:2,size:"small",type:"success",effect:"plain",style:{"margin-left":"4px","font-size":"10px"}},{default:t(()=>[...i[21]||(i[21]=[d("æ³¨å…¥ä¸­",-1)])]),_:1})):C("",!0)],14,Ua))),128)),!W.value&&Q.value.length===0?(u(),m("div",Fa,"ç©ºç›®å½•")):C("",!0)]),x.value==="meta"?(u(),m("div",Aa,[s("div",Da,[e(h,null,{default:t(()=>[e(Pe)]),_:1}),i[22]||(i[22]=d(" skill.json ",-1)),i[23]||(i[23]=s("span",{class:"file-hint"},"æŠ€èƒ½å…ƒä¿¡æ¯ï¼Œå½±å“åˆ—è¡¨å±•ç¤ºå’Œ runner è¡Œä¸º",-1))]),e(Ke,{model:T.value,"label-width":"72px",size:"small",style:{padding:"16px 20px"}},{default:t(()=>[e(xe,{label:"æŠ€èƒ½ ID"},{default:t(()=>[e(De,{value:f.value.id,disabled:""},null,8,["value"])]),_:1}),e(dl,{gutter:12},{default:t(()=>[e(Me,{span:14},{default:t(()=>[e(xe,{label:"åç§°"},{default:t(()=>[e(De,{modelValue:T.value.name,"onUpdate:modelValue":i[2]||(i[2]=w=>T.value.name=w),placeholder:"å¦‚ ç¿»è¯‘åŠ©æ‰‹"},null,8,["modelValue"])]),_:1})]),_:1}),e(Me,{span:10},{default:t(()=>[e(xe,{label:"å›¾æ ‡"},{default:t(()=>[e(De,{modelValue:T.value.icon,"onUpdate:modelValue":i[3]||(i[3]=w=>T.value.icon=w),placeholder:"emoji"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(dl,{gutter:12},{default:t(()=>[e(Me,{span:14},{default:t(()=>[e(xe,{label:"åˆ†ç±»"},{default:t(()=>[e(De,{modelValue:T.value.category,"onUpdate:modelValue":i[4]||(i[4]=w=>T.value.category=w),placeholder:"å¦‚ è¯­è¨€"},null,8,["modelValue"])]),_:1})]),_:1}),e(Me,{span:10},{default:t(()=>[e(xe,{label:"ç‰ˆæœ¬"},{default:t(()=>[e(De,{modelValue:T.value.version,"onUpdate:modelValue":i[5]||(i[5]=w=>T.value.version=w),placeholder:"1.0.0"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(xe,{label:"æè¿°"},{default:t(()=>[e(De,{modelValue:T.value.description,"onUpdate:modelValue":i[6]||(i[6]=w=>T.value.description=w),type:"textarea",rows:2,placeholder:"ç®€è¦æè¿°æŠ€èƒ½åŠŸèƒ½"},null,8,["modelValue"])]),_:1}),e(xe,{label:"çŠ¶æ€"},{default:t(()=>[s("div",Ma,[e(he,{modelValue:T.value.enabled,"onUpdate:modelValue":i[7]||(i[7]=w=>T.value.enabled=w)},null,8,["modelValue"]),s("span",Na,v(T.value.enabled?"å·²å¯ç”¨ï¼ŒSKILL.md å°†æ³¨å…¥ç³»ç»Ÿæç¤º":"å·²ç¦ç”¨"),1)])]),_:1}),e(Cl,{style:{"margin-top":"8px"}},{default:t(()=>[e(xl,{title:"æŸ¥çœ‹ skill.json åŸæ–‡"},{default:t(()=>[s("pre",Ea,v(JSON.stringify({id:f.value.id,...T.value},null,2)),1)]),_:1})]),_:1})]),_:1},8,["model"])])):x.value==="prompt"?(u(),m("div",Ba,[s("div",Ra,[e(h,null,{default:t(()=>[e(Pe)]),_:1}),i[25]||(i[25]=d(" SKILL.md ",-1)),i[26]||(i[26]=s("span",{class:"file-hint"},"æ³¨å…¥åˆ° AI System Prompt çš„æŒ‡ä»¤å†…å®¹",-1)),s("div",Pa,[S.value?(u(),$(ie,{key:0,type:"warning",size:"small"},{default:t(()=>[...i[24]||(i[24]=[d("æœªä¿å­˜",-1)])]),_:1})):C("",!0),s("span",Ka,v(F.value.length)+" å­—ç¬¦",1),e(j,{size:"small",circle:"",loading:ye.value,onClick:me,title:"é‡æ–°åŠ è½½"},{default:t(()=>[e(h,null,{default:t(()=>[e(V)]),_:1})]),_:1},8,["loading"])])]),Ee(s("textarea",{"onUpdate:modelValue":i[8]||(i[8]=w=>F.value=w),class:"code-textarea",spellcheck:"false",placeholder:`# æŠ€èƒ½åç§°

## åŠŸèƒ½è¯´æ˜
æè¿°è¯¥æŠ€èƒ½çš„ç”¨é€”â€¦

## è¡Œä¸ºè§„èŒƒ
- è§„èŒƒ 1
- è§„èŒƒ 2`,onInput:i[9]||(i[9]=w=>S.value=!0)},null,544),[[Al,F.value]])])):(u(),m("div",ja,[s("div",Oa,[e(h,null,{default:t(()=>[e(Pe)]),_:1}),d(" "+v(x.value)+" ",1),s("div",Wa,[se.value?(u(),$(ie,{key:0,type:"warning",size:"small"},{default:t(()=>[...i[27]||(i[27]=[d("æœªä¿å­˜",-1)])]),_:1})):C("",!0),s("span",Ya,v(R.value.length)+" å­—ç¬¦",1),e(j,{size:"small",circle:"",loading:Y.value,onClick:Re,title:"é‡æ–°åŠ è½½"},{default:t(()=>[e(h,null,{default:t(()=>[e(V)]),_:1})]),_:1},8,["loading"]),e(kl,{title:"ç¡®è®¤åˆ é™¤è¯¥æ–‡ä»¶ï¼Ÿ",onConfirm:i[10]||(i[10]=w=>P(x.value))},{reference:t(()=>[e(j,{size:"small",circle:"",type:"danger",plain:""},{default:t(()=>[e(h,null,{default:t(()=>[e(bl)]),_:1})]),_:1})]),_:1})])]),Ee(s("textarea",{"onUpdate:modelValue":i[11]||(i[11]=w=>R.value=w),class:"code-textarea",spellcheck:"false",placeholder:`ç¼–è¾‘ ${x.value} â€¦`,onInput:i[12]||(i[12]=w=>se.value=!0)},null,40,Ha),[[Al,R.value]])]))])],64)):(u(),m("div",xa,[e(h,{size:"48",color:"#c0c4cc"},{default:t(()=>[e(Xe)]),_:1}),i[15]||(i[15]=s("p",null,"ä»å·¦ä¾§é€‰æ‹©ä¸€ä¸ªæŠ€èƒ½å¼€å§‹ç¼–è¾‘",-1)),e(j,{type:"primary",onClick:Ae},{default:t(()=>[e(h,null,{default:t(()=>[e(ke)]),_:1}),i[14]||(i[14]=d(" æ–°å»ºæŠ€èƒ½",-1))]),_:1})]))]),s("div",qa,[s("div",Ja,[e(h,null,{default:t(()=>[e(O)]),_:1}),i[28]||(i[28]=d(" AI åä½œé…ç½® ",-1)),f.value?(u(),m("span",Xa,[d(" å½“å‰: "+v(f.value.name)+" ",1),ue.value.size>1?(u(),m("span",Ga," ("+v(ue.value.size)+" ä¸ªå¹¶è¡Œç”Ÿæˆä¸­) ",1)):C("",!0)])):C("",!0)]),s("div",Qa,[(u(!0),m(M,null,J(I.value,w=>Ee((u(),$(et,{key:w.id,ref_for:!0,ref:Ce=>qe(w.id,Ce),"agent-id":D(g),context:f.value?.id===w.id?Be.value:"",scenario:"skill-studio","skill-id":w.id,"welcome-message":f.value?.id===w.id?oe.value:"",examples:f.value?.id===w.id?_e.value:[],compact:"",onResponse:Ce=>il(w.id),onStreamingChange:Ce=>de(w.id,Ce)},null,8,["agent-id","context","skill-id","welcome-message","examples","onResponse","onStreamingChange"])),[[Gt,f.value?.id===w.id]])),128))])])])}}}),en=lt(Za,[["__scopeId","data-v-3a5bcde8"]]),ln={class:"wc-layout"},tn={class:"wc-panel-header"},an={class:"wc-header-actions"},nn={class:"wc-panel-body file-tree-body"},sn={key:0,class:"wc-loading"},on={key:1,class:"wc-empty"},un={class:"wc-panel-header"},dn={key:0,class:"wc-panel-title file-path-title"},rn={class:"file-ext-badge"},cn={key:1,class:"wc-panel-title muted"},vn={class:"wc-header-actions"},mn={class:"wc-panel-body editor-body"},fn={key:0,class:"wc-empty-editor"},pn={key:1,class:"wc-binary-notice"},yn={class:"editor-wrap"},gn=["onKeydown"],_n={class:"editor-statusbar"},wn={key:0},bn={key:1,class:"status-dirty"},kn={key:2,class:"status-saved"},hn={class:"wc-panel wc-panel-right"},xn={class:"wc-modal"},Cn={class:"wc-modal-footer"},yt=140,$n=400,Vn=900,zn=Fl({__name:"WorkspaceChatLayout",props:{agentId:{},sessionId:{}},emits:["session-change"],setup(He,{emit:pe}){const g=He,I=r(220),ae=r(480),f=r(),x=r(),T=r(),F=r([]),ye=r(!1),S=r(""),X=r(""),G=r(!1),ne=r(!1),Q=r(null),W=r(!1),R=r(""),se=r(!1),Y=r(!1),Ie=sl(()=>(X.value.match(/\n/g)??[]).length+1),qe=sl(()=>S.value?`ç”¨æˆ·å½“å‰æ‰“å¼€çš„æ–‡ä»¶: ${S.value}
ï¼ˆä¿®æ”¹åä¼šå®æ—¶åˆ·æ–°ç¼–è¾‘å™¨ï¼‰`:void 0);let ge=0,ue=0,de=null;function ce(p){ge=p.clientX,ue=I.value,de="left",se.value=!0,window.addEventListener("mousemove",oe),window.addEventListener("mouseup",_e),document.body.style.cursor="col-resize",document.body.style.userSelect="none"}function Be(p){ge=p.clientX,ue=ae.value,de="right",Y.value=!0,window.addEventListener("mousemove",oe),window.addEventListener("mouseup",_e),document.body.style.cursor="col-resize",document.body.style.userSelect="none"}function oe(p){const o=p.clientX-ge;de==="left"?I.value=Math.max(yt,Math.min($n,ue+o)):de==="right"&&(ae.value=Math.max(yt,Math.min(Vn,ue+o)))}function _e(){se.value=!1,Y.value=!1,de=null,window.removeEventListener("mousemove",oe),window.removeEventListener("mouseup",_e),document.body.style.cursor="",document.body.style.userSelect=""}async function N(){ye.value=!0;try{const p=await te.readTree(g.agentId);F.value=re(p.data)}catch{F.value=[]}finally{ye.value=!1}}function re(p){return p?Array.isArray(p)?p.map(o=>({name:o.name,path:o.path??o.name,isDir:o.isDir??o.type==="dir",size:o.size,children:o.children?re(o.children):void 0})).sort((o,i)=>(i.isDir?1:0)-(o.isDir?1:0)||o.name.localeCompare(i.name)):p.children?re(p.children):[]:[]}async function ve(p){G.value&&S.value&&!await Ql.confirm("æœ‰æœªä¿å­˜çš„æ›´æ”¹ï¼Œåˆ‡æ¢æ–‡ä»¶å°†ä¸¢å¤±ã€‚ç»§ç»­ï¼Ÿ","æç¤º",{confirmButtonText:"ç»§ç»­",cancelButtonText:"å–æ¶ˆ",type:"warning"}).then(()=>!0).catch(()=>!1)||(S.value=p,G.value=!1,await we())}async function we(){if(S.value)try{const o=(await te.read(g.agentId,S.value)).data;ne.value=o.binary??!1,ne.value||(X.value=o.content??"",Q.value=o.size!=null?{size:o.size,modTime:o.modTime}:null),G.value=!1}catch{X.value=""}}async function Le(){if(!(!S.value||ne.value))try{await te.write(g.agentId,S.value,X.value),G.value=!1,y.success("å·²ä¿å­˜")}catch{y.error("ä¿å­˜å¤±è´¥")}}async function be(){if(await Ql.confirm(`åˆ é™¤ ${S.value}ï¼Ÿ`,"ç¡®è®¤åˆ é™¤",{confirmButtonText:"åˆ é™¤",cancelButtonText:"å–æ¶ˆ",type:"warning"}).then(()=>!0).catch(()=>!1))try{await te.delete(g.agentId,S.value),S.value="",X.value="",G.value=!1,await N(),y.success("å·²åˆ é™¤")}catch{y.error("åˆ é™¤å¤±è´¥")}}async function Je(){if(R.value.trim())try{await te.write(g.agentId,R.value.trim(),""),W.value=!1,await N(),await ve(R.value.trim()),R.value=""}catch{y.error("åˆ›å»ºå¤±è´¥")}}wl(W,async p=>{p&&(await Dl(),T.value?.focus())});async function Re(){await N(),S.value&&(await new Promise(p=>setTimeout(p,300)),await we())}function P(p){const o=f.value,i=o.selectionStart,V=o.value;X.value=V.slice(0,i)+"  "+V.slice(o.selectionEnd),Dl(()=>{o.selectionStart=o.selectionEnd=i+2})}function Ue(){x.value&&f.value&&(x.value.scrollTop=f.value.scrollTop)}function Fe(p){const o=p.split(".").pop()?.toLowerCase();return o?`.${o}`:"txt"}function ol(p){return p<1024?`${p}B`:p<1024*1024?`${(p/1024).toFixed(1)}KB`:`${(p/1024/1024).toFixed(1)}MB`}Zl(()=>N()),Qt(()=>_e());const Ae=Fl({name:"FileTreeNode",props:{node:Object,activePath:String,depth:{type:Number,default:0}},emits:["open"],setup(p,{emit:o}){const i=r(!1);function V(){p.node.isDir?i.value=!i.value:o("open",p.node.path)}return()=>Oe("div",{class:"tree-item-wrap"},[Oe("div",{class:["tree-item",p.node.isDir&&"is-dir",!p.node.isDir&&p.node.path===p.activePath&&"is-active"],style:{paddingLeft:p.depth*14+10+"px"},onClick:V},[Oe("span",{class:"tree-icon"},p.node.isDir?i.value?"ğŸ“‚":"ğŸ“":il(p.node.name)),Oe("span",{class:"tree-name"},p.node.name),!p.node.isDir&&p.node.size!=null?Oe("span",{class:"tree-size"},me(p.node.size)):null]),p.node.isDir&&i.value&&p.node.children?.length?Oe("div",{class:"tree-children"},p.node.children.map(h=>Oe(Ae,{node:h,activePath:p.activePath,depth:p.depth+1,onOpen:j=>o("open",j)}))):null])}});function il(p){const o=p.split(".").pop()?.toLowerCase()??"";return{go:"ğŸ¹",js:"ğŸ“œ",ts:"ğŸ“˜",vue:"ğŸ’š",py:"ğŸ",md:"ğŸ“",json:"ğŸ“‹",sh:"âš¡",yaml:"âš™ï¸",yml:"âš™ï¸",toml:"âš™ï¸",html:"ğŸŒ",css:"ğŸ¨",sql:"ğŸ—„ï¸",rs:"ğŸ¦€",txt:"ğŸ“„",env:"ğŸ”’"}[o]??"ğŸ“„"}function me(p){return p<1024?`${p}B`:p<1048576?`${(p/1024).toFixed(0)}K`:`${(p/1048576).toFixed(1)}M`}return(p,o)=>(u(),m("div",ln,[s("div",{class:"wc-panel wc-panel-left",style:We({width:I.value+"px"})},[s("div",tn,[o[7]||(o[7]=s("span",{class:"wc-panel-title"},[s("span",{style:{"font-size":"12px","margin-right":"4px"}},"ğŸ“"),d("å·¥ä½œåŒº ")],-1)),s("div",an,[s("button",{class:"wc-icon-btn",title:"æ–°å»ºæ–‡ä»¶",onClick:o[0]||(o[0]=i=>W.value=!0)},"ï¼‹"),s("button",{class:"wc-icon-btn",title:"åˆ·æ–°",onClick:N},"â†º")])]),s("div",nn,[ye.value?(u(),m("div",sn,"åŠ è½½ä¸­â€¦")):F.value.length?C("",!0):(u(),m("div",on,"å·¥ä½œåŒºä¸ºç©º")),(u(!0),m(M,null,J(F.value,i=>(u(),$(D(Ae),{key:i.path,node:i,"active-path":S.value,depth:0,onOpen:ve},null,8,["node","active-path"]))),128))])],4),s("div",{class:Ye(["wc-handle",{dragging:se.value}]),onMousedown:ce},[...o[8]||(o[8]=[s("div",{class:"wc-handle-bar"},null,-1)])],34),s("div",{class:"wc-panel wc-panel-mid",style:We({width:ae.value+"px"})},[s("div",un,[S.value?(u(),m("span",dn,[s("span",rn,v(Fe(S.value)),1),d(" "+v(S.value),1)])):(u(),m("span",cn,"é€‰æ‹©æ–‡ä»¶æŸ¥çœ‹")),s("div",vn,[S.value&&G.value?(u(),m("button",{key:0,class:"wc-save-btn",onClick:Le},"ä¿å­˜")):C("",!0),S.value?(u(),m("button",{key:1,class:"wc-icon-btn",title:"åˆ·æ–°æ–‡ä»¶",onClick:we},"â†º")):C("",!0),S.value?(u(),m("button",{key:2,class:"wc-icon-btn danger",title:"åˆ é™¤æ–‡ä»¶",onClick:be},"âœ•")):C("",!0)])]),s("div",mn,[S.value?ne.value?(u(),m("div",pn," äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œæ— æ³•ç¼–è¾‘ ")):(u(),m(M,{key:2},[s("div",yn,[s("div",{class:"line-numbers",ref_key:"lineNumRef",ref:x},[(u(!0),m(M,null,J(Ie.value,i=>(u(),m("div",{key:i,class:"line-num"},v(i),1))),128))],512),Ee(s("textarea",{ref_key:"editorRef",ref:f,"onUpdate:modelValue":o[1]||(o[1]=i=>X.value=i),class:"code-editor",spellcheck:"false",autocorrect:"off",autocapitalize:"off",onInput:o[2]||(o[2]=i=>{G.value=!0,Ue()}),onScroll:Ue,onKeydown:[nl(al(P,["prevent"]),["tab"]),nl(al(Le,["ctrl","prevent"]),["s"]),nl(al(Le,["meta","prevent"]),["s"])]},null,40,gn),[[Al,X.value]])]),s("div",_n,[s("span",null,v(Fe(S.value)),1),s("span",null,v(Ie.value)+" è¡Œ",1),s("span",null,v(X.value.length)+" å­—ç¬¦",1),Q.value?(u(),m("span",wn,v(ol(Q.value.size)),1)):C("",!0),G.value?(u(),m("span",bn,"â— æœªä¿å­˜")):(u(),m("span",kn,"âœ“ å·²ä¿å­˜"))])],64)):(u(),m("div",fn,[...o[9]||(o[9]=[s("div",{class:"wc-empty-icon"},"âœï¸",-1),s("div",null,"ä»å·¦ä¾§é€‰æ‹©æ–‡ä»¶",-1),s("div",{class:"wc-empty-hint"},"æ”¯æŒæ‹–æ‹½æ–‡ä»¶åˆ°èŠå¤©æ¡†",-1)])]))])],4),s("div",{class:Ye(["wc-handle",{dragging:Y.value}]),onMousedown:Be},[...o[10]||(o[10]=[s("div",{class:"wc-handle-bar"},null,-1)])],34),s("div",hn,[e(et,{"agent-id":He.agentId,"session-id":He.sessionId,context:qe.value,height:"100%",ref:"chatRef",onResponse:Re,onSessionChange:o[3]||(o[3]=i=>p.$emit("session-change",i))},null,8,["agent-id","session-id","context"])]),W.value?(u(),m("div",{key:0,class:"wc-modal-mask",onClick:o[6]||(o[6]=al(i=>W.value=!1,["self"]))},[s("div",xn,[o[11]||(o[11]=s("div",{class:"wc-modal-title"},"æ–°å»ºæ–‡ä»¶",-1)),Ee(s("input",{"onUpdate:modelValue":o[4]||(o[4]=i=>R.value=i),class:"wc-modal-input",placeholder:"å¦‚ notes.md æˆ– scripts/run.sh",onKeyup:nl(Je,["enter"]),ref_key:"newFileInput",ref:T},null,544),[[Al,R.value]]),s("div",Cn,[s("button",{class:"wc-btn",onClick:o[5]||(o[5]=i=>W.value=!1)},"å–æ¶ˆ"),s("button",{class:"wc-btn primary",onClick:Je},"åˆ›å»º")])])])):C("",!0)]))}}),Tn=lt(zn,[["__scopeId","data-v-32231b14"]]),Sn={class:"header-left"},In={class:"chat-layout"},Ln={class:"session-sidebar"},Un={class:"session-sidebar-header"},Fn={class:"session-list"},An=["onClick"],Dn={class:"session-item-title"},Mn={class:"session-item-meta"},Nn={key:0,class:"session-empty"},En={class:"at-panel"},Bn={key:0,class:"at-form"},Rn={class:"chat-area"},Pn={style:{display:"flex","justify-content":"space-between",width:"100%"}},Kn={style:{color:"#999","font-size":"12px"}},jn={style:{display:"flex","align-items":"center",gap:"8px"}},On={style:{"font-weight":"600"}},Wn={key:0,style:{"text-align":"center",color:"#c0c4cc",padding:"32px 0","font-size":"14px"}},Yn={style:{display:"flex","align-items":"center",gap:"8px"}},Hn={style:{"font-size":"13px"}},qn={style:{"font-size":"13px",color:"#606266"}},Jn={key:0,style:{"text-align":"center",color:"#c0c4cc",padding:"40px 0"}},Xn={key:1,class:"relations-list"},Gn={class:"relation-info"},Qn={class:"relation-name"},Zn={class:"relation-tags"},es={class:"relation-desc"},ls={style:{display:"flex","align-items":"center","justify-content":"space-between"}},ts={style:{display:"flex",gap:"8px","margin-top":"4px"}},as={style:{display:"flex","align-items":"center","justify-content":"space-between"}},ns={key:0,style:{"text-align":"center",color:"#c0c4cc",padding:"16px 0","font-size":"13px"}},ss={style:{"font-size":"12px"}},os={style:{"font-size":"12px",color:"#606266"}},is={class:"memory-toolbar",style:{"margin-bottom":"12px",display:"flex",gap:"8px"}},us={style:{display:"flex","align-items":"center",gap:"4px","font-size":"13px"}},ds={style:{display:"flex","align-items":"center","justify-content":"space-between"}},rs={style:{"margin-bottom":"16px",display:"flex","align-items":"center",gap:"8px"}},cs={class:"conv-drawer-body"},vs={key:0,style:{"text-align":"center","margin-bottom":"12px"}},ms={class:"conv-msg-list"},fs={class:"conv-msg-meta"},ps={class:"conv-msg-role"},ys={key:0,class:"conv-msg-sender"},gs={class:"conv-msg-time"},_s={class:"conv-msg-content"},ws={key:0,class:"conv-msg-empty"},bs={style:{display:"flex","justify-content":"space-between","align-items":"center","margin-bottom":"16px"}},ks={class:"channel-card-header"},hs={class:"channel-card-left"},xs={class:"channel-card-name"},Cs={key:0,class:"channel-bot-username"},$s={class:"channel-card-actions"},Vs={key:0,class:"channel-card-body"},zs={class:"channel-info-row"},Ts={class:"channel-info-value"},Ss={class:"channel-info-row"},Is={class:"channel-info-value"},Ls={key:1,class:"channel-card-body"},Us={class:"channel-info-row"},Fs={class:"channel-info-value"},As={style:{opacity:"0.6","font-size":"11px","margin-left":"3px"}},Ds={class:"pending-section"},Ms=["onClick"],Ns={key:0,class:"pending-list"},Es={key:0,style:{"text-align":"center",padding:"12px"}},Bs={class:"pending-user-info"},Rs={class:"pending-user-name"},Ps={key:0,class:"pending-user-username"},Ks={class:"pending-user-id"},js={class:"pending-user-actions"},Os={key:2,class:"pending-empty"},Ws={style:{width:"100%"}},Ys={style:{display:"flex",gap:"6px","align-items":"center"}},Hs={key:0,style:{"margin-top":"6px",display:"flex","align-items":"center",gap:"6px",color:"#909399","font-size":"13px"}},qs={key:1,style:{"margin-top":"6px",color:"#67c23a","font-size":"13px"}},Js={key:2,style:{"margin-top":"6px",color:"#e6a23c","font-size":"13px"}},Xs={key:3,style:{"margin-top":"6px",color:"#f56c6c","font-size":"13px"}},Gs={key:4,style:{"margin-top":"4px"}},Qs={class:"channel-url-preview"},Zs={class:"channel-url-text"},eo={class:"channel-url-preview"},lo={class:"channel-url-text"},to={style:{padding:"20px","max-width":"800px"}},ao={style:{display:"flex",gap:"8px","margin-bottom":"16px","align-items":"flex-start"}},no={style:{"font-size":"13px"}},so=50,oo=Fl({__name:"AgentDetailView",setup(He){const pe=Zt(),g=pe.params.id,I=r(null),ae=r("chat"),f=r(),x=r([]),T=r(!1),F=r();async function ye(){T.value=!0;try{const n=await ia.list({agentId:g,limit:50});x.value=n.data.sessions}catch{}finally{T.value=!1}}function S(n){F.value=n.id,f.value?.resumeSession(n.id)}function X(){F.value=void 0,f.value?.startNewSession()}function G(n){F.value=n,setTimeout(ye,500)}function ne(n){if(!n)return"";const l=Date.now()-n;return l<6e4?"åˆšåˆš":l<36e5?`${Math.floor(l/6e4)}åˆ†å‰`:l<864e5?`${Math.floor(l/36e5)}å°æ—¶å‰`:`${Math.floor(l/864e5)}å¤©å‰`}const Q=r(!1),W=r(""),R=r(""),se=r(!1),Y=r([]);function Ie(){Q.value=!Q.value,Q.value&&!Y.value.length&&qe()}async function qe(){try{const n=await yl.list();Y.value=n.data.filter(l=>l.id!==g)}catch{Y.value=[]}}function ge(n){const l=Y.value.find(c=>c.id===n);l&&f.value?.fillInput(`@${l.name}: `)}async function ue(){const n=W.value,l=R.value.trim();if(!n||!l)return;const z=Y.value.find(je=>je.id===n)?.name??n;se.value=!0;const H={role:"user",text:`â†’ è½¬å‘ç»™ ${z}ï¼š
${l}`};f.value?.appendMessage(H);try{const L=(await yl.message(n,l,g)).data.response,Ve={role:"assistant",text:`â† **${z}** å›å¤ï¼š

${L}`};f.value?.appendMessage(Ve),R.value="",W.value="",Q.value=!1,y.success(`${z} å·²å›å¤`)}catch(je){const L={role:"system",text:`[å¤±è´¥] è½¬å‘å¤±è´¥ï¼š${je.response?.data?.error??je.message??"ç½‘ç»œé”™è¯¯"}`};f.value?.appendMessage(L),y.error("è½¬å‘å¤±è´¥")}finally{se.value=!1}}const de=r(""),ce=r(""),Be=r([]),oe=r(""),_e=r(!1),N=r([]),re=r(""),ve=r(""),we=r(!1);function Le(){const n=I.value?.env||{};N.value=Object.entries(n).map(([l,c])=>({key:l,value:c}))}function be(){const n=re.value.trim();if(!n)return;const l=N.value.findIndex(c=>c.key===n);l>=0?N.value[l].value=ve.value:N.value.push({key:n,value:ve.value}),re.value="",ve.value=""}function Je(n){N.value.splice(n,1)}async function Re(){we.value=!0;try{const n={};for(const{key:c,value:z}of N.value)c.trim()&&(n[c.trim()]=z);const l=await yl.update(g,{env:n});I.value=l.data,y.success("ç¯å¢ƒå˜é‡å·²ä¿å­˜")}catch{y.error("ä¿å­˜å¤±è´¥")}finally{we.value=!1}}const P=r({enabled:!1,schedule:"daily",keepTurns:3,focusHint:"",cronJobId:""}),Ue=r(!1),Fe=r(!1);async function ol(){try{const n=await Ul.getConfig(g);P.value=n.data,o()}catch{}}async function Ae(){Ue.value=!0;try{const n=await Ul.setConfig(g,P.value);P.value=n.data,y.success(P.value.enabled?"è‡ªåŠ¨è®°å¿†å·²å¼€å¯":"è‡ªåŠ¨è®°å¿†å·²å…³é—­")}catch{y.error("ä¿å­˜å¤±è´¥")}finally{Ue.value=!1}}async function il(){Fe.value=!0;try{await Ul.consolidate(g),y.success("è®°å¿†æ•´ç†å·²åœ¨åå°å¯åŠ¨ï¼ˆçº¦éœ€10~30ç§’ï¼‰ï¼Œç¨åè‡ªåŠ¨åˆ·æ–°æ—¥å¿—"),setTimeout(o,1e4)}catch{y.error("æ•´ç†å¤±è´¥")}finally{Fe.value=!1}}const me=r([]),p=r(!1);async function o(){p.value=!0;try{const n=await Ul.runLog(g);me.value=n.data||[]}catch{me.value=[]}finally{p.value=!1}}const i=r([]),V=r(""),h=r(""),j=r(!1),ke=r([]),Z=r(!1),ie=r(""),he=r(!1),Xe=r(""),ee=r([]),ul=r(!1),K=r({agentId:"",agentName:"",relationType:"å¹³çº§åä½œ",strength:"å¸¸ç”¨",desc:""});async function bl(){try{const n=await ft.get(g);ee.value=n.data.parsed||[]}catch{ee.value=[]}}function kl(n){const l=Y.value.find(c=>c.id===n);K.value.agentName=l?l.name:n}async function hl(){if(!K.value.agentId)return;if(ee.value.find(l=>l.agentId===K.value.agentId)){y.warning("è¯¥æˆå‘˜å…³ç³»å·²å­˜åœ¨ï¼Œè¯·å…ˆåˆ é™¤å†é‡æ–°æ·»åŠ ");return}ee.value.push({...K.value}),K.value={agentId:"",agentName:"",relationType:"å¹³çº§åä½œ",strength:"å¸¸ç”¨",desc:""},await xe()}async function Pe(n){ee.value.splice(n,1),await xe()}function De(){if(ee.value.length===0)return"";const n=`| æˆå‘˜ID | æˆå‘˜åç§° | å…³ç³»ç±»å‹ | å…³ç³»ç¨‹åº¦ | è¯´æ˜ |
|--------|--------|--------|--------|------|`,l=ee.value.map(c=>`| ${c.agentId} | ${c.agentName} | ${c.relationType} | ${c.strength} | ${c.desc||""} |`).join(`
`);return n+`
`+l}async function xe(){ul.value=!0;try{await ft.put(g,De()),y.success("å…³ç³»å·²ä¿å­˜")}catch{y.error("ä¿å­˜å¤±è´¥")}finally{ul.value=!1}}function Me(n){const l=["#409EFF","#67C23A","#E6A23C","#F56C6C","#909399","#B45309","#7C3AED","#0891B2"];let c=0;for(let z=0;z<n.length;z++)c=n.charCodeAt(z)+((c<<5)-c);return l[Math.abs(c)%l.length]??"#409EFF"}function dl(n){return n==="ä¸Šçº§"?"danger":n==="ä¸‹çº§"?"":n==="å¹³çº§åä½œ"?"success":"info"}function xl(n){return n==="æ ¸å¿ƒ"?"danger":n==="å¸¸ç”¨"?"warning":"info"}const Cl=r([]),Ke=r(!1),O=r({name:"",expr:"0 9 * * *",tz:"Asia/Shanghai",message:"",enabled:!0});function w(n){return n==="running"?"success":n==="stopped"?"danger":"info"}function Ce(n){return n==="running"?"è¿è¡Œä¸­":n==="stopped"?"å·²åœæ­¢":"ç©ºé—²"}function gt(n){return n?n<1024?n+" B":n<1048576?(n/1024).toFixed(1)+" KB":(n/1048576).toFixed(1)+" MB":"0 B"}function tt(n){return n?new Date(n).toLocaleString():""}const Se=r([]),Ml=r(!1),Ge=r(!1),$e=r(""),$l=r(""),Nl=r(!1),El=r(""),b=r({type:"telegram",name:"",enabled:!0,botToken:"",allowedFrom:"",webPassword:"",webWelcome:"",webTitle:""}),A=r({loading:!1,status:""});let Bl=null;function Rl(n){return/^\*+$/.test(n)}async function at(){const n=b.value.botToken;if(!(!n||Rl(n))){A.value={loading:!0,status:""};try{const c=(await fe.checkToken(g,n)).data;c.duplicate?A.value={loading:!1,status:"duplicate",usedBy:c.usedBy,usedByCh:c.usedByCh}:c.valid?(A.value={loading:!1,status:"ok",botName:c.botName},!b.value.name&&c.botName&&(b.value.name=c.botName)):A.value={loading:!1,status:"error",error:c.error||"Token æ— æ•ˆ"}}catch{A.value={loading:!1,status:"error",error:"ç½‘ç»œé”™è¯¯ï¼Œè¯·é‡è¯•"}}}}wl(()=>b.value.type,n=>{$e.value||($l.value=Pl(n))}),wl(()=>b.value.botToken,n=>{A.value={loading:!1,status:""},Bl&&clearTimeout(Bl),!(!n||Rl(n)||n.length<20||!n.includes(":"))&&(Bl=setTimeout(at,800))});function Qe(n,l){return l?`${window.location.origin}/chat/${n}/${l}`:`${window.location.origin}/chat/${n}`}function nt(n){navigator.clipboard.writeText(n).then(()=>y.success("é“¾æ¥å·²å¤åˆ¶"))}async function Ze(){Ml.value=!0;try{const n=await fe.list(g);Se.value=n.data||[]}catch{Se.value=[]}finally{Ml.value=!1}}function Pl(n){return n+"-"+Date.now().toString(36)}function _t(){$e.value="";const n=I.value?.name||"";$l.value=Pl("telegram"),b.value={type:"telegram",name:n,enabled:!0,botToken:"",allowedFrom:"",webPassword:"",webWelcome:"",webTitle:""},A.value={loading:!1,status:""},Ge.value=!0}function wt(n){$e.value=n.id,b.value={type:n.type,name:n.name,enabled:n.enabled,botToken:n.config?.botToken||"",allowedFrom:n.config?.allowedFrom||"",webPassword:"",webWelcome:n.config?.welcomeMsg||"",webTitle:n.config?.title||""},A.value={loading:!1,status:""},Ge.value=!0}async function bt(){if(!b.value.name||!b.value.type){y.warning("è¯·å¡«å†™åç§°å’Œç±»å‹");return}if(A.value.status==="duplicate"){y.error(`Bot Token å·²è¢«æˆå‘˜ã€Œ${A.value.usedBy}ã€ä½¿ç”¨ï¼Œè¯·æ›´æ¢`);return}Nl.value=!0;try{const n={};if(b.value.type==="telegram"?(b.value.botToken&&(n.botToken=b.value.botToken),b.value.allowedFrom&&(n.allowedFrom=b.value.allowedFrom)):b.value.type==="web"&&(b.value.webPassword&&(n.password=b.value.webPassword),b.value.webWelcome&&(n.welcomeMsg=b.value.webWelcome),b.value.webTitle&&(n.title=b.value.webTitle)),$e.value){const l=Se.value.map(c=>c.id!==$e.value?c:{...c,name:b.value.name,type:b.value.type,enabled:b.value.enabled,config:{...c.config,...n}});await fe.set(g,l)}else{const l={id:$l.value||Pl(b.value.type),name:b.value.name,type:b.value.type,enabled:b.value.enabled,config:n,status:"untested"};await fe.set(g,[...Se.value,l])}y.success(b.value.type==="web"?"ä¿å­˜æˆåŠŸï¼ŒWeb èŠå¤©é¡µç«‹å³ç”Ÿæ•ˆ":"ä¿å­˜æˆåŠŸï¼Œé‡å¯åæ–°æ¸ é“ç”Ÿæ•ˆ"),Ge.value=!1,await Ze()}catch(n){y.error(n.response?.data?.error||"ä¿å­˜å¤±è´¥")}finally{Nl.value=!1}}async function kt(){try{await fe.set(g,Se.value)}catch(n){y.error(n.response?.data?.error||"ä¿å­˜å¤±è´¥"),await Ze()}}async function ht(n){const l=Se.value.filter(c=>c.id!==n.id);try{await fe.set(g,l),Se.value=l,y.success("å·²åˆ é™¤")}catch{y.error("åˆ é™¤å¤±è´¥")}}async function xt(n){El.value=n.id;try{const l=await fe.test(g,n.id);l.data.valid?y.success(l.data.botName?`æµ‹è¯•æˆåŠŸ (@${l.data.botName})`:"æµ‹è¯•æˆåŠŸ"):y.error(l.data.error||"æµ‹è¯•å¤±è´¥"),await Ze()}catch{y.error("æµ‹è¯•è¯·æ±‚å¤±è´¥")}finally{El.value=""}}const el=r({}),Kl=r({}),rl=r(""),jl=r("");async function Vl(n){Kl.value[n]=!0;try{const l=await fe.listPending(g,n);el.value[n]=l.data||[]}catch{el.value[n]=[]}finally{Kl.value[n]=!1}}function Ct(n){rl.value===n?rl.value="":(rl.value=n,Vl(n))}async function $t(n,l){jl.value=`${n}-${l}`;try{await fe.allowUser(g,n,l),y.success(`ç”¨æˆ· ${l} å·²åŠ å…¥ç™½åå•`),await Vl(n),await Ze()}catch{y.error("æ“ä½œå¤±è´¥")}finally{jl.value=""}}async function Vt(n,l){try{await fe.dismissUser(g,n,l),y.success("å·²å¿½ç•¥"),await Vl(n)}catch{y.error("æ“ä½œå¤±è´¥")}}async function st(n,l){try{await Ql.confirm(`ç¡®å®šå°†ç”¨æˆ· ${l} ä»ç™½åå•ä¸­ç§»é™¤ï¼Ÿç§»é™¤åè¯¥ç”¨æˆ·å°†æ— æ³•ä½¿ç”¨æ­¤ Botã€‚`,"ç§»é™¤ç™½åå•",{confirmButtonText:"ç¡®è®¤ç§»é™¤",cancelButtonText:"å–æ¶ˆ",type:"warning"})}catch{return}try{await fe.removeAllowed(g,n,l),y.success(`ç”¨æˆ· ${l} å·²ä»ç™½åå•ç§»é™¤`),await Ze()}catch{y.error("æ“ä½œå¤±è´¥")}}Zl(async()=>{try{const c=await yl.get(g);I.value=c.data}catch{y.error("åŠ è½½ Agent å¤±è´¥")}zt(),Tt(),bl(),qe(),ol(),zl(),Ze(),Le(),await ye();const n=pe.query.tab;n&&(ae.value=n);const l=pe.query.resumeSession;l&&(F.value=l,await new Promise(z=>setTimeout(z,100)),f.value?.resumeSession(l),x.value.find(z=>z.id===l)||(F.value=l))});async function zt(){try{const[n,l]=await Promise.all([te.read(g,"IDENTITY.md"),te.read(g,"SOUL.md")]);de.value=n.data?.content||"",ce.value=l.data?.content||""}catch{}cl()}async function ot(n,l){try{await te.write(g,n,l),y.success(`${n} å·²ä¿å­˜`)}catch{y.error(`ä¿å­˜ ${n} å¤±è´¥`)}}async function Tt(){try{const n=await oa.list();if(Be.value=n.data||[],I.value?.modelId)oe.value=I.value.modelId;else{const l=Be.value.find(c=>c.provider+"/"+c.model===I.value?.model||c.id===I.value?.model);oe.value=l?.id||""}}catch{}}async function St(){if(oe.value){_e.value=!0;try{const n=await yl.update(g,{modelId:oe.value});I.value=n.data,y.success("æ¨¡å‹å·²æ›´æ–°")}catch{y.error("æ›´æ–°å¤±è´¥")}finally{_e.value=!1}}}async function cl(){try{const n=await gl.tree(g);i.value=n.data||[]}catch{i.value=[]}}async function It(n){if(!n.isDir){V.value=n.path,ke.value=n.path.split("/");try{const l=await gl.readFile(g,n.path);h.value=l.data?.content||""}catch{h.value="(æ— æ³•è¯»å–)"}}}async function Lt(){if(V.value){j.value=!0;try{await gl.writeFile(g,V.value,h.value),y.success("è®°å¿†æ–‡ä»¶å·²ä¿å­˜"),cl()}catch{y.error("ä¿å­˜å¤±è´¥")}finally{j.value=!1}}}async function Ut(){const n=ie.value.trim();if(!n){y.warning("è¯·è¾“å…¥è·¯å¾„");return}try{await gl.writeFile(g,n,`# ${n.split("/").pop()?.replace(".md","")||"New File"}

`),y.success("æ–‡ä»¶å·²åˆ›å»º"),Z.value=!1,ie.value="",cl(),V.value=n,ke.value=n.split("/"),h.value=`# ${n.split("/").pop()?.replace(".md","")||"New File"}

`}catch{y.error("åˆ›å»ºå¤±è´¥")}}async function Ft(){const n=Xe.value.trim();if(!n){y.warning("è¯·è¾“å…¥å†…å®¹");return}try{await gl.dailyLog(g,n),y.success("æ—¥å¿—å·²æ·»åŠ "),he.value=!1,Xe.value="",cl()}catch{y.error("æ·»åŠ å¤±è´¥")}}async function zl(){try{const n=await _l.list(g);Cl.value=n.data||[]}catch{}}async function At(){try{await _l.create({name:O.value.name,enabled:O.value.enabled,agentId:g,schedule:{kind:"cron",expr:O.value.expr,tz:O.value.tz},payload:{kind:"agentTurn",message:O.value.message},delivery:{mode:"announce"}}),y.success("ä»»åŠ¡åˆ›å»ºæˆåŠŸ"),Ke.value=!1,zl()}catch(n){y.error(n.response?.data?.error||"åˆ›å»ºå¤±è´¥")}}async function Dt(n){try{await _l.update(n.id,n)}catch{y.error("æ›´æ–°å¤±è´¥")}}async function it(n){try{await _l.run(n.id),y.success("å·²è§¦å‘è¿è¡Œ"),setTimeout(zl,2e3)}catch{y.error("è¿è¡Œå¤±è´¥")}}async function Mt(n){try{await _l.delete(n.id),y.success("å·²åˆ é™¤"),zl()}catch{y.error("åˆ é™¤å¤±è´¥")}}const Tl=r(!1),Ol=r([]),Wl=r(!1),Yl=r(""),Ne=r([]),Hl=r(0),Sl=r(0),Nt=sl(()=>Ne.value.length<Hl.value),vl=r(!1);async function ut(){Tl.value=!0;try{const n=await pt.list(g);Ol.value=n.data}catch{y.error("åŠ è½½å¯¹è¯æ¸ é“å¤±è´¥")}finally{Tl.value=!1}}async function Et(n){Yl.value=n.channelId,Ne.value=[],Hl.value=0,Sl.value=0,Wl.value=!0,await dt()}async function dt(){vl.value=!0;try{const l=(await pt.messages(g,Yl.value,{limit:so,offset:Sl.value})).data;Hl.value=l.total,Sl.value===0?Ne.value=l.messages:Ne.value=[...l.messages,...Ne.value],Sl.value+=l.messages.length}catch{y.error("åŠ è½½æ¶ˆæ¯å¤±è´¥")}finally{vl.value=!1}}async function Bt(){await dt()}return wl(ae,n=>{n==="convlogs"&&Ol.value.length===0&&ut()}),(n,l)=>{const c=_("el-button"),z=_("el-tag"),H=_("el-text"),je=_("el-header"),L=_("el-option"),Ve=_("el-select"),E=_("el-input"),ze=_("el-tab-pane"),U=_("el-form-item"),ll=_("el-form"),Te=_("el-card"),le=_("el-col"),tl=_("el-row"),rt=_("el-badge"),B=_("el-table-column"),ml=_("el-table"),fl=_("el-switch"),Rt=_("el-input-number"),q=_("el-icon"),Pt=_("el-tree"),ql=_("el-empty"),ct=_("el-breadcrumb-item"),Kt=_("el-breadcrumb"),Il=_("el-dialog"),jt=_("el-drawer"),Ot=_("el-link"),Wt=_("CircleCheck"),Yt=_("Warning"),Ht=_("CircleClose"),vt=_("InfoFilled"),mt=_("Link"),qt=_("el-tabs"),Jt=_("el-main"),Xt=_("el-container"),Jl=sa("loading");return u(),$(Xt,{class:"agent-detail"},{default:t(()=>[e(je,{class:"detail-header"},{default:t(()=>[s("div",Sn,[e(c,{icon:D(ea),onClick:l[0]||(l[0]=a=>n.$router.push("/agents")),circle:""},null,8,["icon"]),s("h2",null,v(I.value?.name||"..."),1),e(z,{type:w(I.value?.status)},{default:t(()=>[d(v(Ce(I.value?.status)),1)]),_:1},8,["type"])]),e(H,{type:"info"},{default:t(()=>[d(v(I.value?.model),1)]),_:1})]),_:1}),e(Jt,null,{default:t(()=>[e(qt,{modelValue:ae.value,"onUpdate:modelValue":l[47]||(l[47]=a=>ae.value=a),type:"border-card"},{default:t(()=>[e(ze,{label:"å¯¹è¯",name:"chat"},{default:t(()=>[s("div",In,[s("div",Ln,[s("div",Un,[l[49]||(l[49]=s("span",{class:"sidebar-title"},"å†å²å¯¹è¯",-1)),e(c,{size:"small",type:"primary",plain:"",onClick:X,icon:D(Ll)},{default:t(()=>[...l[48]||(l[48]=[d("æ–°å»º",-1)])]),_:1},8,["icon"])]),Ee((u(),m("div",Fn,[(u(!0),m(M,null,J(x.value,a=>(u(),m("div",{key:a.id,class:Ye(["session-item",{active:F.value===a.id}]),onClick:k=>S(a)},[s("div",Dn,v(a.title||"æ–°å¯¹è¯"),1),s("div",Mn,[s("span",null,v(ne(a.lastAt)),1),e(z,{size:"small",type:"info",effect:"plain",style:{"font-size":"10px",padding:"0 4px"}},{default:t(()=>[d(v(a.messageCount)+" æ¡ ",1)]),_:2},1024),a.tokenEstimate>6e4?(u(),$(z,{key:0,size:"small",type:"warning",effect:"plain",style:{"font-size":"10px",padding:"0 4px"}},{default:t(()=>[d("~"+v(Math.round(a.tokenEstimate/1e3))+"k",1)]),_:2},1024)):C("",!0)])],10,An))),128)),!T.value&&!x.value.length?(u(),m("div",Nn," è¿˜æ²¡æœ‰å¯¹è¯è®°å½• ")):C("",!0)])),[[Jl,T.value]]),s("div",En,[e(c,{size:"small",plain:"",class:"at-toggle-btn",onClick:Ie},{default:t(()=>[...l[50]||(l[50]=[s("span",{class:"at-icon"},"@",-1),d(" å…¶ä»–æˆå‘˜ ",-1)])]),_:1}),Q.value?(u(),m("div",Bn,[e(Ve,{modelValue:W.value,"onUpdate:modelValue":l[1]||(l[1]=a=>W.value=a),placeholder:"é€‰æ‹©æˆå‘˜",size:"small",style:{width:"100%","margin-bottom":"6px"},onChange:ge},{default:t(()=>[(u(!0),m(M,null,J(Y.value,a=>(u(),$(L,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),e(E,{modelValue:R.value,"onUpdate:modelValue":l[2]||(l[2]=a=>R.value=a),type:"textarea",rows:3,placeholder:"è¾“å…¥è¦è½¬å‘çš„æ¶ˆæ¯â€¦",size:"small",style:{"margin-bottom":"6px"}},null,8,["modelValue"]),e(c,{type:"primary",size:"small",style:{width:"100%"},loading:se.value,disabled:!W.value||!R.value.trim(),onClick:ue},{default:t(()=>[...l[51]||(l[51]=[d(" è½¬å‘ ",-1)])]),_:1},8,["loading","disabled"])])):C("",!0)])]),s("div",Rn,[e(et,{ref_key:"aiChatRef",ref:f,"agent-id":D(g),scenario:"agent-detail","welcome-message":`ä½ å¥½ï¼æˆ‘æ˜¯ **${I.value?.name||"AI"}**ï¼Œæœ‰ä»€ä¹ˆå¯ä»¥å¸®ä½ çš„ï¼Ÿ`,height:"calc(100vh - 145px)","show-thinking":!0,onSessionChange:G},null,8,["agent-id","welcome-message"])])])]),_:1}),e(ze,{label:"èº«ä»½ & çµé­‚",name:"identity"},{default:t(()=>[e(Te,{style:{"margin-bottom":"16px"}},{header:t(()=>[...l[52]||(l[52]=[s("span",{style:{"font-weight":"600"}},"åŸºæœ¬è®¾ç½®",-1)])]),default:t(()=>[e(ll,{"label-width":"80px",size:"default"},{default:t(()=>[e(U,{label:"ä½¿ç”¨æ¨¡å‹"},{default:t(()=>[e(Ve,{modelValue:oe.value,"onUpdate:modelValue":l[3]||(l[3]=a=>oe.value=a),placeholder:"é€‰æ‹©æ¨¡å‹",style:{width:"280px","margin-right":"10px"}},{default:t(()=>[(u(!0),m(M,null,J(Be.value,a=>(u(),$(L,{key:a.id,label:a.name||a.model,value:a.id},{default:t(()=>[s("div",Pn,[s("span",null,v(a.name||a.model),1),s("span",Kn,v(a.provider),1)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"]),e(c,{type:"primary",loading:_e.value,onClick:St,disabled:!oe.value},{default:t(()=>[...l[53]||(l[53]=[d("ä¿å­˜",-1)])]),_:1},8,["loading","disabled"]),I.value?.model?(u(),$(H,{key:0,type:"info",style:{"margin-left":"12px","font-size":"12px"}},{default:t(()=>[d(" å½“å‰ï¼š"+v(I.value.model),1)]),_:1})):C("",!0)]),_:1})]),_:1})]),_:1}),e(tl,{gutter:20},{default:t(()=>[e(le,{span:12},{default:t(()=>[e(Te,{header:"IDENTITY.md"},{default:t(()=>[e(E,{modelValue:de.value,"onUpdate:modelValue":l[4]||(l[4]=a=>de.value=a),type:"textarea",rows:15,onBlur:l[5]||(l[5]=a=>ot("IDENTITY.md",de.value))},null,8,["modelValue"])]),_:1})]),_:1}),e(le,{span:12},{default:t(()=>[e(Te,{header:"SOUL.md"},{default:t(()=>[e(E,{modelValue:ce.value,"onUpdate:modelValue":l[6]||(l[6]=a=>ce.value=a),type:"textarea",rows:15,onBlur:l[7]||(l[7]=a=>ot("SOUL.md",ce.value))},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),e(ze,{label:"å…³ç³»",name:"relations"},{default:t(()=>[e(tl,{gutter:20},{default:t(()=>[e(le,{span:14},{default:t(()=>[e(Te,{style:{"margin-bottom":"16px"}},{header:t(()=>[...l[54]||(l[54]=[s("span",{style:{"font-weight":"600"}},"æ·»åŠ å…³ç³»",-1)])]),default:t(()=>[e(ll,{model:K.value,"label-position":"top",size:"default"},{default:t(()=>[e(tl,{gutter:12},{default:t(()=>[e(le,{span:10},{default:t(()=>[e(U,{label:"å…³è”æˆå‘˜"},{default:t(()=>[e(Ve,{modelValue:K.value.agentId,"onUpdate:modelValue":l[8]||(l[8]=a=>K.value.agentId=a),placeholder:"é€‰æ‹©ç³»ç»Ÿæˆå‘˜",filterable:"",style:{width:"100%"},onChange:kl},{default:t(()=>[(u(!0),m(M,null,J(Y.value,a=>(u(),$(L,{key:a.id,label:a.name,value:a.id},{default:t(()=>[s("div",jn,[s("div",{style:We([{width:"24px",height:"24px","border-radius":"50%",display:"flex","align-items":"center","justify-content":"center","font-size":"11px",color:"#fff","flex-shrink":"0"},{background:Me(a.id)}])},v(a.name.charAt(0)),5),s("span",null,v(a.name),1)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(le,{span:7},{default:t(()=>[e(U,{label:"å…³ç³»ç±»å‹"},{default:t(()=>[e(Ve,{modelValue:K.value.relationType,"onUpdate:modelValue":l[9]||(l[9]=a=>K.value.relationType=a),style:{width:"100%"}},{default:t(()=>[e(L,{label:"ä¸Šçº§",value:"ä¸Šçº§"}),e(L,{label:"ä¸‹çº§",value:"ä¸‹çº§"}),e(L,{label:"å¹³çº§åä½œ",value:"å¹³çº§åä½œ"}),e(L,{label:"æ”¯æŒ",value:"æ”¯æŒ"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(le,{span:7},{default:t(()=>[e(U,{label:"åä½œç¨‹åº¦"},{default:t(()=>[e(Ve,{modelValue:K.value.strength,"onUpdate:modelValue":l[10]||(l[10]=a=>K.value.strength=a),style:{width:"100%"}},{default:t(()=>[e(L,{label:"æ ¸å¿ƒ",value:"æ ¸å¿ƒ"}),e(L,{label:"å¸¸ç”¨",value:"å¸¸ç”¨"}),e(L,{label:"å¶å°”",value:"å¶å°”"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(tl,{gutter:12},{default:t(()=>[e(le,{span:18},{default:t(()=>[e(U,{label:"è¯´æ˜ï¼ˆé€‰å¡«ï¼‰"},{default:t(()=>[e(E,{modelValue:K.value.desc,"onUpdate:modelValue":l[11]||(l[11]=a=>K.value.desc=a),placeholder:"ç®€è¦æè¿°è¿™æ®µå…³ç³»..."},null,8,["modelValue"])]),_:1})]),_:1}),e(le,{span:6},{default:t(()=>[e(U,{label:" "},{default:t(()=>[e(c,{type:"primary",style:{width:"100%"},disabled:!K.value.agentId||!K.value.relationType||!K.value.strength,loading:ul.value,onClick:hl},{default:t(()=>[...l[55]||(l[55]=[d(" æ·»åŠ  ",-1)])]),_:1},8,["disabled","loading"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),e(Te,null,{header:t(()=>[s("span",On,[l[56]||(l[56]=d("å·²æœ‰å…³ç³» ",-1)),e(rt,{value:ee.value.length,type:"info",style:{"margin-left":"4px"}},null,8,["value"])])]),default:t(()=>[ee.value.length===0?(u(),m("div",Wn," æš‚æ— å…³ç³»ï¼Œè¯·åœ¨ä¸Šæ–¹æ·»åŠ  ")):(u(),$(ml,{key:1,data:ee.value,size:"small",style:{width:"100%"}},{default:t(()=>[e(B,{label:"æˆå‘˜","min-width":"120"},{default:t(({row:a})=>[s("div",Yn,[s("div",{style:We([{width:"28px",height:"28px","border-radius":"50%",display:"flex","align-items":"center","justify-content":"center","font-size":"12px",color:"#fff","flex-shrink":"0"},{background:Me(a.agentId)}])},v(a.agentName.charAt(0)),5),s("span",Hn,v(a.agentName),1)])]),_:1}),e(B,{label:"ç±»å‹",width:"100"},{default:t(({row:a})=>[e(z,{type:dl(a.relationType),size:"small"},{default:t(()=>[d(v(a.relationType),1)]),_:2},1032,["type"])]),_:1}),e(B,{label:"ç¨‹åº¦",width:"80"},{default:t(({row:a})=>[e(z,{type:xl(a.strength),size:"small",effect:"plain"},{default:t(()=>[d(v(a.strength),1)]),_:2},1032,["type"])]),_:1}),e(B,{label:"è¯´æ˜","min-width":"120","show-overflow-tooltip":""},{default:t(({row:a})=>[s("span",qn,v(a.desc||"â€”"),1)]),_:1}),e(B,{label:"æ“ä½œ",width:"70",fixed:"right"},{default:t(({$index:a})=>[e(c,{type:"danger",link:"",size:"small",onClick:k=>Pe(a)},{default:t(()=>[...l[57]||(l[57]=[d("åˆ é™¤",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]))]),_:1})]),_:1}),e(le,{span:10},{default:t(()=>[e(Te,{header:"å…³ç³»é¢„è§ˆ"},{default:t(()=>[ee.value.length===0?(u(),m("div",Jn," æš‚æ— å…³ç³»æ•°æ® ")):(u(),m("div",Xn,[(u(!0),m(M,null,J(ee.value,a=>(u(),m("div",{key:a.agentId,class:"relation-card"},[s("div",{class:"relation-avatar",style:We({background:Me(a.agentId)})},v(a.agentName.charAt(0).toUpperCase()),5),s("div",Gn,[s("div",Qn,v(a.agentName),1),s("div",Zn,[e(z,{type:dl(a.relationType),size:"small"},{default:t(()=>[d(v(a.relationType),1)]),_:2},1032,["type"]),e(z,{type:xl(a.strength),size:"small",effect:"plain"},{default:t(()=>[d(v(a.strength),1)]),_:2},1032,["type"])]),s("div",es,v(a.desc),1)])]))),128))]))]),_:1})]),_:1})]),_:1})]),_:1}),e(ze,{label:"è®°å¿†",name:"memory"},{default:t(()=>[e(Te,{style:{"margin-bottom":"16px"},shadow:"never"},{header:t(()=>[s("div",ls,[l[58]||(l[58]=s("span",{style:{"font-weight":"600"}},"è‡ªåŠ¨è®°å¿†",-1)),e(fl,{modelValue:P.value.enabled,"onUpdate:modelValue":l[12]||(l[12]=a=>P.value.enabled=a),"active-text":"å·²å¼€å¯","inactive-text":"å·²å…³é—­",onChange:Ae},null,8,["modelValue"])])]),default:t(()=>[e(ll,{model:P.value,"label-position":"top",size:"small",disabled:!P.value.enabled},{default:t(()=>[e(tl,{gutter:16},{default:t(()=>[e(le,{span:6},{default:t(()=>[e(U,{label:"æ•´ç†é¢‘ç‡"},{default:t(()=>[e(Ve,{modelValue:P.value.schedule,"onUpdate:modelValue":l[13]||(l[13]=a=>P.value.schedule=a),style:{width:"100%"}},{default:t(()=>[e(L,{label:"æ¯å°æ—¶",value:"hourly"}),e(L,{label:"æ¯6å°æ—¶",value:"every6h"}),e(L,{label:"æ¯å¤©",value:"daily"}),e(L,{label:"æ¯å‘¨",value:"weekly"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(le,{span:5},{default:t(()=>[e(U,{label:"æ¯ä¸ªä¼šè¯ä¿ç•™è½®æ•°"},{default:t(()=>[e(Rt,{modelValue:P.value.keepTurns,"onUpdate:modelValue":l[14]||(l[14]=a=>P.value.keepTurns=a),min:1,max:20,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),e(le,{span:13},{default:t(()=>[e(U,{label:"è®°å½•é‡ç‚¹ï¼ˆç•™ç©ºåˆ™è‡ªåŠ¨ï¼‰"},{default:t(()=>[e(E,{modelValue:P.value.focusHint,"onUpdate:modelValue":l[15]||(l[15]=a=>P.value.focusHint=a),placeholder:"ä¾‹å¦‚ï¼šè®°å½•æ•°å­¦è§£é¢˜æ­¥éª¤å’Œç”¨æˆ·å¸¸è§é”™è¯¯"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),s("div",ts,[e(c,{type:"primary",size:"small",loading:Ue.value,onClick:Ae},{default:t(()=>[...l[59]||(l[59]=[d(" ä¿å­˜è®¾ç½® ",-1)])]),_:1},8,["loading"]),e(c,{size:"small",loading:Fe.value,onClick:il},{default:t(()=>[...l[60]||(l[60]=[d(" ç«‹å³æ•´ç† ",-1)])]),_:1},8,["loading"]),e(H,{type:"info",size:"small",style:{"align-self":"center","margin-left":"4px"}},{default:t(()=>[d(" æ•´ç†åï¼šLLMæç‚¼æ‘˜è¦å†™å…¥ MEMORY.mdï¼Œæ¯ä¸ªä¼šè¯åªä¿ç•™æœ€è¿‘ "+v(P.value.keepTurns)+" è½®å¯¹è¯ ",1)]),_:1})])]),_:1},8,["model","disabled"])]),_:1}),e(Te,{style:{"margin-bottom":"16px"},shadow:"never"},{header:t(()=>[s("div",as,[l[62]||(l[62]=s("span",{style:{"font-weight":"600"}},"æ•´ç†æ—¥å¿—",-1)),e(c,{size:"small",text:"",onClick:o,loading:p.value},{default:t(()=>[...l[61]||(l[61]=[d("åˆ·æ–°",-1)])]),_:1},8,["loading"])])]),default:t(()=>[me.value.length===0&&!p.value?(u(),m("div",ns," æš‚æ— è¿è¡Œè®°å½•ï¼Œç‚¹å‡»ã€Œç«‹å³æ•´ç†ã€è§¦å‘ç¬¬ä¸€æ¬¡ ")):(u(),$(ml,{key:1,data:me.value.slice(0,20),size:"small"},{default:t(()=>[e(B,{label:"æ—¶é—´",width:"160"},{default:t(({row:a})=>[s("span",ss,v(tt(a.timestamp)),1)]),_:1}),e(B,{label:"çŠ¶æ€",width:"72"},{default:t(({row:a})=>[e(z,{type:a.status==="ok"?"success":"danger",size:"small"},{default:t(()=>[d(v(a.status),1)]),_:2},1032,["type"])]),_:1}),e(B,{label:"ç»“æœ","min-width":"200","show-overflow-tooltip":""},{default:t(({row:a})=>[s("span",os,v(a.message||"â€”"),1)]),_:1})]),_:1},8,["data"]))]),_:1}),s("div",is,[e(c,{type:"primary",size:"small",onClick:l[16]||(l[16]=a=>Z.value=!0)},{default:t(()=>[e(q,null,{default:t(()=>[e(D(Ll))]),_:1}),l[63]||(l[63]=d(" æ–°å»ºæ–‡ä»¶ ",-1))]),_:1}),e(c,{size:"small",onClick:l[17]||(l[17]=a=>he.value=!0)},{default:t(()=>[e(q,null,{default:t(()=>[e(D(la))]),_:1}),l[64]||(l[64]=d(" æ·»åŠ æ—¥å¿— ",-1))]),_:1}),e(c,{size:"small",onClick:cl},{default:t(()=>[e(q,null,{default:t(()=>[e(D(Gl))]),_:1}),l[65]||(l[65]=d(" åˆ·æ–° ",-1))]),_:1})]),e(tl,{gutter:16},{default:t(()=>[e(le,{span:7},{default:t(()=>[e(Te,{header:"è®°å¿†ç›®å½•",shadow:"hover"},{default:t(()=>[e(Pt,{data:i.value,props:{label:"name",children:"children",isLeaf:a=>!a.isDir},onNodeClick:It,"highlight-current":"","default-expand-all":"","expand-on-click-node":!1},{default:t(({data:a})=>[s("span",us,[a.isDir?(u(),$(q,{key:0,style:{color:"#E6A23C"}},{default:t(()=>[e(D(ta))]),_:1})):(u(),$(q,{key:1,style:{color:"#409EFF"}},{default:t(()=>[e(D(aa))]),_:1})),s("span",null,v(a.name),1),!a.isDir&&a.size?(u(),$(H,{key:2,type:"info",size:"small",style:{"margin-left":"auto"}},{default:t(()=>[d(v(gt(a.size)),1)]),_:2},1024)):C("",!0)])]),_:1},8,["data","props"]),i.value.length===0?(u(),$(ql,{key:0,description:"è®°å¿†æ ‘ä¸ºç©º","image-size":40})):C("",!0)]),_:1})]),_:1}),e(le,{span:17},{default:t(()=>[e(Te,{shadow:"hover"},{header:t(()=>[s("div",ds,[e(Kt,{separator:"/"},{default:t(()=>[e(ct,null,{default:t(()=>[...l[66]||(l[66]=[d("memory",-1)])]),_:1}),(u(!0),m(M,null,J(ke.value,(a,k)=>(u(),$(ct,{key:k},{default:t(()=>[d(v(a),1)]),_:2},1024))),128))]),_:1}),V.value?(u(),$(c,{key:0,type:"primary",size:"small",onClick:Lt,loading:j.value},{default:t(()=>[...l[67]||(l[67]=[d("ä¿å­˜",-1)])]),_:1},8,["loading"])):C("",!0)])]),default:t(()=>[V.value?(u(),$(E,{key:0,modelValue:h.value,"onUpdate:modelValue":l[18]||(l[18]=a=>h.value=a),type:"textarea",rows:22,style:{"font-family":"monospace"}},null,8,["modelValue"])):(u(),$(ql,{key:1,description:"ç‚¹å‡»å·¦ä¾§æ–‡ä»¶æŸ¥çœ‹å’Œç¼–è¾‘","image-size":60}))]),_:1})]),_:1})]),_:1}),e(Il,{modelValue:Z.value,"onUpdate:modelValue":l[21]||(l[21]=a=>Z.value=a),title:"æ–°å»ºè®°å¿†æ–‡ä»¶",width:"480px"},{footer:t(()=>[e(c,{onClick:l[20]||(l[20]=a=>Z.value=!1)},{default:t(()=>[...l[69]||(l[69]=[d("å–æ¶ˆ",-1)])]),_:1}),e(c,{type:"primary",onClick:Ut},{default:t(()=>[...l[70]||(l[70]=[d("åˆ›å»º",-1)])]),_:1})]),default:t(()=>[e(ll,{"label-width":"80px"},{default:t(()=>[e(U,{label:"è·¯å¾„"},{default:t(()=>[e(E,{modelValue:ie.value,"onUpdate:modelValue":l[19]||(l[19]=a=>ie.value=a),placeholder:"ä¾‹å¦‚: projects/my-project.md æˆ– topics/cooking.md"},null,8,["modelValue"]),e(H,{type:"info",size:"small",style:{"margin-top":"4px"}},{default:t(()=>[...l[68]||(l[68]=[d("ç›¸å¯¹äº memory/ ç›®å½•",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(Il,{modelValue:he.value,"onUpdate:modelValue":l[24]||(l[24]=a=>he.value=a),title:"æ·»åŠ ä»Šæ—¥æ—¥å¿—",width:"600px"},{footer:t(()=>[e(c,{onClick:l[23]||(l[23]=a=>he.value=!1)},{default:t(()=>[...l[71]||(l[71]=[d("å–æ¶ˆ",-1)])]),_:1}),e(c,{type:"primary",onClick:Ft},{default:t(()=>[...l[72]||(l[72]=[d("æäº¤",-1)])]),_:1})]),default:t(()=>[e(E,{modelValue:Xe.value,"onUpdate:modelValue":l[22]||(l[22]=a=>Xe.value=a),type:"textarea",rows:10,placeholder:"è®°å½•ä»Šå¤©çš„é‡è¦äº‹é¡¹ã€å­¦ä¹ å¿ƒå¾—ã€å¾…åŠ..."},null,8,["modelValue"])]),_:1},8,["modelValue"])]),_:1}),e(ze,{label:"æŠ€èƒ½",name:"skills"},{default:t(()=>[e(en,{"agent-id":D(g)},null,8,["agent-id"])]),_:1}),e(ze,{label:"å†å²å¯¹è¯",name:"convlogs"},{default:t(()=>[s("div",rs,[l[73]||(l[73]=s("span",{style:{"font-weight":"600","font-size":"15px"}},"æ¸ é“å¯¹è¯è®°å½•",-1)),e(c,{size:"small",icon:D(Gl),circle:"",onClick:ut,loading:Tl.value},null,8,["icon","loading"])]),Ee((u(),$(ml,{data:Ol.value,stripe:"","empty-text":"æš‚æ— å¯¹è¯è®°å½•"},{default:t(()=>[e(B,{label:"æ¸ é“","min-width":"200"},{default:t(({row:a})=>[s("span",null,v(a.channelType==="telegram"?"Telegram":"Web")+" "+v(a.channelId),1)]),_:1}),e(B,{label:"æ¶ˆæ¯æ•°",width:"100"},{default:t(({row:a})=>[d(v(a.messageCount)+" æ¡",1)]),_:1}),e(B,{label:"æœ€åæ´»è·ƒ",width:"180"},{default:t(({row:a})=>[d(v(a.lastAt?new Date(a.lastAt).toLocaleString("zh-CN"):"-"),1)]),_:1}),e(B,{label:"æ“ä½œ",width:"100"},{default:t(({row:a})=>[e(c,{size:"small",type:"primary",plain:"",onClick:k=>Et(a)},{default:t(()=>[...l[74]||(l[74]=[d("æŸ¥çœ‹",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[Jl,Tl.value]]),e(jt,{modelValue:Wl.value,"onUpdate:modelValue":l[25]||(l[25]=a=>Wl.value=a),title:Yl.value+" å¯¹è¯è®°å½•",direction:"rtl",size:"520px","destroy-on-close":!1},{default:t(()=>[s("div",cs,[Nt.value?(u(),m("div",vs,[e(c,{size:"small",plain:"",loading:vl.value,onClick:Bt},{default:t(()=>[...l[75]||(l[75]=[d("åŠ è½½æ›´å¤š",-1)])]),_:1},8,["loading"])])):C("",!0),Ee((u(),m("div",ms,[(u(!0),m(M,null,J(Ne.value,(a,k)=>(u(),m("div",{key:k,class:Ye(["conv-msg-item",a.role==="user"?"conv-msg-user":"conv-msg-assistant"])},[s("div",fs,[s("span",ps,v(a.role==="user"?"ç”¨æˆ·":"åŠ©æ‰‹"),1),a.sender?(u(),m("span",ys,v(a.sender),1)):C("",!0),s("span",gs,v(a.ts?new Date(a.ts).toLocaleString("zh-CN"):""),1)]),s("div",_s,v(a.content),1)],2))),128)),!vl.value&&Ne.value.length===0?(u(),m("div",ws," æš‚æ— æ¶ˆæ¯è®°å½• ")):C("",!0)])),[[Jl,vl.value&&Ne.value.length===0]])])]),_:1},8,["modelValue","title"])]),_:1}),e(ze,{label:"å·¥ä½œåŒº",name:"workspace"},{default:t(()=>[e(Tn,{"agent-id":D(g),style:{height:"calc(100vh - 145px)"}},null,8,["agent-id"])]),_:1}),e(ze,{label:"å®šæ—¶ä»»åŠ¡",name:"cron"},{default:t(()=>[e(c,{type:"primary",onClick:l[26]||(l[26]=a=>Ke.value=!0),style:{"margin-bottom":"16px"}},{default:t(()=>[e(q,null,{default:t(()=>[e(D(Ll))]),_:1}),l[76]||(l[76]=d(" æ–°å»ºä»»åŠ¡ ",-1))]),_:1}),e(ml,{data:Cl.value,stripe:""},{default:t(()=>[e(B,{prop:"name",label:"åç§°"}),e(B,{label:"è°ƒåº¦"},{default:t(({row:a})=>[d(v(a.schedule?.expr)+" ("+v(a.schedule?.tz)+")",1)]),_:1}),e(B,{label:"æœ€è¿‘è¿è¡Œ",width:"180"},{default:t(({row:a})=>[a.state?.lastRunAtMs?(u(),m(M,{key:0},[e(z,{type:a.state?.lastStatus==="ok"?"success":"danger",size:"small"},{default:t(()=>[d(v(a.state?.lastStatus),1)]),_:2},1032,["type"]),e(H,{type:"info",size:"small",style:{"margin-left":"4px"}},{default:t(()=>[d(v(tt(a.state?.lastRunAtMs)),1)]),_:2},1024)],64)):(u(),$(H,{key:1,type:"info",size:"small"},{default:t(()=>[...l[77]||(l[77]=[d("æœªè¿è¡Œ",-1)])]),_:1}))]),_:1}),e(B,{label:"å¯ç”¨",width:"80"},{default:t(({row:a})=>[e(fl,{modelValue:a.enabled,"onUpdate:modelValue":k=>a.enabled=k,onChange:k=>Dt(a)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),e(B,{label:"æ“ä½œ",width:"220"},{default:t(({row:a})=>[a.payload?.message==="__MEMORY_CONSOLIDATE__"?(u(),m(M,{key:0},[e(z,{type:"info",size:"small",style:{"margin-right":"8px"}},{default:t(()=>[...l[78]||(l[78]=[d("è®°å¿†ç®¡ç†",-1)])]),_:1}),e(c,{size:"small",onClick:k=>it(a)},{default:t(()=>[...l[79]||(l[79]=[d("ç«‹å³è¿è¡Œ",-1)])]),_:1},8,["onClick"])],64)):(u(),m(M,{key:1},[e(c,{size:"small",onClick:k=>it(a)},{default:t(()=>[...l[80]||(l[80]=[d("ç«‹å³è¿è¡Œ",-1)])]),_:1},8,["onClick"]),e(c,{size:"small",type:"danger",onClick:k=>Mt(a)},{default:t(()=>[...l[81]||(l[81]=[d("åˆ é™¤",-1)])]),_:1},8,["onClick"])],64))]),_:1})]),_:1},8,["data"]),e(Il,{modelValue:Ke.value,"onUpdate:modelValue":l[33]||(l[33]=a=>Ke.value=a),title:"æ–°å»ºå®šæ—¶ä»»åŠ¡",width:"520px"},{footer:t(()=>[e(c,{onClick:l[32]||(l[32]=a=>Ke.value=!1)},{default:t(()=>[...l[82]||(l[82]=[d("å–æ¶ˆ",-1)])]),_:1}),e(c,{type:"primary",onClick:At},{default:t(()=>[...l[83]||(l[83]=[d("åˆ›å»º",-1)])]),_:1})]),default:t(()=>[e(ll,{model:O.value,"label-width":"100px"},{default:t(()=>[e(U,{label:"åç§°"},{default:t(()=>[e(E,{modelValue:O.value.name,"onUpdate:modelValue":l[27]||(l[27]=a=>O.value.name=a)},null,8,["modelValue"])]),_:1}),e(U,{label:"Cron è¡¨è¾¾å¼"},{default:t(()=>[e(E,{modelValue:O.value.expr,"onUpdate:modelValue":l[28]||(l[28]=a=>O.value.expr=a),placeholder:"30 3 * * *"},null,8,["modelValue"])]),_:1}),e(U,{label:"æ—¶åŒº"},{default:t(()=>[e(Ve,{modelValue:O.value.tz,"onUpdate:modelValue":l[29]||(l[29]=a=>O.value.tz=a)},{default:t(()=>[e(L,{label:"Asia/Shanghai",value:"Asia/Shanghai"}),e(L,{label:"UTC",value:"UTC"}),e(L,{label:"America/New_York",value:"America/New_York"})]),_:1},8,["modelValue"])]),_:1}),e(U,{label:"æ¶ˆæ¯"},{default:t(()=>[e(E,{modelValue:O.value.message,"onUpdate:modelValue":l[30]||(l[30]=a=>O.value.message=a),type:"textarea",rows:3},null,8,["modelValue"])]),_:1}),e(U,{label:"å¯ç”¨"},{default:t(()=>[e(fl,{modelValue:O.value.enabled,"onUpdate:modelValue":l[31]||(l[31]=a=>O.value.enabled=a)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])]),_:1}),e(ze,{label:"æ¸ é“",name:"channels"},{default:t(()=>[s("div",bs,[e(H,{type:"info",size:"small"},{default:t(()=>[...l[84]||(l[84]=[d("æ¯ä¸ª AI æˆå‘˜ç‹¬ç«‹é…ç½®è‡ªå·±çš„æ¶ˆæ¯é€šé“ï¼ˆå¦‚ Telegram Bot Tokenï¼‰",-1)])]),_:1}),e(c,{type:"primary",size:"small",onClick:_t},{default:t(()=>[e(q,null,{default:t(()=>[e(D(Ll))]),_:1}),l[85]||(l[85]=d(" æ·»åŠ æ¶ˆæ¯æ¸ é“ ",-1))]),_:1})]),(u(!0),m(M,null,J(Se.value,a=>(u(),m("div",{key:a.id,class:"channel-card"},[s("div",ks,[s("div",hs,[e(z,{size:"small",style:{"margin-right":"8px"}},{default:t(()=>[d(v(a.type),1)]),_:2},1024),s("span",xs,v(a.name),1),a.config?.botName?(u(),m("span",Cs,"@"+v(a.config.botName),1)):C("",!0),e(z,{type:a.status==="ok"?"success":a.status==="error"?"danger":"info",size:"small",effect:"plain",style:{"margin-left":"8px"}},{default:t(()=>[d(v(a.status==="ok"?"âœ“ æ­£å¸¸":a.status==="error"?"âœ— é”™è¯¯":"æœªæµ‹è¯•"),1)]),_:2},1032,["type"])]),s("div",$s,[e(fl,{modelValue:a.enabled,"onUpdate:modelValue":k=>a.enabled=k,size:"small",onChange:kt,style:{"margin-right":"8px"}},null,8,["modelValue","onUpdate:modelValue"]),e(c,{size:"small",onClick:k=>xt(a),loading:El.value===a.id},{default:t(()=>[...l[86]||(l[86]=[d("æµ‹è¯•è¿æ¥",-1)])]),_:1},8,["onClick","loading"]),e(c,{size:"small",onClick:k=>wt(a)},{default:t(()=>[...l[87]||(l[87]=[d("ç¼–è¾‘",-1)])]),_:1},8,["onClick"]),e(c,{size:"small",type:"danger",plain:"",onClick:k=>ht(a)},{default:t(()=>[...l[88]||(l[88]=[d("åˆ é™¤",-1)])]),_:1},8,["onClick"])])]),a.type==="web"?(u(),m("div",Vs,[s("div",zs,[l[90]||(l[90]=s("span",{class:"channel-info-label"},"å…¬å¼€åœ°å€",-1)),s("span",Ts,[e(Ot,{href:Qe(D(g),a.id),target:"_blank",type:"primary",style:{"font-size":"13px"}},{default:t(()=>[d(v(Qe(D(g),a.id)),1)]),_:2},1032,["href"]),e(c,{size:"small",link:"",style:{"margin-left":"8px"},onClick:k=>nt(Qe(D(g),a.id))},{default:t(()=>[...l[89]||(l[89]=[d("å¤åˆ¶",-1)])]),_:1},8,["onClick"])])]),s("div",Ss,[l[91]||(l[91]=s("span",{class:"channel-info-label"},"è®¿é—®å¯†ç ",-1)),s("span",Is,[e(z,{size:"small",type:a.config?.password?"warning":"info",effect:"plain"},{default:t(()=>[d(v(a.config?.password?"å·²è®¾ç½®":"æ— å¯†ç "),1)]),_:2},1032,["type"])])])])):C("",!0),a.type==="telegram"?(u(),m("div",Ls,[s("div",Us,[l[93]||(l[93]=s("span",{class:"channel-info-label"},"ç™½åå•ç”¨æˆ·",-1)),s("span",Fs,[a.allowedFromUsers?.length?(u(!0),m(M,{key:0},J(a.allowedFromUsers,k=>(u(),$(z,{key:k.id,size:"small",closable:"","disable-transitions":!0,style:{"margin-right":"4px","margin-bottom":"4px"},onClose:Xl=>st(a.id,k.id)},{default:t(()=>[d(v(k.username?"@"+k.username:k.firstName||String(k.id))+" ",1),s("span",As,"("+v(k.id)+")",1)]),_:2},1032,["onClose"]))),128)):a.config?.allowedFrom?(u(!0),m(M,{key:1},J(a.config.allowedFrom.split(","),k=>(u(),$(z,{key:k,size:"small",closable:"","disable-transitions":!0,style:{"margin-right":"4px","margin-bottom":"4px"},onClose:Xl=>st(a.id,Number(k.trim()))},{default:t(()=>[d(v(k.trim()),1)]),_:2},1032,["onClose"]))),128)):(u(),$(H,{key:2,type:"warning",size:"small"},{default:t(()=>[...l[92]||(l[92]=[d("æœªè®¾ç½®ï¼ˆé…å¯¹æ¨¡å¼ï¼Œå‘ç”¨æˆ·è¿”å›å…¶ IDï¼‰",-1)])]),_:1}))])]),s("div",Ds,[s("div",{class:"pending-section-header",onClick:k=>Ct(a.id)},[l[95]||(l[95]=s("span",null,"å¾…å®¡æ ¸ç”¨æˆ·",-1)),e(rt,{value:(el.value[a.id]||[]).length,hidden:!(el.value[a.id]||[]).length,type:"warning",style:{"margin-left":"6px"}},null,8,["value","hidden"]),e(c,{size:"small",link:"",onClick:al(k=>Vl(a.id),["stop"]),style:{"margin-left":"8px"}},{default:t(()=>[...l[94]||(l[94]=[d("åˆ·æ–°",-1)])]),_:1},8,["onClick"]),e(q,{style:We([{"margin-left":"4px",transition:"transform 0.2s"},{transform:rl.value===a.id?"rotate(180deg)":""}])},{default:t(()=>[e(D(na))]),_:1},8,["style"])],8,Ms),rl.value===a.id?(u(),m("div",Ns,[Kl.value[a.id]?(u(),m("div",Es,[e(H,{type:"info",size:"small"},{default:t(()=>[...l[96]||(l[96]=[d("åŠ è½½ä¸­...",-1)])]),_:1})])):(el.value[a.id]||[]).length?(u(!0),m(M,{key:1},J(el.value[a.id],k=>(u(),m("div",{key:k.id,class:"pending-user-row"},[s("div",Bs,[s("span",Rs,v(k.firstName||"æœªçŸ¥"),1),k.username?(u(),m("span",Ps,"@"+v(k.username),1)):C("",!0),s("span",Ks,"ID: "+v(k.id),1),e(H,{type:"info",size:"small",style:{"margin-left":"8px"}},{default:t(()=>[d(v(ne(k.lastSeen)),1)]),_:2},1024)]),s("div",js,[e(c,{size:"small",type:"success",plain:"",onClick:Xl=>$t(a.id,k.id),loading:jl.value===`${a.id}-${k.id}`},{default:t(()=>[...l[97]||(l[97]=[d("åŠ å…¥ç™½åå•",-1)])]),_:1},8,["onClick","loading"]),e(c,{size:"small",type:"danger",plain:"",onClick:Xl=>Vt(a.id,k.id)},{default:t(()=>[...l[98]||(l[98]=[d("å¿½ç•¥",-1)])]),_:1},8,["onClick"])])]))),128)):(u(),m("div",Os," æš‚æ— å¾…å®¡æ ¸ç”¨æˆ·ã€‚è®©ç”¨æˆ·å‘ Bot å‘é€ /start å³å¯å‡ºç°åœ¨æ­¤å¤„ã€‚ "))])):C("",!0)])])):C("",!0)]))),128)),!Ml.value&&!Se.value.length?(u(),$(ql,{key:0,description:"æš‚æ— æ¶ˆæ¯æ¸ é“ï¼Œç‚¹å‡»ã€Œæ·»åŠ æ¶ˆæ¯æ¸ é“ã€å¼€å§‹é…ç½®","image-size":80,style:{"margin-top":"40px"}})):C("",!0),e(Il,{modelValue:Ge.value,"onUpdate:modelValue":l[44]||(l[44]=a=>Ge.value=a),title:$e.value?"ç¼–è¾‘æ¶ˆæ¯æ¸ é“":"æ·»åŠ æ¶ˆæ¯æ¸ é“",width:"540px"},{footer:t(()=>[e(c,{onClick:l[43]||(l[43]=a=>Ge.value=!1)},{default:t(()=>[...l[108]||(l[108]=[d("å–æ¶ˆ",-1)])]),_:1}),e(c,{type:"primary",onClick:bt,loading:Nl.value},{default:t(()=>[...l[109]||(l[109]=[d("ä¿å­˜",-1)])]),_:1},8,["loading"])]),default:t(()=>[e(ll,{model:b.value,"label-width":"120px"},{default:t(()=>[e(U,{label:"ç±»å‹",required:""},{default:t(()=>[e(Ve,{modelValue:b.value.type,"onUpdate:modelValue":l[34]||(l[34]=a=>b.value.type=a),style:{width:"100%"}},{default:t(()=>[e(L,{label:"Telegram",value:"telegram"}),e(L,{label:"Web èŠå¤©é¡µ",value:"web"}),e(L,{label:"iMessage",value:"imessage"}),e(L,{label:"WhatsApp",value:"whatsapp"})]),_:1},8,["modelValue"])]),_:1}),e(U,{label:"åç§°",required:""},{default:t(()=>[e(E,{modelValue:b.value.name,"onUpdate:modelValue":l[35]||(l[35]=a=>b.value.name=a),placeholder:"å¦‚ï¼šå®¢æœ Bot"},null,8,["modelValue"])]),_:1}),b.value.type==="telegram"?(u(),m(M,{key:0},[e(U,{label:"Bot Token",required:""},{default:t(()=>[s("div",Ws,[s("div",Ys,[e(E,{modelValue:b.value.botToken,"onUpdate:modelValue":l[36]||(l[36]=a=>b.value.botToken=a),type:"password","show-password":"",placeholder:"ä» @BotFather è·å–",style:{flex:"1"},status:A.value.status==="error"?"error":A.value.status==="ok"?"success":""},null,8,["modelValue","status"]),e(c,{size:"default",loading:A.value.loading,type:A.value.status==="ok"?"success":A.value.status==="error"?"danger":"default",onClick:at,disabled:!b.value.botToken||Rl(b.value.botToken)},{default:t(()=>[...l[99]||(l[99]=[d("éªŒè¯",-1)])]),_:1},8,["loading","type","disabled"])]),A.value.loading?(u(),m("div",Hs,[e(q,{class:"is-loading"},{default:t(()=>[e(D(Gl))]),_:1}),l[100]||(l[100]=d(" æ­£åœ¨éªŒè¯ Tokenâ€¦ ",-1))])):A.value.status==="ok"?(u(),m("div",qs,[e(q,{style:{"vertical-align":"-2px","margin-right":"4px"}},{default:t(()=>[e(Wt)]),_:1}),l[101]||(l[101]=d("Token æœ‰æ•ˆï¼ŒBot åç§°ï¼š",-1)),s("b",null,"@"+v(A.value.botName),1)])):A.value.status==="duplicate"?(u(),m("div",Js,[e(q,{style:{"vertical-align":"-2px","margin-right":"4px"}},{default:t(()=>[e(Yt)]),_:1}),l[102]||(l[102]=d("æ­¤ Token å·²è¢«æˆå‘˜ã€Œ",-1)),s("b",null,v(A.value.usedBy),1),d("ã€çš„æ¸ é“ã€Œ"+v(A.value.usedByCh)+"ã€ä½¿ç”¨ ",1)])):A.value.status==="error"?(u(),m("div",Xs,[e(q,{style:{"vertical-align":"-2px","margin-right":"4px"}},{default:t(()=>[e(Ht)]),_:1}),d(v(A.value.error),1)])):(u(),m("div",Gs,[e(H,{type:"info",size:"small"},{default:t(()=>[e(q,{style:{"vertical-align":"-2px","margin-right":"4px"}},{default:t(()=>[e(vt)]),_:1}),l[103]||(l[103]=d("è¾“å…¥å®Œæˆåè‡ªåŠ¨éªŒè¯ï¼Œä¹Ÿå¯ç‚¹å³ä¾§ã€ŒéªŒè¯ã€æŒ‰é’®æ‰‹åŠ¨è§¦å‘",-1))]),_:1})]))])]),_:1}),e(U,{label:"ç™½åå•ç”¨æˆ·"},{default:t(()=>[e(E,{modelValue:b.value.allowedFrom,"onUpdate:modelValue":l[37]||(l[37]=a=>b.value.allowedFrom=a),placeholder:"å¡«å…¥ Telegram ç”¨æˆ· IDï¼Œå¤šä¸ªç”¨é€—å·åˆ†éš”"},null,8,["modelValue"]),e(H,{type:"info",size:"small",style:{display:"block","margin-top":"4px"}},{default:t(()=>[e(q,{style:{"vertical-align":"-2px","margin-right":"4px"}},{default:t(()=>[e(vt)]),_:1}),l[104]||(l[104]=d("ç•™ç©ºæ—¶ Bot è¿›å…¥é…å¯¹æ¨¡å¼â€”â€”å‘ç”¨æˆ·è¿”å›å…¶ IDï¼Œå¼•å¯¼è”ç³»ç®¡ç†å‘˜æ·»åŠ ç™½åå• ",-1))]),_:1})]),_:1})],64)):C("",!0),b.value.type==="web"?(u(),m(M,{key:1},[$e.value?(u(),$(U,{key:0,label:"è®¿é—®é“¾æ¥"},{default:t(()=>[s("div",Qs,[e(q,{style:{"flex-shrink":"0",color:"#909399"}},{default:t(()=>[e(mt)]),_:1}),s("span",Zs,v(Qe(D(g),$e.value)),1),e(c,{size:"small",link:"",onClick:l[38]||(l[38]=a=>nt(Qe(D(g),$e.value)))},{default:t(()=>[...l[105]||(l[105]=[d("å¤åˆ¶",-1)])]),_:1})])]),_:1})):C("",!0),$e.value?C("",!0):(u(),$(U,{key:1,label:"è®¿é—®é“¾æ¥"},{default:t(()=>[s("div",eo,[e(q,{style:{"flex-shrink":"0",color:"#909399"}},{default:t(()=>[e(mt)]),_:1}),s("span",lo,v(Qe(D(g),$l.value)),1),e(z,{size:"small",type:"info",effect:"plain"},{default:t(()=>[...l[106]||(l[106]=[d("ä¿å­˜åç”Ÿæ•ˆ",-1)])]),_:1})]),e(H,{type:"info",size:"small",style:{display:"block","margin-top":"4px"}},{default:t(()=>[...l[107]||(l[107]=[d(" æ¯ä¸ª Web æ¸ é“æœ‰ç‹¬ç«‹é“¾æ¥ï¼Œå¯åŒæ—¶å¼€æ”¾å¤šä¸ªå…¥å£ ",-1)])]),_:1})]),_:1})),e(U,{label:"è®¿é—®å¯†ç "},{default:t(()=>[e(E,{modelValue:b.value.webPassword,"onUpdate:modelValue":l[39]||(l[39]=a=>b.value.webPassword=a),type:"password","show-password":"",placeholder:"ç•™ç©ºåˆ™æ— éœ€å¯†ç "},null,8,["modelValue"])]),_:1}),e(U,{label:"æ¬¢è¿è¯­"},{default:t(()=>[e(E,{modelValue:b.value.webWelcome,"onUpdate:modelValue":l[40]||(l[40]=a=>b.value.webWelcome=a),placeholder:"ä½ å¥½ï¼æœ‰ä»€ä¹ˆå¯ä»¥å¸®ä½ çš„ï¼Ÿ"},null,8,["modelValue"])]),_:1}),e(U,{label:"é¡µé¢æ ‡é¢˜"},{default:t(()=>[e(E,{modelValue:b.value.webTitle,"onUpdate:modelValue":l[41]||(l[41]=a=>b.value.webTitle=a),placeholder:"AI åŠ©æ‰‹"},null,8,["modelValue"])]),_:1})],64)):C("",!0),e(U,{label:"å¯ç”¨"},{default:t(()=>[e(fl,{modelValue:b.value.enabled,"onUpdate:modelValue":l[42]||(l[42]=a=>b.value.enabled=a)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])]),_:1}),e(ze,{label:"ç¯å¢ƒå˜é‡",name:"env"},{default:t(()=>[s("div",to,[l[113]||(l[113]=s("div",{style:{"margin-bottom":"16px"}},[s("h3",{style:{margin:"0 0 8px 0","font-size":"15px"}},"ç¯å¢ƒå˜é‡"),s("p",{style:{margin:"0",color:"#666","font-size":"13px"}},[d(" é…ç½®æ­¤ AI æˆå‘˜åœ¨æ‰§è¡Œ exec å‘½ä»¤æ—¶å¯ç”¨çš„ç¯å¢ƒå˜é‡ï¼Œä¾‹å¦‚ GITHUB_TOKENã€GIT_AUTHOR_NAME ç­‰ã€‚"),s("br"),d(" è¿™äº›å˜é‡ä¼šæ³¨å…¥åˆ° bash å·¥å…·çš„æ‰§è¡Œç¯å¢ƒä¸­ï¼Œ"),s("strong",null,"ä¸å—ç³»ç»Ÿé»˜è®¤çš„ token è¿‡æ»¤å½±å“"),d("ã€‚ ")])],-1)),s("div",ao,[e(E,{modelValue:re.value,"onUpdate:modelValue":l[45]||(l[45]=a=>re.value=a),placeholder:"KEYï¼ˆå¦‚ GITHUB_TOKENï¼‰",style:{width:"220px","font-family":"monospace"},size:"small",onKeyup:nl(be,["enter"])},null,8,["modelValue"]),e(E,{modelValue:ve.value,"onUpdate:modelValue":l[46]||(l[46]=a=>ve.value=a),placeholder:"VALUE",style:{flex:"1","font-family":"monospace"},size:"small",type:"password","show-password":"",onKeyup:nl(be,["enter"])},null,8,["modelValue"]),e(c,{size:"small",type:"primary",onClick:be,disabled:!re.value.trim()},{default:t(()=>[...l[110]||(l[110]=[d(" æ·»åŠ  ",-1)])]),_:1},8,["disabled"])]),e(ml,{data:N.value,size:"small",style:{width:"100%","margin-bottom":"16px"},"empty-text":"æš‚æ— ç¯å¢ƒå˜é‡"},{default:t(()=>[e(B,{label:"KEY","min-width":"200"},{default:t(({row:a})=>[s("code",no,v(a.key),1)]),_:1}),e(B,{label:"VALUE","min-width":"200"},{default:t(({row:a})=>[e(E,{modelValue:a.value,"onUpdate:modelValue":k=>a.value=k,type:"password","show-password":"",size:"small",style:{"font-family":"monospace"},placeholder:"ï¼ˆæœªè®¾ç½®ï¼‰"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(B,{label:"æ“ä½œ",width:"80",fixed:"right"},{default:t(({$index:a})=>[e(c,{size:"small",type:"danger",link:"",onClick:k=>Je(a)},{default:t(()=>[...l[111]||(l[111]=[d("åˆ é™¤",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]),e(c,{type:"primary",size:"small",loading:we.value,onClick:Re},{default:t(()=>[...l[112]||(l[112]=[d(" ä¿å­˜ç¯å¢ƒå˜é‡ ",-1)])]),_:1},8,["loading"])])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})}}}),vo=lt(oo,[["__scopeId","data-v-3d317701"]]);export{vo as default};
