import{d as Ae,h as $e,c as u,f as s,a as i,w as n,s as S,e as d,F as b,j as x,l as A,t as c,y as Te,b as ne,q as Y,g as _,m as E,z as ae,r as v,o as a,i as F,A as Se,k as y,B as Le,C as Ue,u as De,n as oe,D as Me,E as D}from"./index-CT8hF4h0.js";import{m as ze,c as Ne,t as he,s as Ee,b as ie,d as de}from"./index-D9iuGmy4.js";import{_ as Fe}from"./_plugin-vue_export-helper-DlAUqK2U.js";const je={class:"create-layout"},Be={class:"create-left"},Ke={class:"create-header"},Oe={class:"form-section"},Pe={class:"color-row"},He=["onClick"],Re={class:"form-section"},qe={class:"section-title"},Je={key:0,class:"ai-badge"},Ye={class:"form-section"},Ge={class:"form-section"},Qe={key:0,class:"empty-hint"},We={class:"form-section"},Xe={key:0,class:"empty-hint"},Ze={class:"form-section"},et={key:0,class:"empty-hint"},tt={class:"create-footer"},lt={class:"create-right"},st={class:"agent-tabs-bar"},nt={class:"agent-tabs-scroll"},at=["onClick"],ot={class:"agent-tab add-tab"},it={key:0,class:"assist-hint"},dt={key:0,class:"chat-empty"},ut={key:1},rt={class:"msg-bubble"},pt={key:0,class:"apply-card"},mt={class:"apply-fields"},ft={class:"field-name"},vt={class:"field-preview"},ct=["innerHTML"],_t={key:1,class:"chat-msg assistant"},yt={class:"msg-bubble"},kt={class:"msg-text"},gt={class:"chat-input-area"},bt=Ae({__name:"AgentCreateView",setup(xt){const ue=De(),o=Y({name:"",id:"",description:"",avatarColor:"#409eff",identity:"",soul:"",modelId:"",channelIds:[],toolIds:[],skillIds:[]}),k=Y(new Set),G={},j=_(!1),re=["#409eff","#67c23a","#e6a23c","#f56c6c","#909399","#9b59b6","#1abc9c","#e74c3c"];function Q(){o.id=o.name.toLowerCase().replace(/[^a-z0-9\u4e00-\u9fff\s-]/g,"").trim().replace(/[\s\u4e00-\u9fff]+/g,"-").replace(/-+/g,"-").slice(0,32)}function W(l){const e=l;o[e]=G[l]||"",k.delete(l)}function pe(l){const e={name:"name",id:"id",description:"description",identity:"identity",soul:"soul"};for(const[p,r]of Object.entries(l)){const m=e[p];m&&(G[p]=o[m],o[m]=r,k.add(p),p==="name"&&Q())}D.success("å·²åº”ç”¨åˆ°å·¦ä¾§è¡¨å•")}async function me(){if(!o.name.trim()){D.warning("è¯·å¡«å†™åç§°");return}if(!o.id.trim()){D.warning("è¯·å¡«å†™ ID");return}j.value=!0;try{await ie.create({...o,model:o.modelId||""}),D.success("Agent åˆ›å»ºæˆåŠŸï¼"),ue.push(`/agents/${o.id}`)}catch(l){D.error(l.response?.data?.error||"åˆ›å»ºå¤±è´¥")}finally{j.value=!1}}const M=_([]),B=_([]),K=_([]),O=_([]),L=_([]),f=_("__assist__"),$=_([]),fe=E(()=>L.value.filter(l=>$.value.includes(l.id))),X=E(()=>L.value.filter(l=>!$.value.includes(l.id))),ve=E(()=>f.value==="__assist__"?"é…ç½®åŠ©æ‰‹":L.value.find(l=>l.id===f.value)?.name||f.value);function z(l){f.value=l,ae(()=>T())}function ce(l){$.value.includes(l)||$.value.push(l),z(l)}function _e(l){$.value=$.value.filter(e=>e!==l),f.value===l&&z("__assist__")}const C=Y({__assist__:[]}),Z=E(()=>C[f.value]||[]),U=_(""),w=_(!1),V=_(""),N=_();function T(){ae(()=>{N.value&&(N.value.scrollTop=N.value.scrollHeight)})}function P(l){U.value=l}function ye(l){return l.replace(/\n/g,"<br>")}function ke(l){return{name:"åç§°",id:"ID",description:"æè¿°",identity:"IDENTITY",soul:"SOUL"}[l]||l}async function ee(){const l=U.value.trim();!l||w.value||(C[f.value]||(C[f.value]=[]),C[f.value].push({role:"user",text:l}),U.value="",w.value=!0,V.value="",T(),f.value==="__assist__"?await ge(l):await be(f.value,l))}async function ge(l){const e=`å½“å‰è¡¨å•çŠ¶æ€ï¼šåç§°="${o.name||"ï¼ˆæœªå¡«ï¼‰"}", æè¿°="${o.description||"ï¼ˆæœªå¡«ï¼‰"}"ã€‚
ç”¨æˆ·è¦æ±‚ï¼š${l}

è¯·ç”Ÿæˆ Agent é…ç½®ã€‚å¦‚æœæœ‰è¶³å¤Ÿä¿¡æ¯ï¼Œåœ¨å›ç­”æœ«å°¾é™„ä¸ŠJSONå—ï¼ˆå­—æ®µï¼šname/description/identity/soulï¼‰ï¼Œæ ¼å¼ï¼š
\`\`\`json
{"name":"...","description":"...","identity":"...","soul":"..."}
\`\`\``;let p="",r;try{const m=L.value[0]?.id||"main";await new Promise(H=>{de(m,e,I=>{I.type==="text"?(V.value+=I.text,p+=I.text,T()):(I.type==="done"||I.type==="error")&&H()})});const g=p.match(/```json\s*([\s\S]+?)\s*```/);if(g)try{r=JSON.parse(g[1]),p=p.replace(/```json[\s\S]+?```/,"").trim()}catch{}}catch{p="æŠ±æ­‰ï¼Œç”Ÿæˆé…ç½®æ—¶å‡ºé”™äº†ã€‚è¯·æ£€æŸ¥æ˜¯å¦å·²é…ç½®æ¨¡å‹ API Keyã€‚"}C.__assist__.push({role:"assistant",text:p||V.value,applyData:r}),V.value="",w.value=!1,T()}async function be(l,e){let p="";de(l,e,r=>{r.type==="text"?(V.value+=r.text,p+=r.text,T()):(r.type==="done"||r.type==="error")&&(C[l]||(C[l]=[]),C[l].push({role:"assistant",text:p||V.value||(r.error?`âŒ ${r.error}`:"")}),V.value="",w.value=!1,T())})}return $e(async()=>{const[l,e,p,r,m]=await Promise.allSettled([ze.list(),Ne.list(),he.list(),Ee.list(),ie.list()]);l.status==="fulfilled"&&(M.value=l.value.data),e.status==="fulfilled"&&(B.value=e.value.data),p.status==="fulfilled"&&(K.value=p.value.data),r.status==="fulfilled"&&(O.value=r.value.data),m.status==="fulfilled"&&(L.value=m.value.data),M.value.length>0&&(o.modelId=M.value[0]?.id??"")}),(l,e)=>{const p=v("el-icon"),r=v("el-button"),m=v("el-input"),g=v("el-form-item"),H=v("el-option"),I=v("el-select"),te=v("el-link"),xe=v("el-tag"),R=v("el-checkbox"),q=v("el-checkbox-group"),Ce=v("el-text"),Ve=v("el-form"),le=v("el-dropdown-item"),we=v("el-dropdown-menu"),Ie=v("el-dropdown");return a(),u("div",je,[s("div",Be,[s("div",Ke,[i(r,{text:"",onClick:e[0]||(e[0]=t=>l.$router.push("/agents")),class:"back-btn"},{default:n(()=>[i(p,null,{default:n(()=>[i(F(Se))]),_:1}),e[22]||(e[22]=d(" è¿”å› ",-1))]),_:1}),e[23]||(e[23]=s("h2",{style:{margin:"0"}},"æ–°å»º AI å‘˜å·¥",-1))]),i(Ve,{model:o,"label-position":"top",class:"create-form"},{default:n(()=>[s("div",Oe,[e[24]||(e[24]=s("div",{class:"section-title"},"åŸºæœ¬ä¿¡æ¯",-1)),i(g,{label:"åç§°",required:""},{default:n(()=>[i(m,{modelValue:o.name,"onUpdate:modelValue":e[1]||(e[1]=t=>o.name=t),placeholder:"å¦‚ï¼šç”µå•†å®¢æœåŠ©æ‰‹",onInput:Q},null,8,["modelValue"])]),_:1}),i(g,{label:"ID"},{default:n(()=>[i(m,{modelValue:o.id,"onUpdate:modelValue":e[2]||(e[2]=t=>o.id=t),placeholder:"è‹±æ–‡æ ‡è¯†ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰"},null,8,["modelValue"])]),_:1}),i(g,{label:"æè¿°"},{default:n(()=>[i(m,{modelValue:o.description,"onUpdate:modelValue":e[3]||(e[3]=t=>o.description=t),type:"textarea",rows:2,placeholder:"ç®€çŸ­æè¿°è¿™ä¸ª Agent çš„èŒè´£"},null,8,["modelValue"])]),_:1}),i(g,{label:"å¤´åƒé¢œè‰²"},{default:n(()=>[s("div",Pe,[(a(),u(b,null,x(re,t=>s("div",{key:t,class:S(["color-swatch",{active:o.avatarColor===t}]),style:oe({background:t}),onClick:h=>o.avatarColor=t},null,14,He)),64))])]),_:1})]),s("div",Re,[s("div",qe,[e[25]||(e[25]=d(" èº«ä»½ & çµé­‚ ",-1)),k.has("identity")||k.has("soul")?(a(),u("span",Je,"AI ç”Ÿæˆ")):A("",!0)]),i(g,null,{label:n(()=>[e[27]||(e[27]=s("span",null,[d("IDENTITY "),s("span",{class:"field-hint"},"â€” è§’è‰²å®šä¹‰")],-1)),k.has("identity")?(a(),y(r,{key:0,text:"",size:"small",onClick:e[4]||(e[4]=t=>W("identity")),class:"revert-btn"},{default:n(()=>[...e[26]||(e[26]=[d("â†º æ’¤é”€",-1)])]),_:1})):A("",!0)]),default:n(()=>[i(m,{modelValue:o.identity,"onUpdate:modelValue":e[5]||(e[5]=t=>o.identity=t),type:"textarea",rows:5,class:S({"ai-filled":k.has("identity")}),placeholder:"ä½ æ˜¯ä¸€ä¸ª...ï¼ˆæè¿° Agent çš„è§’è‰²å’Œèƒ½åŠ›ï¼‰",onInput:e[6]||(e[6]=t=>k.delete("identity"))},null,8,["modelValue","class"])]),_:1}),i(g,null,{label:n(()=>[e[29]||(e[29]=s("span",null,[d("SOUL "),s("span",{class:"field-hint"},"â€” è¡Œä¸ºé£æ ¼")],-1)),k.has("soul")?(a(),y(r,{key:0,text:"",size:"small",onClick:e[7]||(e[7]=t=>W("soul")),class:"revert-btn"},{default:n(()=>[...e[28]||(e[28]=[d("â†º æ’¤é”€",-1)])]),_:1})):A("",!0)]),default:n(()=>[i(m,{modelValue:o.soul,"onUpdate:modelValue":e[8]||(e[8]=t=>o.soul=t),type:"textarea",rows:5,class:S({"ai-filled":k.has("soul")}),placeholder:"è¯­æ°”äº²åˆ‡ï¼Œå›ç­”ç®€æ´...ï¼ˆæè¿° Agent çš„ä¸ªæ€§é£æ ¼ï¼‰",onInput:e[9]||(e[9]=t=>k.delete("soul"))},null,8,["modelValue","class"])]),_:1})]),s("div",Ye,[e[30]||(e[30]=s("div",{class:"section-title"},"æ¨¡å‹",-1)),i(g,{label:"é€‰æ‹©æ¨¡å‹"},{default:n(()=>[i(I,{modelValue:o.modelId,"onUpdate:modelValue":e[10]||(e[10]=t=>o.modelId=t),placeholder:"é€‰æ‹©æ¨¡å‹",style:{width:"100%"}},{default:n(()=>[(a(!0),u(b,null,x(M.value,t=>(a(),y(H,{key:t.id,label:`${t.name}ï¼ˆ${t.provider}ï¼‰`,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),s("div",Ge,[e[34]||(e[34]=s("div",{class:"section-title"},"æ¶ˆæ¯é€šé“",-1)),B.value.length===0?(a(),u("div",Qe,[e[32]||(e[32]=d(" æš‚æ— é€šé“ï¼Œå…ˆåœ¨",-1)),i(te,{onClick:e[11]||(e[11]=t=>l.$router.push("/config/channels")),type:"primary"},{default:n(()=>[...e[31]||(e[31]=[d(" å…¨å±€é…ç½® ",-1)])]),_:1}),e[33]||(e[33]=d("æ·»åŠ  ",-1))])):(a(),y(q,{key:1,modelValue:o.channelIds,"onUpdate:modelValue":e[12]||(e[12]=t=>o.channelIds=t)},{default:n(()=>[(a(!0),u(b,null,x(B.value,t=>(a(),y(R,{key:t.id,label:t.id,value:t.id},{default:n(()=>[d(c(t.name)+" ",1),i(xe,{size:"small",style:{"margin-left":"4px"}},{default:n(()=>[d(c(t.type),1)]),_:2},1024)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"]))]),s("div",We,[e[38]||(e[38]=s("div",{class:"section-title"},"å¼€å¯èƒ½åŠ›",-1)),K.value.length===0?(a(),u("div",Xe,[e[36]||(e[36]=d(" æš‚æ— èƒ½åŠ›ï¼Œå…ˆåœ¨",-1)),i(te,{onClick:e[13]||(e[13]=t=>l.$router.push("/config/tools")),type:"primary"},{default:n(()=>[...e[35]||(e[35]=[d(" å…¨å±€é…ç½® ",-1)])]),_:1}),e[37]||(e[37]=d("æ·»åŠ  ",-1))])):(a(),y(q,{key:1,modelValue:o.toolIds,"onUpdate:modelValue":e[14]||(e[14]=t=>o.toolIds=t)},{default:n(()=>[(a(!0),u(b,null,x(K.value,t=>(a(),y(R,{key:t.id,label:t.id,value:t.id},{default:n(()=>[d(c(t.name),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"]))]),s("div",Ze,[e[39]||(e[39]=s("div",{class:"section-title"},"Skills",-1)),O.value.length===0?(a(),u("div",et,"æš‚æ— å·²å®‰è£…çš„ Skills")):(a(),y(q,{key:1,modelValue:o.skillIds,"onUpdate:modelValue":e[15]||(e[15]=t=>o.skillIds=t)},{default:n(()=>[(a(!0),u(b,null,x(O.value,t=>(a(),y(R,{key:t.id,label:t.id,value:t.id},{default:n(()=>[d(c(t.name)+" ",1),i(Ce,{type:"info",size:"small",style:{"margin-left":"4px"}},{default:n(()=>[d("v"+c(t.version),1)]),_:2},1024)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"]))])]),_:1},8,["model"]),s("div",tt,[i(r,{onClick:e[16]||(e[16]=t=>l.$router.push("/agents"))},{default:n(()=>[...e[40]||(e[40]=[d("å–æ¶ˆ",-1)])]),_:1}),i(r,{type:"primary",loading:j.value,onClick:me},{default:n(()=>[...e[41]||(e[41]=[d(" ä¿å­˜ Agent ",-1)])]),_:1},8,["loading"])])]),s("div",lt,[s("div",st,[s("div",nt,[s("div",{class:S(["agent-tab",{active:f.value==="__assist__"}]),onClick:e[17]||(e[17]=t=>z("__assist__"))},[...e[42]||(e[42]=[s("span",{class:"tab-icon"},"ğŸ¤–",-1),d(" é…ç½®åŠ©æ‰‹ ",-1)])],2),(a(!0),u(b,null,x(fe.value,t=>(a(),u("div",{key:t.id,class:S(["agent-tab",{active:f.value===t.id}]),onClick:h=>z(t.id)},[s("div",{class:"tab-avatar",style:oe({background:t.avatarColor||"#409eff"})},c(t.name.charAt(0)),5),d(" "+c(t.name)+" ",1),i(p,{class:"tab-close",onClick:ne(h=>_e(t.id),["stop"])},{default:n(()=>[i(F(Me))]),_:1},8,["onClick"])],10,at))),128)),i(Ie,{onCommand:ce,trigger:"click"},{dropdown:n(()=>[i(we,null,{default:n(()=>[(a(!0),u(b,null,x(X.value,t=>(a(),y(le,{key:t.id,command:t.id},{default:n(()=>[d(c(t.name),1)]),_:2},1032,["command"]))),128)),X.value.length===0?(a(),y(le,{key:0,disabled:""},{default:n(()=>[...e[44]||(e[44]=[d(" æš‚æ— å…¶ä»– Agent ",-1)])]),_:1})):A("",!0)]),_:1})]),default:n(()=>[s("div",ot,[i(p,null,{default:n(()=>[i(F(Le))]),_:1}),e[43]||(e[43]=d(" æ›´å¤š ",-1))])]),_:1})])]),f.value==="__assist__"?(a(),u("div",it,[i(p,null,{default:n(()=>[i(F(Ue))]),_:1}),e[45]||(e[45]=d(" å‘Šè¯‰æˆ‘è¿™ä¸ª Agent è¦åšä»€ä¹ˆï¼Œæˆ‘æ¥å¸®ä½ ç”Ÿæˆé…ç½® ",-1))])):A("",!0),s("div",{class:"chat-messages",ref_key:"chatMsgRef",ref:N},[Z.value.length===0?(a(),u("div",dt,[f.value==="__assist__"?(a(),u(b,{key:0},[e[46]||(e[46]=s("p",null,"âœ¨ ä¾‹å¦‚ï¼š",-1)),s("div",{class:"example-chip",onClick:e[18]||(e[18]=t=>P("æˆ‘éœ€è¦ä¸€ä¸ªç”µå•†å®¢æœ Agentï¼Œè´Ÿè´£è§£ç­”è®¢å•é—®é¢˜ï¼Œè¯­æ°”äº²åˆ‡å‹å¥½"))}," æˆ‘éœ€è¦ä¸€ä¸ªç”µå•†å®¢æœ Agent... "),s("div",{class:"example-chip",onClick:e[19]||(e[19]=t=>P("å¸®æˆ‘åˆ›å»ºä¸€ä¸ªä»£ç å®¡æŸ¥åŠ©æ‰‹ï¼Œä¸“æ³¨äº Python ä»£ç è§„èŒƒ"))}," å¸®æˆ‘åˆ›å»ºä¸€ä¸ªä»£ç å®¡æŸ¥åŠ©æ‰‹... "),s("div",{class:"example-chip",onClick:e[20]||(e[20]=t=>P("åˆ›å»ºä¸€ä¸ªæ¯å¤©æ—©ä¸Šå‘é€å¤©æ°”æŠ¥å‘Šçš„ Agent"))}," åˆ›å»ºä¸€ä¸ªå¤©æ°”æŠ¥å‘Š Agent... ")],64)):(a(),u("p",ut,[e[47]||(e[47]=d("ä¸ ",-1)),s("strong",null,c(ve.value),1),e[48]||(e[48]=d(" å¯¹è¯",-1))]))])):A("",!0),(a(!0),u(b,null,x(Z.value,(t,h)=>(a(),u("div",{key:h,class:S(["chat-msg",t.role])},[s("div",rt,[t.role==="assistant"&&t.applyData?(a(),u("div",pt,[s("div",mt,[(a(!0),u(b,null,x(t.applyData,(J,se)=>(a(),u("div",{key:se,class:"apply-field"},[s("span",ft,c(ke(se)),1),s("span",vt,c(J.slice(0,60))+c(J.length>60?"...":""),1)]))),128))]),i(r,{type:"primary",size:"small",onClick:J=>pe(t.applyData)},{default:n(()=>[...e[49]||(e[49]=[d(" åº”ç”¨åˆ°è¡¨å• â†™ ",-1)])]),_:1},8,["onClick"])])):(a(),u("div",{key:1,class:"msg-text",innerHTML:ye(t.text)},null,8,ct))])],2))),128)),w.value?(a(),u("div",_t,[s("div",yt,[s("div",kt,[d(c(V.value),1),e[50]||(e[50]=s("span",{class:"cursor-blink"},"â–Š",-1))])])])):A("",!0)],512),s("div",gt,[i(m,{modelValue:U.value,"onUpdate:modelValue":e[21]||(e[21]=t=>U.value=t),type:"textarea",rows:2,placeholder:"è¾“å…¥éœ€æ±‚ï¼Œæˆ–é—®ä»»ä½•é—®é¢˜... (Ctrl+Enter å‘é€)",onKeydown:Te(ne(ee,["ctrl","prevent"]),["enter"]),disabled:w.value},null,8,["modelValue","onKeydown","disabled"]),i(r,{type:"primary",loading:w.value,onClick:ee,class:"send-btn"},{default:n(()=>[...e[51]||(e[51]=[d(" å‘é€ ",-1)])]),_:1},8,["loading"])])])])}}}),It=Fe(bt,[["__scopeId","data-v-8c16b19b"]]);export{It as default};
