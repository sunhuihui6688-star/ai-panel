import{d as Xe,e as C,D as Ye,I as ge,i as Qe,c as o,f as I,n as Ze,s as O,a as T,w as B,S as et,b as a,t as m,F as D,m as j,k as f,h as P,p as tt,G as st,g as _e,z as ke,H as V,r as z,o as l,j as ye,q as nt}from"./index-LLEpL_Q-.js";import{n as at,i as ee,o as lt,p as ot,q as ae}from"./index-BclxA8EE.js";import{_ as it}from"./_plugin-vue_export-helper-DlAUqK2U.js";const rt={key:0,class:"drag-overlay"},ut={key:0,class:"running-tasks-banner"},ct={key:0,class:"resumed-list"},dt={key:0,class:"history-loading"},pt={key:1,class:"chat-empty"},ft={key:0,class:"welcome-msg"},ht={key:1,class:"examples"},vt=["onClick"],mt={key:0,class:"msg-row user"},gt={class:"msg-bubble user"},_t={key:0,class:"msg-images"},kt=["src","onClick"],yt={class:"msg-text"},xt={key:1,class:"msg-row assistant"},Ct={class:"msg-col"},bt=["open"],wt={class:"thinking-summary"},St={class:"thinking-len"},$t={class:"thinking-content"},It={key:1,class:"tool-timeline"},Tt=["onClick"],Dt={class:"tool-step-header"},Mt={key:0,class:"tool-spin"},Nt={key:1},jt={key:2},Ft={key:3},Ot={class:"tool-step-icon"},Ut={class:"tool-step-name"},At={key:0,class:"tool-step-summary"},Rt={key:1,class:"tool-step-dur"},Bt={key:0},Lt={key:1},Et={key:2},Jt={key:3},Pt={key:4},zt={class:"tool-step-chevron"},qt={key:0,class:"tool-section"},Ht={class:"tool-pre"},Kt={key:1,class:"tool-section"},Vt={class:"tool-pre result"},Wt=["src","onClick"],Gt=["href"],Xt={class:"tool-file-name"},Yt={class:"tool-file-size"},Qt={class:"msg-bubble assistant"},Zt=["innerHTML"],es={key:1,class:"apply-card"},ts={class:"apply-preview"},ss={class:"apply-key"},ns={class:"apply-val"},as=["onClick"],ls={class:"msg-actions"},os=["onClick","title"],is=["onClick"],rs=["onClick"],us={key:2,class:"option-chips"},cs=["onClick"],ds={key:2,class:"msg-row system"},ps={class:"msg-system"},fs={key:2,class:"msg-row assistant"},hs={class:"msg-col"},vs={key:0,class:"thinking-block",open:""},ms={class:"thinking-summary"},gs={class:"thinking-content"},_s={key:1,class:"tool-timeline"},ks=["onClick"],ys={class:"tool-step-header"},xs={key:0,class:"tool-spin"},Cs={key:1},bs={key:2},ws={class:"tool-step-icon"},Ss={class:"tool-step-name"},$s={key:0,class:"tool-step-summary"},Is={key:1,class:"tool-step-dur"},Ts={key:0},Ds={key:1},Ms={key:2},Ns={key:3},js={key:4},Fs={class:"tool-step-chevron"},Os={key:0,class:"tool-section"},Us={class:"tool-pre"},As={key:1,class:"tool-section"},Rs={class:"tool-pre result"},Bs=["src","onClick"],Ls=["href"],Es={class:"tool-file-name"},Js={class:"tool-file-size"},Ps={key:2,class:"msg-bubble assistant"},zs={key:0,class:"typing-dots"},qs=["innerHTML"],Hs={key:2,class:"blink"},Ks=["src"],Vs={class:"chat-input-area"},Ws={key:0,class:"attachments-bar"},Gs=["src"],Xs=["onClick"],Ys={class:"attach-file-icon"},Qs={class:"attach-file-name"},Zs={class:"attach-file-size"},en=["onClick"],tn={class:"input-row"},sn={class:"textarea-wrap"},nn=["placeholder","disabled","onKeydown"],an={class:"input-actions"},ln={class:"icon-btn",title:"é™„åŠ æ–‡ä»¶ï¼ˆå›¾ç‰‡/ä»£ç /æ–‡æœ¬ï¼‰"},on=["disabled"],rn={key:0,class:"spinner"},un={key:1},cn=Xe({__name:"AiChat",props:{agentId:{},sessionId:{},context:{},scenario:{},skillId:{},placeholder:{},welcomeMessage:{},examples:{default:()=>[]},showThinking:{type:Boolean,default:!1},compact:{type:Boolean,default:!1},bgColor:{},height:{},initialMessages:{},applyable:{type:Boolean,default:!1}},emits:["message","response","apply","session-change","streaming-change"],setup(M,{expose:xe,emit:Ce}){const x=M,L=Ce,g=C(x.initialMessages?[...x.initialMessages]:[]),E=C(""),U=C([]),A=C([]),_=C(!1);Ye(_,s=>L("streaming-change",s));const b=C(""),N=C(""),S=C([]),q=nt(new Map),R=C([]);let $=null;const le=ke(()=>{let s=0;for(const e of g.value)for(const n of e.toolCalls??[])n.taskId&&n.taskStatus&&!["done","error","killed"].includes(n.taskStatus)&&s++;return s+=R.value.filter(e=>!["done","error","killed"].includes(e.status)).length,s}),H=C(!1);let K=0;const W=C(null),G=C(""),k=C(x.sessionId),J=C(!1),X=C(),F=C(),be=ke(()=>({height:x.height??"100%","--bg":x.bgColor??"transparent"}));function oe(){$||($=setInterval(we,3e3))}async function we(){if(q.size===0&&R.value.every(u=>["done","error","killed"].includes(u.status))){$&&(clearInterval($),$=null);return}const e=[];let n=!1;for(const[u,c]of q)try{const t=(await ae.get(c)).data;for(const r of g.value){const i=r.toolCalls?.find(h=>h.id===u);if(i){const h=!["done","error","killed"].includes(i.taskStatus??"");i.taskStatus=t.status,["done","error","killed"].includes(t.status)&&(e.push(u),h&&(n=!0))}}}catch{e.push(u),n=!0}for(const u of e)q.delete(u);let d=!1;for(const u of R.value)if(!["done","error","killed"].includes(u.status))try{const c=await ae.get(u.id),p=u.status;u.status=c.data.status,["done","error","killed"].includes(u.status)&&p!==u.status&&(d=!0)}catch{u.status="error",d=!0}if(!(q.size>0||R.value.some(u=>!["done","error","killed"].includes(u.status)))&&$&&(clearInterval($),$=null),(d||n)&&k.value&&!_.value){const u=k.value;setTimeout(async()=>{if(!_.value&&k.value===u)try{const c=await ee.get(x.agentId,u);if(_.value||k.value!==u)return;const p=c.data.messages??[],t=[];p.some(r=>r.isCompact||r.role==="compaction")&&t.push({role:"system",text:"æ›´æ—©çš„å†…å®¹å·²å‹ç¼©"});for(const r of p)r.role!=="compaction"&&t.push({role:r.role,text:r.text,toolCalls:r.toolCalls?.map(i=>({id:i.id,name:i.name,input:i.input,result:i.result,status:"done",_expanded:!1}))});g.value=t,y()}catch{}},1500)}}ge(()=>{$&&(clearInterval($),$=null)});async function Se(s){try{const n=(await ae.list({sessionId:s})).data,d=n.filter(u=>!["done","error","killed"].includes(u.status));if(n.filter(u=>["done","error","killed"].includes(u.status)).length>0&&setTimeout(async()=>{if(!_.value&&k.value===s)try{const u=await ee.get(x.agentId,s);if(_.value||k.value!==s)return;const c=u.data.messages??[],p=[];c.some(t=>t.isCompact||t.role==="compaction")&&p.push({role:"system",text:"æ›´æ—©çš„å†…å®¹å·²å‹ç¼©"});for(const t of c)t.role!=="compaction"&&p.push({role:t.role,text:t.text,toolCalls:t.toolCalls?.map(r=>({id:r.id,name:r.name,input:r.input,result:r.result,status:"done",_expanded:!1}))});g.value=p,y()}catch{}},500),d.length===0)return;R.value=d.map(u=>({id:u.id,label:u.label||u.id.slice(0,8),status:u.status})),oe()}catch{}}function y(){V(()=>{X.value&&(X.value.scrollTop=X.value.scrollHeight)})}function $e(){F.value&&(F.value.style.height="auto",F.value.style.height=Math.min(F.value.scrollHeight,160)+"px")}function Y(s){E.value=s,V(()=>F.value?.focus())}function ie(s){try{return JSON.stringify(JSON.parse(s),null,2)}catch{return s}}function Ie(s){navigator.clipboard?.writeText(s);const e=g.value.findIndex(n=>n.text===s);W.value=e,setTimeout(()=>{W.value=null},1500)}function Te(s){for(let e=s-1;e>=0;e--){const n=g.value[e];if(n&&n.role==="user"){const d=n.text,v=n.images??[];g.value.splice(e,g.value.length-e),ne(d,v);return}}}function te(s){G.value=s}function re(s){return s?s.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/```(\w*)\n([\s\S]*?)```/g,(n,d,v)=>`<pre class="code-block${d?" lang-"+d:""}"><code>${v}</code></pre>`).replace(/`([^`]+)`/g,'<code class="inline-code">$1</code>').replace(/\*\*(.+?)\*\*/g,"<strong>$1</strong>").replace(/\*(.+?)\*/g,"<em>$1</em>").replace(/\[(.+?)\]\((https?:\/\/[^\)]+)\)/g,'<a href="$2" target="_blank" rel="noopener">$1</a>').replace(/^### (.+)$/gm,"<h3>$1</h3>").replace(/^## (.+)$/gm,"<h2>$1</h2>").replace(/^# (.+)$/gm,"<h1>$1</h1>").replace(/^[-*] (.+)$/gm,"<li>$1</li>").replace(/^\d+\. (.+)$/gm,"<li>$1</li>").replace(/(<li>[\s\S]+?<\/li>)(\n(?!<li>)|$)/g,"<ul>$1</ul>$2").replace(/([^>])\n([^<])/g,"$1<br>$2"):""}function De(s){const e=s.split(`
`),n=[],d=/^([ğŸ™ğŸ˜„ğŸŒğŸ›ğŸ“šğŸ¨ğŸ’¼ğŸ¤–âš½ğŸ¯âœ…âŒğŸ”¥ğŸ’¡ğŸğŸš€ğŸŒŸğŸ’ğŸªğŸ­ğŸ¬ğŸ¤]|[\u{1F300}-\u{1FFFF}]|[\u{2600}-\u{27BF}])\s+(.{4,40})/u;for(const v of e){const u=v.replace(/^[-*â€¢]\s*/,"").trim();if(u.match(d)){const p=u.replace(/[ï¼š:ã€‚ï¼Œ,]$/,"").trim();p.length>=5&&n.push(p)}}return n.slice(0,5)}function Me(s){return s?/\{[\s\S]{30,}\}/.test(s)&&(s.includes('"name"')||s.includes('"identity"')||s.includes('"soul"')||s.includes('"IDENTITY"')||s.includes('"SOUL"')):!1}function Ne(s){const e=ce(s.text);e?(g.value.forEach(n=>{n!==s&&n.applyData&&delete n.applyData}),s.applyData=e,V(()=>L("apply",e))):alert("æœªèƒ½ä»æ¶ˆæ¯ä¸­æå–åˆ°é…ç½® JSONï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶")}function ue(s,e=0){const n=s.indexOf("{",e);if(n===-1)return null;let d=0,v=!1,u=!1;for(let c=n;c<s.length;c++){const p=s[c];if(u){u=!1;continue}if(p==="\\"&&v){u=!0;continue}if(p==='"'){v=!v;continue}if(!v){if(p==="{")d++;else if(p==="}"&&(d--,d===0))return{raw:s.slice(n,c+1),end:c+1}}}return null}function ce(s){const e=/```(?:json)?\s*\n?([\s\S]*?)```/g,n=[];let d;for(;(d=e.exec(s))!==null;){const c=(d[1]??"").trim();c.startsWith("{")&&n.push(c)}for(let c=n.length-1;c>=0;c--){const p=n[c],t=ue(p);if(!t)continue;const r=Q(t.raw)??Q(de(t.raw));if(r)return r}const v=[];let u=0;for(;u<s.length;){const c=ue(s,u);if(!c)break;v.push(c.raw),u=c.end}for(let c=v.length-1;c>=0;c--){const p=v[c],t=Q(p)??Q(de(p));if(t)return t}return null}function Q(s){try{const e=JSON.parse(s);if(e&&typeof e=="object"&&!Array.isArray(e)){const n=["name","id","description","identity","soul","IDENTITY","SOUL","NAME","DESCRIPTION"];if(Object.keys(e).some(d=>n.includes(d)))return e}}catch{}return null}function de(s){let e="",n=!1,d=!1;for(let v=0;v<s.length;v++){const u=s[v];if(d){e+=u,d=!1;continue}if(u==="\\"&&n){e+=u,d=!0;continue}if(u==='"'){n=!n,e+=u;continue}if(n&&u===`
`){e+="\\n";continue}if(n&&u==="\r"){e+="\\r";continue}e+=u}return e}const je={exec:"âš¡",bash:"âš¡",read:"ğŸ“–",write:"âœï¸",edit:"âœï¸",web_search:"ğŸŒ",web_fetch:"ğŸŒ",browser:"ğŸŒ",agent_spawn:"ğŸš€",agent_tasks:"ğŸ“‹",agent_kill:"ğŸ›‘",agent_result:"ğŸ“Š",project_read:"ğŸ“",project_write:"ğŸ“",project_list:"ğŸ“",project_create:"ğŸ“",project_glob:"ğŸ“",memory_search:"ğŸ§ ",memory_get:"ğŸ§ ",image:"ğŸ–¼ï¸",tts:"ğŸ”Š",show_image:"ğŸ–¼ï¸",cron:"â±ï¸"};function pe(s){return je[s]??"âš™ï¸"}function fe(s,e){try{const n=JSON.parse(e);if(s==="exec"||s==="bash")return(n.command??"").slice(0,60);if(s==="read")return n.file_path??n.path??"";if(s==="write")return(n.file_path??n.path??"")+(n.content?` (${n.content.length}B)`:"");if(s==="edit")return n.file_path??n.path??"";if(s==="web_search")return n.query??"";if(s==="web_fetch")return n.url??"";if(s==="agent_spawn")return`â†’ ${n.agentId}: ${(n.task??"").slice(0,40)}`;if(s==="project_read"||s==="project_write")return n.path??"";if(s==="memory_search")return n.query??"";if(s==="show_image")return(n.path??"").split("/").pop()??""}catch{}return""}const Fe=new Set(["txt","md","markdown","js","ts","jsx","tsx","vue","go","py","rs","java","kt","swift","html","css","scss","less","json","yaml","yml","toml","ini","cfg","env","sh","bash","zsh","fish","ps1","bat","cmd","dockerfile","makefile","sql","graphql","proto","xml","svg","gitignore","gitattributes"]);function he(s){const e=s.split(".").pop()?.toLowerCase()??"";return Fe.has(e)}function Oe(s){const e=s.split(".").pop()?.toLowerCase()??"";return{js:"ğŸŸ¨",ts:"ğŸ”µ",vue:"ğŸ’š",go:"ğŸ¹",py:"ğŸ",rs:"ğŸ¦€",html:"ğŸŒ",css:"ğŸ¨",json:"ğŸ“‹",md:"ğŸ“",sh:"âš¡",sql:"ğŸ—„ï¸",yaml:"âš™ï¸",yml:"âš™ï¸",dockerfile:"ğŸ³"}[e]??"ğŸ“„"}function Ue(s){return s<1024?`${s}B`:s<1024*1024?`${(s/1024).toFixed(1)}KB`:`${(s/1024/1024).toFixed(1)}MB`}function Ae(s){const e=s.clipboardData?.items;if(e){for(const n of Array.from(e))if(n.type.startsWith("image/")){s.preventDefault();const d=n.getAsFile();d&&se(d)}}}function Re(s){s.preventDefault(),K++,H.value=!0}function Be(s){s.preventDefault(),K--,K<=0&&(K=0,H.value=!1)}function Le(s){K=0,H.value=!1;const e=s.dataTransfer?.files;if(e)for(const n of Array.from(e))n.type.startsWith("image/")?se(n):he(n.name)&&ve(n)}function Ee(s){const e=s.target.files;if(e){for(const n of Array.from(e))n.type.startsWith("image/")?se(n):he(n.name)&&ve(n);s.target.value=""}}function ve(s){const e=new FileReader;e.onload=()=>{typeof e.result=="string"&&A.value.push({name:s.name,content:e.result})},e.readAsText(s)}function se(s){const e=new FileReader;e.onload=()=>{typeof e.result=="string"&&U.value.push(e.result)},e.readAsDataURL(s)}function Je(s){U.value.splice(s,1)}function Z(){const s=E.value.trim(),e=[...U.value],n=[...A.value];if(!s&&!e.length&&!n.length||_.value)return;let d=s;if(n.length>0){const v=n.map(u=>{const c=u.name.split(".").pop()??"text";return`

ğŸ“ **${u.name}**
\`\`\`${c}
${u.content}
\`\`\``}).join("");d=s?s+v:v.trimStart()}E.value="",U.value=[],A.value=[],V(()=>{F.value&&(F.value.style.height="auto")}),L("message",d,e),ne(d,e)}function ne(s,e,n=!1){n||(g.value.push({role:"user",text:s,images:e.length?e:void 0}),y()),_.value=!0,b.value="",N.value="",S.value=[];const d={role:"assistant",text:"",toolCalls:[]};g.value.push(d),n&&y();const v=g.value.length-1;let u="",c;if(k.value)c=void 0;else{const t=g.value.slice(0,-1).filter(r=>(r.role==="user"||r.role==="assistant")&&r.text).slice(-20).map(r=>({role:r.role,content:r.text}));c=t.length>0?t:void 0}const p={sessionId:k.value,context:x.context,scenario:x.scenario,skillId:x.skillId,images:e.length?e:void 0,history:c};at(x.agentId,s,t=>{switch(t.type){case"thinking_delta":N.value+=t.text,y();break;case"text":case"text_delta":b.value+=t.text,y();break;case"tool_call":{const r={id:t.tool_call?.id??String(Date.now()),name:t.tool_call?.name??"tool",input:t.tool_call?.input?JSON.stringify(t.tool_call.input):void 0,status:"running",_startedAt:Date.now(),_expanded:!1};g.value[v].toolCalls.push(r),S.value.push(r),u=r.id,y();break}case"tool_result":{const r=g.value[v].toolCalls?.find(i=>i.id===u);if(r){if(r.result=t.text,r.status="done",r._startedAt){const h=Date.now()-r._startedAt;r.duration=h<1e3?`${h}ms`:`${(h/1e3).toFixed(1)}s`}if(t.text){const h=t.text.match(/\[media:([^\]]+)\]/);if(h){const We=h[1],Ge=localStorage.getItem("aipanel_token")??"";r.mediaUrl=`/api/media?path=${encodeURIComponent(We)}&token=${encodeURIComponent(Ge)}`}const w=t.text.match(/\[file_card:([^|]+)\|([^|]+)\|([^\]]+)\]/);w&&(r.fileCard={url:w[1],name:w[2],size:w[3]})}if(r.name==="agent_spawn"&&t.text){const h=t.text.match(/ä»»åŠ¡\s*ID[ï¼š:]\s*([a-f0-9-]{8,})/i);h&&(r.taskId=h[1],r.taskStatus="pending",q.set(u,h[1]),oe())}const i=S.value.find(h=>h.id===u);i&&(i.result=r.result,i.status="done",i.duration=r.duration)}y();break}case"done":case"error":{if(t.type==="done"&&t.sessionId){const h=!k.value;k.value=t.sessionId,h&&L("session-change",t.sessionId)}const r=g.value[v];if(r.text=b.value,r.thinking=N.value||void 0,x.applyable){const h=ce(b.value);h&&(g.value.forEach(w=>{w!==r&&w.applyData&&delete w.applyData}),r.applyData=h)}const i=De(b.value);if(i.length>=2&&(r.options=i),t.type==="error"){r.text=`[é”™è¯¯] ${t.error}`;const h=r.toolCalls?.find(w=>w.status==="running");h&&(h.status="error")}_.value=!1,b.value="",N.value="",S.value=[],L("response",r.text),y();break}}},p)}function Pe(){g.value=[]}function ze(s){g.value.push(s),y()}async function qe(s){k.value=s,g.value=[],J.value=!0;const e=s;try{const n=await ee.get(x.agentId,s);if(k.value!==e)return;const d=n.data.messages??[],v=[];d.some(c=>c.isCompact||c.role==="compaction")&&v.push({role:"system",text:"æ›´æ—©çš„å†…å®¹å·²å‹ç¼©"});for(const c of d)c.role!=="compaction"&&v.push({role:c.role,text:c.text,toolCalls:c.toolCalls?.map(p=>({id:p.id,name:p.name,input:p.input,result:p.result,status:"done",_expanded:!1}))});g.value=v,y(),Se(s),me(s)}catch(n){n?.response?.status===404?g.value=[]:(console.error("[AiChat] resumeSession failed",n),g.value=[{role:"system",text:"å†å²åŠ è½½å¤±è´¥ï¼Œç»§ç»­å¯¹è¯ä»å¯æ¥ç»­"}])}finally{J.value=!1}}async function me(s){if(_.value)return;const e=await lt(x.agentId,s);if(k.value!==s||!e.hasWorker)return;if(e.status!=="generating"){const c=async()=>{if(!_.value)try{const p=await ee.get(x.agentId,s);if(_.value||k.value!==s)return;const t=p.data.messages??[],r=[];t.some(i=>i.isCompact||i.role==="compaction")&&r.push({role:"system",text:"æ›´æ—©çš„å†…å®¹å·²å‹ç¼©"});for(const i of t)i.role!=="compaction"&&r.push({role:i.role,text:i.text,toolCalls:i.toolCalls?.map(h=>({id:h.id,name:h.name,input:h.input,result:h.result,status:"done",_expanded:!1}))});g.value=r,y()}catch{}};await c(),setTimeout(async()=>{_.value||k.value===s&&await c()},1e3);return}if(k.value!==s)return;_.value=!0,b.value="",N.value="",S.value=[];const n={role:"assistant",text:"",toolCalls:[]};g.value.push(n);const d=g.value.length-1;y();let v="";const u=ot(x.agentId,s,c=>{switch(c.type){case"idle":g.value.splice(d,1),_.value=!1;break;case"thinking_delta":N.value+=c.text,y();break;case"text":case"text_delta":b.value+=c.text,y();break;case"tool_call":{const p={id:c.tool_call?.id??String(Date.now()),name:c.tool_call?.name??"tool",input:c.tool_call?.input?JSON.stringify(c.tool_call.input):void 0,status:"running",_startedAt:Date.now(),_expanded:!1};g.value[d].toolCalls.push(p),S.value.push(p),v=p.id,y();break}case"tool_result":{const p=g.value[d].toolCalls?.find(t=>t.id===v);if(p){p.result=c.text,p.status="done";const t=S.value.find(r=>r.id===v);t&&(t.result=p.result,t.status="done")}y();break}case"done":case"error":{if(c.type==="done"&&c.sessionId){const t=!k.value;k.value=c.sessionId,t&&L("session-change",c.sessionId)}const p=g.value[d];p.text=b.value,p.thinking=N.value||void 0,c.type==="error"&&(p.text=`[é”™è¯¯] ${c.error}`),_.value=!1,b.value="",N.value="",S.value=[],y();break}}});ge(()=>u.abort())}function He(){k.value=void 0,g.value=[]}function Ke(s){Y(s),V(Z)}function Ve(s){ne(s,[],!0)}return xe({clearMessages:Pe,appendMessage:ze,sendText:Ke,sendSilent:Ve,fillInput:Y,messages:g,streaming:_,currentSessionId:k,resumeSession:qe,startNewSession:He}),Qe(()=>{y(),k.value&&me(k.value)}),(s,e)=>{const n=z("ChatRound"),d=z("el-icon"),v=z("Check"),u=z("CopyDocument"),c=z("Setting"),p=z("Paperclip");return l(),o("div",{class:O(["ai-chat",{compact:M.compact,"has-bg":M.bgColor,"drag-active":H.value}]),style:Ze(be.value),onDragenter:I(Re,["prevent"]),onDragover:e[8]||(e[8]=I(()=>{},["prevent"])),onDragleave:Be,onDrop:I(Le,["prevent","stop"])},[T(et,{name:"drag-fade"},{default:B(()=>[H.value?(l(),o("div",rt,[...e[9]||(e[9]=[a("div",{class:"drag-overlay-content"},[a("div",{class:"drag-overlay-icon"},"ğŸ“"),a("div",{class:"drag-overlay-title"},"æ¾å¼€ä»¥é™„åŠ æ–‡ä»¶"),a("div",{class:"drag-overlay-hint"},"æ”¯æŒå›¾ç‰‡ Â· ä»£ç  Â· æ–‡æœ¬æ–‡ä»¶")],-1)])])):f("",!0)]),_:1}),le.value>0?(l(),o("div",ut,[e[10]||(e[10]=a("span",{class:"running-dot"},null,-1)),a("span",null,"åå°æœ‰ "+m(le.value)+" ä¸ªä»»åŠ¡æ­£åœ¨æ‰§è¡Œä¸­ï¼Œå…³é—­çª—å£åä»ä¼šç»§ç»­è¿è¡Œ",1),R.value.length?(l(),o("span",ct,[(l(!0),o(D,null,j(R.value.filter(t=>!["done","error","killed"].includes(t.status)),t=>(l(),o("span",{key:t.id,class:O(["resumed-chip",t.status])},m(t.status==="running"?"âŸ³":"ğŸŸ¡")+" "+m(t.label),3))),128))])):f("",!0)])):f("",!0),a("div",{class:"chat-messages",ref_key:"msgListRef",ref:X},[J.value?(l(),o("div",dt,[...e[11]||(e[11]=[a("div",{class:"history-loading-dots"},[a("span"),a("span"),a("span")],-1),a("div",{class:"history-loading-text"},"åŠ è½½å†å²å¯¹è¯â€¦",-1)])])):f("",!0),!g.value.length&&!J.value?(l(),o("div",pt,[M.welcomeMessage?(l(),o("div",ft,m(M.welcomeMessage),1)):f("",!0),M.examples.length?(l(),o("div",ht,[(l(!0),o(D,null,j(M.examples,(t,r)=>(l(),o("div",{key:r,class:"example-chip",onClick:i=>Y(t)},m(t),9,vt))),128))])):f("",!0)])):f("",!0),(l(!0),o(D,null,j(_.value?g.value.slice(0,-1):g.value,(t,r)=>(l(),o(D,{key:r},[t.role==="user"?(l(),o("div",mt,[a("div",gt,[t.images?.length?(l(),o("div",_t,[(l(!0),o(D,null,j(t.images,(i,h)=>(l(),o("img",{key:h,src:i,class:"msg-img",onClick:w=>te(i)},null,8,kt))),128))])):f("",!0),a("div",yt,m(t.text),1)])])):t.role==="assistant"?(l(),o("div",xt,[a("div",Ct,[t.thinking?(l(),o("details",{key:0,class:"thinking-block",open:M.showThinking},[a("summary",wt,[T(d,{class:"thinking-icon"},{default:B(()=>[T(n)]),_:1}),e[12]||(e[12]=P(" æ€è€ƒè¿‡ç¨‹ ",-1)),a("span",St,m(t.thinking.length)+" å­—ç¬¦",1)]),a("pre",$t,m(t.thinking),1)],8,bt)):f("",!0),t.toolCalls?.length?(l(),o("div",It,[(l(!0),o(D,null,j(t.toolCalls,(i,h)=>(l(),o("div",{key:h,class:O(["tool-step",i.status]),onClick:w=>i._expanded=!i._expanded},[a("div",Dt,[a("span",{class:O(["tool-step-dot",i.status])},[i.status==="running"?(l(),o("span",Mt,"âŸ³")):i.status==="done"?(l(),o("span",Nt,"âœ“")):i.status==="error"?(l(),o("span",jt,"âœ—")):(l(),o("span",Ft,"â—‹"))],2),a("span",Ot,m(pe(i.name)),1),a("code",Ut,m(i.name),1),i.input?(l(),o("span",At,m(fe(i.name,i.input)),1)):f("",!0),e[14]||(e[14]=a("span",{class:"tool-step-flex"},null,-1)),i.duration?(l(),o("span",Rt,m(i.duration),1)):f("",!0),i.taskId?(l(),o("span",{key:2,class:O(["task-badge",i.taskStatus])},[i.taskStatus==="pending"?(l(),o("span",Bt,"ğŸŸ¡ æ’é˜Ÿä¸­")):i.taskStatus==="running"?(l(),o("span",Lt,[...e[13]||(e[13]=[a("span",{class:"tool-spin"},"âŸ³",-1),P(" æ‰§è¡Œä¸­ ",-1)])])):i.taskStatus==="done"?(l(),o("span",Et,"âœ… å®Œæˆ")):i.taskStatus==="error"?(l(),o("span",Jt,"âŒ å¤±è´¥")):i.taskStatus==="killed"?(l(),o("span",Pt,"ğŸ›‘ å·²ç»ˆæ­¢")):f("",!0)],2)):f("",!0),a("span",zt,m(i._expanded?"â–²":"â–¼"),1)]),i._expanded?(l(),o("div",{key:0,class:"tool-step-body",onClick:e[0]||(e[0]=I(()=>{},["stop"]))},[i.input?(l(),o("div",qt,[e[15]||(e[15]=a("div",{class:"tool-label"},"INPUT",-1)),a("pre",Ht,m(ie(i.input)),1)])):f("",!0),i.result?(l(),o("div",Kt,[e[16]||(e[16]=a("div",{class:"tool-label"},"OUTPUT",-1)),a("pre",Vt,m(i.result.slice(0,3e3))+m(i.result.length>3e3?`
â€¦ (æˆªæ–­)`:""),1)])):f("",!0)])):f("",!0),i.mediaUrl?(l(),o("div",{key:1,class:"tool-media-preview",onClick:e[1]||(e[1]=I(()=>{},["stop"]))},[a("img",{src:i.mediaUrl,class:"tool-media-img",onClick:w=>te(i.mediaUrl)},null,8,Wt)])):f("",!0),i.fileCard?(l(),o("div",{key:2,class:"tool-file-card",onClick:e[2]||(e[2]=I(()=>{},["stop"]))},[a("a",{href:i.fileCard.url,target:"_blank",download:"",class:"tool-file-link"},[e[17]||(e[17]=a("span",{class:"tool-file-icon"},"ğŸ“",-1)),a("span",Xt,m(i.fileCard.name),1),a("span",Yt,m(i.fileCard.size),1),e[18]||(e[18]=a("span",{class:"tool-file-dl"},"â†“ ä¸‹è½½",-1))],8,Gt)])):f("",!0)],10,Tt))),128))])):f("",!0),a("div",Qt,[t.text?(l(),o("div",{key:0,class:"msg-text",innerHTML:re(t.text)},null,8,Zt)):f("",!0),t.applyData&&x.applyable?(l(),o("div",es,[a("div",ts,[(l(!0),o(D,null,j(t.applyData,(i,h)=>(l(),o("div",{key:h,class:"apply-row"},[a("span",ss,m(h),1),a("span",ns,m(String(i).slice(0,60))+m(String(i).length>60?"â€¦":""),1)]))),128))]),a("button",{class:"apply-btn",onClick:i=>s.$emit("apply",t.applyData)}," åº”ç”¨åˆ°è¡¨å• â†™ ",8,as)])):f("",!0),a("div",ls,[a("button",{class:"act-btn",onClick:i=>Ie(t.text),title:W.value===r?"å·²å¤åˆ¶":"å¤åˆ¶"},[W.value===r?(l(),ye(d,{key:0},{default:B(()=>[T(v)]),_:1})):(l(),ye(d,{key:1},{default:B(()=>[T(u)]),_:1}))],8,os),a("button",{class:"act-btn",onClick:i=>Te(r),title:"é‡è¯•"},"â†º",8,is),x.applyable&&!t.applyData&&Me(t.text)?(l(),o("button",{key:0,class:"act-btn apply-manual-btn",onClick:i=>Ne(t),title:"æ£€æµ‹åˆ°é…ç½® JSONï¼Œç‚¹å‡»åº”ç”¨"},[T(d,null,{default:B(()=>[T(c)]),_:1}),e[19]||(e[19]=P(" åº”ç”¨é…ç½® ",-1))],8,rs)):f("",!0)])]),t.options&&t.options.length?(l(),o("div",us,[(l(!0),o(D,null,j(t.options,(i,h)=>(l(),o("button",{key:h,class:"option-chip",onClick:w=>Y(i)},m(i),9,cs))),128))])):f("",!0)])])):t.role==="system"?(l(),o("div",ds,[a("div",ps,m(t.text),1)])):f("",!0)],64))),128)),_.value?(l(),o("div",fs,[a("div",hs,[N.value&&M.showThinking?(l(),o("details",vs,[a("summary",ms,[T(d,{class:"thinking-icon"},{default:B(()=>[T(n)]),_:1}),e[20]||(e[20]=P(" æ€è€ƒä¸­â€¦ ",-1))]),a("pre",gs,[P(m(N.value),1),e[21]||(e[21]=a("span",{class:"blink"},"â–Š",-1))])])):f("",!0),S.value.length?(l(),o("div",_s,[(l(!0),o(D,null,j(S.value,(t,r)=>(l(),o("div",{key:r,class:O(["tool-step",t.status]),onClick:i=>t._expanded=!t._expanded},[a("div",ys,[a("span",{class:O(["tool-step-dot",t.status])},[t.status==="running"?(l(),o("span",xs,"âŸ³")):t.status==="done"?(l(),o("span",Cs,"âœ“")):t.status==="error"?(l(),o("span",bs,"âœ—")):f("",!0)],2),a("span",ws,m(pe(t.name)),1),a("code",Ss,m(t.name),1),t.input?(l(),o("span",$s,m(fe(t.name,t.input)),1)):f("",!0),e[23]||(e[23]=a("span",{class:"tool-step-flex"},null,-1)),t.duration?(l(),o("span",Is,m(t.duration),1)):f("",!0),t.taskId?(l(),o("span",{key:2,class:O(["task-badge",t.taskStatus])},[t.taskStatus==="pending"?(l(),o("span",Ts,"ğŸŸ¡ æ’é˜Ÿä¸­")):t.taskStatus==="running"?(l(),o("span",Ds,[...e[22]||(e[22]=[a("span",{class:"tool-spin"},"âŸ³",-1),P(" æ‰§è¡Œä¸­",-1)])])):t.taskStatus==="done"?(l(),o("span",Ms,"âœ… å®Œæˆ")):t.taskStatus==="error"?(l(),o("span",Ns,"âŒ å¤±è´¥")):t.taskStatus==="killed"?(l(),o("span",js,"ğŸ›‘ å·²ç»ˆæ­¢")):f("",!0)],2)):f("",!0),a("span",Fs,m(t._expanded?"â–²":"â–¼"),1)]),t._expanded?(l(),o("div",{key:0,class:"tool-step-body",onClick:e[3]||(e[3]=I(()=>{},["stop"]))},[t.input?(l(),o("div",Os,[e[24]||(e[24]=a("div",{class:"tool-label"},"INPUT",-1)),a("pre",Us,m(ie(t.input)),1)])):f("",!0),t.result?(l(),o("div",As,[e[25]||(e[25]=a("div",{class:"tool-label"},"OUTPUT",-1)),a("pre",Rs,m(t.result.slice(0,3e3)),1)])):f("",!0)])):f("",!0),t.mediaUrl?(l(),o("div",{key:1,class:"tool-media-preview",onClick:e[4]||(e[4]=I(()=>{},["stop"]))},[a("img",{src:t.mediaUrl,class:"tool-media-img",onClick:i=>te(t.mediaUrl)},null,8,Bs)])):f("",!0),t.fileCard?(l(),o("div",{key:2,class:"tool-file-card",onClick:e[5]||(e[5]=I(()=>{},["stop"]))},[a("a",{href:t.fileCard.url,target:"_blank",download:"",class:"tool-file-link"},[e[26]||(e[26]=a("span",{class:"tool-file-icon"},"ğŸ“",-1)),a("span",Es,m(t.fileCard.name),1),a("span",Js,m(t.fileCard.size),1),e[27]||(e[27]=a("span",{class:"tool-file-dl"},"â†“ ä¸‹è½½",-1))],8,Ls)])):f("",!0)],10,ks))),128))])):f("",!0),b.value||!S.value.length?(l(),o("div",Ps,[!b.value&&!S.value.length?(l(),o("div",zs,[...e[28]||(e[28]=[a("span",null,null,-1),a("span",null,null,-1),a("span",null,null,-1)])])):f("",!0),b.value?(l(),o("div",{key:1,class:"msg-text",innerHTML:re(b.value)},null,8,qs)):f("",!0),b.value?(l(),o("span",Hs,"â–Š")):f("",!0)])):f("",!0)])])):f("",!0)],512),G.value?(l(),o("div",{key:1,class:"img-preview-mask",onClick:e[6]||(e[6]=t=>G.value="")},[a("img",{src:G.value,class:"img-preview-full"},null,8,Ks)])):f("",!0),a("div",Vs,[U.value.length||A.value.length?(l(),o("div",Ws,[(l(!0),o(D,null,j(U.value,(t,r)=>(l(),o("div",{key:"img-"+r,class:"attach-thumb"},[a("img",{src:t},null,8,Gs),a("button",{class:"remove-attach",onClick:i=>Je(r)},"Ã—",8,Xs)]))),128)),(l(!0),o(D,null,j(A.value,(t,r)=>(l(),o("div",{key:"file-"+r,class:"attach-file-chip"},[a("span",Ys,m(Oe(t.name)),1),a("span",Qs,m(t.name),1),a("span",Zs,m(Ue(t.content.length)),1),a("button",{class:"attach-file-remove",onClick:i=>A.value.splice(r,1)},"Ã—",8,en)]))),128))])):f("",!0),a("div",tn,[a("div",sn,[tt(a("textarea",{ref_key:"inputRef",ref:F,"onUpdate:modelValue":e[7]||(e[7]=t=>E.value=t),placeholder:M.placeholder||"è¾“å…¥æ¶ˆæ¯â€¦ æ”¯æŒæ‹–æ‹½å›¾ç‰‡æˆ–æ–‡ä»¶ (Ctrl+Enter å‘é€)",disabled:_.value||J.value,rows:"1",class:"chat-textarea",onKeydown:[_e(I(Z,["ctrl","prevent"]),["enter"]),_e(I(Z,["meta","prevent"]),["enter"])],onPaste:Ae,onInput:$e},null,40,nn),[[st,E.value]])]),a("div",an,[a("label",ln,[T(d,null,{default:B(()=>[T(p)]),_:1}),a("input",{type:"file",multiple:"",hidden:"",onChange:Ee},null,32)]),a("button",{class:"send-btn",disabled:_.value||J.value||!E.value.trim()&&!U.value.length&&!A.value.length,onClick:Z},[_.value?(l(),o("span",rn)):(l(),o("span",un,"â†‘"))],8,on)])]),e[29]||(e[29]=a("div",{class:"input-hint"},"Ctrl+Enter å‘é€ Â· æ”¯æŒæ‹–æ‹½å›¾ç‰‡/æ–‡ä»¶",-1))])],38)}}}),hn=it(cn,[["__scopeId","data-v-6ad26062"]]);export{hn as A};
