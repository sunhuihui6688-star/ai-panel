import{d as nt,h as ot,c as f,b as e,a as c,w as m,m as lt,i as j,j as D,g as M,E as N,r as h,N as at,o as u,f as _,F as R,l as L,t as x,n as it,x as F,u as rt,M as ct}from"./index-DaBhmNjc.js";import{r as W}from"./index-DOB2ih9P.js";import{_ as dt}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ut={class:"team-view"},ft={class:"page-header"},pt={style:{display:"flex",gap:"8px"}},mt={key:0,class:"empty-state"},gt={key:1,class:"empty-state"},vt=["height"],ht=["x1","y1","x2","y2","stroke-width","onMouseenter"],yt=["transform","onClick"],_t=["fill"],xt={"text-anchor":"middle","dominant-baseline":"central",fill:"#fff","font-weight":"700","font-size":"15","font-family":"system-ui, sans-serif"},kt=["fill"],wt={"text-anchor":"middle",y:"46","font-size":"12",fill:"#303133","font-family":"system-ui, sans-serif","paint-order":"stroke",stroke:"#f5f7fa","stroke-width":"3"},bt={"text-anchor":"middle",y:"58","font-size":"10",fill:"#909399","font-family":"system-ui, monospace"},Ct={class:"tooltip-members"},At={class:"tooltip-name"},Et={class:"tooltip-name"},Mt={class:"tooltip-tags"},Tt={key:0,class:"tooltip-label"},zt={class:"legend"},Bt={class:"legend-item"},Dt={class:"legend-item"},Nt={width:"28",height:"8"},Rt=["stroke-width"],T=820,Lt=28,U=150,O=80,H=80,Ft=nt({__name:"TeamView",setup(Ot){const X=rt(),S=M(),b=M(!1),g=M({nodes:[],edges:[]}),V={核心:4,常用:2.5,偶尔:1.5};function q(s,t){const n={};s.forEach(i=>{n[i.id]=0});const a=s.length+2;for(let i=0;i<a;i++){let p=!1;for(const r of t){const k=n[r.from]??0,w=n[r.to]??0;if(r.type==="上级"){const y=k-1;w>y&&(n[r.to]=y,p=!0)}else if(r.type==="下级"){const y=k+1;w<y&&(n[r.to]=y,p=!0)}}if(!p)break}const d=Object.values(n),l=d.length?Math.min(...d):0;return s.forEach(i=>{n[i.id]=(n[i.id]??0)-l}),n}const $=F(()=>q(g.value.nodes,g.value.edges)),G=F(()=>{const s=Object.values($.value).reduce((t,n)=>Math.max(t,n),0);return Math.max(400,O+s*U+140)}),Y=F(()=>{const s=g.value.nodes,t=$.value,n={};s.forEach(d=>{const l=t[d.id]??0;n[l]||(n[l]=[]),n[l].push(d.id)});const a={};for(const[d,l]of Object.entries(n)){const i=Number(d),p=O+i*U,r=T-H*2,k=l.length>1?r/(l.length-1):0;l.forEach((w,y)=>{const B=l.length===1?T/2:H+y*k;a[w]={x:Math.round(B),y:Math.round(p)}})}return a});function A(s){return Y.value[s]??{x:T/2,y:O}}function E(s,t,n){const a=A(s),d=A(t),l=d.x-a.x,i=d.y-a.y,p=Math.sqrt(l*l+i*i)||1,r=Lt+3;return n==="start"?{x:a.x+l/p*r,y:a.y+i/p*r}:{x:d.x-l/p*r,y:d.y-i/p*r}}function J(s){return V[s]??1.5}const I=["#409EFF","#67C23A","#E6A23C","#F56C6C","#7C3AED","#0891B2","#B45309","#64748B"];function K(s){let t=0;for(let n=0;n<s.length;n++)t=s.charCodeAt(n)+((t<<5)-t);return I[Math.abs(t)%I.length]??"#409EFF"}function Q(s){return(s||"?").charAt(0).toUpperCase()}function P(s){return g.value.nodes.find(t=>t.id===s)?.name??s}function Z(s){X.push(`/agents/${s}`)}const v=M({visible:!1,x:0,y:0,type:"",strength:"",label:"",from:"",to:""});function tt(s,t){const n=S.value?.getBoundingClientRect();n&&(v.value={visible:!0,x:s.clientX-n.left+14,y:s.clientY-n.top-10,type:t.type,strength:t.strength,label:t.label,from:t.from,to:t.to})}function et(){v.value.visible=!1}async function z(){b.value=!0;try{const s=await W.graph();g.value=s.data}catch{N.error("加载图谱失败")}finally{b.value=!1}}async function st(){try{await ct.confirm("将清空所有成员的 RELATIONS.md，此操作不可恢复。确认吗？","清空所有关系",{confirmButtonText:"确认清空",cancelButtonText:"取消",type:"warning"})}catch{return}try{await W.clearAll(),N.success("已清空所有成员关系"),await z()}catch{N.error("清空失败")}}return ot(z),(s,t)=>{const n=h("Refresh"),a=h("el-icon"),d=h("el-button"),l=h("Delete"),i=h("Share"),p=h("Connection"),r=h("el-tag"),k=h("el-card"),w=h("ArrowUp"),y=h("ArrowDown"),B=at("loading");return u(),f("div",ut,[e("div",ft,[t[2]||(t[2]=e("h2",null,"团队关系图谱",-1)),e("div",pt,[c(d,{size:"small",onClick:z},{default:m(()=>[c(a,null,{default:m(()=>[c(n)]),_:1}),t[0]||(t[0]=_(" 刷新 ",-1))]),_:1}),c(d,{size:"small",type:"danger",plain:"",onClick:st},{default:m(()=>[c(a,null,{default:m(()=>[c(l)]),_:1}),t[1]||(t[1]=_(" 清空所有关系 ",-1))]),_:1})])]),lt((u(),j(k,{class:"graph-card"},{default:m(()=>[!b.value&&!g.value.nodes.length?(u(),f("div",mt,[c(a,{style:{"font-size":"64px",color:"#c0c4cc",display:"block",margin:"0 auto 16px"}},{default:m(()=>[c(i)]),_:1}),t[3]||(t[3]=e("p",{style:{color:"#909399","text-align":"center",margin:"0"}},"暂无成员数据",-1))])):!b.value&&g.value.nodes.length&&!g.value.edges.length?(u(),f("div",gt,[c(a,{style:{"font-size":"64px",color:"#c0c4cc",display:"block",margin:"0 auto 16px"}},{default:m(()=>[c(p)]),_:1}),t[4]||(t[4]=e("p",{style:{color:"#909399","text-align":"center",margin:"0"}},"为成员配置 RELATIONS.md 即可自动生成关系图谱",-1)),t[5]||(t[5]=e("p",{style:{color:"#c0c4cc","text-align":"center","font-size":"13px",margin:"6px 0 0"}}," 前往成员详情页 → 「关系」Tab 编辑 ",-1))])):(u(),f("div",{key:2,class:"graph-container",ref_key:"containerRef",ref:S},[(u(),f("svg",{width:T,height:G.value,class:"graph-svg"},[(u(!0),f(R,null,L(g.value.edges,o=>(u(),f("g",{key:`${o.from}-${o.to}`},[e("line",{x1:E(o.from,o.to,"start").x,y1:E(o.from,o.to,"start").y,x2:E(o.from,o.to,"end").x,y2:E(o.from,o.to,"end").y,stroke:"#94a3b8","stroke-width":J(o.strength),"stroke-opacity":"0.6","stroke-linecap":"round",class:"graph-edge",onMouseenter:C=>tt(C,o),onMouseleave:et},null,40,ht)]))),128)),(u(!0),f(R,null,L(g.value.nodes,o=>(u(),f("g",{key:o.id,transform:`translate(${A(o.id).x}, ${A(o.id).y})`,class:"graph-node",onClick:C=>Z(o.id)},[t[6]||(t[6]=e("circle",{r:"30",fill:"rgba(0,0,0,0.07)",transform:"translate(2,3)"},null,-1)),e("circle",{r:"28",fill:K(o.id),stroke:"#fff","stroke-width":"2.5"},null,8,_t),e("text",xt,x(Q(o.id)),1),e("circle",{cx:"20",cy:"-20",r:"6",fill:o.status==="running"?"#67C23A":"#c0c4cc",stroke:"#fff","stroke-width":"1.5"},null,8,kt),e("text",wt,x(o.name),1),e("text",bt,x(o.id),1)],8,yt))),128))],8,vt)),v.value.visible?(u(),f("div",{key:0,class:"edge-tooltip",style:it({left:v.value.x+"px",top:v.value.y+"px"})},[e("div",Ct,[e("span",At,x(P(v.value.from)),1),t[7]||(t[7]=e("span",{class:"tooltip-sep"},"↔",-1)),e("span",Et,x(P(v.value.to)),1)]),e("div",Mt,[c(r,{size:"small",type:"info",effect:"plain"},{default:m(()=>[_(x(v.value.type),1)]),_:1}),c(r,{size:"small",effect:"plain"},{default:m(()=>[_(x(v.value.strength),1)]),_:1})]),v.value.label?(u(),f("div",Tt,x(v.value.label),1)):D("",!0)],4)):D("",!0)],512))]),_:1})),[[B,b.value]]),g.value.nodes.length?(u(),j(k,{key:0,class:"legend-card"},{default:m(()=>[e("div",zt,[t[10]||(t[10]=e("span",{class:"legend-title"},"布局规则：",-1)),e("span",Bt,[c(a,null,{default:m(()=>[c(w)]),_:1}),t[8]||(t[8]=_(" 上方 = 上级",-1))]),t[11]||(t[11]=e("span",{class:"legend-item"},"— 同层 = 平级协作",-1)),e("span",Dt,[c(a,null,{default:m(()=>[c(y)]),_:1}),t[9]||(t[9]=_(" 下方 = 下级",-1))]),t[12]||(t[12]=e("span",{class:"legend-divider"}," | ",-1)),t[13]||(t[13]=e("span",{class:"legend-title"},"线粗：",-1)),(u(),f(R,null,L(V,(o,C)=>e("span",{key:C,class:"legend-item"},[(u(),f("svg",Nt,[e("line",{x1:"0",y1:"4",x2:"28",y2:"4",stroke:"#64748b","stroke-width":o,"stroke-linecap":"round"},null,8,Rt)])),_(" "+x(C),1)])),64)),t[14]||(t[14]=e("span",{class:"legend-divider"}," | ",-1)),t[15]||(t[15]=e("span",{class:"legend-item"},[e("svg",{width:"12",height:"12"},[e("circle",{cx:"6",cy:"6",r:"5",fill:"#67C23A"})]),_(" 运行中 ")],-1)),t[16]||(t[16]=e("span",{class:"legend-item"},[e("svg",{width:"12",height:"12"},[e("circle",{cx:"6",cy:"6",r:"5",fill:"#c0c4cc"})]),_(" 空闲 ")],-1))])]),_:1})):D("",!0)])}}}),It=dt(Ft,[["__scopeId","data-v-3abd991a"]]);export{It as default};
