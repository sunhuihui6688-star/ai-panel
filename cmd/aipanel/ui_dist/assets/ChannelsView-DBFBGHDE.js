import{c}from"./index-CVTh1UCw.js";import{d as K,h as W,c as y,f as z,a as e,w as a,g as V,r as s,o as v,e as d,t as w,F as A,l as G,j as H,p as J,E as m,K as Q}from"./index-DmlRbR38.js";const R={class:"channels-page"},X={style:{display:"flex","justify-content":"space-between","align-items":"center","margin-bottom":"20px"}},le=K({__name:"ChannelsView",setup(Y){const x=V([]),r=V(!1),g=V(""),k=V(!1),n=J({id:"",name:"",type:"telegram",enabled:!0,config:{botToken:"",defaultAgent:"main",allowedFrom:""}});W(b);async function b(){try{const o=await c.list();x.value=o.data}catch{}}function B(){g.value="",Object.assign(n,{id:"",name:"",type:"telegram",enabled:!0,config:{botToken:"",defaultAgent:"main",allowedFrom:""}}),r.value=!0}function E(o){g.value=o.id,Object.assign(n,{...o,config:{...o.config}}),r.value=!0}async function F(){if(!n.name||!n.type){m.warning("è¯·å¡«å†™å¿…è¦å­—æ®µ");return}n.id||(n.id=n.type+"-"+Date.now().toString(36)),k.value=!0;try{g.value?await c.update(g.value,{...n}):await c.create({...n,status:"untested"}),m.success("ä¿å­˜æˆåŠŸ"),r.value=!1,b()}catch(o){m.error(o.response?.data?.error||"ä¿å­˜å¤±è´¥")}finally{k.value=!1}}async function $(o){try{await c.update(o.id,{enabled:o.enabled})}catch{m.error("æ›´æ–°å¤±è´¥")}}async function j(o){try{await c.test(o.id),m.success("æµ‹è¯•æˆåŠŸ"),b()}catch{m.error("æµ‹è¯•å¤±è´¥")}}async function D(o){try{await Q.confirm(`ç¡®å®šåˆ é™¤é€šé“ "${o.name}"ï¼Ÿ`,"ç¡®è®¤åˆ é™¤",{type:"warning"}),await c.delete(o.id),m.success("å·²åˆ é™¤"),b()}catch{}}return(o,t)=>{const M=s("Plus"),N=s("el-icon"),p=s("el-button"),U=s("el-tag"),f=s("el-table-column"),q=s("el-text"),T=s("el-switch"),I=s("el-table"),L=s("el-card"),C=s("el-option"),O=s("el-select"),i=s("el-form-item"),_=s("el-input"),P=s("el-form"),S=s("el-dialog");return v(),y("div",R,[z("div",X,[t[10]||(t[10]=z("h2",{style:{margin:"0"}},"ðŸ“¡ æ¶ˆæ¯é€šé“",-1)),e(p,{type:"primary",onClick:B},{default:a(()=>[e(N,null,{default:a(()=>[e(M)]),_:1}),t[9]||(t[9]=d(" æ·»åŠ é€šé“ ",-1))]),_:1})]),e(L,{shadow:"hover"},{default:a(()=>[e(I,{data:x.value,stripe:""},{default:a(()=>[e(f,{label:"ç±»åž‹",width:"120"},{default:a(({row:l})=>[e(U,{size:"small"},{default:a(()=>[d(w(l.type),1)]),_:2},1024)]),_:1}),e(f,{prop:"name",label:"åç§°","min-width":"160"}),e(f,{label:"é…ç½®","min-width":"200"},{default:a(({row:l})=>[e(q,{type:"info",size:"small"},{default:a(()=>[(v(!0),y(A,null,G(l.config,(u,h)=>(v(),y("span",{key:h,style:{"margin-right":"8px"}},w(h)+": "+w(u),1))),128))]),_:2},1024)]),_:1}),e(f,{label:"å¯ç”¨",width:"80"},{default:a(({row:l})=>[e(T,{modelValue:l.enabled,"onUpdate:modelValue":u=>l.enabled=u,onChange:u=>$(l),size:"small"},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),e(f,{label:"çŠ¶æ€",width:"100"},{default:a(({row:l})=>[e(U,{type:l.status==="ok"?"success":l.status==="error"?"danger":"info",size:"small"},{default:a(()=>[d(w(l.status==="ok"?"âœ“":l.status==="error"?"âœ—":"?"),1)]),_:2},1032,["type"])]),_:1}),e(f,{label:"æ“ä½œ",width:"180"},{default:a(({row:l})=>[e(p,{size:"small",onClick:u=>j(l)},{default:a(()=>[...t[11]||(t[11]=[d("æµ‹è¯•",-1)])]),_:1},8,["onClick"]),e(p,{size:"small",onClick:u=>E(l)},{default:a(()=>[...t[12]||(t[12]=[d("ç¼–è¾‘",-1)])]),_:1},8,["onClick"]),e(p,{size:"small",type:"danger",onClick:u=>D(l)},{default:a(()=>[...t[13]||(t[13]=[d("åˆ é™¤",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),e(S,{modelValue:r.value,"onUpdate:modelValue":t[8]||(t[8]=l=>r.value=l),title:g.value?"ç¼–è¾‘é€šé“":"æ·»åŠ é€šé“",width:"520px"},{footer:a(()=>[e(p,{onClick:t[7]||(t[7]=l=>r.value=!1)},{default:a(()=>[...t[14]||(t[14]=[d("å–æ¶ˆ",-1)])]),_:1}),e(p,{type:"primary",onClick:F,loading:k.value},{default:a(()=>[...t[15]||(t[15]=[d("ä¿å­˜",-1)])]),_:1},8,["loading"])]),default:a(()=>[e(P,{model:n,"label-width":"120px"},{default:a(()=>[e(i,{label:"ç±»åž‹",required:""},{default:a(()=>[e(O,{modelValue:n.type,"onUpdate:modelValue":t[0]||(t[0]=l=>n.type=l),style:{width:"100%"}},{default:a(()=>[e(C,{label:"Telegram",value:"telegram"}),e(C,{label:"iMessage",value:"imessage"}),e(C,{label:"WhatsApp",value:"whatsapp"})]),_:1},8,["modelValue"])]),_:1}),e(i,{label:"åç§°",required:""},{default:a(()=>[e(_,{modelValue:n.name,"onUpdate:modelValue":t[1]||(t[1]=l=>n.name=l),placeholder:"å¦‚ Telegram Bot"},null,8,["modelValue"])]),_:1}),e(i,{label:"ID"},{default:a(()=>[e(_,{modelValue:n.id,"onUpdate:modelValue":t[2]||(t[2]=l=>n.id=l),placeholder:"å”¯ä¸€æ ‡è¯†"},null,8,["modelValue"])]),_:1}),n.type==="telegram"?(v(),y(A,{key:0},[e(i,{label:"Bot Token",required:""},{default:a(()=>[e(_,{modelValue:n.config.botToken,"onUpdate:modelValue":t[3]||(t[3]=l=>n.config.botToken=l),type:"password","show-password":""},null,8,["modelValue"])]),_:1}),e(i,{label:"é»˜è®¤ Agent"},{default:a(()=>[e(_,{modelValue:n.config.defaultAgent,"onUpdate:modelValue":t[4]||(t[4]=l=>n.config.defaultAgent=l),placeholder:"main"},null,8,["modelValue"])]),_:1}),e(i,{label:"å…è®¸çš„å‘é€è€…"},{default:a(()=>[e(_,{modelValue:n.config.allowedFrom,"onUpdate:modelValue":t[5]||(t[5]=l=>n.config.allowedFrom=l),placeholder:"é€—å·åˆ†éš”çš„ Telegram ç”¨æˆ· ID"},null,8,["modelValue"])]),_:1})],64)):H("",!0),e(i,{label:"å¯ç”¨"},{default:a(()=>[e(T,{modelValue:n.enabled,"onUpdate:modelValue":t[6]||(t[6]=l=>n.enabled=l)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}});export{le as default};
