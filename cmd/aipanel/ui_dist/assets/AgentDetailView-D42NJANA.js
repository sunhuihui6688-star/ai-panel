import{d as Al,h as $l,E as m,i as w,w as t,B as Il,g as u,r as f,o as d,a as l,f as i,k as $,y as Ul,t as r,e as o,z as ze,m as Ml,c,F as I,l as Z,q as Sl,j as F,n as Te,C as Fl,D as Nl,G as Dl,H as El,I as Ll}from"./index-DQYoL3YD.js";import{b as Ae,f as ee,g as le,h as P,i as Bl,e as $e,r as He}from"./index-CGdO17In.js";import{A as Rl}from"./AiChat-BpL16qko.js";import{_ as jl}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Ol={class:"header-left"},Yl={class:"chat-layout"},Pl={class:"session-sidebar"},Jl={class:"session-sidebar-header"},Hl={class:"session-list"},ql=["onClick"],Gl={class:"session-item-title"},Kl={class:"session-item-meta"},Wl={key:0,class:"session-empty"},Ql={class:"at-panel"},Xl={key:0,class:"at-form"},Zl={class:"chat-area"},et={style:{display:"flex","align-items":"center",gap:"8px"}},lt={style:{"font-weight":"600"}},tt={key:0,style:{"text-align":"center",color:"#c0c4cc",padding:"32px 0","font-size":"14px"}},at={style:{display:"flex","align-items":"center",gap:"8px"}},nt={style:{"font-size":"13px"}},st={style:{"font-size":"13px",color:"#606266"}},ot={key:0,style:{"text-align":"center",color:"#c0c4cc",padding:"40px 0"}},it={key:1,class:"relations-list"},ut={class:"relation-info"},dt={class:"relation-name"},rt={class:"relation-tags"},mt={class:"relation-desc"},ft={style:{display:"flex","align-items":"center","justify-content":"space-between"}},pt={style:{display:"flex",gap:"8px","margin-top":"4px"}},vt={style:{display:"flex","align-items":"center","justify-content":"space-between"}},ct={key:0,style:{"text-align":"center",color:"#c0c4cc",padding:"16px 0","font-size":"13px"}},yt={key:1,style:{"text-align":"center",color:"#c0c4cc",padding:"16px 0","font-size":"13px"}},gt={style:{"font-size":"12px"}},_t={style:{"font-size":"12px",color:"#606266"}},bt={class:"memory-toolbar",style:{"margin-bottom":"12px",display:"flex",gap:"8px"}},ht={style:{display:"flex","align-items":"center",gap:"4px","font-size":"13px"}},wt={style:{display:"flex","align-items":"center","justify-content":"space-between"}},xt={style:{"margin-top":"8px",display:"flex",gap:"8px","align-items":"center"}},kt=Al({__name:"AgentDetailView",setup(Ct){const Ie=Il(),p=Ie.params.id,E=u(null),Ue=u("chat"),U=u(),te=u([]),ae=u(!1),L=u();async function Me(){ae.value=!0;try{const n=await Bl.list({agentId:p,limit:50});te.value=n.data.sessions}catch{}finally{ae.value=!1}}function qe(n){L.value=n.id,U.value?.resumeSession(n.id)}function Ge(){L.value=void 0,U.value?.startNewSession()}function Ke(n){L.value=n,setTimeout(Me,500)}function We(n){if(!n)return"";const e=Date.now()-n;return e<6e4?"刚刚":e<36e5?`${Math.floor(e/6e4)}分前`:e<864e5?`${Math.floor(e/36e5)}小时前`:`${Math.floor(e/864e5)}天前`}const J=u(!1),H=u(""),q=u(""),ve=u(!1),M=u([]);function Qe(){J.value=!J.value,J.value&&!M.value.length&&Se()}async function Se(){try{const n=await Ae.list();M.value=n.data.filter(e=>e.id!==p)}catch{M.value=[]}}function Xe(n){const e=M.value.find(s=>s.id===n);e&&U.value?.fillInput(`@${e.name}: `)}async function Ze(){const n=H.value,e=q.value.trim();if(!n||!e)return;const g=M.value.find(N=>N.id===n)?.name??n;ve.value=!0;const T={role:"user",text:`→ 转发给 ${g}：
${e}`};U.value?.appendMessage(T);try{const v=(await Ae.message(n,e,p)).data.response,S={role:"assistant",text:`← **${g}** 回复：

${v}`};U.value?.appendMessage(S),q.value="",H.value="",J.value=!1,m.success(`${g} 已回复`)}catch(N){const v={role:"system",text:`❌ 转发失败：${N.response?.data?.error??N.message??"网络错误"}`};U.value?.appendMessage(v),m.error("转发失败")}finally{ve.value=!1}}const ne=u(""),se=u(""),y=u({enabled:!1,schedule:"daily",keepTurns:3,focusHint:"",cronJobId:""}),ce=u(!1),ye=u(!1);async function el(){try{const n=await $e.getConfig(p);y.value=n.data,n.data.cronJobId&&ge()}catch{}}async function Fe(){ce.value=!0;try{const n=await $e.setConfig(p,y.value);y.value=n.data,m.success(y.value.enabled?"自动记忆已开启":"自动记忆已关闭")}catch{m.error("保存失败")}finally{ce.value=!1}}async function ll(){ye.value=!0;try{await $e.consolidate(p),m.success("记忆整理已在后台启动，稍后刷新记忆文件查看结果"),setTimeout(ge,3e3)}catch{m.error("整理失败")}finally{ye.value=!1}}const oe=u([]),ie=u(!1);async function ge(){if(y.value.cronJobId){ie.value=!0;try{const n=await P.runs(y.value.cronJobId);oe.value=n.data.slice().reverse()}catch{oe.value=[]}finally{ie.value=!1}}}const ue=u([]),B=u(""),R=u(""),_e=u(!1),be=u([]),G=u(!1),de=u(""),K=u(!1),re=u(""),Ne=u([]),j=u(""),W=u(""),me=u(null),C=u([]),he=u(!1),_=u({agentId:"",agentName:"",relationType:"平级协作",strength:"常用",desc:""});async function tl(){try{const n=await He.get(p);C.value=n.data.parsed||[]}catch{C.value=[]}}function al(n){const e=M.value.find(s=>s.id===n);_.value.agentName=e?e.name:n}async function nl(){if(!_.value.agentId)return;if(C.value.find(e=>e.agentId===_.value.agentId)){m.warning("该成员关系已存在，请先删除再重新添加");return}C.value.push({..._.value}),_.value={agentId:"",agentName:"",relationType:"平级协作",strength:"常用",desc:""},await De()}async function sl(n){C.value.splice(n,1),await De()}function ol(){if(C.value.length===0)return"";const n=`| 成员ID | 成员名称 | 关系类型 | 关系程度 | 说明 |
|--------|--------|--------|--------|------|`,e=C.value.map(s=>`| ${s.agentId} | ${s.agentName} | ${s.relationType} | ${s.strength} | ${s.desc||""} |`).join(`
`);return n+`
`+e}async function De(){he.value=!0;try{await He.put(p,ol()),m.success("关系已保存")}catch{m.error("保存失败")}finally{he.value=!1}}function we(n){const e=["#409EFF","#67C23A","#E6A23C","#F56C6C","#909399","#B45309","#7C3AED","#0891B2"];let s=0;for(let g=0;g<n.length;g++)s=n.charCodeAt(g)+((s<<5)-s);return e[Math.abs(s)%e.length]??"#409EFF"}function Ee(n){return n==="上级"?"danger":n==="下级"?"":n==="平级协作"?"success":"info"}function Le(n){return n==="核心"?"danger":n==="常用"?"warning":"info"}const Be=u([]),Q=u(!1),b=u({name:"",expr:"0 9 * * *",tz:"Asia/Shanghai",message:"",enabled:!0});function il(n){return n==="running"?"success":n==="stopped"?"danger":"info"}function ul(n){return n==="running"?"运行中":n==="stopped"?"已停止":"空闲"}function Re(n){return n?n<1024?n+" B":n<1048576?(n/1024).toFixed(1)+" KB":(n/1048576).toFixed(1)+" MB":"0 B"}function dl(n){return new Date(n).toLocaleString()}function je(n){return n?new Date(n).toLocaleString():""}$l(async()=>{try{const e=await Ae.get(p);E.value=e.data}catch{m.error("加载 Agent 失败")}rl(),tl(),Se(),el(),cl(),fe(),await Me();const n=Ie.query.resumeSession;n&&(L.value=n,await new Promise(s=>setTimeout(s,100)),U.value?.resumeSession(n),te.value.find(s=>s.id===n)||(L.value=n))});async function rl(){try{const[n,e]=await Promise.all([ee.read(p,"IDENTITY.md"),ee.read(p,"SOUL.md")]);ne.value=n.data?.content||"",se.value=e.data?.content||""}catch{}X()}async function xe(n,e){try{await ee.write(p,n,e),m.success(`${n} 已保存`)}catch{m.error(`保存 ${n} 失败`)}}async function X(){try{const n=await le.tree(p);ue.value=n.data||[]}catch{ue.value=[]}}async function ml(n){if(!n.isDir){B.value=n.path,be.value=n.path.split("/");try{const e=await le.readFile(p,n.path);R.value=e.data?.content||""}catch{R.value="(无法读取)"}}}async function fl(){if(B.value){_e.value=!0;try{await le.writeFile(p,B.value,R.value),m.success("记忆文件已保存"),X()}catch{m.error("保存失败")}finally{_e.value=!1}}}async function pl(){const n=de.value.trim();if(!n){m.warning("请输入路径");return}try{await le.writeFile(p,n,`# ${n.split("/").pop()?.replace(".md","")||"New File"}

`),m.success("文件已创建"),G.value=!1,de.value="",X(),B.value=n,be.value=n.split("/"),R.value=`# ${n.split("/").pop()?.replace(".md","")||"New File"}

`}catch{m.error("创建失败")}}async function vl(){const n=re.value.trim();if(!n){m.warning("请输入内容");return}try{await le.dailyLog(p,n),m.success("日志已添加"),K.value=!1,re.value="",X()}catch{m.error("添加失败")}}async function cl(){try{const n=await ee.read(p,"/");Array.isArray(n.data)&&(Ne.value=n.data.map(e=>({name:e.name,isDir:e.isDir,size:e.size,modTime:e.modTime,path:e.name})))}catch{}}async function yl(n){if(!n.isDir){j.value=n.path||n.name,me.value=n;try{const e=await ee.read(p,j.value);W.value=e.data?.content||""}catch{W.value="(无法读取)"}}}async function gl(){j.value&&await xe(j.value,W.value)}async function fe(){try{const n=await P.list();Be.value=n.data||[]}catch{}}async function _l(){try{await P.create({name:b.value.name,enabled:b.value.enabled,schedule:{kind:"cron",expr:b.value.expr,tz:b.value.tz},payload:{kind:"agentTurn",message:b.value.message},delivery:{mode:"announce"}}),m.success("任务创建成功"),Q.value=!1,fe()}catch(n){m.error(n.response?.data?.error||"创建失败")}}async function bl(n){try{await P.update(n.id,n)}catch{m.error("更新失败")}}async function Oe(n){try{await P.run(n.id),m.success("已触发运行"),setTimeout(fe,2e3)}catch{m.error("运行失败")}}async function hl(n){try{await P.delete(n.id),m.success("已删除"),fe()}catch{m.error("删除失败")}}return(n,e)=>{const s=f("el-button"),g=f("el-tag"),T=f("el-text"),N=f("el-header"),v=f("el-option"),S=f("el-select"),V=f("el-input"),O=f("el-tab-pane"),z=f("el-card"),h=f("el-col"),D=f("el-row"),x=f("el-form-item"),pe=f("el-form"),wl=f("el-badge"),k=f("el-table-column"),ke=f("el-table"),Ce=f("el-switch"),xl=f("el-input-number"),Y=f("el-icon"),Ye=f("el-tree"),Pe=f("el-empty"),Je=f("el-breadcrumb-item"),kl=f("el-breadcrumb"),Ve=f("el-dialog"),Cl=f("el-tabs"),Vl=f("el-main"),zl=f("el-container"),Tl=Ll("loading");return d(),w(zl,{class:"agent-detail"},{default:t(()=>[l(N,{class:"detail-header"},{default:t(()=>[i("div",Ol,[l(s,{icon:$(Ul),onClick:e[0]||(e[0]=a=>n.$router.push("/agents")),circle:""},null,8,["icon"]),i("h2",null,r(E.value?.name||"..."),1),l(g,{type:il(E.value?.status)},{default:t(()=>[o(r(ul(E.value?.status)),1)]),_:1},8,["type"])]),l(T,{type:"info"},{default:t(()=>[o(r(E.value?.model),1)]),_:1})]),_:1}),l(Vl,null,{default:t(()=>[l(Cl,{modelValue:Ue.value,"onUpdate:modelValue":e[33]||(e[33]=a=>Ue.value=a),type:"border-card"},{default:t(()=>[l(O,{label:"对话",name:"chat"},{default:t(()=>[i("div",Yl,[i("div",Pl,[i("div",Jl,[e[35]||(e[35]=i("span",{class:"sidebar-title"},"历史对话",-1)),l(s,{size:"small",type:"primary",plain:"",onClick:Ge,icon:$(ze)},{default:t(()=>[...e[34]||(e[34]=[o("新建",-1)])]),_:1},8,["icon"])]),Ml((d(),c("div",Hl,[(d(!0),c(I,null,Z(te.value,a=>(d(),c("div",{key:a.id,class:Sl(["session-item",{active:L.value===a.id}]),onClick:A=>qe(a)},[i("div",Gl,r(a.title||"新对话"),1),i("div",Kl,[i("span",null,r(We(a.lastAt)),1),l(g,{size:"small",type:"info",effect:"plain",style:{"font-size":"10px",padding:"0 4px"}},{default:t(()=>[o(r(a.messageCount)+" 条 ",1)]),_:2},1024),a.tokenEstimate>6e4?(d(),w(g,{key:0,size:"small",type:"warning",effect:"plain",style:{"font-size":"10px",padding:"0 4px"}},{default:t(()=>[o("~"+r(Math.round(a.tokenEstimate/1e3))+"k",1)]),_:2},1024)):F("",!0)])],10,ql))),128)),!ae.value&&!te.value.length?(d(),c("div",Wl," 还没有对话记录 ")):F("",!0)])),[[Tl,ae.value]]),i("div",Ql,[l(s,{size:"small",plain:"",class:"at-toggle-btn",onClick:Qe},{default:t(()=>[...e[36]||(e[36]=[i("span",{class:"at-icon"},"@",-1),o(" 其他成员 ",-1)])]),_:1}),J.value?(d(),c("div",Xl,[l(S,{modelValue:H.value,"onUpdate:modelValue":e[1]||(e[1]=a=>H.value=a),placeholder:"选择成员",size:"small",style:{width:"100%","margin-bottom":"6px"},onChange:Xe},{default:t(()=>[(d(!0),c(I,null,Z(M.value,a=>(d(),w(v,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),l(V,{modelValue:q.value,"onUpdate:modelValue":e[2]||(e[2]=a=>q.value=a),type:"textarea",rows:3,placeholder:"输入要转发的消息…",size:"small",style:{"margin-bottom":"6px"}},null,8,["modelValue"]),l(s,{type:"primary",size:"small",style:{width:"100%"},loading:ve.value,disabled:!H.value||!q.value.trim(),onClick:Ze},{default:t(()=>[...e[37]||(e[37]=[o(" 转发 ",-1)])]),_:1},8,["loading","disabled"])])):F("",!0)])]),i("div",Zl,[l(Rl,{ref_key:"aiChatRef",ref:U,"agent-id":$(p),scenario:"agent-detail","welcome-message":`你好！我是 **${E.value?.name||"AI"}**，有什么可以帮你的？`,height:"calc(100vh - 145px)","show-thinking":!0,onSessionChange:Ke},null,8,["agent-id","welcome-message"])])])]),_:1}),l(O,{label:"身份 & 灵魂",name:"identity"},{default:t(()=>[l(D,{gutter:20},{default:t(()=>[l(h,{span:12},{default:t(()=>[l(z,{header:"IDENTITY.md"},{default:t(()=>[l(V,{modelValue:ne.value,"onUpdate:modelValue":e[3]||(e[3]=a=>ne.value=a),type:"textarea",rows:15,onBlur:e[4]||(e[4]=a=>xe("IDENTITY.md",ne.value))},null,8,["modelValue"])]),_:1})]),_:1}),l(h,{span:12},{default:t(()=>[l(z,{header:"SOUL.md"},{default:t(()=>[l(V,{modelValue:se.value,"onUpdate:modelValue":e[5]||(e[5]=a=>se.value=a),type:"textarea",rows:15,onBlur:e[6]||(e[6]=a=>xe("SOUL.md",se.value))},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),l(O,{label:"关系",name:"relations"},{default:t(()=>[l(D,{gutter:20},{default:t(()=>[l(h,{span:14},{default:t(()=>[l(z,{style:{"margin-bottom":"16px"}},{header:t(()=>[...e[38]||(e[38]=[i("span",{style:{"font-weight":"600"}},"添加关系",-1)])]),default:t(()=>[l(pe,{model:_.value,"label-position":"top",size:"default"},{default:t(()=>[l(D,{gutter:12},{default:t(()=>[l(h,{span:10},{default:t(()=>[l(x,{label:"关联成员"},{default:t(()=>[l(S,{modelValue:_.value.agentId,"onUpdate:modelValue":e[7]||(e[7]=a=>_.value.agentId=a),placeholder:"选择系统成员",filterable:"",style:{width:"100%"},onChange:al},{default:t(()=>[(d(!0),c(I,null,Z(M.value,a=>(d(),w(v,{key:a.id,label:a.name,value:a.id},{default:t(()=>[i("div",et,[i("div",{style:Te([{width:"24px",height:"24px","border-radius":"50%",display:"flex","align-items":"center","justify-content":"center","font-size":"11px",color:"#fff","flex-shrink":"0"},{background:we(a.id)}])},r(a.name.charAt(0)),5),i("span",null,r(a.name),1)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(h,{span:7},{default:t(()=>[l(x,{label:"关系类型"},{default:t(()=>[l(S,{modelValue:_.value.relationType,"onUpdate:modelValue":e[8]||(e[8]=a=>_.value.relationType=a),style:{width:"100%"}},{default:t(()=>[l(v,{label:"上级",value:"上级"}),l(v,{label:"下级",value:"下级"}),l(v,{label:"平级协作",value:"平级协作"}),l(v,{label:"支持",value:"支持"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(h,{span:7},{default:t(()=>[l(x,{label:"协作程度"},{default:t(()=>[l(S,{modelValue:_.value.strength,"onUpdate:modelValue":e[9]||(e[9]=a=>_.value.strength=a),style:{width:"100%"}},{default:t(()=>[l(v,{label:"核心",value:"核心"}),l(v,{label:"常用",value:"常用"}),l(v,{label:"偶尔",value:"偶尔"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(D,{gutter:12},{default:t(()=>[l(h,{span:18},{default:t(()=>[l(x,{label:"说明（选填）"},{default:t(()=>[l(V,{modelValue:_.value.desc,"onUpdate:modelValue":e[10]||(e[10]=a=>_.value.desc=a),placeholder:"简要描述这段关系..."},null,8,["modelValue"])]),_:1})]),_:1}),l(h,{span:6},{default:t(()=>[l(x,{label:" "},{default:t(()=>[l(s,{type:"primary",style:{width:"100%"},disabled:!_.value.agentId||!_.value.relationType||!_.value.strength,loading:he.value,onClick:nl},{default:t(()=>[...e[39]||(e[39]=[o(" 添加 ",-1)])]),_:1},8,["disabled","loading"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),l(z,null,{header:t(()=>[i("span",lt,[e[40]||(e[40]=o("已有关系 ",-1)),l(wl,{value:C.value.length,type:"info",style:{"margin-left":"4px"}},null,8,["value"])])]),default:t(()=>[C.value.length===0?(d(),c("div",tt," 暂无关系，请在上方添加 ")):(d(),w(ke,{key:1,data:C.value,size:"small",style:{width:"100%"}},{default:t(()=>[l(k,{label:"成员","min-width":"120"},{default:t(({row:a})=>[i("div",at,[i("div",{style:Te([{width:"28px",height:"28px","border-radius":"50%",display:"flex","align-items":"center","justify-content":"center","font-size":"12px",color:"#fff","flex-shrink":"0"},{background:we(a.agentId)}])},r(a.agentName.charAt(0)),5),i("span",nt,r(a.agentName),1)])]),_:1}),l(k,{label:"类型",width:"100"},{default:t(({row:a})=>[l(g,{type:Ee(a.relationType),size:"small"},{default:t(()=>[o(r(a.relationType),1)]),_:2},1032,["type"])]),_:1}),l(k,{label:"程度",width:"80"},{default:t(({row:a})=>[l(g,{type:Le(a.strength),size:"small",effect:"plain"},{default:t(()=>[o(r(a.strength),1)]),_:2},1032,["type"])]),_:1}),l(k,{label:"说明","min-width":"120","show-overflow-tooltip":""},{default:t(({row:a})=>[i("span",st,r(a.desc||"—"),1)]),_:1}),l(k,{label:"操作",width:"70",fixed:"right"},{default:t(({$index:a})=>[l(s,{type:"danger",link:"",size:"small",onClick:A=>sl(a)},{default:t(()=>[...e[41]||(e[41]=[o("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]))]),_:1})]),_:1}),l(h,{span:10},{default:t(()=>[l(z,{header:"关系预览"},{default:t(()=>[C.value.length===0?(d(),c("div",ot," 暂无关系数据 ")):(d(),c("div",it,[(d(!0),c(I,null,Z(C.value,a=>(d(),c("div",{key:a.agentId,class:"relation-card"},[i("div",{class:"relation-avatar",style:Te({background:we(a.agentId)})},r(a.agentName.charAt(0).toUpperCase()),5),i("div",ut,[i("div",dt,r(a.agentName),1),i("div",rt,[l(g,{type:Ee(a.relationType),size:"small"},{default:t(()=>[o(r(a.relationType),1)]),_:2},1032,["type"]),l(g,{type:Le(a.strength),size:"small",effect:"plain"},{default:t(()=>[o(r(a.strength),1)]),_:2},1032,["type"])]),i("div",mt,r(a.desc),1)])]))),128))]))]),_:1})]),_:1})]),_:1})]),_:1}),l(O,{label:"记忆",name:"memory"},{default:t(()=>[l(z,{style:{"margin-bottom":"16px"},shadow:"never"},{header:t(()=>[i("div",ft,[e[42]||(e[42]=i("span",{style:{"font-weight":"600"}},"自动记忆",-1)),l(Ce,{modelValue:y.value.enabled,"onUpdate:modelValue":e[11]||(e[11]=a=>y.value.enabled=a),"active-text":"已开启","inactive-text":"已关闭",onChange:Fe},null,8,["modelValue"])])]),default:t(()=>[l(pe,{model:y.value,"label-position":"top",size:"small",disabled:!y.value.enabled},{default:t(()=>[l(D,{gutter:16},{default:t(()=>[l(h,{span:6},{default:t(()=>[l(x,{label:"整理频率"},{default:t(()=>[l(S,{modelValue:y.value.schedule,"onUpdate:modelValue":e[12]||(e[12]=a=>y.value.schedule=a),style:{width:"100%"}},{default:t(()=>[l(v,{label:"每小时",value:"hourly"}),l(v,{label:"每6小时",value:"every6h"}),l(v,{label:"每天",value:"daily"}),l(v,{label:"每周",value:"weekly"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(h,{span:5},{default:t(()=>[l(x,{label:"每个会话保留轮数"},{default:t(()=>[l(xl,{modelValue:y.value.keepTurns,"onUpdate:modelValue":e[13]||(e[13]=a=>y.value.keepTurns=a),min:1,max:20,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),l(h,{span:13},{default:t(()=>[l(x,{label:"记录重点（留空则自动）"},{default:t(()=>[l(V,{modelValue:y.value.focusHint,"onUpdate:modelValue":e[14]||(e[14]=a=>y.value.focusHint=a),placeholder:"例如：记录数学解题步骤和用户常见错误"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),i("div",pt,[l(s,{type:"primary",size:"small",loading:ce.value,onClick:Fe},{default:t(()=>[...e[43]||(e[43]=[o(" 保存设置 ",-1)])]),_:1},8,["loading"]),l(s,{size:"small",loading:ye.value,onClick:ll},{default:t(()=>[...e[44]||(e[44]=[o(" 立即整理 ",-1)])]),_:1},8,["loading"]),l(T,{type:"info",size:"small",style:{"align-self":"center","margin-left":"4px"}},{default:t(()=>[o(" 整理后：LLM提炼摘要写入 MEMORY.md，每个会话只保留最近 "+r(y.value.keepTurns)+" 轮对话 ",1)]),_:1})])]),_:1},8,["model","disabled"])]),_:1}),l(z,{style:{"margin-bottom":"16px"},shadow:"never"},{header:t(()=>[i("div",vt,[e[46]||(e[46]=i("span",{style:{"font-weight":"600"}},"整理日志",-1)),l(s,{size:"small",text:"",onClick:ge,loading:ie.value},{default:t(()=>[...e[45]||(e[45]=[o("刷新",-1)])]),_:1},8,["loading"])])]),default:t(()=>[y.value.enabled?oe.value.length===0&&!ie.value?(d(),c("div",yt," 暂无运行记录 ")):(d(),w(ke,{key:2,data:oe.value.slice(0,10),size:"small"},{default:t(()=>[l(k,{label:"时间",width:"160"},{default:t(({row:a})=>[i("span",gt,r(je(a.startedAt)),1)]),_:1}),l(k,{label:"状态",width:"80"},{default:t(({row:a})=>[l(g,{type:a.status==="ok"?"success":"danger",size:"small"},{default:t(()=>[o(r(a.status),1)]),_:2},1032,["type"])]),_:1}),l(k,{label:"结果","min-width":"200","show-overflow-tooltip":""},{default:t(({row:a})=>[i("span",_t,r(a.output||a.error||"—"),1)]),_:1})]),_:1},8,["data"])):(d(),c("div",ct," 开启自动记忆后此处显示运行记录 "))]),_:1}),i("div",bt,[l(s,{type:"primary",size:"small",onClick:e[15]||(e[15]=a=>G.value=!0)},{default:t(()=>[l(Y,null,{default:t(()=>[l($(ze))]),_:1}),e[47]||(e[47]=o(" 新建文件 ",-1))]),_:1}),l(s,{size:"small",onClick:e[16]||(e[16]=a=>K.value=!0)},{default:t(()=>[l(Y,null,{default:t(()=>[l($(Fl))]),_:1}),e[48]||(e[48]=o(" 添加日志 ",-1))]),_:1}),l(s,{size:"small",onClick:X},{default:t(()=>[l(Y,null,{default:t(()=>[l($(Nl))]),_:1}),e[49]||(e[49]=o(" 刷新 ",-1))]),_:1})]),l(D,{gutter:16},{default:t(()=>[l(h,{span:7},{default:t(()=>[l(z,{header:"记忆目录",shadow:"hover"},{default:t(()=>[l(Ye,{data:ue.value,props:{label:"name",children:"children",isLeaf:a=>!a.isDir},onNodeClick:ml,"highlight-current":"","default-expand-all":"","expand-on-click-node":!1},{default:t(({data:a})=>[i("span",ht,[a.isDir?(d(),w(Y,{key:0,style:{color:"#E6A23C"}},{default:t(()=>[l($(Dl))]),_:1})):(d(),w(Y,{key:1,style:{color:"#409EFF"}},{default:t(()=>[l($(El))]),_:1})),i("span",null,r(a.name),1),!a.isDir&&a.size?(d(),w(T,{key:2,type:"info",size:"small",style:{"margin-left":"auto"}},{default:t(()=>[o(r(Re(a.size)),1)]),_:2},1024)):F("",!0)])]),_:1},8,["data","props"]),ue.value.length===0?(d(),w(Pe,{key:0,description:"记忆树为空","image-size":40})):F("",!0)]),_:1})]),_:1}),l(h,{span:17},{default:t(()=>[l(z,{shadow:"hover"},{header:t(()=>[i("div",wt,[l(kl,{separator:"/"},{default:t(()=>[l(Je,null,{default:t(()=>[...e[50]||(e[50]=[o("memory",-1)])]),_:1}),(d(!0),c(I,null,Z(be.value,(a,A)=>(d(),w(Je,{key:A},{default:t(()=>[o(r(a),1)]),_:2},1024))),128))]),_:1}),B.value?(d(),w(s,{key:0,type:"primary",size:"small",onClick:fl,loading:_e.value},{default:t(()=>[...e[51]||(e[51]=[o("保存",-1)])]),_:1},8,["loading"])):F("",!0)])]),default:t(()=>[B.value?(d(),w(V,{key:0,modelValue:R.value,"onUpdate:modelValue":e[17]||(e[17]=a=>R.value=a),type:"textarea",rows:22,style:{"font-family":"monospace"}},null,8,["modelValue"])):(d(),w(Pe,{key:1,description:"点击左侧文件查看和编辑","image-size":60}))]),_:1})]),_:1})]),_:1}),l(Ve,{modelValue:G.value,"onUpdate:modelValue":e[20]||(e[20]=a=>G.value=a),title:"新建记忆文件",width:"480px"},{footer:t(()=>[l(s,{onClick:e[19]||(e[19]=a=>G.value=!1)},{default:t(()=>[...e[53]||(e[53]=[o("取消",-1)])]),_:1}),l(s,{type:"primary",onClick:pl},{default:t(()=>[...e[54]||(e[54]=[o("创建",-1)])]),_:1})]),default:t(()=>[l(pe,{"label-width":"80px"},{default:t(()=>[l(x,{label:"路径"},{default:t(()=>[l(V,{modelValue:de.value,"onUpdate:modelValue":e[18]||(e[18]=a=>de.value=a),placeholder:"例如: projects/my-project.md 或 topics/cooking.md"},null,8,["modelValue"]),l(T,{type:"info",size:"small",style:{"margin-top":"4px"}},{default:t(()=>[...e[52]||(e[52]=[o("相对于 memory/ 目录",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(Ve,{modelValue:K.value,"onUpdate:modelValue":e[23]||(e[23]=a=>K.value=a),title:"添加今日日志",width:"600px"},{footer:t(()=>[l(s,{onClick:e[22]||(e[22]=a=>K.value=!1)},{default:t(()=>[...e[55]||(e[55]=[o("取消",-1)])]),_:1}),l(s,{type:"primary",onClick:vl},{default:t(()=>[...e[56]||(e[56]=[o("提交",-1)])]),_:1})]),default:t(()=>[l(V,{modelValue:re.value,"onUpdate:modelValue":e[21]||(e[21]=a=>re.value=a),type:"textarea",rows:10,placeholder:"记录今天的重要事项、学习心得、待办..."},null,8,["modelValue"])]),_:1},8,["modelValue"])]),_:1}),l(O,{label:"工作区",name:"workspace"},{default:t(()=>[l(D,{gutter:20},{default:t(()=>[l(h,{span:8},{default:t(()=>[l(z,{header:"文件列表"},{default:t(()=>[l(Ye,{data:Ne.value,props:{label:"name",children:"children"},onNodeClick:yl,"highlight-current":"","default-expand-all":""},null,8,["data"])]),_:1})]),_:1}),l(h,{span:16},{default:t(()=>[l(z,{header:j.value||"选择文件查看"},{default:t(()=>[j.value?(d(),c(I,{key:0},[l(V,{modelValue:W.value,"onUpdate:modelValue":e[24]||(e[24]=a=>W.value=a),type:"textarea",rows:20},null,8,["modelValue"]),i("div",xt,[l(s,{type:"primary",onClick:gl},{default:t(()=>[...e[57]||(e[57]=[o("保存",-1)])]),_:1}),me.value?(d(),w(T,{key:0,type:"info",size:"small"},{default:t(()=>[o(r(Re(me.value.size))+" · "+r(dl(me.value.modTime)),1)]),_:1})):F("",!0)])],64)):F("",!0)]),_:1},8,["header"])]),_:1})]),_:1})]),_:1}),l(O,{label:"定时任务",name:"cron"},{default:t(()=>[l(s,{type:"primary",onClick:e[25]||(e[25]=a=>Q.value=!0),style:{"margin-bottom":"16px"}},{default:t(()=>[l(Y,null,{default:t(()=>[l($(ze))]),_:1}),e[58]||(e[58]=o(" 新建任务 ",-1))]),_:1}),l(ke,{data:Be.value,stripe:""},{default:t(()=>[l(k,{prop:"name",label:"名称"}),l(k,{label:"调度"},{default:t(({row:a})=>[o(r(a.schedule?.expr)+" ("+r(a.schedule?.tz)+")",1)]),_:1}),l(k,{label:"最近运行",width:"180"},{default:t(({row:a})=>[a.state?.lastRunAtMs?(d(),c(I,{key:0},[l(g,{type:a.state?.lastStatus==="ok"?"success":"danger",size:"small"},{default:t(()=>[o(r(a.state?.lastStatus),1)]),_:2},1032,["type"]),l(T,{type:"info",size:"small",style:{"margin-left":"4px"}},{default:t(()=>[o(r(je(a.state?.lastRunAtMs)),1)]),_:2},1024)],64)):(d(),w(T,{key:1,type:"info",size:"small"},{default:t(()=>[...e[59]||(e[59]=[o("未运行",-1)])]),_:1}))]),_:1}),l(k,{label:"启用",width:"80"},{default:t(({row:a})=>[l(Ce,{modelValue:a.enabled,"onUpdate:modelValue":A=>a.enabled=A,onChange:A=>bl(a)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),l(k,{label:"操作",width:"220"},{default:t(({row:a})=>[a.payload?.message==="__MEMORY_CONSOLIDATE__"?(d(),c(I,{key:0},[l(g,{type:"info",size:"small",style:{"margin-right":"8px"}},{default:t(()=>[...e[60]||(e[60]=[o("记忆管理",-1)])]),_:1}),l(s,{size:"small",onClick:A=>Oe(a)},{default:t(()=>[...e[61]||(e[61]=[o("立即运行",-1)])]),_:1},8,["onClick"])],64)):(d(),c(I,{key:1},[l(s,{size:"small",onClick:A=>Oe(a)},{default:t(()=>[...e[62]||(e[62]=[o("立即运行",-1)])]),_:1},8,["onClick"]),l(s,{size:"small",type:"danger",onClick:A=>hl(a)},{default:t(()=>[...e[63]||(e[63]=[o("删除",-1)])]),_:1},8,["onClick"])],64))]),_:1})]),_:1},8,["data"]),l(Ve,{modelValue:Q.value,"onUpdate:modelValue":e[32]||(e[32]=a=>Q.value=a),title:"新建定时任务",width:"520px"},{footer:t(()=>[l(s,{onClick:e[31]||(e[31]=a=>Q.value=!1)},{default:t(()=>[...e[64]||(e[64]=[o("取消",-1)])]),_:1}),l(s,{type:"primary",onClick:_l},{default:t(()=>[...e[65]||(e[65]=[o("创建",-1)])]),_:1})]),default:t(()=>[l(pe,{model:b.value,"label-width":"100px"},{default:t(()=>[l(x,{label:"名称"},{default:t(()=>[l(V,{modelValue:b.value.name,"onUpdate:modelValue":e[26]||(e[26]=a=>b.value.name=a)},null,8,["modelValue"])]),_:1}),l(x,{label:"Cron 表达式"},{default:t(()=>[l(V,{modelValue:b.value.expr,"onUpdate:modelValue":e[27]||(e[27]=a=>b.value.expr=a),placeholder:"30 3 * * *"},null,8,["modelValue"])]),_:1}),l(x,{label:"时区"},{default:t(()=>[l(S,{modelValue:b.value.tz,"onUpdate:modelValue":e[28]||(e[28]=a=>b.value.tz=a)},{default:t(()=>[l(v,{label:"Asia/Shanghai",value:"Asia/Shanghai"}),l(v,{label:"UTC",value:"UTC"}),l(v,{label:"America/New_York",value:"America/New_York"})]),_:1},8,["modelValue"])]),_:1}),l(x,{label:"消息"},{default:t(()=>[l(V,{modelValue:b.value.message,"onUpdate:modelValue":e[29]||(e[29]=a=>b.value.message=a),type:"textarea",rows:3},null,8,["modelValue"])]),_:1}),l(x,{label:"启用"},{default:t(()=>[l(Ce,{modelValue:b.value.enabled,"onUpdate:modelValue":e[30]||(e[30]=a=>b.value.enabled=a)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})}}}),$t=jl(kt,[["__scopeId","data-v-ce19f56d"]]);export{$t as default};
